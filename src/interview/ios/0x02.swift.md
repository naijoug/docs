---
title: Swift
icon: hashtag

index: true

---

<!-- more -->
  
## ç»“æ„ä½“ä¸ç±»

### â“`Swift` ç»“æ„ä½“ä¸ç±»çš„åŒºåˆ«

::: details ğŸ’¡

  - å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼šç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼›ç±»æ˜¯å¼•ç”¨ç±»å‹ã€‚
    
    ä¸€ä¸ªç»“æ„ä½“å®ä¾‹è¢«èµ‹å€¼ç»™ä¸€ä¸ªæ–°çš„å˜é‡æˆ–è€…ä½œä¸ºä¸€ä¸ªå‡½æ•°çš„å‚æ•°ä¼ é€’æ—¶ï¼Œè¿™ä¸ªå®ä¾‹çš„æ‹·è´ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥æ”¹å˜æ–°å˜é‡ä¸­çš„å€¼ä¸ä¼šå½±å“åŸæ¥çš„å®ä¾‹ã€‚
    ä¸€ä¸ªç±»å®ä¾‹èµ‹å€¼å®é™…ä¸Šæ˜¯ä¼ é€’äº†ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥ä¿®æ”¹èµ‹å€¼åçš„å®ä¾‹ä¹Ÿä¼šå½±å“åˆ°åŸæ¥çš„å®ä¾‹ã€‚
    
  - ç»§æ‰¿ï¼šç»“æ„ä½“ä¸èƒ½ç»§æ‰¿å…¶ä»–çš„ç»“æ„ä½“æˆ–è€…ç±»ï¼›ç±»å¯ä»¥ç»§æ‰¿å…¶ä»–çš„ç±»ã€‚
  
  - ç±»å‹è½¬åŒ–ï¼šç»“æ„ä½“ä¸èƒ½ï¼›ç±»å¯ä»¥è¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨ `is` å’Œ `as` æ“ä½œç¬¦åœ¨è¿è¡Œæ—¶æ£€æŸ¥å®ä¾‹çš„ç±»å‹ã€‚
  
  - ææ„å‡½æ•°ï¼šç»“æ„ä½“æ²¡æœ‰ï¼›ç±»æœ‰ææ„å‡½æ•°ï¼Œç”¨æ¥åœ¨ç±»å®ä¾‹è¢«é”€æ¯å‰æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚
  
  - å¼•ç”¨è®¡æ•°ï¼šç»“æ„ä½“æ²¡æœ‰ï¼›ç±»é€šè¿‡å¼•ç”¨è®¡æ•°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ 
  
  - åè®®ï¼šç±»å’Œç»“æ„ä½“éƒ½å¯ä»¥å®ç°åè®®ï¼Œä½†æ˜¯ç±»å¯ä»¥åˆ©ç”¨æŸäº›ç‰¹å®šçš„åè®®æä¾›çš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚
  
:::

### â“`Swift` ä¸­çš„ `pwt`ã€`vwt`

::: details ğŸ’¡

> `pwt` å’Œ `vwt` æ˜¯ `Swift` çš„åº•å±‚å®ç°ä¸Šæ–‡ä¸­çš„æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ `PropertyWitnessTable` å’Œ `ValueWitnessTable` çš„ç®€å†™ã€‚

  - `pwt`ï¼ˆProperty Witness Tableï¼‰ï¼šå±æ€§è§è¯è¡¨
    > å±æ€§è§è¯è¡¨åŒ…å«äº†å±æ€§çš„ä¸€äº›åŸºç¡€ä¿¡æ¯å’Œæ“ä½œå‡½æ•°ï¼Œå¦‚ `destroy`ã€`initialize`ã€`get`ç­‰ã€‚`pwt` åœ¨ `Swift` ä¸­ä¸ºåè®®æ‰©å±•ä»¥åŠæ³›å‹ç¼–ç¨‹æä¾›äº†å¯èƒ½ã€‚
    
  - `vwt`ï¼ˆValue Witness Tableï¼‰ï¼šå€¼è§è¯è¡¨
    > å€¼è§è¯è¡¨æ˜¯ä¸€ä¸ªç»“æ„ä½“çš„å…ƒä¿¡æ¯çš„é›†åˆã€‚å®ƒåŒ…å«äº†æè¿°å¯¹è±¡å¦‚ä½•å¤åˆ¶ã€é”€æ¯çš„å‡½æ•°æŒ‡é’ˆï¼Œä»¥åŠå¯¹è±¡çš„å¤§å°å’Œå¯¹é½æ–¹å¼ç­‰ä¿¡æ¯ã€‚æ¯ä¸ª `Swift` å¯å–å€¼ç±»å‹ï¼Œæ¯”å¦‚ `structï¼Œenumï¼Œtuple` ç­‰ï¼Œéƒ½æœ‰å¯¹åº”çš„å€¼è§è¯è¡¨ã€‚å½“éœ€è¦è¿›è¡Œä¸€äº›å†…å­˜æ“ä½œæ—¶ï¼Œå¦‚å¤åˆ¶ã€é”€æ¯ã€ç§»åŠ¨å†…å­˜ç­‰ï¼Œä¾¿ä¼šè°ƒç”¨å®ƒä»¬å¯¹åº”çš„ `Value Witness Table` ä¸­çš„å‡½æ•°æ¥è¿›è¡Œæ“ä½œã€‚
    
æ€»ç»“ï¼šè¿™äº›è¡¨åœ¨ç¼–è¯‘æ—¶å°±ä¼šç”Ÿæˆï¼Œå¹¶é™„ç€åœ¨æ¯ä¸ªç±»å‹çš„å…ƒæ•°æ®ä¸Šã€‚åœ¨è¿è¡Œæ—¶ï¼Œå½“ç±»å‹éœ€è¦å¯¹è‡ªèº«çš„å±æ€§æˆ–è€…å€¼è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™äº›è¡¨ä¸­çš„å‡½æ•°ã€‚å®ƒä»¬æ˜¯ `Swift` åœ¨æ³›å‹å’Œåè®®ä¸Šé¢åšåˆ°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡çš„å…³é”®æ‰€åœ¨ã€‚

:::

### ç»“æ„ä½“

#### â“`Swift` ä¸­ `Array`ã€`Dictionary`ã€`Set` ä¸ºä»€ä¹ˆè®¾è®¡æˆå€¼ç±»å‹

::: details ğŸ’¡

  - è¯­ä¹‰æ¸…æ™°
    > å¯ä»¥ä½¿èµ‹å€¼çš„è¯­ä¹‰æ›´åŠ æ¸…æ™°ã€‚å½“ä½ æŠŠä¸€ä¸ªæ•°ç»„ï¼ˆæˆ–å­—å…¸ã€é›†åˆï¼‰èµ‹å€¼ç»™æ–°çš„å˜é‡æ—¶ï¼Œ`Swift` å®é™…ä¸Šä¼šå¤åˆ¶ä¸€ä»½è¿™ä¸ªæ•°ç»„ï¼Œè¿™æ„å‘³ç€æ–°å˜é‡å’Œæ—§å˜é‡ä¹‹é—´ä¸å­˜åœ¨ä»»ä½•å…³è”ï¼Œå¯¹å…¶ä¸­ä¸€ä¸ªçš„æ”¹åŠ¨ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚
  
  - çº¿ç¨‹å®‰å…¨
    > åœ¨æ¶‰åŠå¤šçº¿ç¨‹æ“ä½œçš„ç¯å¢ƒä¸­ï¼Œæ— éœ€æ‹…å¿ƒå¯¹æ•°ç»„ï¼ˆæˆ–å­—å…¸ã€é›†åˆï¼‰çš„ä¿®æ”¹ä¼šæ½œåœ¨åœ°å½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚æœ‰åˆ©äºå‡å°‘ç”±ç«æ€æ¡ä»¶ï¼ˆrace conditionï¼‰å¯¼è‡´çš„é—®é¢˜ï¼Œå¹¶ä½¿å¾—ä»£ç æ›´åŠ å®‰å…¨ã€‚
  
  - æ€§èƒ½ä¼˜åŒ–
    > è™½ç„¶å€¼ç±»å‹åœ¨èµ‹å€¼æ—¶éœ€è¦å¤åˆ¶å…¶æ•°æ®ï¼Œä½† `Swift` é‡‡ç”¨äº†ä¸€ç§è¢«ç§°ä¸ºâ€œå†™æ—¶å¤åˆ¶â€ï¼ˆcopy-on-writeï¼‰çš„ä¼˜åŒ–ç­–ç•¥ã€‚åªæœ‰å½“æ•°æ®çœŸæ­£éœ€è¦è¢«æ”¹åŠ¨æ—¶ï¼Œ`Swift` æ‰ä¼šå¤åˆ¶ä¸€ä»½æ•°æ®ï¼Œé¿å…äº†ä¸å¿…è¦çš„å¤åˆ¶æ“ä½œã€‚

:::

#### â“`cow` è®¾è®¡è¯´ä¸€ä¸‹

::: details ğŸ’¡

  `cow` (Copy on Write) : Swift çš„å†™æ—¶æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®åªæœ‰ç­‰åˆ°èµ‹å€¼ä¿®æ”¹æ—¶æ‰è¿›è¡Œæ‹·è´ï¼Œä¸»è¦åº”ç”¨åœ¨ç³»ç»Ÿè®¾è®¡çš„å€¼ç±»å‹(`String`ã€`Array`ã€`Dictionary`)

:::
  
  > `isKnownUniquelyReferenced` å®ç°è‡ªå®šä¹‰ç»“æ„ä½“ `cow`
  
::: details ğŸ’¡
  
  `isKnownUniquelyReferenced` å‡½æ•°å¯ä»¥ç”¨æ¥æ£€æµ‹æ˜¯è¢«è¢«å¤šä¸ªå˜é‡å¼•ç”¨
  
  ```swift
  // æ•°æ®åŒ…è£…ç±»
  final class Wrapper<A> {
    var wrapper: A
    init(_ value: A) { 
        self.wrapper = value 
    }
  }
  struct MyArray {
    private var storage: Wrapper<[Int]>
    init() {
        storage = Box([1, 2, 3])
    }
    /// æ·»åŠ æ•°æ®
    mutating func append(_ item: Int) {
        // åˆ¤æ–­æ˜¯å¦ä¸ºå”¯ä¸€çš„å¼•ç”¨ï¼Œå¦‚æœä¸æ˜¯ï¼Œå…ˆåˆ›å»ºå‰¯æœ¬å¯¹è±¡ï¼Œåœ¨è¿›è¡Œæ·»åŠ ä¿®æ”¹
        if !isKnownUniquelyReferenced(&storage) {
            storage = Wrapper(storage.wrapper)
        }
        storage.wapper.append(item)
    }
  }
  ```
  
:::

### ç±»

#### â“`Swift` ä¸­çš„åˆå§‹åŒ–æ–¹æ³•

::: details ğŸ’¡

> åˆå§‹åŒ–æ–¹æ³•æ˜¯ç”¨æ¥ç¡®ä¿ç±»å‹å®ä¾‹ä¸­çš„æ‰€æœ‰å­˜å‚¨å±æ€§éƒ½è¢«èµ‹äºˆåˆå§‹å€¼çš„ç‰¹æ®Šæ–¹æ³•ã€‚

`Swift` çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­æœ‰ä¸¤ä¸ªé˜¶æ®µï¼š

  - ç¬¬ä¸€é˜¶æ®µæ˜¯ä¸ºæ¯ä¸ªå­˜å‚¨å‹å±æ€§è®¾ç½®åˆå§‹å€¼ã€‚å½“æ¯ä¸ªå­˜å‚¨å‹å±æ€§çš„åˆå§‹å€¼è¢«ç¡®å®šå
  - ç¬¬äºŒé˜¶æ®µå¼€å§‹ï¼Œå®ƒå…è®¸äººä»¬å¯ä»¥è‡ªå®šä¹‰ä»–ä»¬çš„å­˜å‚¨å‹å±æ€§ã€‚

`Swift` çš„æ„é€ å™¨åˆ†ä¸ºä¸¤ç§ï¼šæŒ‡å®šæ„é€ å™¨å’Œä¾¿åˆ©æ„é€ å™¨ã€‚

  - æŒ‡å®šæ„é€ å™¨ï¼šç±»ä¸­æœ€ä¸»è¦çš„æ„é€ å™¨ï¼Œä¸€ä¸ªç±»å¿…é¡»æ‹¥æœ‰è‡³å°‘ä¸€ä¸ªæŒ‡å®šæ„é€ å™¨ã€‚
  - ä¾¿åˆ©æ„é€ å™¨ï¼šç±»ä¸­æ¯”è¾ƒæ¬¡è¦çš„ï¼Œè¾…åŠ©å‹çš„æ„é€ å™¨ã€‚å®ƒé€šå¸¸åœ¨ä¸ºæŸä¸ªç‰¹å®šä½¿ç”¨åœºæ™¯æˆ–è€…ç‰¹å®šè¾“å…¥å€¼æä¾›æ„é€ æ–¹ä¾¿ã€‚

```swift
class MyClass {
    var name: String

    // æŒ‡å®šæ„é€ å™¨
    init(name: String) {
        self.name = name
    }
    
    // ä¾¿åˆ©æ„é€ å™¨
    convenience init() {
        self.init(name: "[Unnamed]")
    }
}
```

:::

#### â“`static` å’Œ `class` çš„åŒºåˆ«

::: details ğŸ’¡

  `static` å’Œ `class` éƒ½å¯ä»¥ç”¨æ¥å£°æ˜ç±»å‹çº§åˆ«çš„æ–¹æ³•æˆ–å±æ€§ã€‚

  - `static` å¯ä»¥ç”¨äºç±»ã€ç»“æ„ä½“å’Œæšä¸¾ï¼Œå£°æ˜é™æ€æ–¹æ³•å’Œé™æ€å±æ€§ã€‚å¯¹äºé™æ€æ–¹æ³•å’Œå±æ€§ï¼Œæ— è®ºæ˜¯åœ¨ç±»è¿˜æ˜¯åœ¨ç±»çš„å®ä¾‹ä¸­ï¼Œéƒ½æ˜¯å…±äº«åŒä¸€ä¸ªå­˜å‚¨ç©ºé—´ã€‚å¯¹äºä½¿ç”¨ `static` å£°æ˜çš„è®¡ç®—å±æ€§æˆ–æ–¹æ³•ï¼Œæ— æ³•åœ¨å­ç±»ä¸­è¿›è¡Œé‡å†™ã€‚è¿™æ˜¯å› ä¸º `static` å£°æ˜çš„å±æ€§å’Œæ–¹æ³•è¢«ç»‘å®šåˆ°äº†å®ƒä»¬è¢«å£°æ˜çš„ç±»å‹ä¸Šã€‚

    ```swift
    class MyClass {
        static var myStaticProperty: Int {
            return 1
        }
    }
    ```

  - `class` å…³é”®å­—åªèƒ½ç”¨äºç±»ï¼Œç”¨äºå£°æ˜ç±»æ–¹æ³•å’Œç±»å±æ€§ã€‚ä½¿ç”¨ `class` å…³é”®å­—æ ‡è®°çš„è®¡ç®—å±æ€§æˆ–è€…æ–¹æ³•å¯ä»¥åœ¨å­ç±»ä¸­è¿›è¡Œé‡å†™ã€‚

    ```swift
    class MySuperClass {
        class var myClassProperty: Int {
            return 1
        }
    }
    
    class MySubClass: MySuperClass {
        override class var myClassProperty: Int {
            return 2
        }
    }
    ```

:::

### å±æ€§

#### â“å­˜å‚¨å±æ€§ä¸è®¡ç®—å±æ€§åŒºåˆ«

::: details ğŸ’¡

  - **å­˜å‚¨å±æ€§**ï¼šé¡¾åæ€ä¹‰ï¼Œå­˜å‚¨å±æ€§æ˜¯æŸä¸ªç‰¹å®šç±»æˆ–ç»“æ„ä½“å®ä¾‹æ‰€å­˜å‚¨çš„ä¸€ä¸ªå€¼ï¼Œå¦‚ `Intã€Stringã€Double` ç±»å‹çš„å¸¸é‡æˆ–å˜é‡ã€‚è¿™ä¸ªå€¼å¯èƒ½æ˜¯å®šä¹‰æ—¶ç›´æ¥èµ‹å€¼çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼ã€‚

    ```swift
    // Point ç»“æ„ä½“æœ‰ä¸¤ä¸ªå­˜å‚¨å±æ€§ x å’Œ yã€‚
    struct Point {
        var x = 0.0
        var y = 0.0
    }
    var point = Point(x: 5.0, y: 5.0)
    ```

  - **è®¡ç®—å±æ€§**ï¼šè®¡ç®—å±æ€§å¹¶ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ª `getter` å’Œä¸€ä¸ªå¯é€‰çš„ `setter` æ¥é—´æ¥è·å–å’Œè®¾ç½®å…¶ä»–å±æ€§æˆ–è€…å˜é‡çš„å€¼ã€‚

    ```swift
    struct Rectangle {
        var width = 0.0
        var height = 0.0
    
        // Rectangle ç»“æ„ä½“æœ‰ä¸€ä¸ªè®¡ç®—å±æ€§ area
        var area: Double {
            get { // é€šè¿‡ width å’Œ height è®¡ç®—å¾—æ¥
                return width * height
            }
            set { // å¯ä»¥é€šè¿‡è®¾ç½® area çš„å€¼é—´æ¥ä¿®æ”¹ width å’Œ height çš„å€¼
                width = sqrt(newValue)
                height = sqrt(newValue)
            }
        }
    }
    ```

  > æ€»ç»“ï¼šå­˜å‚¨å±æ€§æ˜¯å­˜å‚¨åœ¨ç‰¹å®šç±»æˆ–ç»“æ„ä½“å®ä¾‹ä¸­çš„ä¸€ä¸ªå¸¸é‡æˆ–å˜é‡ï¼›è®¡ç®—å±æ€§åˆ™æ˜¯é€šè¿‡è®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªå€¼ã€‚

:::

#### â“å»¶è¿Ÿå­˜å‚¨å±æ€§

::: details ğŸ’¡

  > å»¶è¿Ÿå­˜å‚¨å±æ€§ï¼ˆ`Lazy Stored Properties`ï¼‰æ˜¯æŒ‡å½“å±æ€§é¦–æ¬¡è¢«è°ƒç”¨æ—¶æ‰è®¡ç®—å…¶åˆå§‹å€¼çš„å±æ€§ã€‚åœ¨å±æ€§å£°æ˜å‰æ·»åŠ  `lazy` å…³é”®å­—æ¥è¡¨ç¤ºä¸€ä¸ªå»¶è¿Ÿå­˜å‚¨å±æ€§ã€‚

ä½¿ç”¨åœºæ™¯ï¼š

  - å±æ€§åˆå§‹åŒ–æ¶ˆè€—å¤§ï¼Œä½†åˆå¯èƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚
  - å±æ€§çš„å€¼ä¾èµ–äºå®ä¾‹çš„å…¶ä»–å±æ€§ï¼Œä½†æ˜¯åˆéœ€è¦åœ¨å®ä¾‹å®Œå…¨åˆå§‹åŒ–ä»¥åæ‰èƒ½è·å–ã€‚

```swift
class DataImporter {
    
    /*
    DataImporter æ˜¯ä¸€ä¸ªè´Ÿè´£å°†å¤–éƒ¨æ–‡ä»¶ä¸­çš„æ•°æ®å¯¼å…¥çš„ç±»ã€‚
    è¿™ä¸ªç±»çš„åˆå§‹åŒ–ä¼šæ¶ˆè€—ä¸å°‘æ—¶é—´ã€‚
    */
    var fileName = "data.txt"
    // å¯¼å…¥æ•°æ®çš„ä»£ç ......
}

class DataManager {
    lazy var importer = DataImporter()
    var data = [String]()
    // å…¶ä»–æ•°æ®ç®¡ç†ä»£ç ......
}

let manager = DataManager()
manager.data.append("Some data")
// 'importer' å±æ€§å°šæœªè¢«åˆ›å»º
print(manager.importer.fileName)
// 'importer' å±æ€§ç°åœ¨è¢«åˆ›å»ºäº†
// è¾“å‡º "data.txtâ€
```

:::
  
------

## å­—ç¬¦ä¸²

### â“`Swift` ä¸­çš„ `String` çš„è®¾è®¡ç†å¿µ

::: details ğŸ’¡
 
  > è®¾è®¡ç†å¿µï¼šå®‰å…¨ã€ç®€æ´ã€ç°ä»£ã€æ˜“ç”¨ã€‚
    
  - å®‰å…¨æ€§ï¼šå­—ç¬¦ä¸²è¢«è®¾è®¡ä¸ºå€¼ç±»å‹ï¼›æ— æ³•é€šè¿‡ä¸‹æ ‡ç´¢å¼•æ¥è®¿é—®å­—ç¬¦ï¼Œéœ€è¦ä½¿ç”¨ `String.Index` ç±»å‹çš„ç´¢å¼•è¿›è¡Œå­—ç¬¦ä¸²çš„è®¿é—®å’Œæ“ä½œã€‚
 
  - ç®€æ´æ€§ï¼šä¸»è¦ä½“ç°åœ¨å†…ç½®çš„å­—ç¬¦ä¸²ç›¸å…³ `API` ä¸Šï¼Œç®€åŒ–äº† `OC` é—ç•™çš„æ¥å£åç§°å†—é•¿çš„é—®é¢˜ã€‚
 
  - ç°åœ°åŒ–ï¼šæ”¯æŒ `Unicode`ï¼Œå¯ä»¥å¤„ç†å¤šæ ·åŒ–çš„æ–‡æœ¬å†…å®¹ã€‚è¿™æ˜¯å› ä¸ºåœ¨ `Swift` ä¸­ `String` ç±»å‹ä»¥ `UTF-16` çš„å½¢å¼å­˜å‚¨ã€‚

  - æ˜“ç”¨æ€§ï¼šå¯ä»¥è·Ÿä¸€èˆ¬çš„åŸºæœ¬ç±»å‹å€¼ä¸€æ ·ï¼Œç›´æ¥è¿›è¡Œâ€œ+â€ã€â€œ+=â€è¿ç®—ç¬¦çš„æ“ä½œï¼Œè¿˜æœ‰å„ç§å†…ç½®çš„å¤„ç†å­—ç¬¦ä¸²çš„ `API`ï¼Œå¦‚ï¼šå¤§å°å†™è½¬åŒ–ï¼Œå»é™¤å‰åç©ºæ ¼ç­‰ã€‚

:::

### â“ä¸ºä»€ä¹ˆ `Swift` å°† `String` è®¾è®¡ä¸ºä¸èƒ½é€šè¿‡ç´¢å¼•è®¿é—®

::: details ğŸ’¡

  å› ä¸º `Swift` ä¸­çš„ `String` å…¼å®¹ `Unicode` å­—ç¬¦ä¸²çš„ã€‚

  åœ¨ `Unicode` ä¸­ï¼Œå­—ç¬¦çš„é•¿åº¦å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼ˆä¾‹å¦‚ï¼ŒæŸäº› `emoji` è¡¨æƒ…å­—ç¬¦ç”±å¤šä¸ª `Unicode` ç»„æˆï¼‰ï¼Œæ‰€ä»¥é‡‡ç”¨æ•´æ•°ç´¢å¼•å¯èƒ½ä¼šå°†å­—ç¬¦ä¸²æˆªæ–­ï¼Œå¯¼è‡´å­—ç¬¦ä¸å®Œæ•´ï¼Œç”šè‡³å¯¼è‡´å´©æºƒã€‚

:::

### â“å¦‚ä½•è¯„ä»· `String` çš„ç´¢å¼•è®¾è®¡

::: details ğŸ’¡

  åœ¨ `Swift` ä¸­ `String` çš„ç´¢å¼•è®¾è®¡æ˜¯ä¸ºäº†å¤„ç† `Unicode` å­—ç¬¦ä¸²çš„å¤æ‚æ€§ã€‚

  å­—ç¬¦ä¸²æ˜¯ç”± `Unicode` å­—ç¬¦ç»„æˆçš„ï¼Œè€Œ `Unicode` å­—ç¬¦çš„é•¿åº¦æ˜¯ä¸å›ºå®šçš„ã€‚æœ‰çš„ `Unicode` å­—ç¬¦å¯èƒ½ç”±ä¸€ä¸ª `Unicode` æ ‡é‡ï¼ˆscalarï¼‰æ„æˆï¼Œè€Œæœ‰çš„ `Unicode` å­—ç¬¦å¯èƒ½ç”±å¤šä¸ª `Unicode` æ ‡é‡æ„æˆã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªå¯è§†å­—ç¬¦å¯èƒ½ç”±å¤šä¸ª `Unicode` å­—ç¬¦æ„æˆï¼Œä¾‹å¦‚å¸¦é‡éŸ³çš„å­—æ¯ã€‚

  å› æ­¤åœ¨ `Swift` ä¸­ï¼Œ`String` çš„ç´¢å¼•ä¸èƒ½ç®€å•åœ°ç”¨æ•´æ•°è¡¨ç¤ºã€‚å¦‚æœç”¨æ•´æ•°è¡¨ç¤ºï¼Œä¼šå¯¼è‡´å–å­—ç¬¦çš„æ“ä½œæˆä¸ºä¸€ä¸ª `O(n)` æ—¶é—´å¤æ‚åº¦çš„æ“ä½œï¼Œå› ä¸ºå¿…é¡»ä»å¤´å¼€å§‹éå†å­—ç¬¦ä¸²è·å¾—æŒ‡å®šç´¢å¼•çš„å­—ç¬¦ã€‚æ­¤å¤–ï¼Œç”±äº `Unicode` å­—ç¬¦é•¿åº¦çš„ä¸å›ºå®šæ€§ï¼Œå¦‚æœç”¨æ•´æ•°åšç´¢å¼•è¿˜å¯èƒ½ä¼šé€ æˆç´¢å¼•è¶Šç•Œçš„é”™è¯¯ã€‚

  ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œ`Swift` è®¾è®¡äº† `String.Index` æ¥ä½œä¸ºå­—ç¬¦ä¸²çš„ç´¢å¼•ã€‚`String.Index` å°è£…äº†å¯¹åº•å±‚å­—ç¬¦ä¸²å­˜å‚¨çš„è®¿é—®ï¼Œå¯ä»¥é«˜æ•ˆä¸”å®‰å…¨åœ°è¿›è¡Œå­—ç¬¦çš„è®¿é—®ã€‚åªèƒ½é€šè¿‡ç‰¹å®šçš„æ–¹æ³•(æ¯”å¦‚`index(after:)`æˆ–è€…`index(before:)`ç­‰)æ¥æ“ä½œç´¢å¼•ï¼Œè¿™æœ‰åŠ©äºä¿è¯å­—ç¬¦ä¸²çš„è®¿é—®å®‰å…¨æ€§ã€‚

  è™½ç„¶è¿™ç§è®¾è®¡ä½¿å¾—å¤„ç†å­—ç¬¦ä¸²çš„ç´¢å¼•å˜å¾—ç¨å¾®æœ‰äº›ç¹çï¼Œä½†æ˜¯å´èƒ½æœ‰æ•ˆåœ°å¤„ç† `Unicode` å­—ç¬¦ä¸²çš„å¤æ‚æ€§ï¼Œä¿è¯å­—ç¬¦ä¸²æ“ä½œçš„å®‰å…¨æ€§å’Œæ•ˆç‡ï¼Œé¿å…äº†è¯¸å¤šå¸¸è§çš„é”™è¯¯ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è¯´ `String` çš„ç´¢å¼•è®¾è®¡æ˜¯éå¸¸ä¼˜ç§€å’Œåˆ‡å®å¯è¡Œçš„ã€‚

:::
  
------

## æšä¸¾

### â“`Swift` ä¸­çš„æšä¸¾å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€çš„åŒºåˆ«

::: details ğŸ’¡

  - å…³è”å€¼ï¼šæšä¸¾æˆå‘˜å¯ä»¥ä¸ä»»æ„ç±»å‹çš„å€¼è¿›è¡Œå…³è”å­˜å‚¨ï¼Œå«åšå…³è”å€¼ï¼ˆ`Associated Values`ï¼‰ï¼›æ¯ä¸ªæšä¸¾æˆå‘˜çš„å…³è”å€¼ç±»å‹å¯ä»¥æ˜¯ä¸åŒçš„ã€‚
  
  - æ–¹æ³•ï¼šä¸ç»“æ„ä½“å’Œç±»ä¸€æ ·ï¼Œæšä¸¾ä¹Ÿå¯ä»¥å®šä¹‰æ–¹æ³•ï¼Œåœ¨æšä¸¾å€¼å®ä¾‹ä¸Šè°ƒç”¨çš„æ–¹æ³•åŠŸèƒ½ï¼›
  
  - æ„é€ å‡½æ•°ï¼šå¯ä»¥æä¾›æ„é€ å‡½æ•°ï¼Œç”¨ä»¥æä¾›ä¸€ä¸ªå¸¦æœ‰é»˜è®¤æšä¸¾å€¼çš„å®ä¾‹ã€‚
  
  - é€’å½’æšä¸¾ï¼šå¦‚æœæšä¸¾çš„ä¸€ç§ `case` æŒæœ‰è¯¥æšä¸¾ç±»å‹çš„å…³è”å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæšä¸¾å°±æ˜¯é€’å½’æšä¸¾ã€‚
  
  - æ¨¡å¼åŒ¹é…ï¼šæšä¸¾å€¼å’Œ `switch` è¯­å¥ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼ŒåŒ…æ‹¬è·å–æšä¸¾å€¼å…³è”å€¼ï¼Œæˆ–è€…å¤šä¸ª `case` å€¼ä¸€èµ·åŒ¹é…ã€‚

:::

### â“`Swift` ä¸­çš„ `switch` å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€æœ‰ä»€ä¹ˆåŒºåˆ«

::: details ğŸ’¡

  - æ¨¡å¼åŒ¹é…ï¼šå¯ä»¥è¿›è¡Œå¤æ‚çš„æ¨¡å¼åŒ¹é…ï¼ŒåŒ…æ‹¬å…ƒç»„ã€èŒƒå›´åŒ¹é…ä»¥åŠå…³è”æšä¸¾å€¼ç­‰ã€‚
  
  - æ— éœ€ `break`ï¼šå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¦‚`C`è¯­è¨€æ¯ä¸ª `case` åé¢éƒ½éœ€è¦æ·»åŠ  `break` å…³é”®å­—ä»¥é€€å‡º `switch` å¦åˆ™å°†ä¼šå‘ç”Ÿè´¯ç©¿ç°è±¡ã€‚åœ¨ `Swift` ä¸­æ¯ä¸ª `case` åé¢ä¸éœ€è¦æ·»åŠ  `break`ï¼Œå½“é‡åˆ°ç¬¦åˆçš„ `case` åç¨‹åºä¼šç›´æ¥é€€å‡º `switch` è¯­å¥ã€‚
  
  - ç»‘å®šå¸¸é‡å’Œå˜é‡ï¼šåœ¨ä¸€ä¸ª `case` çš„è¯­å¥ä¸­ï¼Œå¯ä»¥ç”¨ `let` æˆ–è€… `var` æ¥ç»‘å®šåŒ¹é…åˆ°çš„å€¼åˆ°ä¸´æ—¶çš„å¸¸é‡æˆ–å˜é‡ä¸­ã€‚

:::
    
### â“æ¨¡å¼åŒ¹é…æ·±å…¥è¯´ä¸€ä¸‹

::: details ğŸ’¡

  `Swift` çš„æ¨¡å¼åŒ¹é…éå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œå®ƒä¸ä»…å¯ä»¥ä½¿ç”¨åœ¨ `switch` è¯­å¥ä¸­ï¼Œè¿˜å¯ç”¨åœ¨ `ifã€whileã€guard` è¯­å¥ä¸­ï¼Œä»¥åŠ `for-in` å¾ªç¯å’Œç±»å‹è½¬æ¢ã€‚

  - **é€šé…ç¬¦æ¨¡å¼ï¼ˆWildcard Patternï¼‰**ï¼š ä½¿ç”¨ `_` è¡¨ç¤ºï¼ŒåŒ¹é…ä»»ä½•å€¼ï¼Œä½†ä¸ç»‘å®šè¯¥å€¼ã€‚

    ```swift
    let someValue: Int? = 42
    if let _ = someValue {
        print("This will always be true!")
    }
    ```

  - **æ ‡è¯†ç¬¦æ¨¡å¼ï¼ˆIdentifier Patternï¼‰** åŒ¹é…ä»»ä½•å€¼å¹¶èµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡æˆ–è€…å˜é‡ã€‚

    ```swift
    let someValue: Int? = 42
    if let value = someValue {
        print("Value is \(value)")  // "Value is 42"
    }
    ```

  - **å€¼ç»‘å®šæ¨¡å¼ï¼ˆValue-Binding Patternï¼‰ï¼š** å°†åŒ¹é…çš„å€¼ç»‘å®šç»™ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡ã€‚

    ```swift
    let point = (3, 2)
    switch point {
    case let (x, y):
        print("The point is at (\(x), \(y))")  // "The point is at (3, 2)"
    }
    ```

  - **å…ƒç»„æ¨¡å¼ï¼ˆTuple Patternï¼‰ï¼š** ç”¨æ¥åŒ¹é…å…ƒç»„ã€‚

    ```swift
    let points = [(0, 0), (0, 1), (1, 0), (1, 1)]
    for let (x, y) in points where x == y {
        print("Matched point (\(x), \(y))")  // "Matched point (0, 0)", "Matched point (1, 1)"
    }
    ```

  - **æšä¸¾ç”¨ä¾‹æ¨¡å¼ï¼ˆEnumeration Case Patternï¼‰ï¼š** åŒ¹é…æšä¸¾çš„æŸä¸ª `case`ã€‚

    ```swift
    enum Direction {
        case north, south, east, west
    }
    
    let heading: Direction = .north
    if .north = heading {
        print("We're heading north!")  // "We're heading north!"
    }
    ```

  - **ç±»å‹è½¬æ¢æ¨¡å¼ï¼š** æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºæŸä¸ªç±»å‹ï¼Œå¦‚æœæ˜¯çš„è¯ç»‘å®šä¸ºé‚£ä¸ªç±»å‹çš„å¸¸é‡æˆ–å˜é‡ã€‚

    ```swift
    let someValue: Any = 42
    if let value as Int = someValue {
        print("Value as an integer is \(value)")  // "Value as an integer is 42"
    }
    ```

  - **å¯é€‰æ¨¡å¼ï¼ˆOptional Patternï¼‰ï¼š** ç”¨æ¥åŒ¹é…å¯é€‰å€¼ã€‚

    ```swift
    let someOptional: Int? = 42
    if .some(let value) = someOptional {
        print("Value is \(value)")  // "Value is 42"
    }
    // ä½¿ç”¨è¯­æ³•ç³–
    if let value = someOptional {
        print("Value is \(value)")  // "Value is 42"
    }
    ```

:::
  
------

## å¯é€‰ç±»å‹

### â“`Swift` å¯é€‰ç±»å‹ `Optional` äº†è§£å—

::: details ğŸ’¡

  `Optional` æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒæŒ‡çš„æ˜¯å˜é‡æˆ–å¸¸é‡å¯èƒ½å®Œå…¨æ²¡æœ‰å€¼ï¼Œæˆ–è€…è¯´å˜é‡æˆ–å¸¸é‡çš„å€¼å¯èƒ½ä¸ºç©ºã€‚

  `Swift` ä½¿ç”¨ `Optional` æ¥å¤„ç†å€¼å¯èƒ½ä¸º `nil` çš„æƒ…å†µã€‚è¿™ä¸ `Objective-C` ä¸åŒï¼Œå› ä¸º `Objective-C` ä¸­ä»»ä½•å¯¹è±¡ç±»å‹éƒ½å¯ä»¥è¢«è®¾å®šä¸º `nil`ï¼Œè€ŒåŸºæœ¬ç±»å‹åˆ™ä¸èƒ½ã€‚åœ¨ `Swift` ä¸­ï¼Œå¯é€‰ç±»å‹å¯ä»¥ç”¨äºæ‰€æœ‰ç±»å‹ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹ã€‚

å£°æ˜ä¸€ä¸ª `Optional` ç±»å‹çš„è¯­æ³•æ˜¯åœ¨ç±»å‹åé¢åŠ ä¸Šä¸€ä¸ªé—®å· `?`ã€‚

è§£åŒ…æœ‰ä¸¤ç§æ–¹å¼ï¼š
  
  - å¼ºåˆ¶è§£åŒ…ï¼Œä½¿ç”¨æ„Ÿå¹å· `!`
  - å¯é€‰å‹ç»‘å®šï¼Œä½¿ç”¨ `if let` æˆ–è€… `guard let`ã€‚

```swift
// å£°æ˜å¯é€‰å­—ç¬¦ä¸²
var myString: String? = "Hello, Swift!"

if let actualString = myString {
    print("The string has - \(actualString)")
} else {
    print("The string does not have a value")
}
```

  > ä½¿ç”¨ `Optional` ç±»å‹æ—¶ï¼Œéœ€è¦æ³¨æ„å®‰å…¨åœ°è§£åŒ…ï¼Œä»¥é¿å…å‡ºç° `nil` å€¼å¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯ã€‚è€Œè¿™æ°æ°æ˜¯ `Swift` ä½¿ç”¨ `Optional` çš„ä¸€ä¸ªå…³é”®ç†å¿µï¼Œå°±æ˜¯è®©æ½œåœ¨çš„ `nil` æ›´æ˜æ˜¾ï¼Œä»è€Œæå‡ç¨‹åºçš„å®‰å…¨æ€§ã€‚

:::

### â“`Optional` å¯é€‰ç±»å‹çš„åº•å±‚å®ç°

::: details ğŸ’¡

  ä¸ `Objective-C` ä¸­çš„ `nil` ç•¥æœ‰ä¸åŒï¼Œå› ä¸º `Swift` ä¸­çš„ `nil` ä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œæ˜¯ä¸€ä¸ªè¡¨ç¤ºæ²¡æœ‰å€¼çš„çŠ¶æ€ã€‚

  ```swift
  public enum Optional<Wrapped>: ExpressibleByNilLiteral {
    case none           // è¡¨ç¤ºæ²¡æœ‰å€¼ nil
    case some(Wrapped)  // è¡¨ç¤ºæœ‰å€¼
  }
  ```

::: 

### â“`Swift` ç»Ÿä¸€ç±»å‹çš„å˜é‡å¯é€‰å€¼ä¸éå¯é€‰å€¼å†…å­˜æœ‰ä»€ä¹ˆåŒºåˆ«

::: details ğŸ’¡

åœ¨ `Swift` ä¸­ï¼Œå¯é€‰å€¼ï¼ˆOptionalï¼‰å®é™…ä¸Šæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹

```swift
enum Optional<Wrapped> {
    case none           // è¡¨ç¤ºæ²¡æœ‰å€¼
    case some(Wrapped)  // è¡¨ç¤ºæœ‰å€¼
}
```

å› æ­¤ï¼Œå¯é€‰å€¼åœ¨å†…å­˜ä¸Šæ¯”éå¯é€‰å€¼å¤šäº†ä¸€å±‚æšä¸¾çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤šå‡ºçš„è¿™ä¸€å±‚éœ€è¦ä¸€äº›é¢å¤–çš„å†…å­˜æ¥å­˜å‚¨æšä¸¾çš„çŠ¶æ€ï¼ˆ`none`æˆ–`some`ï¼‰ã€‚å…·ä½“å¤šå‡ºå¤šå°‘å†…å­˜ï¼Œå–å†³äºç‰¹å®šçš„æšä¸¾ç±»å‹å’Œç¼–è¯‘å™¨çš„ä¼˜åŒ–ã€‚åœ¨å¯é€‰å€¼ä¸º `none` çš„çŠ¶æ€ä¸‹ï¼Œä¹Ÿå°±æ˜¯ `nil` çš„æƒ…å†µä¸‹ï¼Œå¯é€‰å€¼å› ä¸ºæ²¡æœ‰éœ€è¦å­˜å‚¨çš„å€¼ï¼Œæ‰€ä»¥åœ¨å†…å­˜ä¸­ä¸€èˆ¬åªéœ€è¦å­˜å‚¨æšä¸¾çš„çŠ¶æ€ã€‚

:::
  
------

## é—­åŒ…

### â“`Swift` ä¸­çš„é—­åŒ…

::: details ğŸ’¡

  - é€ƒé€¸é—­åŒ… 
    > é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥å‡½æ•°ï¼Œå¦‚æœè¿™ä¸ªé—­åŒ…åœ¨å‡½æ•°è¿”å›ä¹‹åå†æ‰§è¡Œï¼Œåˆ™ä¸ºé€ƒé€¸é—­åŒ…ï¼Œé—­åŒ…å‚æ•°éœ€è¦ä½¿ç”¨ `@escaping` ä¿®é¥°ã€‚
  
    ```swift
    var completionHandlers: [() -> Void] = []
    func someFunctionWithEscapingClosure(completionHandler: @escaping () -> Void) {
        completionHandlers.append(completionHandler)
    }
    ```
  
  - éé€ƒé€¸é—­åŒ…
    > é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œåœ¨å‡½æ•°è¿”å›ä¹‹å‰ï¼Œè¿™ä¸ªé—­åŒ…å·²ç»æ‰§è¡Œï¼Œåˆ™ä¸ºéé€ƒé€¸é—­åŒ…ã€‚
  
    ```swift
    func someFunctionWithNonescapingClosure(closure: () -> Void) {
        closure()
    }
    ```
    
  - å°¾éšé—­åŒ…
    > å°†é—­åŒ…ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œé—­åŒ…å‚æ•°å°±æ˜¯ä¸€ä¸ªå†™åœ¨å°¾éšå‡½æ•°è°ƒç”¨åé¢çš„ä¸€ä¸ªé—­åŒ…è¡¨è¾¾å¼ã€‚
  
    ```swift
    func someFunctionThatTakesAClosure(closure: () -> Void) {
        // å‡½æ•°ä½“éƒ¨åˆ†
    }
    
    // ä»¥ä¸‹æ˜¯ä¸ä½¿ç”¨å°¾éšé—­åŒ…è¿›è¡Œå‡½æ•°è°ƒç”¨
    someFunctionThatTakesAClosure(closure: {
        // é—­åŒ…ä¸»ä½“éƒ¨åˆ†
    })
    
    // ä»¥ä¸‹æ˜¯ä½¿ç”¨å°¾éšé—­åŒ…è¿›è¡Œå‡½æ•°è°ƒç”¨
    someFunctionThatTakesAClosure() {
        // å°¾éšé—­åŒ…ä¸»ä½“éƒ¨åˆ†
    }
    ```
  
  - è‡ªåŠ¨é—­åŒ…
    > éœ€è¦ä¸€ä¸ªä¸æ¥å—å‚æ•°çš„é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œä½¿ç”¨ `@autoclosure` ä¿®é¥°ã€‚ç”¨ä½œé—­åŒ…è¡¨è¾¾å¼çš„å»¶è¿ŸåŠ è½½ï¼Œåªæœ‰å½“é—­åŒ…è¡¨è¾¾å¼çœŸæ­£è°ƒç”¨æ—¶æ‰æ‰§è¡Œã€‚
    
    ```swift
    var customersInLine = ["Chris", "Alex", "John", "Jessie"]
    let customerProvider = { customersInLine.remove(at: 0) }
    print("Now serving \(customerProvider())!")
    ```

:::
  
------
  
## å‡½æ•°

### â“`Swift` å‡½æ•°æ´¾å‘æœºåˆ¶

::: details ğŸ’¡

  - **ç›´æ¥æ´¾å‘ï¼ˆDirect Dispatchï¼‰**ï¼šç›´æ¥æ´¾å‘å‘ç”Ÿåœ¨å€¼ç±»å‹ï¼ˆæšä¸¾ã€ç»“æ„ä½“ï¼‰å’Œ `final` ç±»ä¸Šçš„æ–¹æ³•ã€å±æ€§å’Œä¸‹æ ‡ã€‚è¿™äº›æ“ä½œçš„æ´¾å‘æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå†³å®šçš„ï¼Œä¸å­˜åœ¨åŠ¨æ€æ´¾å‘çš„è¿‡ç¨‹ï¼Œä¸èƒ½è¢«è¦†ç›–ï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿæ˜¯æœ€é«˜çš„ã€‚
  
  - **è™šè¡¨æ´¾å‘ï¼ˆVirtual Table Dispatchï¼‰**ï¼šè™šè¡¨æ´¾å‘å‘ç”Ÿåœ¨æ™®é€šç±»ï¼ˆé `final`ï¼‰ä¸Šçš„æ–¹æ³•ã€å±æ€§å’Œä¸‹æ ‡ã€‚è¿™äº›æ“ä½œçš„æ´¾å‘æ–¹å¼ç”± `Swift` ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶é€šè¿‡è™šè¡¨ï¼ˆ`vtable`ï¼‰æ¥æŸ¥æ‰¾ã€‚è™šè¡¨æ˜¯ä¸€ç§åœ¨ç¼–è¯‘æ—¶æœŸç”Ÿæˆçš„ç”¨äºåŠ¨æ€æ´¾å‘å‡½æ•°çš„æ•°æ®ç»“æ„ï¼Œå­˜å‚¨äº†ç±»å‹çš„åŠ¨æ€ç±»å‹ä¿¡æ¯ã€‚
  
  - **è§è¯è¡¨æ´¾å‘ï¼ˆWitness Table Dispatchï¼‰**ï¼šè§è¯è¡¨æ´¾å‘å‘ç”Ÿåœ¨åè®®æ–¹æ³•ã€å±æ€§å’Œä¸‹æ ‡çš„æ“ä½œã€‚è¿™äº›æ“ä½œçš„æ´¾å‘æ–¹å¼ç”± `Swift` ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ç§åä¸ºè§è¯è¡¨çš„ç±»ä¼¼äºè™šè¡¨çš„æœºåˆ¶ï¼ŒæŸ¥æ‰¾å¹¶è°ƒç”¨ç›¸åº”çš„å®ç°ã€‚è§è¯è¡¨åŒ…å«äº†åè®®çš„åŠ¨æ€ç±»å‹ä¿¡æ¯å’Œåè®®æ–¹æ³•çš„å®ç°ã€‚å¯¹äºå¸¦æœ‰ `where` å­å¥çš„åè®®æ‰©å±•æä¾›çš„é»˜è®¤å®ç°ï¼Œä¼šä¸ºç¬¦åˆä¸åŒæ¡ä»¶çš„ç±»å‹ç”Ÿæˆä¸åŒçš„è§è¯è¡¨ã€‚

| ç±»å‹ | ç›´æ¥æ´¾å‘ | å‡½æ•°è¡¨æ´¾å‘ | æ¶ˆæ¯æ´¾å‘
| --- | ---
| `struct`      | æ‰€æœ‰æ–¹æ³• | æ—  | æ— 
| `class`       | æ‰©å±•æ–¹æ³• | åˆå§‹åŒ–å®šä¹‰æ–¹æ³• | æ— 
| `protocol`    | æ‰©å±•æ–¹æ³• | åˆå§‹åŒ–å®šä¹‰æ–¹æ³• | `@objc`

:::

### â“`inout` å…³é”®å­—åšäº†ä»€ä¹ˆ

::: details ğŸ’¡

  `inout` å¯ä»¥è®©å‡½æ•°ã€æ–¹æ³•æˆ–è€…è¿ç®—ç¬¦å¯ä»¥æ”¹å˜ä¼ å…¥å‚æ•°çš„å€¼ã€‚

  åœ¨ `Swift` ä¸­ï¼Œæ ‡é‡ç±»å‹ï¼ˆå¦‚`Int`ï¼Œ`Double`ï¼Œ`Bool`ï¼Œ`String`ç­‰ï¼‰å’Œç»“æ„ä½“ï¼Œæšä¸¾éƒ½æ˜¯å€¼ç±»å‹ï¼ˆvalue typeï¼‰, ä¹Ÿå°±æ˜¯åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜è¿™äº›å‚æ•°å¹¶ä¸ä¼šå½±å“åˆ°å‡½æ•°å¤–éƒ¨çš„å€¼ï¼Œå› ä¸ºä¼ é€’çš„æ˜¯å€¼çš„æ‹·è´ã€‚

  `inout` å…³é”®å­—å…è®¸å‡½æ•°ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒå°†å€¼ä¼ é€’ç»™å‡½æ•°ï¼Œå¹¶å°†å‡½æ•°è¿”å›åçš„å€¼å¤åˆ¶å›åŸå§‹å˜é‡ã€‚

  ```swift
  func increment(_ value: inout Int) {
    value += 1
    print(value)
  }

  var value = 1
  print(value)      // 1
  increment(&value) // 2
  print(value)      // 2
  ```

:::

### å‡½æ•°å¼ç¼–ç¨‹

#### â“â€œ`Swift` ä¸­å‡½æ•°æ˜¯ç¬¬ä¸€ç­‰å…¬æ°‘â€ è¿™å¥è¯æ€ä¹ˆç†è§£

::: details ğŸ’¡

  > ä¸€ç­‰å…¬æ°‘ï¼šåŒå…¶å®ƒåŸºç¡€æ•°æ®ç±»å‹ä¸€æ ·ã€‚

  - å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°(é«˜é˜¶å‡½æ•°)ã€‚
  - å¯ä»¥ä½œä¸ºå…¶ä»–å‡½æ•°çš„è¿”å›å€¼ã€‚
  - å¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚
  - å¯ä»¥å­˜å‚¨åœ¨æ•°æ®ç»“æ„ä¸­ã€‚

:::

#### â“`map`ã€`filter`ã€`reduce`

::: details ğŸ’¡

> `map`ã€`filter`ã€`reduce` æ˜¯ `Swift` ä¸­å¸¸ç”¨çš„ä¸‰ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¸»è¦ç”¨äºå¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚

  - `map`ï¼šè·å–ä¸€ä¸ªé—­åŒ…è¡¨è¾¾å¼ä½œä¸ºå…¶å”¯ä¸€å‚æ•°ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨ä¸€æ¬¡è¯¥é—­åŒ…å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æœ‰æ‰€æœ‰æ–°å€¼çš„æ•°ç»„ã€‚

    ```swift
    let numbers = [1, 2, 3, 4, 5]
    let doubled = numbers.map { $0 * 2 }   // è¿”å›æ–°çš„æ•°ç»„ï¼š[2, 4, 6, 8, 10]
    ```

  - `filter`ï¼šç”¨äºè¿‡æ»¤æ•°ç»„ï¼ŒåŒæ ·éœ€è¦ä¼ å…¥ä¸€ä¸ªé—­åŒ…è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ï¼Œ è¿™ä¸ªé—­åŒ…å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç”¨æ¥ç¡®å®šæ˜¯å¦è¿‡æ»¤æ‰æŸä¸€ä¸ªå…ƒç´ ã€‚

    ```swift
    let numbers = [1, 2, 3, 4, 5]
    let evens = numbers.filter { $0 % 2 == 0 } // è¿”å›æ–°çš„æ•°ç»„ï¼š[2, 4]
    ```

  - `reduce`ï¼šå°†æ‰€æœ‰å…ƒç´ ç»„åˆæˆä¸€ä¸ªå€¼ã€‚å®ƒéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé—­åŒ…å‡½æ•°ã€‚é—­åŒ…å‡½æ•°ä¼šè¢«æ•°ç»„ä¸­çš„å…ƒç´ ä¾æ­¤è°ƒç”¨ï¼Œå¹¶å°†ç»“æœè¿ç»­ç»„åˆèµ·æ¥ã€‚

    ```swift
    let numbers = [1, 2, 3, 4, 5]
    let sum = numbers.reduce(0, { $0 + $1 })   // è¿”å›çš„ç»“æœæ˜¯ï¼š15
    let sum = numbers.reduce(0, +) // ç®€åŒ–ç‰ˆæœ¬
    ```

:::

#### â“`Swift` å‡½æ•°å¼ç¼–ç¨‹ (å‡½å­ã€å•å­)

::: details ğŸ’¡

  > å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå‡½å­ï¼ˆ`functor`ï¼‰å’Œå•å­ï¼ˆ`monad`ï¼‰æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„æœ¯è¯­ã€‚
  
  - å‡½å­ : æ˜¯ä¸€ç§å¯ä»¥å°†æ‰€æœ‰çš„è¾“å…¥æ“ä½œæ˜ å°„åˆ°è¾“å‡ºæ“ä½œçš„å¯¹è±¡ã€‚åœ¨ `Swift` ä¸­ï¼Œæœ€å¸¸è§çš„å‡½å­å°±æ˜¯ `Array`, `map` æ–¹æ³•å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‡½å­æ“ä½œã€‚
  
  - å•å­ : æ˜¯å‡½å­çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œæ»¡è¶³ä¸€äº›é¢å¤–æ¡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒéœ€è¦å®ç°ä¸¤ä¸ªæ–¹æ³•ï¼šä¸€ä¸ªæ˜¯ç”¨æ¥åˆ›å»ºå•å­çš„æ–¹æ³•ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨æ¥è¿æ¥ä¸¤ä¸ªå•å­çš„æ–¹æ³•ã€‚åœ¨ `Swift` ä¸­ï¼Œå¯¹äº `Array` æ¥è¯´ï¼Œåˆ›å»ºå•å­çš„æ–¹æ³•æ˜¯åˆå§‹åŒ–æ–¹æ³•ï¼Œè¿æ¥ä¸¤ä¸ªå•å­çš„æ–¹æ³•åŒæ ·æ˜¯ `flatMap`ã€‚

:::

#### â“`Swift` å‡½æ•°ä¸­çš„ `Currying`

::: details ğŸ’¡

> `Currying`ï¼ˆæŸ¯é‡ŒåŒ–ï¼‰æ˜¯ä¸€ç§å°†å…·æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ã€‚

```swift
// æ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°
func add(a: Int, b: Int) -> Int {
    return a + b
}
let result = add(a: 3, b: 2) // è¿”å› 5

// æŸ¯é‡ŒåŒ–ä¸ºä¸€ä¸ªæ¥å—ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ï¼Œè¿”å›çš„å‡½æ•°åŒæ ·æ¥å—ä¸€ä¸ªå‚æ•°å¹¶è¿”å›åŠ æ³•ç»“æœ
func add(a: Int) -> ((Int) -> Int) {
    return { b in return a + b }
}
let addThree = add(a: 3)  // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
let result = addThree(2)  // è¿”å› 5
```

é€šè¿‡æŸ¯é‡ŒåŒ–ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå…·æœ‰ç‰¹å®šè¡Œä¸ºçš„æ–°å‡½æ•°ï¼Œè¿™åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¾ˆå¸¸è§ã€‚å½“æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡ç±»ä¼¼çš„å‡½æ•°æ—¶ï¼Œè¿™ç§æŠ€æœ¯ä¼šéå¸¸æœ‰ç”¨ã€‚

:::

-----

## åè®®

### â“`Swift` ä¸­çš„åè®®ä¸ `OC` ä¸­åè®®çš„ç‰¹ç‚¹å’ŒåŒºåˆ«

::: details ğŸ’¡

  - ç›¸åŒç‚¹ : åè®®åœ¨ `Swift` å’Œ `Objective-C` ä¸­éƒ½æ˜¯å®šä¹‰ä¸€ç»„ç‰¹å®šçš„æ–¹æ³•ã€å±æ€§æˆ–è€…å…¶å®ƒè¦æ±‚çš„å·¥å…·ã€‚å…¶ä»–ç±»ã€ç»“æ„ä½“æˆ–è€…æšä¸¾éƒ½å¯ä»¥éµå®ˆè¿™äº›åè®®ï¼Œå¹¶æä¾›è¿™äº›è¦æ±‚çš„å…·ä½“å®ç°ã€‚

  - ä¸åŒç‚¹
    * `Objective-C` ä¸­ï¼Œåè®®å¾€å¾€ç”¨äºå®ç°â€œå§”æ‰˜â€æ¨¡å¼ï¼Œå°¤å…¶æ˜¯åœ¨ `UI` ç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨ã€‚åè®®ä¸­åªèƒ½åŒ…å«æ–¹æ³•çš„å£°æ˜ã€‚
    * `Swift` ä¸­çš„åè®®æ›´åŠ å¼ºå¤§ã€‚

> `Swift` åè®®ï¼š

  - è¦æ±‚éµå¾ªåè®®çš„ç±»å‹æä¾›ç‰¹å®šåç§°å’Œç±»å‹çš„å®ä¾‹å±æ€§æˆ–è€…ç±»å‹å±æ€§
  - è¦æ±‚éµå¾ªåè®®çš„ç±»å‹æä¾›ç‰¹å®šåç§°å’Œç±»å‹çš„æ–¹æ³•ã€åˆå§‹åŒ–æ–¹æ³•ã€ä¸‹æ ‡æ“ä½œç¬¦
  - è¦æ±‚éµå¾ªåè®®çš„ç±»å‹æä¾›ç‰¹å®šçš„æ“ä½œç¬¦æ–¹æ³•
  - ä¸ºéµå¾ªåè®®çš„ç±»å‹æä¾›é»˜è®¤çš„æ–¹æ³•æˆ–è€…å±æ€§çš„å®ç°
  - å¯ä»¥å®šä¹‰ç±»å‹åˆ«å
  - å¯ä»¥ç»§æ‰¿å…¶å®ƒåè®®
  - å¯ä»¥åœ¨åè®®ä¸­ä½¿ç”¨å…³è”ç±»å‹ç­‰

:::

### â“â€œé¢å‘åè®®ç¼–ç¨‹â€ è¯´è¯´ä½ çš„ç†è§£

::: details ğŸ’¡

  - æ ¸å¿ƒæ€æƒ³ : å…ˆå®šä¹‰å‡ºéœ€è¦çš„è¡Œä¸ºå’Œç‰¹æ€§ï¼Œç„¶åå†æ ¹æ®è¿™äº›è¦æ±‚æ¥ç¼–å†™å…·ä½“çš„å®ç°ï¼Œè€Œä¸æ˜¯å…ˆå†™å…·ä½“çš„ç±»å‹ç„¶åå†å»è€ƒè™‘å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚
  
  - ä¼˜ç‚¹ï¼šä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´åŠ çµæ´»å’Œå¯å¤ç”¨ã€‚ç”±äºåè®®çš„é»˜è®¤å®ç°å’Œå¤šåè®®ç»§æ‰¿ç­‰ç‰¹æ€§ï¼Œèƒ½å¤Ÿè½»æ¾åœ°å®šä¹‰å‡ºè¡Œä¸ºå¤æ‚çš„ç±»å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡åè®®çš„ç»„åˆæ¥å®ç°æ›´ä¸ºå¼ºå¤§çš„åŠŸèƒ½ã€‚ä¹Ÿä½¿å¾—ä»£ç è§£è€¦æ€§æ›´å¼ºï¼Œæ›´å®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

:::

------

## æ³›å‹

### â“å…³è”ç±»å‹

::: details ğŸ’¡

  åœ¨ `Swift` ä¸­ï¼Œå…³è”ç±»å‹æ˜¯ç”¨åœ¨åè®®ä¸­çš„ä¸€ç§ç±»å‹ã€‚å…³è”ç±»å‹æä¾›äº†ä¸€ç§æ–¹å¼æ¥ä½¿åè®®ä¸­çš„æ–¹æ³•ã€å±æ€§æˆ–ä¸‹æ ‡è„šæœ¬çš„ç±»å‹ä¿æŒçµæ´»æ€§ã€‚å®ƒç»™åè®®æ·»åŠ äº†ä¸€ä¸ªéœ€è¦åœ¨å®ç°åè®®çš„æ—¶å€™æ‰ç¡®å®šçš„ç±»å‹å ä½ç¬¦ã€‚

  å…³è”ç±»å‹æ˜¯é€šè¿‡ `associatedtype` å…³é”®å­—å£°æ˜çš„ã€‚ä¸€æ—¦ä¸€ä¸ªåè®®æ‹¥æœ‰äº†å…³è”ç±»å‹ï¼Œå®ƒå°±ä¸èƒ½è¢«å½“åšä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ä½¿ç”¨ã€‚

```swift
// å®¹å™¨åè®®
protocol Container {
    associatedtype Item // å…³è”ç±»å‹
    mutating func append(_ item: Item)  // æ·»åŠ å…ƒç´ 
    var count: Int { get }              // è·å–å…ƒç´ æ•°é‡
    subscript(i: Int) -> Item { get }   // é€šè¿‡ç´¢å¼•è·å–å…ƒç´ 
}

struct IntArray: Container { // å®ç° Int ç±»å‹çš„å®¹å™¨åè®®
    var items = [Int]()
    typealias Item = Int

    mutating func append(_ item: Int) {
        items.append(item)
    }

    var count: Int {
        return items.count
    }

    subscript(i: Int) -> Int {
        return items[i]
    }
}
```

:::

### â“`AnyIterator` äº†è§£å—

::: details ğŸ’¡

  > `AnyIterator` æ˜¯ä¸€ç§ç±»å‹æ“¦é™¤çš„è¿­ä»£å™¨ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹æ³•æ¥åˆ›å»ºç¬¦åˆ `IteratorProtocol` çš„ç±»å‹ï¼Œè€Œä¸éœ€è¦åˆ›å»ºæ–°çš„ï¼Œè‡ªå®šä¹‰çš„ç±»å‹ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ•´æ•°åºåˆ—å¹¶ä¸”å¸Œæœ›åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨æ¥è¿­ä»£è¿™ä¸ªåºåˆ—ï¼Œè€Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰çš„è¿­ä»£å™¨ç±»å‹ã€‚å¯ä»¥ä½¿ç”¨ `AnyIterator` æ¥å®ç°è¿™ç§è¡Œä¸ºï¼š

```swift
var num = 1
let iterator = AnyIterator { () -> Int? in
    let nextNum = num
    num *= 2
    return nextNum
}

for _ in 0..<10 {
    print(iterator.next() ?? "")
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ `AnyIterator` åˆ›å»ºäº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¯¥è¿­ä»£å™¨åœ¨æ¯æ¬¡è°ƒç”¨ `next` æ—¶è¿”å›å½“å‰çš„ `num` å¹¶å°† `num` ä¹˜ä»¥ 2ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿­ä»£å™¨æ¥è®¡ç®—æŒ‡æ•°åºåˆ—çš„å‰ N ä¸ªæ•°ï¼Œè€Œæ— éœ€åˆ›å»ºè‡ªå®šä¹‰çš„è¿­ä»£å™¨ç±»å‹ã€‚åªç”¨è¿™ä¸ªé—­åŒ…ï¼Œå°±å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚

:::

### â“æ³›å‹ç±»å‹æ“¦é™¤å¦‚ä½•å®ç°

::: details ğŸ’¡

  > æ³›å‹ç±»å‹æ“¦é™¤ : å°†å…·æœ‰ç‰¹å®šæ³›å‹ç±»å‹çº¦æŸçš„å¯¹è±¡è½¬åŒ–ä¸ºä¸€ä¸ªä¸å†å…·æœ‰ç‰¹å®šæ³›å‹ç±»å‹çš„å¯¹è±¡ï¼Œä½†ä»ç„¶ä¿æŒç›¸ä¼¼çš„è¡Œä¸ºã€‚
  
  æ³›å‹ç±»å‹æ“¦é™¤å¤„ç†ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡å°†æ³›å‹ç±»å‹æˆ–å‡½æ•°åŒ…è£…åœ¨ä¸€ä¸ªéæ³›å‹ç±»å‹ä¸­æ¥è¾¾æˆçš„ã€‚
  
```swift 
// åè®®
protocol MyProtocol {}
// å®ç° MyProtocol çš„æ³›å‹ç±»
class MyGenericClass<T: MyProtocol> {}
// å°†æ³›å‹ç±» MyGenericClass è¿›è¡Œç±»å‹æ“¦é™¤ï¼ŒåŒäº‹å…·å¤‡ MyProtocol çš„è¡Œä¸º
class AnyMyGenericClass {
    private var _myClass: AnyObject
    init<T: MyProtocol>(_ myClass: MyGenericClass<T>) {
        _myClass = myClass
    }
}
```

:::

------

## Codable

  > `Codable`æ˜¯ä¸€ä¸ªç»„åˆåè®®ï¼Œå®ƒæ˜¯ `Decodable` å’Œ `Encodable` çš„ "æ··åˆåè®®"ï¼Œç”¨äºé€šç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æƒ…å†µã€‚

### â“`Codable` å¦‚ä½•å®ç° `key` æ˜ å°„

::: details ğŸ’¡

> `Codable` æ˜¯ `Swift` ä¸­å¤„ç†æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„åè®®ã€‚å½“ `JSON` å­—æ®µåç§°å’Œæ¨¡å‹å±æ€§åç§°ä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªåè®®ä¸­çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§ â€”â€” é”®æ˜ å°„ (key mapping)ã€‚åœ¨æ¨¡å‹ä¸­å®šä¹‰ä¸€ä¸ªæšä¸¾ï¼Œéµå®ˆ `CodingKey` åè®®ï¼Œç”¨äºæ˜ å°„ `JSON` å­—æ®µå’Œæ¨¡å‹å±æ€§ã€‚

```swift
struct User: Codable {
    var id: Int
    var name: String
    var registrationDate: Date

    //å®šä¹‰é”®æ˜ å°„çš„æšä¸¾
    enum CodingKeys: String, CodingKey {
        case id
        case name
        case registrationDate = "registration_date"  //è¿›è¡Œé”®æ˜ å°„
    }
}
```

æ³¨æ„ï¼šå¦‚æœå‹ç±»å‹ä¸­æ‰€æœ‰çš„é”®éƒ½å’Œ `JSON` çš„é”®ä¸€ä¸€å¯¹åº”ï¼Œé‚£ä¹ˆä¸éœ€è¦æ‰‹åŠ¨æä¾› `CodingKeys`ã€‚`Swift` çš„ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ª`String`ç±»å‹çš„ï¼Œåä¸º`CodingKeys`çš„æšä¸¾ï¼Œé‡Œé¢åŒ…å«äº†æ¯ä¸ªå±æ€§å¯¹åº”çš„é”®ã€‚ä½†ä¸€æ—¦åœ¨æ¨¡å‹ä¸­è‡ªå®šä¹‰äº† `CodingKeys`ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šåœæ­¢è‡ªåŠ¨åˆæˆï¼Œéœ€è¦ä¸ºæ¨¡å‹ä¸­çš„æ¯ä¸ªå±æ€§éƒ½æä¾›å¯¹åº”çš„é”®ã€‚

:::

### â“`Codable` å®ç°åŸç†

::: details ğŸ’¡

  åœ¨æ ‡å‡†åº“ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª `Decoder` åè®®ï¼Œä¸€èˆ¬è§£ç å™¨ï¼ˆæ¯”å¦‚ `JSONDecoder`ï¼‰éƒ½ä¼šéµå¾ªè¿™ä¸ªåè®®ã€‚ç›¸åº”åœ°ï¼Œè¿˜æœ‰ä¸€ä¸ª `Encoder` åè®®ï¼Œç¼–ç å™¨ï¼ˆå¦‚ `JSONEncoder`ï¼‰ä¼šéµå¾ªè¿™ä¸ªåè®®ã€‚

  å¯¹äºæ¯ä¸ªæ•°æ®ç±»å‹ï¼Œåªè¦å®ƒéµå¾ªäº† `Decodable` åè®®ï¼Œå°±å¯ä»¥è§£ç ï¼›éµå¾ªäº† `Encodable` åè®®ï¼Œå°±å¯ä»¥ç¼–ç ã€‚é€šè¿‡åè®®é»˜è®¤å®ç°ç¼–ç è§£ç ä»»åŠ¡ã€‚

```swift
// è§£ç æ–¹æ³•
init(from decoder: Decoder) throws
// ç¼–ç æ–¹æ³•
func encode(to encoder: Encoder) throws
```

:::
  
------
  
## å¼‚æ­¥ç¼–ç¨‹

### â“`Swift` å¦‚ä½•å®ç°è‡ªå·±çš„ `Promise` 

::: details ğŸ’¡

å®ç°è‡ªå·±çš„ `Promise` å®è´¨ä¸Šæ˜¯è¦åˆ›å»ºä¸€ä¸ªå¯ä»¥åŒ…è£…å¼‚æ­¥æ“ä½œï¼Œå¹¶èƒ½å¤Ÿåœ¨ä¹‹åè·å–å…¶ç»“æœçš„å¯¹è±¡ã€‚

```swift
// ä¸€ç§ç®€å•çš„ Promise å®ç°
class Promise<Value> {
    private var value: Value?
    private var error: Error?
    private var callbacks = [(Result<Value, Error>) -> Void]()

    func fulfill(_ value: Value) {
        self.value = value
        executeCallbacksIfNeeded()
    }

    func reject(_ error: Error) {
        self.error = error
        executeCallbacksIfNeeded()
    }

    // then æ–¹æ³•è¢«è°ƒç”¨æ¥æ·»åŠ ä¸€ä¸ªå°†åœ¨ Promise è§£å†³æ—¶è°ƒç”¨çš„å›è°ƒ
    func then(_ callback: @escaping (Result<Value, Error>) -> Void) {
        callbacks.append(callback)
        executeCallbacksIfNeeded()
    }

    // ä¸€æ—¦ Promise è¢«è§£å†³(fulfilled æˆ– rejected)ï¼Œå®ƒå°±ä¼šæ‰§è¡Œæ‰€æœ‰å›è°ƒå‡½æ•°ï¼Œå¹¶æ¸…ç©ºå›è°ƒé˜Ÿåˆ—
    private func executeCallbacksIfNeeded() {
        if let value = value {
            callbacks.forEach { $0(.success(value)) }
            callbacks = []
        } else if let error = error {
            callbacks.forEach { $0(.failure(error)) }
            callbacks = []
        }
    }
}

// ä½¿ç”¨ Promise
let promise = Promise<Int>()

promise.then { result in
    switch result {
    case .success(let value):
        print("Value: \(value)")
    case .failure(let error):
        print("Error: \(error)")
    }
}

// åœ¨å…¨å±€é˜Ÿåˆ—ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œ2ç§’åï¼Œ`fulfill` æ–¹æ³•å°† `Promise` çŠ¶æ€æ›´æ”¹ä¸ºå·²è§£å†³ï¼Œå¹¶æ‰“å°â€œValue: 5â€ã€‚
DispatchQueue.global().async {
    sleep(2) // simulate async operation
    promise.fulfill(5)
}
```

:::

### â“`async/await`

::: details ğŸ’¡

  > `Swift 5.5` æ–°å¼•å…¥çš„ä¸¤ä¸ªå…³é”®å­—ï¼Œä¸»è¦ç”¨äºç®€åŒ–ã€ç¾åŒ– `Swift` ä¸­çš„å¼‚æ­¥ä»»åŠ¡çš„ç¼–ç å’Œé˜…è¯»ã€‚

  `async/await` å¸¦æ¥äº†æ›´æ¸…æ™°ã€æ›´ç®€æ´çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ã€‚è§£å†³äº†è¿‡å»å¤„ç†å¤šå¼‚æ­¥ä»»åŠ¡å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œå¯ä»¥å’ŒåŒæ­¥ä»£ç ä¸€æ ·é¡ºåºç¼–å†™ï¼Œå¤§å¤§æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

  - `async`ï¼šè¡¨ç¤ºä¸€ä¸ªå‡½æ•°ä¸ºå¼‚æ­¥å‡½æ•°ã€‚å¼‚æ­¥å‡½æ•°æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨åå°è¿›ç¨‹è¿è¡Œè€Œä¸ä¼šé˜»å¡å½“å‰çš„è¿è¡Œè¿›ç¨‹ã€‚
  
  - `await`ï¼šé€šå¸¸åœ¨å¼‚æ­¥å‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ—¶ä½¿ç”¨ï¼Œä»¥è¡¨ç¤ºç­‰å¾…è¿™ä¸ªå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚

  ```swift
  func fetchDataFromServer() async -> Data {
    ...
  }
  func processData() async {
    let data = await fetchDataFromServer() 
    ...
  }
  ```
  
:::

### Sendable

#### â“`Sendable` 

::: details ğŸ’¡

  > `Swift 5.5` ä¸­ä¸å¹¶å‘ç›¸å…³çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œæ˜¯ä¸€ä¸ªæ ‡è®°æ€§çš„åè®®ã€‚ç”¨äºè¡¨ç¤ºéµå¾ªè¯¥åè®®çš„ç±»å‹æ˜¯èƒ½å®‰å…¨åœ°å‘é€åˆ°å’Œæ¥æ”¶è‡ªåˆ«çš„å¹¶å‘ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ï¼Œå¼‚æ­¥ä»»åŠ¡ã€actorï¼‰ã€‚
  
  ç±»å‹å¯ä»¥æ ‡è®° `Sendable` åè®®çš„ä¸¤ä¸ªæ¡ä»¶ï¼š
  
  - å€¼ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œæšä¸¾ã€ç»“æ„ä½“ï¼‰
  - æ‰€æœ‰çš„å­˜å‚¨å±æ€§ï¼ˆåŒ…æ‹¬é€’å½’åœ°ï¼‰éƒ½æ˜¯ `Sendable`
  
  ```swift
  // ç›´æ¥éµå¾ª Sendable åè®®
  struct Point: Sendable {
    let x: Double
    let y: Double
  }

  // æ‰©å±•éµå¾ª Sendable åè®®
  struct Point {
    let x = Double
    let y = Double
  }
  extension Point: Sendable {}
  ```

:::

#### â“`class` ç±»å‹å¯ä»¥æ ‡è®°ä¸º `Sendable` å—

::: details ğŸ’¡

  `class` å¹¶ä¸æ˜¯å€¼ç±»å‹ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥è®© `class` éµä» `Sendable` åè®®ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ `@unchecked Sendable` å±æ€§å¼ºåˆ¶è¡¨æ˜ `class` æ˜¯ `Sendable`ã€‚å¿…é¡»ä¿è¯è¿™ä¸ªç±»å‹æ˜¯ `class`ï¼Œåœ¨ä¼ é€’è¿™ä¸ªç±»çš„å®ä¾‹æ—¶ä»æ—§èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

  `class`éµä» `Sendable` åè®®æ—¶å¿…é¡»å°å¿ƒï¼Œå› ä¸º `Sendable` è¦æ±‚éµå¾ªè¯¥åè®®çš„ç±»å‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ `@unchecked Sendable` å¯èƒ½å¼•å‘éš¾ä»¥è°ƒè¯•çš„çº¿ç¨‹é—®é¢˜ã€‚
  
:::

## æ··ç¼–

### â“`Swift` ä¸ `OC` æ··ç¼–ç›¸äº’è°ƒç”¨

::: details ğŸ’¡

  - `Swift` è°ƒç”¨ `Objective-C`ï¼š
    > åœ¨ä¸º `Swift` å·¥ç¨‹å¯¼å…¥ `OC` ç±»åï¼Œ`Xcode` ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º `é¡¹ç›®åç§°-Swift.h` çš„å¤´æ–‡ä»¶ï¼Œåªéœ€è¦åœ¨éœ€è¦ä½¿ç”¨ `OC` ä¸­å¯¹è±¡çš„ `Swift` æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥è¿™ä¸ªæ–‡ä»¶å³å¯å®ç° `OC` çš„ç±»ã€æ–¹æ³•çš„è°ƒç”¨ã€‚ï¼ˆæ³¨æ„æ˜¯åœ¨ `OC` æ–‡ä»¶ä¸­å¼•å…¥ï¼‰ã€‚

  - `Objective-C` è°ƒç”¨ `Swift`ï¼š
    > é¡¹ç›®éœ€æ·»åŠ æ¡¥æ¥å¤´æ–‡ä»¶ï¼ˆå³åˆ›å»ºä¸€ä¸ª `Swift` æ–‡ä»¶æ—¶ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„ `é¡¹ç›®åç§°-Bridging-Header.h` æ–‡ä»¶ï¼‰ï¼Œç„¶ååœ¨è¯¥å¤´æ–‡ä»¶ä¸­ï¼Œå¼•å…¥è¦ç”¨åˆ°çš„ `OC` ç±»çš„å¤´æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ `Swift` ä¸­æ­£å¸¸ä½¿ç”¨ `OC` ç±»å’Œæ–¹æ³•ã€‚åœ¨ `Swift` ä»£ç å®ç°åï¼Œ`OC` å°±å¯ä»¥é€šè¿‡åœ¨ `OC` ä¸­å¼•å…¥ `TargetName-Swift.h` æ–‡ä»¶æ¥è°ƒç”¨ `Swift` ä»£ç äº†ã€‚

:::

### â“`dynamic` åœ¨ `Swift` ä¸ `OC` ä¸­çš„ä½œç”¨
  
::: details ğŸ’¡

  - åœ¨ `Objective-C` ä¸­ï¼Œ`dynamic` å…³é”®å­—ç”¨äºå‘ŠçŸ¥ç¼–è¯‘å™¨ï¼Œæ–¹æ³•çš„å®ç°å°†åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šï¼Œå³ä¸åœ¨ç¼–è¯‘æ—¶è¿›è¡Œç»‘å®šã€‚è¿™å…è®¸åœ¨è¿è¡Œæ—¶æ›¿æ¢ã€æ·»åŠ æˆ–è€…ä¿®æ”¹æ–¹æ³•å®ç°ã€‚
    > é€šå¸¸ä¼šåœ¨å®šä¹‰äº†å±æ€§çš„ `getter` å’Œ `setter` æ–¹æ³•åï¼Œä½¿ç”¨ `@dynamic` å…³é”®å­—æ¥é¿å…ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆæ–¹æ³•å®ç°ï¼Œç„¶ååœ¨è¿è¡Œæ—¶æ‰‹åŠ¨æä¾›è¿™äº›æ–¹æ³•çš„å®ç°ã€‚
    
  - åœ¨ `Swift` ä¸­ï¼Œ`dynamic` å…³é”®å­—ç”¨äºåœ¨ç±»æˆ–è€…ç±»çš„æˆå‘˜å‰ï¼Œè¡¨ç¤ºè¯¥ç±»æˆ–è€…ç±»çš„æˆå‘˜å¯ä»¥è¢« `Objective-C` åŠ¨æ€è°ƒåº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«`dynamic`ä¿®é¥°çš„æˆå‘˜æ–¹æ³•ã€å±æ€§æˆ–ä¸‹æ ‡è„šæœ¬çš„è°ƒç”¨ä¼šå˜æˆä¸€ä¸ª `Objective-C` çš„æ¶ˆæ¯å‘é€ã€‚
    > `Swift` ä¸­çš„ `dynamic` ä¸ä»…ä»…å‘Šè¯‰ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾æ–¹æ³•å®ç°ï¼Œè€Œä¸”è¿˜ç¡®ä¿äº†è¢«ä¿®é¥°çš„å…ƒç´ å¯ä»¥è¢« `Objective-C` è®¿é—®ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥è¢« `Objective-C` çš„è¿è¡Œæ—¶ç‰¹æ€§ï¼ˆå¦‚ `Key-Value Observing`ã€`Key-Value Coding`ï¼‰ä½¿ç”¨ã€‚

  æ³¨æ„ï¼šåœ¨ `Swift` ä¸­ï¼Œ`dynamic` åªèƒ½ç”¨äºä¿®é¥°ç±»çš„å®ä¾‹æˆå‘˜ï¼Œä¸èƒ½ç”¨äºä¿®é¥°é™æ€æˆå‘˜æˆ–è€…å…¨å±€å‡½æ•°ã€‚åŒæ—¶ï¼Œåªæœ‰ç»§æ‰¿è‡ª `NSObject` çš„ç±»å¯ä»¥ä½¿ç”¨ `dynamic` ä¿®é¥°æ–¹æ³•æˆ–è€…å±æ€§ã€‚

:::

------

## æ–°ç‰¹æ€§

### â“`@dynamicMemberLookup`
  
::: details ğŸ’¡
  
  > `Swift 4.2` å¼•å…¥çš„ `@dynamicMemberLookup` ç‰¹æ€§ã€‚è¿™ç§æ–°ç‰¹æ€§å…è®¸æˆ‘ä»¬åˆ›å»ºè¢«åŠ¨æ€è°ƒç”¨çš„ç±»å‹ï¼Œå®ƒçš„å±æ€§å’Œæ–¹æ³•åœ¨ç¼–è¯‘æ—¶æ˜¯æœªçŸ¥çš„ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šç¡®å®šã€‚è¿™å¯¹äºåˆ©ç”¨ `Swift` æ¥è°ƒç”¨ `Python`ï¼Œ`JavaScript`ï¼Œ`Ruby` å’Œå…¶ä»–åŠ¨æ€è¯­è¨€çš„ä»£ç éå¸¸æœ‰ç”¨ã€‚è¿™æ ·å¯ä»¥ä½¿å¾— `Swift` å…·æœ‰ä¸€å®šçš„åŠ¨æ€æ€§ï¼ŒåŒæ—¶åˆä¸å¤±ç±»å‹å®‰å…¨ã€‚

```swift
@dynamicMemberLookup
struct DynamicMember {
    let dictionary = ["dynamicMember": 110, "otherMember": 119]
    subscript(dynamicMember member: String) -> Int {
        return dictionary[member] ?? 114
    }
}
let member = DynamicMember()
print(member.dynamicMember) // 110
```

:::

### â“`@PropertyWrapper`

::: details ğŸ’¡

  > `Swift 5.1` å¼•å…¥äº†ä¸€é¡¹æ–°ç‰¹æ€§ï¼šå±æ€§åŒ…è£…å™¨ï¼ˆproperty wrappersï¼‰ã€‚å±æ€§åŒ…è£…å™¨æä¾›äº†ä¸€ç§å°†ç‰¹æ€§æ·»åŠ åˆ°å±æ€§ä¸Šçš„æ–°æ–¹æ³•ï¼Œä¾‹å¦‚çº¿ç¨‹å®‰å…¨ï¼Œæ‡’åŠ è½½ï¼Œé”®å€¼è§‚å¯Ÿï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ç­‰ï¼Œä»è€Œä½¿è¿™äº›å±æ€§æ›´æ˜“äºå¤ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œå±æ€§åŒ…è£…å™¨å°±æ˜¯ä¸€ä¸ªå®šä¹‰äº†ç‰¹æ®Šè®¿é—®ç­–ç•¥çš„ç»“æ„æˆ–ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè®¿é—®ç­–ç•¥é™„åŠ åˆ°å±æ€§ä¸Šï¼Œè€Œä¸æ˜¯é‡æ–°å®ç°ç›¸åŒçš„è®¿é—®ç­–ç•¥ã€‚

```swift
// å®šä¹‰å±æ€§åŒ…è£…å™¨
@PropertyWrapper
struct HundredOrLess {
    private var score = 0
    var wrappedValue: Int {
        get { return score }
        set { score = min(newValue, 100) }
    }
}
// ä½¿ç”¨å±æ€§åŒ…è£…å™¨
struct Grade {
    /// æ•°å­¦æˆç»©
    @HundredOrLess var math: Int
    /// ä½“è‚²æˆç»©
    @HundredOrLess var gym: Int
}
```

:::

### â“`@_specialize` - æ³›å‹è¯­æ³•ç‰¹æ€§

::: details ğŸ’¡

  > `@_specialize` æ˜¯ `Swift` ä¸­çš„ä¸€ä¸ªç§æœ‰ç‰¹æ€§ï¼Œåœ¨æ­£å¼çš„ `Swift` ç‰ˆæœ¬ä¸­ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–è€…ä¿®æ”¹ã€‚

  `@_specialize` å±æ€§ç”¨æ¥å‘Šè¯‰ `Swift` çš„ç¼–è¯‘å™¨ï¼Œå°½å¯èƒ½åœ°ä¸ºç‰¹å®šçš„ç±»å‹å‚æ•°ç”Ÿæˆä¸“é—¨çš„ä»£ç ã€‚è¿™æ„å‘³ç€å½“ä¸€ä¸ªä½¿ç”¨ç‰¹å®šç±»å‹å‚æ•°çš„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¸å†ä½¿ç”¨é€šç”¨ç‰ˆæœ¬ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸ºè¿™äº›ç‰¹å®šç±»å‹ç”Ÿæˆçš„ä¸“é—¨ä»£ç ã€‚

  ä¼˜ç‚¹ï¼šæ€§èƒ½ä¼˜åŒ–ï¼Œå› ä¸ºä¸å†éœ€è¦ç±»å‹æ£€æŸ¥å’Œè§£åŒ…ï¼Œä¹Ÿä¸å†éœ€è¦åŠ¨æ€æ´¾å‘ã€‚

```swift
// æ¯”è¾ƒä¸¤ä¸ª Comparable çš„å…ƒç´ å¹¶è¿”å›æœ€å°çš„ä¸€ä¸ª
func min<T: Comparable>(_ x: T, _ y: T) -> T {
    return y < x ? y : x
}

// @_specialize ä¼˜åŒ–ï¼Œç”Ÿæˆä¸€ä¸ªä¸“é—¨å¤„ç† Int çš„ç‰ˆæœ¬
@_specialize(where T == Int)
func min<T: Comparable>(_ x: T, _ y: T) -> T {
    return y < x ? y : x
}
```

:::

### â“`@_functionBuilder`

::: details ğŸ’¡

  > `Swift 5.1` å¼•å…¥äº†å‡½æ•°å»ºæ„å™¨ç‰¹æ€§ï¼Œç›®å‰è¿˜å¤„äºç§æœ‰é˜¶æ®µï¼Œæ•…ä»¥ `_` å¼€å¤´ã€‚å‡½æ•°å»ºæ„å™¨åŠŸèƒ½ä¸»è¦ç”¨äºç®€åŒ–å¤§é‡æ ·æ¿ä»£ç ã€‚
  
```swift
// SwiftUI 
VStack(content: { 
    return Group { 
        Text("Hello") 
        Text("World") 
    } 
})
// @_functionBuilder å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹å†™æ³•
VStack { 
    Text("Hello") 
    Text("World") 
}
```

:::