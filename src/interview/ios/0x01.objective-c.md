---
title: Objective-C
icon: hashtag

index: true

---

<!-- more -->

## reference

<!-- block -->

- [2013-11-27 objc ä¸­çš„ block](https://blog.ibireme.com/2013/11/27/objc-block/)
- [2013-05-29 å¯¹ Objective-C ä¸­ Block çš„è¿½æ¢](http://www.cnblogs.com/biosli/archive/2013/05/29/iOS_Objective-C_Block.html)

<!-- NSCache -->

- [2015-12-09 NSCache æºç åˆ†æ](https://github.com/nixzhu/dev-blog/blob/master/2015-12-09-nscache.md)
- [2015-02-11 Foundation: NSCache](http://southpeak.github.io/2015/02/11/cocoa-foundation-nscache)
- [2012-07-14 NSCache](http://nshipster.com/nscache)

------

## è®¾è®¡ç†å¿µ

  `OC` åº•å±‚æ˜¯ä½¿ç”¨ `C/C++` å®ç°ã€‚å®šä¸€ä¸ªç»§æ‰¿ `NSObject` çš„ç±»ï¼Œè¿™ä¸ªç±»åº•å±‚ä½¿ç”¨ `C` è¯­è¨€ä¸­çš„ `struct` ç»“æ„ä½“æ¥å®ç°çš„ã€‚ 

### â“`OCã€Javaã€Python` è¿è¡Œæ•ˆç‡å­°é«˜

::: details ğŸ’¡

- `Objective-C`: ç¼–è¯‘å‹è¯­è¨€ï¼Œè¿è¡Œæ•ˆç‡é€šå¸¸ä¼˜äºè§£é‡Šå‹è¯­è¨€ã€‚åº•å±‚æ˜¯åŸºäº `C`ï¼Œä½†æ˜¯ç”±äºåŠ¨æ€æ´¾å‘çš„ç‰¹æ€§ä¼šä¸€å®šç¨‹åº¦ä¸Šå½±å“æ•ˆç‡ã€‚

- `Java`: ç¼–è¯‘å‹è¯­è¨€ï¼Œè¿è¡Œç¯å¢ƒæ˜¯ `JVM`(`Java` è™šæ‹Ÿæœº)ï¼Œé€šè¿‡ `JIT`(Just In Time compiler)æŠ€æœ¯ï¼Œ`Java` èƒ½å°†å­—èŠ‚ç å®æ—¶åœ°ç¼–è¯‘æˆæœºå™¨ç è¿è¡Œï¼Œå› æ­¤è¿è¡Œæ•ˆç‡**è¾ƒé«˜**ï¼Œè€Œä¸”åœ¨å¤§æ•°æ®å’Œ `Web` æœåŠ¡é¢†åŸŸè¡¨ç°ä¼˜ç§€ã€‚

- `Python`: æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œå…¶è¿è¡Œæ•ˆç‡**è¾ƒä½**ï¼Œæ— æ³•ä¸ç¼–è¯‘å‹è¯­è¨€ç›¸æ¯”ã€‚ä½†æ˜¯ `Python` çš„æ˜“è¯»æ€§ã€æ˜“å†™æ€§ä»¥åŠä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“ï¼Œä½¿å®ƒåœ¨ç§‘å­¦è®¡ç®—ã€äººå·¥æ™ºèƒ½ç­‰é¢†åŸŸå¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚

:::

### â“`OC` çš„åŠ¨æ€æ€§

::: details ğŸ’¡

> `OC` çš„ `runtime` æ–‡æ¡£ä¸­ä»‹ç»ä¸­å°±è¯¦ç»†å†™æ˜äº†ï¼Œ`runtime` çš„è®¾è®¡æ˜¯ä¸ºäº†å°†æ›´å¤šçš„å¤„ç†å»¶è¿Ÿåˆ°ç¼–è¯‘åã€‚
 
  - åŠ¨æ€ç±»å‹ (`Dynamic typing`) : ç¼–è¯‘æ—¶å¹¶ä¸ç¡®å®šå¯¹è±¡ç±»å‹ï¼Œåœ¨è¿è¡Œæ—¶æ‰åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ã€‚`OC` ä¸­ä¸€åˆ‡å¯¹è±¡éƒ½å¯ä»¥ç”¨ `id` æŒ‡é’ˆæŒ‡å‘ã€‚
  
  - åŠ¨æ€ç»‘å®š (`Dynamic binding`) : æ–¹æ³•çš„è°ƒç”¨ä¹Ÿæ˜¯è¿è¡Œæ—¶æ‰å†³å®šï¼Œè€Œå¹¶éç¼–è¯‘æ—¶ã€‚
  
  - åŠ¨æ€åŠ è½½ (`Dynamic loading`) : è¿è¡Œæ—¶å¯ä»¥åŠ¨æ€åŠ è½½å…¶å®ƒæ¨¡å—æˆ–æ¡†æ¶ã€‚

:::

### â“`OC` æ˜¯å¦‚ä½•ä¿è¯ç³»ç»Ÿå‡çº§å `ABI` çš„ç¨³å®šæ€§

::: details ğŸ’¡

  - å‘åå…¼å®¹ï¼ˆ`Backward Compatibility`ï¼‰ï¼šæ–°ç‰ˆæœ¬çš„ç³»ç»Ÿåº“åœ¨è®¾è®¡å’Œæ›´æ–°æ—¶ï¼Œä¼šå°½é‡ä¿è¯å‘ä¸‹å…¼å®¹ã€‚

  - åŠ¨æ€æ€§ï¼ˆ`Dynamic Nature`ï¼‰ï¼šä½œä¸ºä¸€ç§åŠ¨æ€è¯­è¨€ï¼Œ`OC` å¤§é‡ä½¿ç”¨åŠ¨æ€åˆ†å‘å’Œè¿è¡Œæ—¶è§£æã€‚è¿™æ„å‘³ç€å¾ˆå¤šäº‹æƒ…åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šï¼Œä¾‹å¦‚æ–¹æ³•çš„è°ƒç”¨ã€å¯¹è±¡çš„ç”Ÿæˆç­‰ã€‚è¿™ç§æœºåˆ¶åœ¨ç»´æŠ¤ `ABI` ç¨³å®šæ€§æ—¶æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶è§£æå’Œå¤„ç†ä¸€äº›å¯èƒ½çš„é—®é¢˜ã€‚ 

  - åˆ©ç”¨ç±»å’Œåˆ†ç±»ï¼ˆ`Class and Category`ï¼‰ï¼šä½¿ç”¨ç±»å’Œåˆ†ç±»æ¥æ¨¡å—åŒ–ä»£ç ï¼Œä½¿å¾—ä»£ç é€»è¾‘æ›´å®¹æ˜“ç®¡ç†ï¼Œä¹Ÿæ›´åˆ©äºç»´æŠ¤ `ABI` ç¨³å®šæ€§ã€‚åœ¨æ–°å¢æˆ–è€…ä¿®æ”¹åŠŸèƒ½æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„ç±»æˆ–è€…åˆ†ç±»ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ—§çš„ä»£ç ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ—§çš„ä»£ç é€»è¾‘å’Œ `ABI` ä¸è¢«ç ´åã€‚

  - æ¥å£è¿‡æœŸæ ‡æ³¨(`API Deprecation`)ï¼šç³»ç»Ÿåº“åœ¨å¼•å…¥æ–°çš„æ¥å£æ—¶ï¼Œä¼šæŠŠä¸æ¨èä½¿ç”¨çš„æ—§æ¥å£æ ‡è®°ä¸º `deprecated`ï¼Œä½†ä¸ä¼šç«‹å³åˆ é™¤ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä¾èµ–æ—§æ¥å£çš„ä»£ç åœ¨ä¸€æ®µæ—¶é—´å†…å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

  æ³¨ï¼šä»¥ä¸Šè¿™äº›éƒ½åªèƒ½å°½å¯èƒ½åœ°ä¿è¯ `ABI` çš„ç¨³å®šæ€§ï¼Œä½†å¹¶ä¸èƒ½ç»å¯¹åœ°ä¿è¯ã€‚å› ä¸ºç³»ç»Ÿå‡çº§å¾€å¾€ä¼šå¼•å…¥æ–°çš„åŠŸèƒ½ã€æ–°çš„æ¶æ„ï¼Œæˆ–è€…ä¿®å¤æ—§çš„ `bug`ï¼Œè¿™äº›éƒ½å¯èƒ½å¯¹ `ABI` äº§ç”Ÿå½±å“ã€‚æ‰€ä»¥ï¼Œä½œä¸ºå¼€å‘è€…åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„å…¼å®¹æ€§ï¼Œé¿å…è¿‡åº¦ä¾èµ–å¯èƒ½ä¼šå˜åŠ¨çš„æ¥å£å’Œè¡Œä¸ºã€‚

:::

------

## æ•°æ®ç±»å‹

### id

#### â“`id` vs `self` vs `super`

::: details ğŸ’¡

  - `id`ï¼šä¸€ç§æ•°æ®ç±»å‹ï¼Œä¹Ÿå«åšåŠ¨æ€å¯¹è±¡ç±»å‹ï¼Œæ‰€æœ‰çš„ `Objective-C` å¯¹è±¡éƒ½å¯ä»¥ç”¨ `id` ç±»å‹æ¥æ¥æ”¶ã€‚`id` ç±»å‹ä¼šå¿½ç•¥ç±»å‹ä¿¡æ¯ï¼Œå¯ä»¥ç»™å®ƒå‘é€ä»»ä½•æ¶ˆæ¯ï¼Œå¦‚æœåœ¨è¿è¡Œæ—¶å¯¹è±¡èƒ½å¤Ÿå“åº”è¿™ä¸ªæ¶ˆæ¯ï¼Œåˆ™ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ¥é”™ã€‚

  - `self`: æ¯ä¸ªå¯¹è±¡æ–¹æ³•çš„éšå«å‚æ•°ï¼Œå®ƒæŒ‡å‘è°ƒç”¨å½“å‰æ–¹æ³•çš„å¯¹è±¡ã€‚`self` çš„æ•°æ®ç±»å‹ä¹Ÿæ˜¯ `id`ï¼Œä½†å®ƒé€šå¸¸ç”¨æ¥å¼•ç”¨å¯¹è±¡è‡ªå·±ã€‚å¯ä»¥ç”¨ `self` æ¥è®¿é—®å±æ€§æˆ–è€…è°ƒç”¨æ–¹æ³•ã€‚

  - `super`: å¹¶ä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ ‡è¯†ç¬¦ï¼Œä»£è¡¨å½“å‰å¯¹è±¡çš„çˆ¶ç±»ã€‚å½“ä½ å‘ `super` å‘é€æ¶ˆæ¯æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ²¿ç€æ–¹æ³•çš„ç»§æ‰¿é“¾å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°ä¸ºæ­¢ã€‚è¿™ä¸ªæœºåˆ¶å¯ç”¨äºåœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œä»¥å®ç°ä»£ç çš„å¤ç”¨ã€‚

:::

#### â“`id` vs `NSObject`

::: details ğŸ’¡

  - `id`: ä¸€ä¸ªåŠ¨æ€ç±»å‹çš„å¯¹è±¡æŒ‡é’ˆï¼Œå®ƒå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„ `Objective-C` å¯¹è±¡ã€‚`id` ç±»å‹çš„å¯¹è±¡å¯ä»¥æ¥æ”¶ä»»ä½•æ¶ˆæ¯è€Œä¸ä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™ï¼Œè¿è¡ŒæœŸè‹¥æ— æ³•å“åº”åˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚ä½¿ç”¨ `id` ç±»å‹å¯ä»¥ç¼–å†™å‡ºéå¸¸çµæ´»çš„ä»£ç ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦é¢å¯¹æ½œåœ¨çš„è¿è¡ŒæœŸé”™è¯¯ã€‚

  - `NSObject`: æ˜¯æ‰€æœ‰ `Objective-C` ç±»çš„åŸºç±»ï¼Œå®šä¹‰äº†ä¸€äº›æ‰€æœ‰å¯¹è±¡éƒ½èƒ½å“åº”çš„åŸºæœ¬æ–¹æ³•ï¼Œä¾‹å¦‚ -`init`ã€`retain`ã€`release` ç­‰ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ç±»å‹å£°æ˜ä¸º `NSObject *`ï¼Œåªèƒ½ç»™å®ƒå‘é€ `NSObject` ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚å¦‚æœè¯•å›¾å‘é€å…¶ä»–æ¶ˆæ¯ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚

:::

#### â“`id` vs `instancetype`

::: details ğŸ’¡

  - `id`ï¼šä¸€ä¸ªåŠ¨æ€ç±»å‹çš„å¯¹è±¡æŒ‡é’ˆï¼Œå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„ `Objective-C` å¯¹è±¡ã€‚ä½¿ç”¨ `id` ç±»å‹çš„å˜é‡å¯ä»¥è°ƒç”¨ä»»ä½•æ–¹æ³•ï¼Œå¦‚æœè¯¥å¯¹è±¡çš„ç±»å®ç°äº†è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨ã€‚ç¼ºç‚¹æ˜¯ç¼–è¯‘å™¨æ— æ³•è¿›è¡Œç±»å‹æ£€æŸ¥å’Œè‡ªåŠ¨è¡¥å…¨ã€‚

  - `instancetype`ï¼šä¸€ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œä¸»è¦ç”¨äºè¡¨ç¤ºå¯¹è±¡çš„å®ä¾‹ï¼Œç”¨åœ¨æ–¹æ³•çš„è¿”å›ç±»å‹ä¸­ã€‚ä¸ `id` ç±»å‹ä¸åŒï¼Œæ–¹æ³•ä½¿ç”¨ `instancetype` ä½œä¸ºè¿”å›ç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè®¤ä¸ºè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå½“å‰ç±»çš„å®ä¾‹ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥å¸®åŠ©ç¼–è¯‘å™¨è¿›è¡Œæ›´å‡†ç¡®çš„ç±»å‹æ£€æŸ¥ï¼ŒåŒæ—¶è¿˜èƒ½æä¾›è‡ªåŠ¨è¡¥å…¨çš„æ”¯æŒã€‚

:::

#### â“`id` ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ç‚¹è¯­æ³•

::: details ğŸ’¡

  > ç‚¹è¯­æ³•æ˜¯ä¸€ç§ç®€åŒ–å±æ€§è®¿é—®çš„è¯­æ³•ã€‚åº•å±‚å®é™…ä¸Šæ˜¯ç¼–è¯‘å™¨åšäº†ä¸€ä¸ªè½¬æ¢æ“ä½œï¼ŒæŠŠç‚¹è¯­æ³•è½¬æ¢æˆç›¸åº”çš„ `getter`ï¼ˆå¯¹äºè·å–å±æ€§ï¼‰æˆ–è€… `setter`ï¼ˆå¯¹äºè®¾ç½®å±æ€§ï¼‰æ–¹æ³•çš„è°ƒç”¨ã€‚

  - æ˜ç¡®ç±»å‹çš„å¯¹è±¡ï¼Œç¼–è¯‘å™¨å¯ä»¥çŸ¥é“å¯¹è±¡çš„ç±»å®šä¹‰ï¼ŒçŸ¥é“è¯¥å¯¹è±¡æ‰€æ‹¥æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸå¯ä»¥æ­£ç¡®åœ°åšå‡ºè½¬æ¢ã€‚

  - `id` ç±»å‹çš„å¯¹è±¡ï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“å®ƒçš„å®é™…ç±»å‹ä»¥åŠæ‹¥æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œç‚¹è¯­æ³•çš„è½¬æ¢ã€‚

:::

### â“`nil` vs `Nil` vs `NULL` vs `NSNull`

::: details ğŸ’¡

> è¿™äº›éƒ½æ˜¯è¡¨ç¤º"æ— "æˆ–"ç©º"çš„ç‰¹å®šå€¼

  - `nil`ï¼šä¸€ä¸ªè¡¨ç¤ºå¯¹è±¡æŒ‡é’ˆä¸ºç©ºçš„ç‰¹æ®Šå€¼ã€‚

  - `Nil`ï¼šä¸€ä¸ªè¡¨ç¤ºç±»æŒ‡é’ˆä¸ºç©ºçš„ç‰¹æ®Šå€¼ã€‚

  - `NULL`ï¼šä¸€ä¸ªè¡¨ç¤ºæœªæŒ‡å‘ä»»ä½•ä¸œè¥¿çš„åŸå§‹æŒ‡é’ˆçš„ç‰¹æ®Šå€¼ã€‚æ­£å¦‚ä½ åœ¨ä»»ä½•çº¯`C`çš„ä»£ç å’Œ`Objective-C`ä»£ç ä¸­çœ‹åˆ°çš„ï¼Œ`NULL`é€šå¸¸æŒ‡é’ˆè¡¨ç¤º"æ²¡æœ‰ä¸œè¥¿"æˆ–è€…æ˜¯"æ— "ã€‚

  - `NSNull`ï¼šä¸€ä¸ªè¡¨ç¤ºç©ºå€¼çš„ç±»ï¼Œé€šå¸¸åœ¨ä¸èƒ½ä½¿ç”¨`nil`çš„æƒ…å†µä¸‹è¡¨ç¤ºç©ºå€¼ã€‚æ¯”å¦‚åœ¨`NSArray`æˆ–`NSDictionary`å¯¹è±¡ä¸­ï¼Œä½ ä¸èƒ½ç›´æ¥ä½¿ç”¨`nil`ï¼Œä½†ä½ å¯ä»¥ç”¨ä¸€ä¸ª`NSNull`å¯¹è±¡æ¥ä»£è¡¨"æ²¡æœ‰å€¼"çš„æƒ…å†µã€‚

:::

### â“ç±»ç°‡çš„ä¼˜ç¼ºç‚¹

::: details ğŸ’¡

  > ç±»ç°‡ï¼ˆ`Class Cluster`ï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œåœ¨ `Objective-C` çš„ç±»åº“ä¸­æœ‰å¹¿æ³›çš„è¿ç”¨ï¼Œä¾‹å¦‚`NSString`ï¼Œ`NSArray`ï¼Œ`NSDictionary`ç­‰éƒ½æ˜¯ç±»ç°‡çš„ä¾‹å­ã€‚ç±»ç°‡å°†ä¸€äº›å®ç°ç»†èŠ‚å°è£…åœ¨å†…éƒ¨ï¼Œå¯¹å¤–åªæä¾›ä¸€ä¸ªç®€å•çš„å…¬å…±æ¥å£ã€‚

  - ä¼˜ç‚¹ï¼š

    * å°è£…ï¼šç±»ç°‡å°†ç›¸å…³çš„å­ç±»æ”¾åœ¨åŒä¸€ä¸ªçˆ¶ç±»ä¸­ï¼Œä½¿å¾—æ¡†æ¶æ›´åŠ ç®€æ´ï¼Œä½¿ç”¨è€…æ— éœ€ç†Ÿæ‚‰å¤§é‡ç±»å°±èƒ½å¤Ÿåšå¾ˆå¤šäº‹æƒ…ã€‚

    * éšè—å®ç°ç»†èŠ‚ï¼šå¯¹å¤–åªæš´éœ²æŠ½è±¡çš„æ¥å£ï¼Œéšè—äº†å…·ä½“å®ç°çš„ç»†èŠ‚ã€‚è¿™ä¹Ÿä¿æŠ¤äº†ä»£ç çš„ç¨³å®šæ€§ï¼Œå³ä½¿åœ¨å®ç°è¿‡ç¨‹ä¸­æ”¹å˜äº†ç›¸å…³çš„ç±»æˆ–ç®—æ³•ï¼Œå¯¹å¤–æ¥å£çš„ä¸å˜å°±ä¿è¯äº†ä»£ç çš„ç¨³å®šæ€§ã€‚

    * ä»£ç çš„åˆ†å±‚æ›´åŠ æ¸…æ™°ï¼šç±»ç°‡æ¨¡å¼å°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»‘å®šåœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œä½¿å¾—ç±»çš„åˆ†å±‚å…³ç³»æ›´æ¸…æ¥šã€‚

  - ç¼ºç‚¹ï¼š

    * å¯æ‰©å±•æ€§å·®ï¼šç”±äºç±»ç°‡çš„å…·ä½“å®ç°ä¸å¯¹å¤–æš´éœ²ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å®šåˆ¶æŸäº›ç‰¹æ®Šçš„è¡Œä¸ºï¼Œæ‰©å±•æ€§å°±ä¼šå˜å¾—å¾ˆå·®ã€‚

    * åˆ›å»ºå­ç±»å›°éš¾ï¼šç”±äºå¤§éƒ¨åˆ†æ–¹æ³•åœ¨ç§æœ‰å­ç±»ä¸­å®ç°ï¼Œå¦‚æœè¦åˆ›å»ºç±»ç°‡çš„å­ç±»å¹¶è¦†ç›–æŸäº›æ–¹æ³•ï¼Œå¯èƒ½éœ€è¦å®ç°å¤§é‡çš„ä»£ç æ‰èƒ½è·å¾—é¢„æœŸçš„è¡Œä¸ºã€‚

    * ç»´æŠ¤éš¾åº¦å¤§ï¼šç”±äºç±»ç°‡ä¸­åŒ…å«äº†å¤§é‡çš„ç§æœ‰å­ç±»ï¼Œå¦‚æœè¦ä¿®æ”¹æˆ–æ‰©å±•ä»£ç ï¼Œå°±éœ€è¦å¯¹æ‰€æœ‰çš„å­ç±»è¿›è¡Œå¤„ç†ï¼Œè¿™ä¼šå¢åŠ ç»´æŠ¤éš¾åº¦ã€‚

:::

### â“`NSNumber` æ˜¯å¦‚ä½•å®ç°çš„

::: details ğŸ’¡

> `NSNumber`æ˜¯ `Foundation` æ¡†æ¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒæ˜¯åŒ…è£…ç±»å‹ï¼Œä¹Ÿæ˜¯å¯¹åŸºæœ¬çš„ `C` å’Œ `Objective-C` æ•°æ®ç±»å‹(`Integer`ã€`Float`ã€`Bool`ç­‰)è¿›è¡Œå°è£…çš„ä¸€ä¸ªç±»ã€‚åœ¨ `Objective-C` ä¸èƒ½ç›´æ¥åœ¨`NSArray`ã€`NSDictionary` ç­‰é›†åˆç±»ä¸­å­˜æ”¾éå¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° `NSNumber` è¿™ä¸ªç±»ã€‚

å¤§è‡´å®ç°åŸç†ï¼š`NSNumber`çš„å¯¹è±¡å¾ˆå¯èƒ½å†…éƒ¨åŒ…å«ä¸€ä¸ª `union` ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œè¿™ä¸ª `union` åŒ…å«äº†æ‰€æœ‰å¯ä»¥è¡¨ç¤ºçš„æ•°æ®ç±»å‹ï¼ˆæ•´æ•°ï¼Œæµ®ç‚¹ï¼Œå¸ƒå°”ï¼Œetcï¼‰ã€‚

```objc
// æ„é€ æ–¹æ³•å¯èƒ½æ˜¯æ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹æ¥è®¾ç½®å¯¹åº”çš„ union æˆå‘˜å˜é‡çš„å€¼
- (instancetype)initWithInt:(int)value {
    if (self = [super init]) {
        _value.intVal = value;
    }
    return self;
}
- (instancetype)initWithFloat:(float)value {
    if (self = [super init]) {
        _value.floatVal = value;
    }
    return self;
}

// å–å€¼æ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæ ¹æ®å–å€¼çš„ç±»å‹è¿”å›å¯¹åº”çš„ union æˆå‘˜å˜é‡çš„å€¼
- (int)intValue {
    return _value.intVal;
}
- (float)floatValue {
    return _value.floatVal;
}
```

:::

### NSString
  
#### â“`OC` ä¸­çš„ä¸‰ç§å­—ç¬¦ä¸²
    
::: details ğŸ’¡
    
  - `__NSCFConstantString` ï¼šåœ¨ç¼–è¯‘æ—¶è¢«åˆ›å»ºçš„å¸¸é‡å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚`NSString *str = @"Hello, World!"`ã€‚è¿™äº›å¯¹è±¡ä¼šåœ¨ç¼–è¯‘æ—¶å°±è¢«åˆ›å»ºï¼Œå¹¶ä¸”åœ¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¸ä¼šè¢«é”€æ¯ã€‚
  
  - `__NSTaggedPointerString` ï¼šä½¿ç”¨ `Tagged Pointer` æŠ€æœ¯æ¥æé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼Œé€šå¸¸ç”¨äºå­˜å‚¨è¾ƒå°çš„å­—ç¬¦ä¸²æ•°æ®ã€‚
  
  - `__NSCFString` ï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª `Core Foundation` å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼ˆ`CFStringRef`ï¼‰ï¼Œè¿™ç§ç±»å‹çš„å­—ç¬¦ä¸²é€šå¸¸ä¼šåœ¨è¿è¡Œæ—¶ç¨‹åºåŠ¨æ€åˆ›å»ºçš„å¯¹è±¡å­—ç¬¦ä¸²ã€‚

:::

#### â“`Tagged Pointer` äº†è§£å—

::: details ğŸ’¡

  > `iOS 7` ä¹‹å `Apple` ä¸ºäº†ä¼˜åŒ–å¼•å…¥çš„ä¸€é¡¹æŠ€æœ¯ã€‚ä»å­—é¢æ„æ€ä¸Šæ¥çœ‹`Tagged Pointer`å°±æ˜¯å¸¦æœ‰æ ‡ç­¾çš„æŒ‡é’ˆã€‚
  
  ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ `64-bit` æ¶æ„ä¸‹ï¼Œä¸€ä¸ªæŒ‡é’ˆçš„å€¼éœ€è¦å ç”¨ `8 byte` çš„å†…å­˜ç©ºé—´ï¼›ç„¶è€Œå¯¹äºä¸€äº›éå¸¸å°çš„æ•°æ®ï¼Œæ¯”å¦‚ `NSNumber`ã€`NSDate`ã€`NSString` ç­‰ï¼Œä½¿ç”¨ `8 byte` å­˜å‚¨å¯¹è±¡æŒ‡é’ˆå°±æ˜¾å¾—éå¸¸æµªè´¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè‹¹æœå¼•å…¥äº† `Tagged Pointer` æŠ€æœ¯ï¼Œé€šè¿‡æ ‡ç­¾ç›´æ¥å°†å°çš„æ•°æ®å¯¹è±¡åµŒå…¥åˆ°æŒ‡é’ˆä¸­ï¼Œè¿™æ ·å¯¹äºå°çš„æ•°æ®å¯¹è±¡ï¼Œå°±æ— éœ€é¢å¤–çš„å†…å­˜æ¥å­˜å‚¨äº†ï¼Œèƒ½å¤Ÿæ˜¾è‘—æé«˜å†…å­˜çš„åˆ©ç”¨ç‡ã€‚éœ€è¦æ³¨æ„ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä½¿ç”¨ `Tagged Pointer` æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä¸èƒ½äººä¸ºæ§åˆ¶ã€‚
  
  å…·ä½“åˆ° `NSString` è¿™ç§åœºæ™¯ä¸­ï¼Œå¦‚æœå­—ç¬¦ä¸²çš„å†…å®¹éå¸¸çŸ­ï¼Œé‚£ä¹ˆå®ƒçš„å®ç°æ–¹å¼å¯èƒ½å°±æ˜¯ `Tagged Pointer`ï¼Œç›´æ¥å°†å­—ç¬¦ä¸²å†…å®¹å­˜åœ¨æŒ‡é’ˆä¸­ï¼Œæé«˜äº†å†…å­˜åˆ©ç”¨ç‡ã€‚
  
:::

#### â“`NSString` å¦‚ä½•è®¡ç®—å­—ç¬¦çš„ä¸ªæ•°

::: details ğŸ’¡

  å¯ä»¥ä½¿ç”¨ `NSString` çš„ `length` å±æ€§æ¥è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼Œä½†è¿™å®é™…ä¸Šè¿”å›çš„æ˜¯å­—ç¬¦ä¸²ä¸­ `Unicode` ç¼–ç çš„å­—ç¬¦æ•°é‡ï¼Œå¹¶ä¸æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„å­—ç¬¦æ•°é‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦å’Œä¸€ä¸ª `emoji` è¡¨æƒ…ï¼Œå¯èƒ½éƒ½ä¼šè¢«ç®—ä½œå¤šä¸ª `Unicode` å­—ç¬¦ã€‚

å¯ä»¥ä½¿ç”¨ `NSString` çš„ `enumerateSubstringsInRange:options:usingBlock:` æ–¹æ³•ï¼Œç”¨ `NSStringEnumerationByComposedCharacterSequences` é€‰é¡¹æ¥ç»Ÿè®¡å­—ç¬¦ä¸²çš„å­—ç¬¦æ•°é‡ã€‚

```objc
__block NSUInteger characterCount = 0;
[myString enumerateSubstringsInRange:NSMakeRange(0, myString.length)
                           options:NSStringEnumerationByComposedCharacterSequences
                        usingBlock:^(NSString *substring, NSRange substringRange, NSRange enclosingRange, BOOL *stop) {
    characterCount++;
}];
```

:::


### NSArray

#### â“`[[NSMutableArray alloc] init]` vs `[NSMutableArray array]`

::: details ğŸ’¡

  - ç›¸åŒç‚¹ï¼šéƒ½æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯å˜æ•°ç»„çš„ã€‚

  - ä¸åŒç‚¹
    * ä»£ç ç®€æ´åº¦ï¼š`[NSMutableArray array]` æ¯” `[[NSMutableArray alloc] init]` ä»£ç æ›´ç®€æ´ï¼Œæ›´æ˜“äºé˜…è¯»å’Œç†è§£ã€‚
    * è¿”å›çš„å¯¹è±¡æ‰€æœ‰æƒï¼š`[[NSMutableArray alloc] init]` è¿”å›çš„æ˜¯ä¸€ä¸ªå¼•ç”¨è®¡æ•°ä¸º 1 çš„å¯¹è±¡ï¼Œè€Œ `[NSMutableArray array]` è¿”å›çš„æ˜¯ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼ˆ`autoreleased object`ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨æ–¹æ³•å†…åˆ›å»ºäº†æ•°ç»„ï¼Œç„¶åéœ€è¦è¿”å›è¿™ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆ `[NSMutableArray array]` æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒè¿”å›çš„å¯¹è±¡ä¼šåœ¨æ–¹æ³•ç»“æŸåè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚å¦‚æœæ˜¯åœ¨æ–¹æ³•å†…éƒ¨åˆ›å»ºæ•°ç»„ï¼Œä¸”æ•°ç»„åœ¨æ–¹æ³•ç»“æŸåå°±ä¸å†éœ€è¦ï¼Œé‚£ä¹ˆ `[[NSMutableArray alloc] init]` æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒçš„å¼•ç”¨è®¡æ•°ä¸º1ï¼Œå½“ä¸å†éœ€è¦å®ƒæ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ `release` æ–¹æ³•å°†å…¶é‡Šæ”¾ã€‚

:::

#### â“`NSMutableArray` çš„åº•å±‚å®ç°

::: details ğŸ’¡

> `NSMutableArray` æ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤å…ƒç´ ã€‚

å®ç°åŸç†ï¼š

  - åœ¨åˆ›å»º `NSMutableArray` æ—¶ï¼Œä¼šåˆ†é…ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œç”¨æ¥ä¿å­˜å…ƒç´ ã€‚å½“å…ƒç´ æ•°é‡è¶…è¿‡æ•°ç»„çš„å®¹é‡æ—¶ï¼Œ`Foundation` æ¡†æ¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€æ›´å¤§çš„æ•°ç»„ï¼Œç„¶åå°†æ—§æ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ï¼Œç„¶åé‡Šæ”¾æ—§æ•°ç»„ã€‚

  - å½“ä» `NSMutableArray` ä¸­åˆ é™¤å…ƒç´ æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç«‹å³æ”¶ç¼©å†…å­˜ç©ºé—´ã€‚ç›¸åï¼Œè¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ä¼šè¢«æ ‡è®°ä¸ºç©ºé—²ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜æ–°æ·»åŠ çš„å…ƒç´ ã€‚åªæœ‰å½“æ•°ç»„çš„ç©ºé—²ç©ºé—´è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼æ—¶ï¼Œ`Foundation` æ¡†æ¶æ‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€æ›´å°çš„æ•°ç»„ï¼Œç„¶åå°†æ—§æ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ï¼Œç„¶åé‡Šæ”¾æ—§æ•°ç»„ã€‚

:::

### NSDictionary

#### â“`NSDictionary` çš„åº•å±‚å®ç°

::: details ğŸ’¡

> `NSDictionary` æ˜¯ä¸€ä¸ªä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨å¯¹è±¡çš„æ¥å£ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œè¡¨å®ç°ã€‚

å®ç°åŸç†ï¼š

  - å“ˆå¸Œè¡¨ï¼šåœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œå“ˆå¸Œå‡½æ•°å°†æ¯ä¸ªé”® (`key`) æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªå”¯ä¸€çš„ç´¢å¼•ã€‚é€šè¿‡è¯¥ç´¢å¼•ï¼Œå­˜å‚¨çš„ç›¸å…³å€¼ (`value`) å¯ä»¥å¿«é€Ÿåœ°è¢«æ‰¾åˆ°ã€‚è¿™å°±æ˜¯ `NSDictionary` å¯ä»¥å¿«é€ŸæŸ¥æ‰¾é”®å¯¹åº”å€¼çš„åŸå› ã€‚

  - ç¢°æ’å¤„ç†ï¼šå½“ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨çš„åŒä¸€ä¸ªä½ç½®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿç¢°æ’ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæœ‰å‡ ç§ç­–ç•¥å¯ä»¥å¤„ç†è¿™ç§ç¢°æ’ï¼Œæ¯”å¦‚é“¾åœ°å€æ³•ï¼Œå¼€æ”¾åœ°å€æ³•ç­‰ã€‚ä¸è¿‡å…·ä½“ `Foundation` ä½¿ç”¨å“ªç§ç­–ç•¥å»å¤„ç†ç¢°æ’æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šã€‚

  - åŠ¨æ€è°ƒæ•´ï¼šéšç€æ•°æ®çš„å¢åŠ ï¼Œä¸ºäº†ä¿æŒæ“ä½œçš„é«˜æ•ˆï¼Œå“ˆå¸Œè¡¨å¯èƒ½éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹ç»å¸¸ä¼´éšç€æ•°æ®çš„é‡æ–°å“ˆå¸Œï¼Œä¸ºçš„å°±æ˜¯ä¿æŒå“ˆå¸Œå€¼å‡åŒ€åˆ†å¸ƒï¼Œä¿æŒä¼˜ç§€çš„æŸ¥æ‰¾æ•ˆç‡ã€‚
    
:::
  
#### â“`NSDictionary` vs `NSHashTable` vs `NSMapTable`

::: details ğŸ’¡

> `NSDictionary`ï¼Œ`NSHashTable` å’Œ `NSMapTable` éƒ½æ˜¯ `Objective-C` ä¸­å¸¸ç”¨çš„é›†åˆç±»å‹ã€‚

  - `NSDictionary`ï¼šå­˜å‚¨é”®å€¼å¯¹çš„é›†åˆï¼Œæ¯ä¸ªé”®éƒ½æ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚å¯¹é”®è¿›è¡Œ `copy` æ“ä½œï¼Œå¯¹å€¼è¿›è¡Œ `retain`(å¼ºå¼•ç”¨)æ“ä½œã€‚é”®å¿…é¡»è¦ä¿æŒå”¯ä¸€ã€‚æŸ¥æ‰¾æ“ä½œæ€§èƒ½é«˜æ•ˆï¼Œæ—¶é—´å¤æ‚æ€§ä¸º `O(1)`ã€‚

  - `NSHashTable`ï¼šä¸€ä¸ªå¯ä»¥å­˜å‚¨ä»»æ„å¯¹è±¡çš„é›†åˆï¼Œé›†åˆä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯å”¯ä¸€çš„ã€‚è¯¥ç±»æä¾›äº†å¯¹å¯¹è±¡å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨çš„é€‰é¡¹ï¼Œå¯ä»¥æ›´åŠ çµæ´»åœ°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚

  - `NSMapTable`ï¼šå’Œ `NSDictionary` éå¸¸ç›¸ä¼¼ï¼Œä½† `NSMapTable` å¯¹é”®å’Œå€¼å¯ä»¥é€‰æ‹©å¼ºå¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œæ¯” `NSDictionary` æ›´åŠ çµæ´»ã€‚å¦å¤–ï¼Œ`NSMapTable` å…è®¸é”®å’Œå€¼ä¸º`nil`ï¼Œè€Œ `NSDictionary` åˆ™ä¸å…è®¸ã€‚

:::
  
> â“å„è‡ªæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯
  
::: details ğŸ’¡
   
  - `NSDictionary`ï¼š`NSDictionary` ç”±äºå…¶é«˜æ•ˆçš„æŸ¥æ‰¾é€Ÿåº¦ï¼Œå¹¿æ³›ç”¨äºéœ€è¦ä¾æ®é”®æŸ¥æ‰¾å€¼çš„åœºæ™¯ã€‚
    > ä¾‹å¦‚ï¼Œé…ç½®æ–‡ä»¶çš„å­˜å‚¨å’Œè¯»å–ï¼Œç½‘ç»œè¯·æ±‚çš„å‚æ•°å°è£…ï¼ŒJSON æ•°æ®çš„è§£æç­‰ã€‚

  - `NSHashTable`ï¼š`NSHashTable` é€‚ç”¨äºå­˜å‚¨ä¸éœ€è¦é‡å¤çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹å†…å­˜ç®¡ç†æœ‰ä¸€å®šè¦æ±‚çš„åœºæ™¯ã€‚
    > ä¾‹å¦‚ï¼Œåœ¨ç¼“å­˜ä¸­å­˜å‚¨å¯¹è±¡ä½†ä¸å¼•å…¥å¼ºå¼•ç”¨ï¼Œé˜²æ­¢å†…å­˜æ— æ³•é‡Šæ”¾çš„é—®é¢˜ï¼›æˆ–è€…åœ¨å­˜å‚¨ `delegate` å¯¹è±¡æ—¶ï¼Œé¿å…å¼•å…¥å¾ªç¯å¼•ç”¨ã€‚

  - `NSMapTable`ï¼š`NSMapTable` å¯ä»¥å®ç°å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨é”®å€¼å¯¹ï¼Œæ‰€ä»¥é€‚ç”¨äºä¸€äº›ç‰¹æ®Šåœºæ™¯ã€‚
    > ä¾‹å¦‚ï¼Œåœ¨ä¸å¼•å…¥å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ç¼“å­˜å¯¹è±¡ï¼Œæˆ–è€…å¸Œæœ›è·Ÿè¸ªå“ªäº›å¯¹è±¡å¼•ç”¨äº†å…¶å®ƒå¯¹è±¡ç­‰ã€‚

:::
   
#### â“`NSDictionary` vs `NSCache`

::: details ğŸ’¡

`NSDictionary` å’Œ `NSCache` éƒ½æ˜¯èƒ½å¤Ÿå­˜å‚¨é”®å€¼å¯¹çš„é›†åˆï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›ä¸»è¦çš„åŒºåˆ«ï¼Œä½¿å®ƒä»¬é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼š

  - `NSDictionary` æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å“ˆå¸Œè¡¨ï¼Œå…¶ä¸­çš„é”®å€¼å¯¹éƒ½æ˜¯å¼ºå¼•ç”¨çš„ã€‚é”®æ˜¯å”¯ä¸€çš„ä¸”ä¸å¯å˜çš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ`NSCache` æ˜¯ä¸€ä¸ªå¯å˜çš„é›†åˆï¼Œå…¶ä¸­çš„é”®å€¼å¯¹éƒ½æ˜¯å¼ºå¼•ç”¨çš„ï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šé”®ä¸æ˜¯åƒ `NSDictionary` ç®¡ç†é‚£æ ·é€šè¿‡ `copy` ç®¡ç†ï¼Œè€Œæ˜¯é€šè¿‡ `retain` ç®¡ç†ï¼Œå› æ­¤é”®å¯ä»¥æ˜¯å¯å˜çš„ã€‚

  - å¦ä¸€ä¸ªé‡è¦çš„åŒºåˆ«åœ¨äºå†…å­˜ç®¡ç†ã€‚`NSCache` åœ¨ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾ç¼“å­˜çš„éƒ¨åˆ†æˆ–å…¨éƒ¨æ•°æ®ä»¥èŠ‚çœå†…å­˜ã€‚è¿™ä½¿å¾—åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œ`NSCache` å¯ä»¥è‡ªåŠ¨å¤„ç†ä½å†…å­˜è­¦å‘Šï¼Œè€Œ `NSDictionary` åˆ™éœ€è¦æ‰‹åŠ¨å¤„ç†ä½å†…å­˜è­¦å‘Šã€‚

  - `NSCache` æ”¯æŒé€šè¿‡ `NSDiscardableContent` åè®®æ¥æ§åˆ¶ç¼“å­˜å†…å®¹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™æ ·çš„å¯¹è±¡åœ¨è¢«ç¼“å­˜æ—¶ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ª `beginContentAccess` ä¹‹åé…å¯¹çš„ `endContentAccess` è°ƒç”¨è®¡æ•°å™¨ã€‚å½“å¯¹è±¡çš„è®¡æ•°å™¨ä¸º 0 æ—¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æœ‰å¯èƒ½è¢«æ¸…å‡ºç¼“å­˜ã€‚

æ€»ç»“ï¼š`NSDictionary` å’Œ `NSCache` çš„ä¸åŒä¸»è¦åœ¨äºå†…å­˜ç®¡ç†å’Œå¯å˜æ€§ã€‚å®é™…ä¸Šï¼Œ`NSCache` æ›´ç±»ä¼¼ä¸€ä¸ªä¼˜åŒ–äº†å†…å­˜ç®¡ç†çš„ `NSMutableDictionary`ï¼Œæ›´é€‚åˆç”¨äºå­˜å‚¨å¤§é‡ä¼šå æ®å¤§é‡å†…å­˜çš„å¯¹è±¡ï¼Œä¾‹å¦‚å›¾ç‰‡ç­‰ã€‚

:::

  > â“`NSCache` ä¸­ç¼“å­˜çš„å¯¹è±¡ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™è¢«é‡Šæ”¾

::: details ğŸ’¡

  - å†…å­˜å‹åŠ›ï¼šå½“æ“ä½œç³»ç»Ÿè§¦å‘ä½å†…å­˜è­¦å‘Šæ—¶ï¼Œ`NSCache` ä¼šè‡ªåŠ¨é‡Šæ”¾ä¸€äº›ç¼“å­˜çš„å¯¹è±¡ä»¥èŠ‚çº¦å†…å­˜ã€‚

  - ç¼“å­˜æŸä¸ªå¯¹è±¡çš„ `NSCache` å®ä¾‹è¢«é”€æ¯æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šè¢«é‡Šæ”¾ã€‚

  - å½“ç¼“å­˜è¾¾åˆ°å…¶æé™æ—¶ï¼ˆè¿™å–å†³äºä½ è®¾ç½®çš„ç¼“å­˜çš„æ•°é‡å’Œæ€»æˆæœ¬çš„ä¸Šé™ï¼‰ï¼Œ`NSCache` å¯èƒ½ä¼šå¼€å§‹ç§»é™¤ä¸€äº›å¯¹è±¡ã€‚

  - å¦‚æœç¼“å­˜çš„å¯¹è±¡å®ç°äº† `NSDiscardableContent` åè®®ï¼Œé‚£ä¹ˆå¯¹è±¡çš„é‡Šæ”¾è¿˜ä¼šå–å†³äºå®ƒçš„ `beginContentAccess` å’Œ `endContentAccess` æ–¹æ³•çš„è°ƒç”¨è®¡æ•°ã€‚å½“è¿™ä¸ªè®¡æ•°ä¸º 0 å¹¶ä¸”å†…å­˜å‹åŠ›è¾ƒå¤§æ—¶ï¼Œå¯¹è±¡å¯èƒ½è¢«é‡Šæ”¾ã€‚

:::

#### â“`isEqual` å’Œ `hash` çš„å…³ç³»

::: details ğŸ’¡

  - `isEqual:` æ–¹æ³•æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚
    > å¦‚ä½•åˆ¤æ–­å¯¹è±¡çš„ç›¸ç­‰æ€§ï¼Œå¯ä»¥åœ¨è‡ªå®šä¹‰ç±»ä¸­é‡å†™è¿™ä¸ªæ–¹æ³•æ¥è‡ªå®šä¹‰åˆ¤æ–­è§„åˆ™ã€‚

  - `hash` æ–¹æ³•è¿”å›ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼ˆ`NSUInteger`ï¼‰çš„å“ˆå¸Œå€¼ï¼Œè¿™ä¸ªå€¼è¢«ç”¨äº `UITableView`ã€`NSSet`ã€`NSDictionary` ç­‰é›†åˆç±»çš„æ“ä½œä»¥æå‡æ€§èƒ½ã€‚
    > å¯¹è±¡çš„å“ˆå¸Œå€¼ä¸»è¦æ˜¯é€šè¿‡å¯¹è±¡çš„å†…å®¹è¿›è¡Œè®¡ç®—å¾—å‡ºã€‚

  - `isEqual:` æ–¹æ³•å’Œ `hash` æ–¹æ³•éœ€è¦ä¿æŒä¸€è‡´ï¼Œæ„æ€æ˜¯å½“ä¸¤ä¸ªå¯¹è±¡ `isEqual` çš„è¿”å›å€¼ç›¸ç­‰æ—¶ï¼Œå®ƒä»¬çš„ `hash` æ–¹æ³•è¿”å›å€¼å¿…é¡»ä¹Ÿç›¸ç­‰ã€‚
    > âš ï¸ åè¿‡æ¥å¹¶ä¸ä¸€å®šï¼Œå³å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„ `hash` å€¼ç›¸ç­‰ï¼Œå¹¶ä¸ä¸€å®šè¦æ±‚ä»–ä»¬ `isEqual` å€¼ä¹Ÿä¸€å®šç›¸ç­‰ï¼Œå› ä¸ºä¸åŒçš„å¯¹è±¡æœ‰å¯èƒ½äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ï¼ˆé€šå¸¸è¢«ç§°ä¸ºå“ˆå¸Œå†²çªï¼‰ã€‚ 

æ€»ç»“ï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰å¯¹è±¡åŠå…¶ç›¸ç­‰æ€§çš„è§„åˆ™ï¼Œé‚£ä¹ˆé€šå¸¸éœ€è¦åŒæ—¶é‡è½½ `isEqual:` å’Œ `hash` æ–¹æ³•ï¼Œå¹¶ç¡®ä¿å®ƒä»¬çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚

:::

------

## æµç¨‹æ§åˆ¶

### â“ä»‹ç»ä¸€ä¸‹ `iOS` ä¸­çš„éå†æ–¹æ³•

::: details ğŸ’¡

  - **ä¼ ç»Ÿçš„ for å¾ªç¯**ï¼šå¯¹äºå¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ çš„é›†åˆï¼ˆå¦‚æ•°ç»„ï¼‰ã€‚

    ```objc
    NSArray *array = ...;
    for (NSInteger i = 0; i < array.count; i++) {
        id obj = array[i];
        // ä½¿ç”¨ obj å’Œ i
    }
    ```

  - **for-in å¾ªç¯**ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„éå†æ–¹å¼ï¼Œç®€å•ä¸”æ€§èƒ½ä¼˜ç§€ã€‚

    ```objc
    NSArray *array = ...;
    for (id obj in array) {
        // ä½¿ç”¨ obj
    }
    ```

  - **Block æšä¸¾**ï¼šå¾ˆå¤šé›†åˆç±»éƒ½æä¾›äº†åŸºäº `block` çš„éå†æ–¹æ³•ï¼Œæ¯”å¦‚`enumerateObjectsUsingBlock:`ã€‚

    ```objc
    NSArray *array = ...;
    [array enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        // ä½¿ç”¨ obj å’Œ idx
    }];
    ```

  - **NSEnumerator**ï¼šä¸€ä¸ªç”¨äºéå†é›†åˆçš„ç±»ï¼Œä½¿ç”¨ `nextObject` æ–¹æ³•å¯ä»¥å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ã€‚

    ```objc
    NSArray *array = ...;
    NSEnumerator *enumerator = [array objectEnumerator];
    id obj;
    while (obj = [enumerator nextObject]) {
        // ä½¿ç”¨ obj
    }
    ```
    
:::

### â“`for in` éå†çš„æ—¶å€™åœ¨é‡Œé¢å¢åŠ ä¸€ä¸ªå…ƒç´ ä¼šæ€ä¹ˆæ ·ï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´ ä¼šæ€ä¹ˆæ ·ï¼Œä¸ºä»€ä¹ˆ

::: details ğŸ’¡

> åœ¨ä½¿ç”¨ `for in` éå†é›†åˆç±»ï¼ˆæ¯”å¦‚æ•°ç»„æˆ–å­—å…¸ï¼‰çš„æ—¶å€™ï¼Œ`Objective-C` æ˜¯ä¸å…è®¸åœ¨éå†è¿‡ç¨‹ä¸­æ›´æ”¹é›†åˆï¼ˆå³åœ¨å¢åŠ å…ƒç´ æˆ–åˆ é™¤å…ƒç´ ï¼‰çš„ã€‚å¦‚æœè¯•å›¾åœ¨ `for in` éå†è¿‡ç¨‹ä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå…·ä½“è¡¨ç°ä¸º `NSException`ã€‚

åŸå› ï¼šå¯¹äºå®¹å™¨çš„éå†é€šå¸¸ä½¿ç”¨çš„æ˜¯è¿­ä»£å™¨æ¨¡å¼ï¼Œè¿­ä»£çš„è¿‡ç¨‹éœ€è¦ä¸€ä¸ªç¨³å®šçš„ç¯å¢ƒã€‚å¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­ä¿®æ”¹äº†å®¹å™¨ï¼ˆå¢åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼‰ï¼Œå°±å¯èƒ½å¯¼è‡´è¿­ä»£å™¨çš„çŠ¶æ€å¼‚å¸¸ï¼Œæ¯”å¦‚è¿­ä»£é¡ºåºå‡ºç°é”™è¯¯ï¼Œæˆ–è€…éå†åˆ°ä¸å­˜åœ¨çš„å…ƒç´ ã€‚

```objc
// å¯ä»¥å…ˆå°†éœ€è¦åˆ é™¤çš„å…ƒç´ è®°å½•ä¸‹æ¥ï¼Œç­‰éå†ç»“æŸåå†è¿›è¡Œåˆ é™¤
NSMutableArray *removeArray = [NSMutableArray array];
for (id obj in originalArray) {
    if (shouldRemove(obj)) {
        [removeArray addObject:obj];
    }
}
[originalArray removeObjectsInArray:removeArray];
```

:::

------

## ç±»

### load

#### â“`+load` ä¸ `+initialize` åŒºåˆ«

::: details ğŸ’¡

  è¿™ä¸¤ä¸ªéƒ½æ˜¯ç±»æ–¹æ³•ï¼Œå¯ä»¥ä»ä¸‹é¢å‡ ä¸ªæ–¹é¢å»å¯¹æ¯”ä¸¤è€…çš„åŒºåˆ«
  
  - è°ƒç”¨æ—¶æœº
    * `+load` : è¿™æ˜¯åœ¨è¿è¡Œæ—¶åŠ è½½æ—¶ï¼Œè¿›è¡Œè§¦å‘è°ƒç”¨ã€‚
    * `+initialize` : ä¼šåœ¨ç±»ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ï¼Œè¿›è¡Œè§¦å‘è°ƒç”¨ã€‚
  
  - è°ƒç”¨æ¬¡æ•°
    * `+load` : åªä¼šåœ¨è¿è¡Œæ—¶åŠ è½½æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡ã€‚
    * `+initialize` : ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡ã€‚

  - è°ƒç”¨çˆ¶ç±»
    * `+load` : ä¸ä¼šè°ƒç”¨çˆ¶ç±»çš„ `+load`
    * `+initialize` : å¦‚æœå½“å‰ç±»æ²¡æœ‰

  - æ‰‹åŠ¨è°ƒç”¨
    * `+load` : ä¸èƒ½æ‰‹åŠ¨è°ƒç”¨ï¼Œè¿è¡Œæ—¶è¿›è¡Œè°ƒç”¨çš„ã€‚æ‰‹åŠ¨è°ƒç”¨ä¼šè§¦å‘å¼‚å¸¸ã€‚
    * `+initialize` : å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ã€‚
  
:::
  
  > â“`+load` çš„è°ƒç”¨é¡ºåº
  
::: details ğŸ’¡
  
  - `+load` æ–¹æ³•è°ƒç”¨é¡ºåºä¸ç¼–è¯‘è¿æ¥é¡ºåºæœ‰å…³ã€‚
  - ä¸åŒç±»ä¹‹é—´çš„`+load`æ–¹æ³•çš„è°ƒç”¨é¡ºåºä¸èƒ½ç¡®å®šï¼Œå–å†³äºç¼–è¯‘è¿æ¥é¡ºåºã€‚
  - å¦‚æœçˆ¶ç±»ã€å­ç±»å’Œåˆ†ç±»éƒ½å®ç°äº† `+load` æ–¹æ³•ï¼Œ`+load` æ–¹æ³•çš„è°ƒç”¨é¡ºåºæ˜¯ï¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„`+load`ï¼Œå†è°ƒç”¨å­ç±»çš„`+load`ï¼Œæœ€åè°ƒç”¨åˆ†ç±»çš„`+load`ã€‚
  
:::

#### â“ä¸¤ä¸ªç±»çš„ `load` æ–¹æ³•é‡Œäº’ç›¸åˆ›å»ºå¦ä¸€ä¸ªç±»ä¼šæ€ä¹ˆæ ·

::: details ğŸ’¡

> `load` æ–¹æ³•æ˜¯åœ¨ä¸€ä¸ªç±»è¢«å¼•å…¥åˆ°è¿è¡Œæ—¶ç³»ç»Ÿæ—¶è°ƒç”¨ï¼Œæ¯ä¸ªç±»çš„ `load` æ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚å®ƒä»¬å¾€å¾€åœ¨ `main` å‡½æ•°å¯åŠ¨ä¹‹å‰å°±å¼€å§‹æ‰§è¡Œã€‚

å¦‚æœä¸¤ä¸ªç±»çš„`load`æ–¹æ³•é‡Œäº’ç›¸åˆ›å»ºå¯¹æ–¹ï¼š

  - åœ¨åŠ è½½ç±»Aæ—¶ï¼Œå¦‚æœ`load`æ–¹æ³•é‡Œåˆ›å»ºäº†ç±»Bçš„å®ä¾‹ï¼Œä¼šå¯¼è‡´ç«‹å³åŠ è½½ç±»Bã€‚

  - åœ¨åŠ è½½ç±»Bæ—¶ï¼Œå¦‚æœ`load`æ–¹æ³•é‡Œåˆ›å»ºäº†ç±» A çš„å®ä¾‹ï¼Œä½†æ­¤æ—¶å› ä¸ºç±» A å·²ç»åœ¨åŠ è½½ä¸­ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè§¦å‘ç±» A çš„`load`æ–¹æ³•ã€‚

æ³¨æ„ï¼šæ­¤æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªå¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´å…¶ä»–ä¸å¯é¢„çŸ¥çš„å‰¯ä½œç”¨æˆ–é”™è¯¯ï¼Œå› æ­¤åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­åº”é¿å…è¿™æ ·åšã€‚

  åœ¨å®é™…å¼€å‘ä¸­ï¼Œ`load` æ–¹æ³•é€šå¸¸ç”¨æ¥æ‰§è¡Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å¹¶ä¸”æ¶‰åŠåˆ°ç±»æœ¬èº«çš„æ“ä½œï¼Œä¾‹å¦‚æ³¨å†Œç±»åˆ°ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œæˆ–è€…è®¾ç½®ä¸ºè§‚å¯Ÿè€…ç­‰ç­‰ã€‚åœ¨ `load` æ–¹æ³•ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œã€ä¿®æ”¹ç¯å¢ƒçŠ¶æ€æˆ–è€…äº§ç”Ÿå‰¯ä½œç”¨é€šå¸¸æ˜¯ä¸æ¨èçš„ã€‚å¦‚æœéœ€è¦åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œåˆå§‹åŒ–ä»£ç ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ `+initialize` æ–¹æ³•ï¼Œå®ƒåœ¨ç±»ç¬¬ä¸€æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶è¢«è°ƒç”¨ï¼Œè€Œä¸”å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰ `initialize` æ–¹æ³•ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„ `initialize` æ–¹æ³•ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚

:::

### åˆå§‹åŒ–

#### â“`alloc` åšäº†ä»€ä¹ˆï¼Œ`init` å‘¢ï¼Œ`new` å‘¢ï¼Œ`new` åˆå§‹åŒ–æœ‰ä»€ä¹ˆåŒºåˆ«

::: details ğŸ’¡

  - `alloc`ï¼š`alloc` æ„ä¸º `allocation`ï¼Œç”¨äºåœ¨å †å†…å­˜ä¸­åˆ†é…å†…å­˜ï¼Œåˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå†…å­˜å—çš„åœ°å€ï¼Œè¿™ä¸ªå†…å­˜å—åˆšå¥½å¤Ÿå­˜æ”¾å¯¹è±¡çš„æ‰€æœ‰å®ä¾‹å˜é‡ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå†…å­˜å—ä¸­çš„å†…å®¹æ˜¯æœªåˆå§‹åŒ–çš„ã€‚

  - `init`ï¼š`init` æ˜¯ç”¨æ¥åˆå§‹åŒ–å¯¹è±¡çš„ã€‚ä½¿ç”¨ `alloc` åˆ†é…åœ°å€åˆ›å»ºçš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„å®ä¾‹å˜é‡éƒ½ä¼šè¢«åˆå§‹åŒ–ä¸º 0ï¼Œä½†é€šå¸¸éœ€è¦å¯¹è¿™äº›å®ä¾‹å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥å°±è°ƒç”¨ `init` æ–¹æ³•ã€‚`init` æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªåˆå§‹åŒ–åçš„å¯¹è±¡ã€‚

  - `new`ï¼š`new` æ˜¯ `alloc` å’Œ `init` çš„ç®€å†™ï¼Œå®ƒç­‰åŒäº `alloc` æ–¹æ³•åé¢è·Ÿä¸€ä¸ª `init` æ–¹æ³•ã€‚ä½¿ç”¨ `new`æ–¹æ³•å¯ä»¥ä¸€æ­¥å®Œæˆå¯¹è±¡çš„åˆ†é…å’Œåˆå§‹åŒ–ã€‚

`new`å’Œ`alloc-init`åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢

  - ä½¿ç”¨ `new` æ‰§è¡Œçš„æ˜¯ `alloc` å’Œ `init`ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½ä¸èƒ½å¸¦å‚æ•°ã€‚
  - ä½¿ç”¨ `alloc` å’Œ `init`ï¼Œå¯ä»¥å¯¹ `init` æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œæ¯”å¦‚ `initWithFrame:`ï¼Œ `initWithNibName:bundle:` ç­‰ç­‰ã€‚ è¿™ä¹Ÿæ˜¯ `new` å’Œ `alloc-init` çš„ä¸»è¦åŒºåˆ«ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä½¿ç”¨ `alloc-init` æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸æ˜¯ `new`ã€‚
    
:::

#### â“`NS_DESIGNATED_INITIALIZER` å¦‚ä½•æ·»åŠ 

::: details ğŸ’¡

  > `NS_DESIGNATED_INITIALIZER` æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºå‘ç¼–è¯‘å™¨æ ‡æ˜è¿™ä¸ªæ˜¯` Designated Initializer`ã€‚ä¸»è¦ç›®çš„å°±æ˜¯æ˜ç¡®æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬éµå®ˆåˆå§‹åŒ–æ–¹æ³•çš„åŸºæœ¬è§„åˆ™ï¼šæ‰€æœ‰çš„åˆå§‹åŒ–æ–¹æ³•æœ€ç»ˆéƒ½åº”è¯¥é€šè¿‡è°ƒç”¨åŒä¸€ç±»ä¸­çš„ä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ¥å®Œæˆåˆå§‹åŒ–ã€‚

  `NS_DESIGNATED_INITIALIZER` è¿™ä¸ªå®ä¸æ˜¯å¿…é¡»çš„ã€‚ä½†åŠ ä¸Šè¿™ä¸ªå®å¯ä»¥æ˜ç¡®æŒ‡å‡ºå“ªä¸ªæ˜¯æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œæœ‰åŠ©äºæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚å¦å¤–ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ `Xcode` å¼€å‘ï¼Œå¹¶ä¸”å¯ç”¨äº†ä¸€äº›è­¦å‘Šé€‰é¡¹ï¼Œæ²¡æœ‰ä½¿ç”¨ `NS_DESIGNATED_INITIALIZER` å®æ¥æ ‡è®°æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ `Xcode` å‘å‡ºè­¦å‘Šä¿¡æ¯ã€‚

  `NS_DESIGNATED_INITIALIZER` è¿™ä¸ªå®çš„å·¥ä½œåŸç†æ˜¯ï¼Œå¦‚æœä½ çš„ç±»ä¸­çš„æŸä¸ªåˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨äº†è¿™ä¸ªå®ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰è°ƒç”¨åŒç±»ä¸­çš„å…¶ä»–ä½¿ç”¨äº†è¿™ä¸ªå®çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨äº†çˆ¶ç±»ä¸­ä½¿ç”¨äº†è¿™ä¸ªå®çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šå‘å‡ºä¸€ä¸ªè­¦å‘Šã€‚

```objc
@interface MyClass : NSObject
- (instancetype)initWithMyParameter:(id)myParameter NS_DESIGNATED_INITIALIZER;
@end
@implementation MyClass
- (instancetype)initWithMyParameter:(id)myParameter {
    // å…ˆè°ƒç”¨çˆ¶ç±»çš„ init
    self = [super init];
    if (self) {
        // åˆå§‹åŒ–æ“ä½œ...
    }
    return self;
}
@end
```

:::

### é‡è½½

#### â“`OC` å¦‚ä½•å®ç°å¤šé‡ç»§æ‰¿

::: details ğŸ’¡

  - **åè®®ï¼ˆProtocolï¼‰**ï¼š`OC` ä¸­çš„åè®®ç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ¥å£ï¼Œå¯ä»¥å®šä¹‰ä¸€ç»„æ–¹æ³•å’Œå±æ€§ï¼Œç„¶åç”±ç±»å»å®ç°ã€‚ä¸€ä¸ªç±»å¯ä»¥åŒæ—¶å®ç°å¤šä¸ªåè®®ï¼Œè¿™å°±å®ç°äº†ç±»ä¼¼å¤šé‡ç»§æ‰¿çš„æ•ˆæœï¼Œåªæ˜¯å®ç°åè®®çš„ç±»éœ€è¦è‡ªå·±å®ç°åè®®ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ã€‚

  - **ç»„åˆ**ï¼šåœ¨ä¸€ä¸ªç±»ä¸­åŒ…å«å…¶ä»–ç±»çš„å®ä¾‹ä½œä¸ºæˆå‘˜å˜é‡ï¼Œå€Ÿæ­¤å¯ä»¥ä½¿ç”¨å…¶ä»–ç±»çš„åŠŸèƒ½ï¼Œé—´æ¥å®ç°å¤šé‡ç»§æ‰¿çš„æ•ˆæœã€‚
    > ä¾‹å¦‚ï¼Œç±»AåŒ…å«ç±»Bå’Œç±»Cçš„å®ä¾‹ï¼Œé‚£ä¹ˆç±»Aå°±å¯ä»¥ä½¿ç”¨ç±»Bå’Œç±»Cçš„åŠŸèƒ½ã€‚

  - **åˆ†ç±»ï¼ˆCategoryï¼‰**ï¼šä¸€ç§ä½¿å¾—ç°æœ‰ç±»å¢åŠ æ–¹æ³•çš„æ–¹å¼ï¼Œæ˜¯åœ¨è¿è¡Œæ—¶å†³è®®çš„ã€‚å¯ä»¥é€šè¿‡åˆ›å»ºåˆ†ç±»ï¼Œå°†å…¶ä»–ç±»çš„æ–¹æ³•å¼•å…¥ï¼Œå®ç°ç±»ä¼¼å¤šç»§æ‰¿çš„æ•ˆæœã€‚ä½†æ˜¯åˆ†ç±»ä¸èƒ½æ·»åŠ æ–°çš„å®ä¾‹å˜é‡ã€‚

  - **æ¶ˆæ¯è½¬å‘ï¼ˆMessage Forwardingï¼‰**ï¼šå…è®¸å°†ä¸€ä¸ªæ–¹æ³•è°ƒç”¨è½¬å‘ç»™å…¶ä»–å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚å¦‚æœæŸä¸ªç±»æ— æ³•å“åº”æŸä¸ªæ¶ˆæ¯ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶å°†è¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å¦ä¸€ä¸ªèƒ½å¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„å¯¹è±¡ã€‚

:::

#### â“é™æ€æ–¹æ³•æ˜¯å¦èƒ½è¢«é‡å†™

::: details ğŸ’¡

  åœ¨ `Objective-C` ä¸­ï¼Œé€šå¸¸æ‰€è¯´çš„ "é™æ€æ–¹æ³•" å®é™…ä¸Šæ˜¯æŒ‡"ç±»æ–¹æ³•"ï¼Œç”¨ "+" ç¬¦å·æ¥å£°æ˜ã€‚è¿™ç§æ–¹æ³•æ˜¯å¯ä»¥è¢«å­ç±»é‡å†™çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨å­ç±»ä¸­é‡å†™äº†ä¸€ä¸ªå·²ç»åœ¨çˆ¶ç±»ä¸­å®šä¹‰çš„ç±»æ–¹æ³•ï¼Œé‚£ä¹ˆå½“ä½ ç”¨å­ç±»æ¥è°ƒç”¨è¿™ä¸ªç±»æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯å­ç±»ä¸­çš„ç‰ˆæœ¬ï¼Œè¿™å°±æ˜¯æ–¹æ³•é‡å†™ã€‚æ‰€ä»¥ï¼Œ"é™æ€æ–¹æ³•"æ˜¯å¯ä»¥è¢«å­ç±»é‡å†™çš„ã€‚

  ç„¶è€Œè¿™å’Œå…¶ä»–ä¸€äº›è¯­è¨€å¦‚ `Java` æˆ– `C++` ä¸­çš„é™æ€æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨ `Java` æˆ–` C++` ä¸­ï¼Œå£°æ˜ä¸º `static` çš„æ–¹æ³•æ˜¯ä¸èƒ½è¢«å­ç±»é‡å†™çš„ã€‚

:::

### åå°„

#### â“`OC` ä¸­çš„å†…çœå’Œåå°„ï¼Œåº•å±‚å®ç°åŸç†ï¼Œåº”ç”¨åœºæ™¯æœ‰å“ªäº›

::: details ğŸ’¡

å†…çœå’Œåå°„æ˜¯åŸºäºå…¶åŠ¨æ€çš„ç‰¹æ€§å®ç°çš„ï¼Œåº•å±‚ä¾èµ–äº `runtime` ç³»ç»Ÿã€‚

  - å†…çœï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§èƒ½åŠ›ï¼Œå…è®¸ç¨‹åºæ£€æŸ¥å¯¹è±¡çš„ç±»å‹æˆ–å±æ€§ã€‚
    > å¯ä»¥é€šè¿‡ç³»ç»Ÿæä¾›çš„å„ç§ `API`ï¼ˆå¦‚`isKindOfClass:`, `respondsToSelector:` ç­‰æ–¹æ³•ï¼‰æ¥å®ç°å†…çœã€‚

  - åå°„ï¼šç¨‹åºèƒ½å¤Ÿè§‚å¯Ÿå’Œä¿®æ”¹è‡ªèº«ç»“æ„å’Œè¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚
    > åå°„ä¸»è¦ä¾èµ–äºç³»ç»Ÿæä¾›çš„ `API`ï¼Œå¦‚`NSClassFromString`, `NSStringFromClass`, `NSSelectorFromString`, `NSStringFromSelector` ç­‰å‡½æ•°ã€‚

å®ç°åŸç†ï¼š 
  
  `Objective-C` å¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ª `isa` æŒ‡é’ˆæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»ï¼Œè¿™ä¸ªç±»ä¸­å­˜å‚¨äº†ç±»çš„æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ï¼Œå¹¶ä¸”å¦‚æœç±»ç»§æ‰¿è‡ªå…¶ä»–ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»è¿˜ä¼šé€šè¿‡ `superclass` æŒ‡é’ˆæ‰¾åˆ°å…¶çˆ¶ç±»ï¼Œè¿™æ ·å±‚å±‚é€’æ¨ï¼Œå½¢æˆäº†ä¸€æ¡ç±»é“¾ï¼Œåˆ©ç”¨è¿™æ¡é“¾æ¡å°±å¯ä»¥æ£€æŸ¥å’Œæ“ä½œå¯¹è±¡çš„è¡Œä¸ºå’Œç»“æ„ã€‚

åº”ç”¨åœºæ™¯ï¼š 

  - æ•°æ®å’Œæ¨¡å‹çš„è‡ªåŠ¨æ˜ å°„ã€‚
    > ä¾‹å¦‚ `JSON` æ•°æ®è½¬ `Model` å¯¹è±¡ï¼Œé€šå¸¸éœ€è¦å†™å¤§é‡çš„æ˜ å°„ä»£ç ã€‚åˆ©ç”¨å†…çœæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–å¯¹è±¡çš„å±æ€§ä¿¡æ¯ï¼Œä»è€Œå®ç°è‡ªåŠ¨æ˜ å°„ã€‚ 
  - åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ ç±»ï¼Œæ–¹æ³•ï¼Œå±æ€§ã€‚
    > ä¾‹å¦‚å¯ä»¥åœ¨è¿è¡Œæ—¶ç»™ä¸€ä¸ªç±»æ·»åŠ å±æ€§æˆ–æ–¹æ³•ï¼Œæˆ–è€…ä¿®æ”¹æ–¹æ³•çš„å®ç°ç­‰ã€‚ 
  - åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆ`AOP`ï¼‰ä¸­ï¼Œç»å¸¸éœ€è¦è¿è¡Œæ—¶ä¿®æ”¹å¯¹è±¡çš„è¡Œä¸ºã€‚
  - åœ¨æ‰§è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼Œå¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶æ¥åŠ¨æ€åœ°è°ƒç”¨éœ€è¦æµ‹è¯•çš„æ–¹æ³•ã€‚

:::

#### â“æœ‰ç”¨è¿‡åå°„å—ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šæƒ³åˆ°ç”¨åå°„ï¼Œæœ‰æ²¡æœ‰åˆ«çš„åŠæ³•

::: details ğŸ’¡

åå°„ï¼š

  - è¿è¡Œæ—¶ï¼ˆ`Runtime`ï¼‰ï¼š`Objective-C` çš„è¿è¡Œæ—¶ç³»ç»Ÿä½¿å¾—èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œä¿®æ”¹ç±»å’Œå¯¹è±¡çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œä¿®æ”¹ç±»å’Œå®ä¾‹å˜é‡ï¼ŒåŠ¨æ€åˆ›å»ºç±»ï¼ŒåŠ¨æ€æ›¿æ¢æ–¹æ³•ç­‰ç­‰ã€‚
  - `NSClassFromString` å’Œ `NSSelectorFromString` è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥ä»å­—ç¬¦ä¸²ä¸­å¾—åˆ°ç±»å’Œæ–¹æ³•ã€‚

ä½¿ç”¨åœºæ™¯ï¼š

  - è§£æå¤æ‚çš„ `JSON` æˆ– `XML` ç»“æ„çš„æ—¶å€™ï¼Œæ¯”å¦‚æƒ³æŠŠ `JSON` è½¬æ¢ä¸ºç‰¹å®šçš„å¯¹è±¡ï¼Œè€Œ `JSON` çš„é”®å€¼æ°å¥½å¯¹åº”äº†è¿™ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨åå°„éå†å¯¹è±¡çš„å±æ€§ï¼Œå¹¶å¡«å……å¯¹åº”çš„å€¼ã€‚
  - å¦‚æœéœ€è¦ç¼–å†™æ›´é€šç”¨æ€§çš„ä»£ç ï¼Œä¾‹å¦‚æ­£åœ¨ç¼–å†™ä¸€ä¸ªé€šç”¨çš„æ•°æ®æºï¼Œå®ƒéœ€è¦å¤„ç†ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨åå°„ã€‚

æ›¿ä»£æ–¹æ¡ˆï¼šå¦‚æœæ˜ç¡®çŸ¥é“è¦æ“ä½œçš„ç±»å‹ï¼Œé‚£ä¹ˆé€šå¸¸ä¸éœ€è¦ä½¿ç”¨åå°„ã€‚å¯ä»¥ç›´æ¥é€šè¿‡å±æ€§åç§°è®¿é—®å±æ€§ï¼Œæˆ–è€…ç›´æ¥è°ƒç”¨æ–¹æ³•ã€‚

æ€»ç»“ï¼šè™½ç„¶åå°„æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œèƒ½å¤Ÿæä¾›æå¤§çš„çµæ´»æ€§ï¼Œä½†æ˜¯å®ƒåº”è¯¥è°¨æ…ä½¿ç”¨ã€‚ä¸æ­£ç¡®çš„ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼Œç”šè‡³äº§ç”Ÿé”™è¯¯ã€‚åªæœ‰åœ¨å¿…è¦çš„æ—¶å€™æ‰åº”è¯¥ä½¿ç”¨åå°„ã€‚

:::

------

## å±æ€§

### â“`@property` æ˜¯ä»€ä¹ˆ

::: details ğŸ’¡

  > `@property` æ˜¯ `Objective-C` ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºå£°æ˜ä¸€ä¸ªå±æ€§ã€‚ä¸»è¦ä½œç”¨æ˜¯ä¸ºç±»çš„å®ä¾‹å˜é‡ï¼ˆå±æ€§ï¼‰ç”Ÿæˆå¯¹åº”çš„è®¿é—®å™¨æ–¹æ³•ï¼Œå³ `getter` æ–¹æ³•å’Œ `setter` æ–¹æ³•ã€‚
  
  
  - `@property` ä¿®é¥°å™¨
  
    * åŸå­æ€§ : `atomic`ã€`nonatomic`
    * è¯»å†™æ€§ : `readwrite`ã€`readonly`
    * å†…å­˜ç®¡ç† : `assign`ã€`strong`ã€`weak`ã€`copy`
   * å…¼å®¹æ€§(`Swift`) : `nullable`ã€`nonnull`ã€`class`

  - `@property` ä¼˜ç‚¹
  
    * éš”ç¦»æ€§ï¼šå¯ä»¥å°è£…å®ä¾‹å˜é‡çš„ç›´æ¥è®¿é—®ï¼Œå°†ç±»çš„å†…éƒ¨å®ç°ä¸å¤–éƒ¨æ¥å£éš”ç¦»ï¼Œæé«˜æ•°æ®çš„å®‰å…¨æ€§ã€‚
    * å¯ç»´æŠ¤æ€§ï¼šå¯ä»¥åœ¨ `getter` å’Œ `setter` ä¸­æ·»åŠ ç‰¹å®šçš„é€»è¾‘å¦‚è®¾ç½®æ–°å€¼æ—¶è¿›è¡ŒéªŒè¯ï¼Œè·å–å€¼æ—¶è¿”å›ä¸€ä¸ªè®¡ç®—åçš„å€¼ç­‰ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚ 

:::

### â“`@property` çš„é»˜è®¤å…³é”®å­—
  
::: details ğŸ’¡

```objc
// åŸºæœ¬æ•°æ®ç±»å‹ => é»˜è®¤æ˜¯: atomic, readwrite, assign
@property int num;
// å¯¹è±¡æ•°æ®ç±»å‹ => é»˜è®¤æ˜¯: atomic, readwrite, strong, nullable
@property NSObject *obj;
```

:::
  
### â“`@property` çš„åº•å±‚å®ç°

::: details ğŸ’¡  
  
  > `@property` æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºå£°æ˜ç±»çš„å±æ€§ã€‚å£°æ˜ä¸€ä¸ªå±æ€§æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›ä»£ç ï¼Œè¿™å°±æ˜¯ `@property` çš„åº•å±‚å®ç°ã€‚

  - å®ä¾‹å˜é‡ï¼š`@property` åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨åˆæˆä¸€ä¸ªå¸¦ä¸‹åˆ’çº¿å‰ç¼€çš„å®ä¾‹å˜é‡ã€‚
    > ä¾‹å¦‚å£°æ˜äº†ä¸€ä¸ªåä¸º `foo` çš„å±æ€§ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º `_foo` çš„å®ä¾‹å˜é‡ã€‚

  - `getter` å’Œ `setter` æ–¹æ³•ï¼šä¼šä¸ºå±æ€§è‡ªåŠ¨ç”Ÿæˆ `getter` å’Œ `setter` æ–¹æ³•ã€‚

  - å†…å­˜ç®¡ç†ï¼šæŒ‡å®šçš„å±æ€§ä¿®é¥°ç¬¦ï¼ˆ`assign`ã€`strong`ã€`weak`ã€`copy` ç­‰ï¼‰ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ `setter` æ–¹æ³•ä¸­ç”Ÿæˆç›¸åº”çš„å†…å­˜ç®¡ç†ä»£ç ï¼Œæ¯”å¦‚å¼•ç”¨è®¡æ•°çš„å¢åŠ å’Œå‡å°ï¼Œæ‹·è´å¯¹è±¡ç­‰ã€‚

  - `KVO` æ”¯æŒï¼š`@property` è‡ªåŠ¨ç”Ÿæˆçš„ `getter` å’Œ `setter` æ–¹æ³•æ”¯æŒé”®å€¼è§‚å¯Ÿ(`Key-Value Observing`)ï¼Œå…è®¸å…¶å®ƒå¯¹è±¡è§‚å¯Ÿå’Œå“åº”å±æ€§å€¼çš„æ”¹å˜ã€‚
    

  > `runtime` å±‚é¢
  
  å£°æ˜ `@property` åï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®å±æ€§çš„ç‰¹æ€§åœ¨ `class_rw_t` ç»“æ„ä¸­çš„ `methods` å’Œ `properties` ä¸­ç”Ÿæˆ `getter` å’Œ `setter` æ–¹æ³•ä»¥åŠç›¸åº”çš„å±æ€§ã€‚ç„¶ååœ¨è¿è¡Œæ—¶ï¼Œè¿™äº› `getter` å’Œ `setter` æ–¹æ³•ä»¥åŠå±æ€§è¢«å¼•å…¥åˆ° `objc_class` çš„ç»“æ„ä¸­ã€‚
  
  ```objc
  struct objc_class {
      Class isa;              // metaclass çš„æŒ‡é’ˆ
      Class super_class;      // çˆ¶ç±»
      cache_t cache;          // ç¼“å­˜
      class_data_bits_t bits; // ç±»çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘ class_rw_t æ•°æ®ç»“æ„çš„æŒ‡é’ˆ
  };
  // å¯è¯»å†™ç»“æ„ï¼Œå­˜å‚¨è¿è¡Œæ—¶æ·»åŠ çš„ç±»ä¿¡æ¯
  struct class_rw_t {
      uint32_t flags;
      uint32_t version;
      const class_ro_t *ro;           // åªè¯»ç»“æ„ä½“ï¼Œä¿å­˜ç¼–è¯‘æ—¶ç¡®å®šçš„ç±»ä¿¡æ¯
      method_array_t methods;         // æ–¹æ³•åˆ—è¡¨
      property_array_t properties;    // å±æ€§åˆ—è¡¨
      protocol_array_t protocols;     // åè®®åˆ—è¡¨
      Class firstSubclass;
      Class nextSiblingClass;
  };
  ```
  
::: 
  
### åŸå­æ€§
  
#### â“ `atomic` vs `nonatomic`

::: details ğŸ’¡

`atomic`å’Œ`nonatomic`æ˜¯Objective-Cä¸­å£°æ˜å±æ€§æ—¶ä½¿ç”¨çš„ä¸¤ç§å±æ€§åŸå­æ€§ï¼ˆatomicityï¼‰ä¿®é¥°ç¬¦ã€‚

**atomic**ï¼šä»£è¡¨å±æ€§æ˜¯åŸå­ï¼ˆatomicï¼‰æ“ä½œã€‚è¿™æ„å‘³ç€å¯¹è¯¥å±æ€§çš„setterå’Œgetteræ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ã€‚ä½†ï¼Œè¿™å¹¶ä¸ä»£è¡¨æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯”å¦‚å¯¹å±æ€§çš„è¯»-å†™-å†™æ“ä½œå°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒæ—¶atomicä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šatomicæˆ–nonatomicï¼Œåˆ™é»˜è®¤ä¸ºatomicã€‚

**nonatomic**ï¼šä»£è¡¨å±æ€§éåŸå­æ“ä½œã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹è¯¥å±æ€§çš„å­˜å–æ“ä½œå¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µï¼Œä½†åœ¨æ€§èƒ½ä¸Šæœ‰æ‰€ä¼˜åŠ¿ï¼Œå› ä¸ºnonatomicé¿å…äº†åŠ é”å¼€é”€ã€‚

ä¸ºäº†æé«˜æ•ˆç‡ï¼Œåœ¨æ²¡æœ‰å¹¶å‘è®¿é—®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨`nonatomic`ã€‚å¯¹äºæœ‰å¹¶å‘è®¿é—®çš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨getterå’Œsetterä¸­å®ç°é€‚å½“çš„é”æ¥ç®¡ç†å¯¹è¿™äº›å±æ€§çš„è®¿é—®ï¼Œè€Œä¸æ˜¯ä»…ä»…ä¾èµ–äº`atomic`ï¼Œå› ä¸º`atomic`å¹¶ä¸èƒ½å®Œå…¨è§£å†³å¹¶å‘çš„é—®é¢˜ã€‚

:::

#### â“`atomic` ä¿®é¥°çš„å±æ€§æ˜¯å¦å¯ä»¥è¢«é‡è½½

::: details ğŸ’¡

ä¸è®ºä¸€ä¸ªå±æ€§æ˜¯é€šè¿‡`atomic`è¿˜æ˜¯`nonatomic`ä¿®é¥°ï¼Œå®ƒéƒ½å¯ä»¥è¢«å­ç±»é‡è½½ã€‚é‡è½½ä¸€ä¸ªå±æ€§ä¸»è¦å°±æ˜¯æä¾›ä¸€ä¸ªæ–°çš„setteræˆ–è€…getterã€‚åœ¨å­ç±»ä¸­é‡è½½ä¸€ä¸ª`atomic`å±æ€§æ—¶ï¼Œé™¤éä½ æ˜ç¡®é‡è½½äº†è¿™ä¸ªå±æ€§çš„å…¨éƒ¨å­˜å–å™¨ï¼ˆåŒ…æ‹¬getterå’Œsetterï¼‰ï¼Œå¦åˆ™å®ƒä»ç„¶æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ çš„setteræˆ–getteråšäº†ä¸€äº›ç‰¹æ®Šçš„æ“ä½œï¼ˆæ¯”å¦‚å‘å¸ƒé€šçŸ¥æˆ–è€…è°ƒç”¨äº†å…¶ä»–çš„ä¾èµ–äºè¯¥å±æ€§çš„æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦åœ¨å­ç±»ä¸­è¦†ç›–è¿™ä¸ªå±æ€§ï¼Œä»¥ä¿æŒç›¸åŒçš„è¡Œä¸ºã€‚

ä¾‹å¦‚ï¼š
```objective-c
@interface MyClass : NSObject
@property (atomic, strong) NSString *name;
@end

@implementation MyClass
@synthesize name = _name;
// é‡è½½getteræ–¹æ³•
- (NSString *)name {
  @synchronized (self) {
      return _name;
  }
}
// é‡è½½setteræ–¹æ³•
- (void)setName:(NSString *)name {
  @synchronized (self) {
      _name = name;
  }
}
@end
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`name`å±æ€§è¢«å£°æ˜ä¸º`atomic`ï¼Œåœ¨å­ç±»ä¸­æˆ‘ä»¬é‡è½½äº†`name`çš„getterå’Œsetterï¼Œä½¿ç”¨`@synchronized`æ¥ç¡®ä¿å®ƒä»¬çš„åŸå­æ“ä½œã€‚

:::
 
### å†…å­˜ç®¡ç†
  
#### â“`assign`ã€`strong`ã€`weak`ã€`copy` åŒºåˆ«
  
::: details ğŸ’¡
  
  - `assign`ï¼šæ˜¯èµ‹å€¼ç‰¹æ€§ï¼Œç®€å•è®¾ç½®å˜é‡ï¼Œä¸æ›´æ”¹å¼•ç”¨è®¡æ•°ã€‚
    > ä¸»è¦ç”¨åœ¨åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ˆå¦‚ `int`ã€`float`ï¼‰æˆ– `C` æ•°æ®ç±»å‹ï¼ˆå¦‚ ç»“æ„ä½“ã€æ•°ç»„ï¼‰è€Œä¸æ˜¯å¯¹è±¡ã€‚
  
  - `strong`ï¼ˆç±»ä¼¼äºï¼š`retain`ï¼‰ï¼šæ˜¯æ‰€æœ‰æƒï¼ˆowningï¼‰ç‰¹æ€§ã€‚
    > é‡‡ç”¨ `ARC`ï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ¨è®¾ç½®æ–¹æ³•ä¸­æ’å…¥ `retain` è°ƒç”¨ï¼Œä½¿å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å¢åŠ ï¼Œä»è€Œè¡¨ç¤ºå½“å‰å¯¹è±¡æ‹¥æœ‰æ•°æ®å€¼ã€‚
  
  - `weak`ï¼šæ˜¯éæ‹¥æœ‰å…³ç³»ï¼ˆnon-owningï¼‰ç‰¹æ€§ï¼Œå³å¼±å¼•ç”¨ã€‚
    > å½“ç”¨ `weak` ä¿®é¥°å¯¹è±¡æ—¶ï¼Œè¢«æŒ‡å‘çš„å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸ä¼šå¢åŠ ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå½“å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œè¢« `weak` ä¿®é¥°çš„å˜é‡ä¼šè‡ªåŠ¨è¢«ç½®ä¸º `nil`ï¼Œé˜²æ­¢é‡æŒ‡é’ˆçš„å‡ºç°ã€‚`weak` ä¿®é¥°çš„å±æ€§é€‚åˆåœ¨å·²ç»å­˜åœ¨å¯¹å¯¹è±¡çš„ `strong` å¼•ç”¨ï¼Œæˆ–è€…å¯¹è±¡ä¹‹é—´å­˜åœ¨ç›¸äº’å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚
  
  - `copy`ï¼šæ˜¯æ‹·è´ç‰¹æ€§ã€‚
    > é€‚åˆ `NSString`ã€`NSArray`ã€`NSDictionary` ç­‰ä¸å¯å˜å¯¹è±¡ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šä½¿ç”¨ `copy` ä¿æŒå°è£…æ€§ï¼Œå¯¹è±¡åœ¨å†…éƒ¨å¯èƒ½éœ€è¦ä¸€ä¸ªæ•°æ®çš„å®Œæ•´å‰¯æœ¬ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªå‰¯æœ¬ç»™å¤–ç•Œä½¿ç”¨ï¼Œé˜²æ­¢ä½œä¸ºæ¥å£æä¾›çš„å¯¹è±¡çš„åˆå§‹æ•°æ®è¢«æ”¹å˜ã€‚

  é€‰æ‹©å“ªç§å±æ€§ä¿®é¥°ç¬¦è¦è§†æƒ…å†µè€Œå®šï¼Œå¦‚æœæ•°æ®æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆé€‰æ‹© `assign` æˆ– `copy` è¾ƒå¥½ï¼›å¦‚æœæ•°æ®æ˜¯å¯å˜çš„ï¼Œå¯ä»¥é€‰æ‹© `strong` æˆ– `weak`ã€‚

:::

#### â“`assign` å¯ä»¥ç”¨äº `OC` å¯¹è±¡å—

::: details ğŸ’¡

  > `assign` æ˜¯ä¸€ç§å±æ€§ä¿®é¥°ç¬¦ï¼Œç”¨äºæŒ‡å®šå±æ€§çš„èµ‹å€¼è¯­ä¹‰ã€‚`assign` å¯ä»¥ç”¨äºä»»ä½•æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ `Objective-C` å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¯¹è±¡æ¥è¯´ä¸æ¨èä½¿ç”¨ `assign`ã€‚

  å°† `assign` ç”¨äº `Objective-C `å¯¹è±¡æ—¶ï¼Œå…¶ä¼šç”Ÿæˆä¸€ä¸ªè®¾ç½®å™¨ï¼Œå…¶è¡Œä¸ºå°†ä¼ å…¥çš„å€¼èµ‹å€¼ç»™å®ä¾‹å˜é‡ï¼Œå¹¶ä¸æ”¹å˜è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚å¦‚æœè¯¥å¯¹è±¡åœ¨å…¶å®ƒåœ°æ–¹è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨å°±æˆäº†ä¸€ä¸ªæ‚¬æŒ‚æŒ‡é’ˆï¼ˆæˆ–è€…è¯´â€œé‡æŒ‡é’ˆâ€ï¼‰ï¼Œè¿™å°†ä¼šå¼•èµ·ç¨‹åºåœ¨è°ƒç”¨è¯¥å¯¹è±¡æ—¶å´©æºƒã€‚

  > åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨ `assign`ã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦åˆ›å»ºä¸€ä¸ª â€œå¼±å¼•ç”¨å¹¶ä¸”ä¸å¸Œæœ›åœ¨å¯¹è±¡è¢«é‡Šæ”¾æ—¶è‡ªåŠ¨è®¾ç½®ä¸º `nil`â€ æ—¶ï¼Œ`assign` å°±ä¼šæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯éœ€è¦ç¡®ä¿ä¸ä¼šå‘ç”Ÿæ‚¬æŒ‚æŒ‡é’ˆã€‚

:::

#### â“`copy` ä¸€èˆ¬ä¼šç”¨æ¥ä¿®é¥° `NSString`ï¼Œå¯ä»¥ä½¿ç”¨ `strong` å—

::: details ğŸ’¡

  > `NSString` ä½¿ç”¨ `copy` æ˜¯ä¸ºäº†é˜²æ­¢åœ¨èµ‹å€¼å¯å˜å­—ç¬¦ä¸²æ—¶ç”±äºåŸå­—ç¬¦ä¸²å‘ç”Ÿæ”¹å˜è€Œå¼•å‘éé¢„æœŸé—®é¢˜ã€‚

  - `NSString` çš„å­ç±» `NSMutableString` æ˜¯å¯ä»¥å˜åŒ–çš„ã€‚å¦‚æœä½¿ç”¨ `strong` å¹¶æŠŠä¸€ä¸ª `NSMutableString` å®ä¾‹èµ‹å€¼ç»™ `NSString` å¯¹è±¡ï¼Œç„¶åæ”¹å˜è¯¥ `NSMutableString` å®ä¾‹ï¼Œé‚£ä¹ˆ `NSString` å®ä¾‹ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚

  - å¦‚æœä½¿ç”¨ `copy`ï¼Œå½“ä¸€ä¸ª `NSMutableString` å®ä¾‹èµ‹å€¼ç»™ `NSString` å¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šä¼šå¤åˆ¶ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬ã€‚è¿™æ ·å³ä½¿åŸå­—ç¬¦ä¸²æ”¹å˜ `NSString` å®ä¾‹ä¹Ÿä¸ä¼šå—å½±å“ã€‚
  
:::

### å…¼å®¹æ€§

#### â“`nonnull`ã€`nullable` ç”¨è¿‡å—

::: details ğŸ’¡
  
  è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦æ˜¯åœ¨ `Objective-C` ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒèµ·æºäº `Swift` è¯­è¨€ä¸­çš„ `Optional` ç±»å‹ã€‚åœ¨ `Swift` ä¸­ï¼Œæ¯ä¸ªå˜é‡æˆ–è€…å‡½æ•°è¿”å›å€¼éƒ½å¿…é¡»æ˜ç¡®è¯´æ˜æ˜¯å¦å¯ä»¥ä¸ºç©ºã€‚ä¸ºäº†åœ¨ `Objective-C` å’Œ `Swift` çš„æ¡¥æ¥ä¸­ä¿æŒä¸€è‡´ï¼Œå¼•å…¥äº†è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦æ¥æ˜ç¡®å¯¹è±¡çš„ `nil` çŠ¶æ€ã€‚
  
  - `nonnull`ï¼šè¿™ä¸ªä¿®é¥°ç¬¦è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ä¸åº”è¯¥ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‚æ•°æˆ–è€…è¿”å›å€¼ç»å¯¹ä¸èƒ½ä¸º `nil`ã€‚å¦‚æœè¯•å›¾å°† `nil` èµ‹å€¼ç»™ä¸€ä¸ª `nonnull` çš„å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šã€‚

  - `nullable`ï¼šè¿™ä¸ªä¿®é¥°ç¬¦å’Œ `nonnull` çš„åŠŸèƒ½æ°æ°ç›¸åï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå‚æ•°æˆ–è€…è¿”å›å€¼å¯ä»¥ä¸º `nil`ã€‚ä¸€ä¸ªæ²¡æœ‰è¢«æ˜¾å¼å£°æ˜ä¸º `nonnull` æˆ–è€… `nullable` çš„å¯¹è±¡é»˜è®¤ä¸º `nullable`ã€‚

æ³¨æ„ï¼šè¿™ä¸¤ä¸ªä¿®é¥°ç¬¦åªæ˜¯ç”¨æ¥å¸®åŠ©ç¼–è¯‘å™¨æ£€æŸ¥ä»£ç çš„é”™è¯¯ï¼Œå¹¶ä¸èƒ½çœŸæ­£é˜»æ­¢ç¨‹åºå‘˜å°† `nil` èµ‹å€¼ç»™ `nonnull` çš„å¯¹è±¡ï¼Œè¿™ä¸ªåˆ¤æ–­è¿˜éœ€è¦å¼€å‘è€…åœ¨ç¼–ç æ—¶è‡ªå·±æ³¨æ„ã€‚

:::

#### â“`class` å±æ€§ä¿®é¥°å™¨

::: details ğŸ’¡

> `class` å±æ€§ä¿®é¥°ç¬¦ä¸»è¦è¿ç”¨äºå®šä¹‰ä¸€ä¸ªç±»ç±»å‹çš„å±æ€§ï¼Œå®ƒçš„ç”¨é€”ä¸»è¦æ˜¯æ ‡æ˜ä¸€ä¸ª `property` çš„å…³è”å¯¹è±¡ç±»å‹æ˜¯ä¸€ä¸ªç±»å±æ€§ï¼Œè€Œéä¸€ä¸ªå®ä¾‹å±æ€§ã€‚

```objc
@property (class, nonatomic, readonly) NSString *appName;
```

:::

### @synthesize

#### â“`@synthesize` vs `@dynamic`

::: details ğŸ’¡

  - `@synthesize`ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ç¼–è¯‘æ—¶è‡ªåŠ¨åˆ›å»º `getter/setter` æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨å®ç°çš„è¯ã€‚

  - `@dynamic`ï¼šè¿™ä¸ªå…³é”®å­—å‘Šè¯‰ç¼–è¯‘å™¨,å±æ€§çš„ `getter` å’Œ `setter` æ–¹æ³•ç”±è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆï¼ˆå½“ç„¶å¯¹äº`@dynamic var`ï¼Œç¼–è¯‘å™¨è¿˜æ˜¯ä¼šé»˜è®¤æ·»åŠ å…¶æˆå‘˜å˜é‡`_var`ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨å®ç° `setter/getter`ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œæ—¶ï¼Œç¼–è¯‘å™¨å‘ç°æ‰¾ä¸åˆ° `setter/getter` å°±ä¼šå´©æºƒã€‚å¥½å¤„æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šå¯¹è±¡ã€‚

æ³¨ï¼š`@dynamic` å¸¸å¸¸å’Œè¿è¡Œæ—¶å‡½æ•° `class_addMethod` é…åˆä½¿ç”¨ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚æœ€å¸¸è§çš„åº”ç”¨æ˜¯åœ¨ `Core Data` çš„ `NSManagedObject` å­ç±»ä¸­ï¼Œ`Core Data` çš„å±æ€§ç»å¸¸è¢«è®¾ç½®ä¸º `@dynamic`ï¼Œ`NSManagedObject` åˆ©ç”¨ `Core Data` çš„åº•å±‚å­˜å‚¨è®¿é—®è¿™äº›å±æ€§ï¼Œä»¥ä¾¿å°†å¯¹è±¡çš„å®é™…æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œè€Œä¸æ˜¯å†…å­˜ä¸­ã€‚ 

:::

#### â“`@synthesize` åˆæˆå®ä¾‹å˜é‡çš„è§„åˆ™æ˜¯ä»€ä¹ˆ

::: details ğŸ’¡

  > `@synthesize` æŒ‡ä»¤åœ¨å®ç°(`.m`)æ–‡ä»¶ä¸­ç”¨äºè®©ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆä¸å±æ€§ç›¸å¯¹åº”çš„å®ä¾‹å˜é‡ï¼Œå¹¶ä¸”ä¼šä¸ºè¿™ä¸ªå®ä¾‹å˜é‡ç”Ÿæˆ `getter` å’Œ `setter` æ–¹æ³•ã€‚

`@synthesize` åŸºæœ¬è§„åˆ™ï¼š

  - å½“åœ¨ `.h` æ–‡ä»¶ä¸­ç”¨ `@property propertyName;` å£°æ˜ä¸€ä¸ªå±æ€§æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º `_propertyName` çš„å®ä¾‹å˜é‡ï¼Œè¿™ä¸ªå®ä¾‹å˜é‡çš„åç§°æ˜¯å±æ€§åå‰åŠ ä¸€ä¸ªä¸‹åˆ’çº¿ã€‚å¦‚æœæ— æ³•è®¿é—®è¿™ä¸ªå®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆå¯èƒ½å°±éœ€è¦ç”¨åˆ° `@synthesize` æ¥è®©ç¼–è¯‘å™¨ç”Ÿæˆè¿™ä¸ªå®ä¾‹å˜é‡ã€‚

  - `@synthesize` åé¢å¯ä»¥è·Ÿä¸Šä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå˜é‡åã€‚å¦‚æœè·Ÿä¸Šä¸€ä¸ªå˜é‡åå¦‚ `@synthesize propertyName;` é‚£ä¹ˆç¼–è¯‘å™¨ä¼šä»…ä¸º `propertyName` è¿™ä¸ªå±æ€§ç”Ÿæˆä¸€ä¸ªåä¸º `propertyName`ï¼ˆæ²¡æœ‰ä¸‹åˆ’çº¿ï¼‰çš„å®ä¾‹å˜é‡ã€‚å¦‚æœè·Ÿä¸Šä¸¤ä¸ªå˜é‡åï¼Œå¦‚ `@synthesize propertyName = _propertyName;` ç¼–è¯‘å™¨ä¼šä¸º `propertyName` è¿™ä¸ªå±æ€§ç”Ÿæˆä¸€ä¸ªåä¸º `_propertyName` çš„å®ä¾‹å˜é‡ã€‚

  - å¦‚æœä¸€ä¸ªå±æ€§è¢« `@synthesize` æŒ‡å®šäº†ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§çš„ `getter` å’Œ `setter` æ–¹æ³•å°±ä¼šå’Œè¿™ä¸ªå®ä¾‹å˜é‡ç»‘å®šï¼Œå³é€šè¿‡ `getter` å’Œ `setter` æ–¹æ³•æ“ä½œçš„å°±æ˜¯è¿™ä¸ªå®ä¾‹å˜é‡ã€‚

```objc
@implementation MyClass
@synthesize foo = myFoo; // åˆ›å»ºä¸€ä¸ªåä¸º myFoo çš„å®ä¾‹å˜é‡
@end
```

:::

> â“å¦‚æœå±æ€§åä¸º `foo`ï¼Œå­˜åœ¨ä¸€ä¸ªåä¸º `_foo` çš„å®ä¾‹å˜é‡ï¼Œè¿˜ä¼šè‡ªåŠ¨åˆæˆæ–°å˜é‡ä¹ˆ

::: details ğŸ’¡

  å±æ€§åä¸º `foo`ï¼ŒåŒæ—¶å·²ç»å®ç°äº†ä¸€ä¸ªåä¸º `_foo` çš„å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ä½¿ç”¨ `@synthesize` å…³é”®å­—æ¥æ‰‹åŠ¨æŒ‡å®šæˆå‘˜å˜é‡åï¼‰ï¼Œç¼–è¯‘å™¨ä¸ä¼šå†åˆæˆæ–°çš„å®ä¾‹å˜é‡ã€‚å› ä¸ºç¼–è¯‘å™¨é»˜è®¤çš„å‘½åè§„åˆ™æ˜¯åœ¨å±æ€§åå‰åŠ  `_` ä½œä¸ºæˆå‘˜å˜é‡åï¼Œå¦‚æœå·²ç»å­˜åœ¨è¿™æ ·çš„æˆå‘˜å˜é‡ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå†åˆ›å»ºæ–°çš„å˜é‡ã€‚

```objc
@interface MyClass : NSObject
@property (nonatomic, strong) id foo;
@end

@implementation MyClass {
    id _foo; // ä¸ä¼šå†åˆæˆæ–°çš„å®ä¾‹å˜é‡
}
```

:::

#### â“`@synthesize` çš„ä½¿ç”¨åœºæ™¯

::: details ğŸ’¡

  - è®¾ç½®å®ä¾‹å˜é‡åã€‚
    > `@synthesize` å…³é”®å­—å…è®¸æ‰‹åŠ¨æ”¹å˜è‡ªåŠ¨ç”Ÿæˆçš„å®ä¾‹å˜é‡çš„åç§°ã€‚

  - åè®®å±æ€§è‡ªåŠ¨åˆæˆã€‚
    > å®ç°åè®®æ—¶ï¼Œä¸ºäº†é¿å…é‡å¤ç¼–å†™ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ `@synthesize` æ¥è‡ªåŠ¨åˆæˆåè®®ä¸­å®šä¹‰çš„å±æ€§ã€‚ 

  - ä¸ç”Ÿæˆå®ä¾‹å˜é‡ã€‚
    > å½“åœ¨ç±»æ‰©å±• (`@interface MyClass()`) æˆ–è€…çˆ¶ç±»ä¸­å·²ç»å£°æ˜äº†å±æ€§çš„å®ä¾‹å˜é‡ `_foo`ï¼Œæ­¤æ—¶åœ¨å­ç±»ä¸­å¦‚æœ `@synthesize foo;`ï¼Œåˆ™ä¸ä¼šç”Ÿæˆ `foo` å¯¹åº”çš„å®ä¾‹å˜é‡ã€‚

  - ç”Ÿæˆå®ä¾‹å˜é‡ã€‚
    > å½“åœ¨å¤´æ–‡ä»¶æˆ–è€…ç±»æ‰©å±•ï¼ˆ`@interface MyClass()`ï¼‰ä¸­å£°æ˜ `@property` å±æ€§ä½†æ²¡æœ‰ `@synthesize foo;`ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆ `_foo` å®ä¾‹å˜é‡ã€‚å¦‚æœåœ¨ `.m` æ–‡ä»¶ä¸­å£°æ˜ `@property` å±æ€§ä½†æ²¡æœ‰ `@synthesize foo;`ï¼Œåˆ™ä¸ä¼šè‡ªåŠ¨åˆæˆå±æ€§çš„å®ä¾‹å˜é‡ã€‚

æ³¨ï¼šåœ¨ `Xcode 4.4` åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å·²ç»å¼€å¯äº† `@synthesize` è‡ªåŠ¨ç”Ÿæˆï¼Œå·²ç»ä¸éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ `@synthesize`ï¼Œé™¤éåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦æ‰‹åŠ¨æŒ‡å®šå®ä¾‹å˜é‡çš„åå­—ã€‚

:::

------

## æ‹·è´

### â“`copy` vs `mutableCopy`

::: details ğŸ’¡

> `copy` å’Œ `mutableCopy` æ˜¯ `NSObject` ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè¢«ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„æ‹·è´ã€‚

  - `copy`ï¼šæ‰§è¡Œçš„æ˜¯æµ…æ‹·è´ï¼ˆä¹Ÿå«åšæŒ‡é’ˆæ‹·è´ï¼‰ï¼Œæ‹·è´åçš„å¯¹è±¡ç±»å‹æ˜¯ä¸å¯å˜çš„ã€‚
    > `copy` å¹¶æ²¡æœ‰å¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯æ‹·è´å¯¹è±¡æŒæœ‰çš„æŒ‡é’ˆã€‚å› æ­¤åŸå§‹å¯¹è±¡å’Œæ‹·è´å¯¹è±¡æŒ‡å‘ç›¸åŒçš„å†…å­˜åœ°å€ã€‚

  - `mutableCopy`ï¼šæ‰§è¡Œçš„æ˜¯æ·±æ‹·è´ï¼ˆä¹Ÿå«åšå†…å®¹æ‹·è´ï¼‰ï¼Œæ‹·è´åçš„å¯¹è±¡ç±»å‹æ˜¯å¯å˜çš„ã€‚
    > `mutableCopy` ä¼šå¼€è¾Ÿä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œæ‹·è´å¯¹è±¡çš„å€¼åˆ°è¿™å—æ–°çš„å†…å­˜ç©ºé—´ã€‚

æ³¨ï¼šæµ…æ‹·è´å¹¶ä¸æ„å‘³ç€æ‹·è´å‡ºæ¥çš„å¯¹è±¡ä¸€å®šæ˜¯ä¸å¯å˜çš„ï¼Œå…·ä½“è¿˜éœ€è¦çœ‹æ‹·è´çš„æºå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ã€‚å¦‚æœæ‹·è´çš„æºå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆ `copy` æ–¹æ³•æ‹·è´å‡ºæ¥çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼›å¦‚æœæ‹·è´çš„æºå¯¹è±¡æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆ `copy` æ–¹æ³•æ‹·è´å‡ºæ¥çš„å¯¹è±¡å°±æ˜¯å¯å˜çš„ã€‚

:::

> â“`copy` ä¿®é¥°çš„å±æ€§ï¼Œæ‹·è´å‘ç”Ÿçš„æ—¶æœº

::: details ğŸ’¡

  `copy`å…³é”®å­—ä¿®é¥°çš„å±æ€§ï¼Œæ‹·è´åŠ¨ä½œå‘ç”Ÿåœ¨ `setter` æ–¹æ³•è¢«è°ƒç”¨æ—¶ã€‚å…·ä½“å‘ç”Ÿåœ¨å±æ€§è¢«èµ‹å€¼çš„è¿‡ç¨‹ä¹‹ä¸­ï¼Œæ–°çš„å¯¹è±¡é€šè¿‡ `copy` æ–¹æ³•ç”Ÿæˆï¼Œç„¶åè¢«èµ‹å€¼ç»™å±æ€§ã€‚

```objc
@property (nonatomic, copy) NSString *name;

// å±æ€§èµ‹å€¼
person.name = @"John";
// ç­‰ä»·äº
[person setName:[@"John" copy]];
```

:::


### â“`copy` ä¿®é¥°çš„å±æ€§çš„ `setter` æ–¹æ³•å¦‚ä½•é‡å†™

::: details ğŸ’¡

```objc
@interface MyClass : NSObject
@property (nonatomic, copy) NSString *myString;
@end

@implementation MyClass
- (void)setMyString:(NSString *)newString {
    // å…ˆæ£€æŸ¥æ–°å€¼ä¸æ—§å€¼æ˜¯å¦ç›¸ç­‰
    if (_myString != newString) {
        _myString = [newString copy]; // ä½¿ç”¨ copy è¿›è¡Œèµ‹å€¼
    }
}
@end
```

:::

### â“`copy` ä¸€èˆ¬ç”¨äºä¸å¯å˜å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆ

::: details ğŸ’¡

  - ä½¿ç”¨ `copy` å¯ä»¥é˜²æ­¢ä¸å¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«æ„å¤–ä¿®æ”¹ã€‚

    ```objc
    @interface Person : NSObject
    @property (nonatomic, copy) NSString *name;
    @end
    
    NSMutableString *mutableString = [NSMutableString stringWithString:@"Hello"];
    Person *person = [[Person alloc] init];
    person.name = mutableString;
    [mutableString appendString:@" World"];
    NSLog(@"%@", person.name); // "Hello"ï¼Œä½¿ç”¨ copyï¼Œperson.name ä¸ä¼šéšç€ mutableString çš„æ”¹å˜è€Œæ”¹å˜
    // å¦‚æœ name ä½¿ç”¨ strong ä¿®é¥°ï¼Œåˆ™ä¼šä¼šæ‰“å° "Hello World"
    ```

  - æŸäº›å…·æœ‰çˆ¶å­å…³ç³»çš„ç±»ï¼Œå­ç±»å¯¹è±¡èµ‹å€¼ç»™ç”¨ `copy` ä¿®é¥°çš„çˆ¶ç±»å˜é‡åï¼Œçˆ¶ç±»å˜é‡ä¼šå˜ä¸ºåŸæ¥çš„çˆ¶ç±»ç‰¹æ€§(é‡Œæ°æ›¿æ¢)ã€‚
    
    ```objc
    NSMutableString *mutableString = [NSMutableString stringWithString:@"Hello"];
    NSString *copyString = [mutableString copy];
    [mutableString appendString:@" World"];
    NSLog(@"%@", copyString); // "Hello"ï¼Œcopy åçš„ copyString æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¸ä¼šæ”¹å˜
    ```

:::

### â“`@property (copy) NSMutableArray *array;` è¿™ä¸ªå†™æ³•æ­£ç¡®å—

::: details ğŸ’¡

> è¿™ä¸ªå†™æ³•å¯ä»¥è¿è¡Œé€šè¿‡ï¼Œä½†ä»ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µæ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å†™æ³•ã€‚

  ç»™ä¸€ä¸ªå±æ€§æ·»åŠ  `copy` æ ‡è¯†æ—¶ï¼Œè¿™ä¸ªå±æ€§çš„ `setter` å°†ä¼šä½¿ç”¨ä¼ å…¥å¯¹è±¡çš„ `copy` æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œåœ¨ `Objective-C` ä¸­ï¼Œ`copy` æ–¹æ³•å¯¹ `NSMutableArray` å®ä¾‹è°ƒç”¨å°†è¿”å›ä¸€ä¸ª `NSArray` å®ä¾‹ã€‚è¿™æ˜¯ç”±äº `copy` ç­–ç•¥æ€»æ˜¯è¿”å›ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬ã€‚

  æ‰€ä»¥ï¼Œå¦‚æœç”¨ `@property (copy) NSMutableArray *array;` è¿™ä¸ªå†™æ³•ï¼Œå®é™…ä¸Šå¾—åˆ°çš„ `array` æ˜¯ä¸€ä¸ªä¸å¯å˜æ•°ç»„ `NSArray`ã€‚åœ¨åç»­ä»£ç ä¸­å°è¯•å‘è¿™ä¸ª â€œå¯å˜æ•°ç»„â€ (`NSMutableArray`) ä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼Œå°†ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚

:::

> â“`NSMutableArray` å±æ€§å¦‚ä½•æ”¯æŒ `copy` 

::: details ğŸ’¡

  éœ€è¦æ‰‹åŠ¨å®ç°å±æ€§çš„ `getter` å’Œ `setter` æ–¹æ³•ï¼Œå¹¶åœ¨ `setter` æ–¹æ³•ä¸­ä½¿ç”¨ `mutableCopy` è¿›è¡Œæ‹·è´ã€‚

```objc
@interface MyClass : NSObject
@property (nonatomic, strong) NSMutableArray *array;
@end

@implementation MyClass

- (void)setArray:(NSMutableArray *)newArray {
    // è¿™æ ·å¯ä»¥ä¿è¯æ¯æ¬¡è®¾ç½®æ–°æ•°ç»„æ—¶éƒ½åˆ›å»ºä¸€ä¸ªå¯å˜å‰¯æœ¬ï¼Œè€Œä¸æ˜¯æŒ‡å‘åŸå§‹æ•°ç»„ã€‚
    _array = [newArray mutableCopy];
}

@end
```

:::

### â“è‡ªå®šä¹‰ç±»å¦‚ä½•å®ç° `copy` åŠŸèƒ½

::: details ğŸ’¡

  è‡ªå®šä¹‰ç±»éœ€è¦æ”¯æŒæ‹·è´åŠŸèƒ½ï¼Œéœ€è¦éµå¾ªå¹¶å®ç° `NSCopying` åè®®ï¼Œå¹¶é‡å†™ `copyWithZone:` æ–¹æ³•ã€‚

```objc
// è‡ªå®šä¹‰ç±» Person å®ç° copy åŠŸèƒ½
//  - 1> éµå¾ª NSCopying åè®®
@interface Person : NSObject <NSCopying>
@property (nonatomic, copy) NSString *name;
@property (nonatomic, assign) NSUInteger age;
@end

@implementation Person
//  - 2> å®ç° copyWithZone: æ–¹æ³•
- (id)copyWithZone:(NSZone *)zone {
    Person *copyPerson = [[[self class] allocWithZone:zone]init];
    copyPerson.name = [self.name copyWithZone:zone]; // å¯¹è±¡ç±»å‹å±æ€§éœ€è¦è°ƒç”¨ copyWithZone å®Œæˆæ‹·è´
    copyPerson.age = self.age;
    return copyPerson;
}
@end

// ä½¿ç”¨
Person *person = [[Person alloc] init];
Person *newPerson = [person copy]; // å®Œæˆæ‹·è´
```

:::

### â“è‡ªå®šä¹‰ç±»å¦‚ä½•å®ç° `mutableCopy` åŠŸèƒ½

::: details ğŸ’¡

  è‡ªå®šä¹‰ç±»å‹å®ç° `mutableCopy`ï¼Œéœ€è¦éµå¾ª `NSMutableCopying` åè®®ï¼Œå¹¶å®ç° `mutableCopyWithZone:` æ–¹æ³•ã€‚

```objc
@interface Person : NSObject <NSMutableCopying>
@property (nonatomic, copy) NSString *name;
@property (nonatomic, assign) NSUInteger age;
@end

@implementation Person
- (id)mutableCopyWithZone:(NSZone *)zone {
    Person *copyPerson = [[[self class] allocWithZone:zone]init];
    copyPerson.name = [self.name mutableCopyWithZone:zone]; // å¯¹è±¡ç±»å‹ï¼Œä½¿ç”¨ mutableCopyWithZone è·å–å¯å˜å‰¯æœ¬
    copyPerson.age = self.age; // åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ 
    return copyPerson;
}
@end
```

:::

### â“`[object copy]` æ˜¯æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´

::: details ğŸ’¡

> `[object copy]`æ–¹æ³•çš„è¡Œä¸ºå–å†³äºå¯¹è±¡æ”¯æŒå“ªç§æ‹·è´ã€‚

  - é»˜è®¤æƒ…å†µä¸‹ï¼Œ`[object copy]`æ‰§è¡Œçš„æ˜¯æµ…æ‹·è´ï¼Œä¹Ÿå«åšæŒ‡é’ˆæ‹·è´ï¼Œå³åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å†…å®¹æŒ‡å‘åŸå¯¹è±¡å†…å­˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¿®æ”¹æ–°å¤åˆ¶å‡ºæ¥çš„å¯¹è±¡ä¼šå½±å“åˆ°åŸå¯¹è±¡ã€‚

  - å¦‚æœè¦å®ç°æ·±æ‹·è´ï¼Œéœ€è¦å¯¹è±¡éµå®ˆ `NSCopying` æˆ– `NSMutableCopying` åè®®ï¼Œå¹¶å®ç° `copyWithZone:` æˆ– `mutableCopyWithZone:` æ–¹æ³•ï¼Œåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œå®é™…çš„å¤åˆ¶æ“ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`[object copy]` æ‰§è¡Œçš„å°±æ˜¯æ·±æ‹·è´ï¼Œå³å®Œå…¨å¤åˆ¶å‡ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å†…å®¹å’ŒåŸå¯¹è±¡æ˜¯ç‹¬ç«‹çš„ã€‚ä¿®æ”¹æ–°å¤åˆ¶å‡ºæ¥çš„å¯¹è±¡ä¸ä¼šå½±å“åˆ°åŸå¯¹è±¡ã€‚

ğŸŒ° `NSArray` å’Œ `NSString` ç­‰ä¸å¯å˜å¯¹è±¡çš„ `copy` æ–¹æ³•æ‰§è¡Œçš„æ˜¯æµ…æ‹·è´ï¼Œè€Œ `mutableCopy` æ–¹æ³•æ‰§è¡Œçš„æ˜¯æ·±æ‹·è´ã€‚è€Œå¯¹äºå®ƒä»¬å„è‡ªçš„å¯å˜ç‰ˆæœ¬ï¼Œå³ `NSMutableArray` å’Œ `NSMutableString` ç­‰ï¼Œ `copy` å’Œ `mutableCopy` æ–¹æ³•éƒ½æ‰§è¡Œçš„æ˜¯æ·±æ‹·è´ã€‚

æ€»ç»“ï¼š`[object copy]` æ˜¯æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´ï¼Œéœ€è¦æ ¹æ®è¯¥å¯¹è±¡çš„å…·ä½“å®ç°æ¥åˆ¤æ–­ã€‚

:::

------

## Block
  
### â“`block` vs `delegate`
  
::: details ğŸ’¡

  - å®šä¹‰æ–¹å¼ï¼š
    * `block` æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°†ä¸€æ®µä»£ç å°è£…åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªå˜é‡ã€‚
    * `delegate` ä»£ç†æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ˜¯é€šè¿‡ `protocol` å®šä¹‰äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç„¶åç”±å…¶ä»–ç±»å»å®ç°è¿™äº›æ–¹æ³•ã€‚

  - ä½¿ç”¨åœºæ™¯ï¼š
    * `block` é€‚åˆä¸€äº›ç®€å•çš„é€»è¾‘å¤„ç†ï¼Œå¦‚åŠ¨ç”»å›è°ƒï¼Œæ•°ç»„éå†ç­‰ã€‚
    * `delegate` ä»£ç†é€šå¸¸ç”¨äºå¤„ç†å¤æ‚çš„äº¤äº’ï¼Œå¦‚ `TableView` çš„æ•°æ®æºåŠä»£ç†æ–¹æ³•ï¼Œç½‘ç»œè¯·æ±‚çš„å›è°ƒç­‰ã€‚

  - æ‰§è¡Œæµç¨‹ï¼š
    * `block` åœ¨è°ƒç”¨æ—¶æ˜¯åŒä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•å†…éƒ¨çš„ï¼Œé€»è¾‘å…³ç³»ç›¸å¯¹æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£ã€‚
    * `delegate` ä»£ç†æ–¹æ³•å¯èƒ½åˆ†æ•£åœ¨ä»£ç çš„ä¸åŒåœ°æ–¹ï¼Œä½¿å¾—è°ƒè¯•å’Œé˜…è¯»ä»£ç ç¨å¾®å›°éš¾ä¸€äº›ã€‚

  - ç”Ÿå‘½å‘¨æœŸï¼š
    * `block` æœ‰å¯èƒ½å¯¼è‡´å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚
    * `delegate` ç”±äºæ˜¯ `weak` å¼•ç”¨ï¼Œä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚

  - æ’åºï¼š
    * `block` å¯ä»¥æœ‰å¤šä¸ªä¸”åŒæ—¶å­˜åœ¨ï¼Œé¡ºåºå¯ä»¥è‡ªç”±æ”¹å˜ã€‚
    * `delegate` é€šå¸¸åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé€šå¸¸éœ€è¦å…¶ä»–æ–¹å¼è¿›è¡Œæ’åºã€‚ 

:::
  
### â“`block` vs å‡½æ•°æŒ‡é’ˆ
  
::: details ğŸ’¡
  
  - `block`ï¼šä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨ä¸€æ®µä»£ç ï¼Œå¹¶ä¸”è¿™æ®µä»£ç å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¢«æ‰§è¡Œã€‚å¯ä»¥è®¿é—®åœ¨å£°æ˜ä»–çš„é‚£ä¸ªä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡ï¼Œè¿™è¢«ç§°ä¸ºâ€œå˜é‡æ•è·â€ã€‚
  
  - å‡½æ•°æŒ‡é’ˆï¼šå‡½æ•°æŒ‡é’ˆæ˜¯å­˜å‚¨ç€å‡½æ•°åœ°å€çš„æŒ‡é’ˆå˜é‡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåœ°å€å€¼ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ã€‚å‡½æ•°æŒ‡é’ˆä¸èƒ½åƒ `block` é‚£æ ·è®¿é—®å˜é‡ï¼Œåªèƒ½é€šè¿‡ä¼ å‚çš„æ–¹å¼å»ä½¿ç”¨å¤–éƒ¨çš„æ•°æ®ã€‚
  
:::

### â“`block` åº•å±‚å®ç°

::: details ğŸ’¡

  `block` æ˜¯ä¸€ä¸ª `Objective-C` å¯¹è±¡ï¼Œå®ƒçš„å®šä¹‰ä¸­åŒ…å«äº†ä¸€ä¸ªç»“æ„ä½“å’Œå‡½æ•°æŒ‡é’ˆã€‚

```objc
// ç®€åŒ–ç‰ˆ block ç»“æ„ä½“
struct Block_literal {
    void *isa;
    int flags;
    int reserved;
    void (*invoke)(void *, ...);
    struct block_descriptor *descriptor;
    /* captured variables... */
};
```

  - `isa`ï¼šæŒ‡å‘å¯¹è±¡çš„ç±»å‹ï¼Œæ‰€æœ‰ `Objective-C` å¯¹è±¡éƒ½æœ‰è¯¥å˜é‡ã€‚
  - `flags` å’Œ `reserved`ï¼šæä¾›å…³äº `block` çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚ `block` ç±»å‹ç­‰ã€‚
  - `invoke`ï¼šä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘è¿›è¡Œè°ƒç”¨çš„å‡½æ•°ã€‚
  - `descriptor`ï¼šä¸€ä¸ªæŒ‡å‘ `Block_descriptor` ç»“æ„çš„æŒ‡é’ˆï¼Œå…¶ä¸­åŒ…å«ç›¸å…³ä¿¡æ¯ã€‚

`block` çš„å†…å­˜ç®¡ç†ï¼š

  - å½“ `block` æ²¡æœ‰æ•è·ä»»ä½•å¤–éƒ¨å˜é‡ï¼Œæˆ–è€…ä»…ä½¿ç”¨äº†å…¨å±€å˜é‡å’Œé™æ€å˜é‡æ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ª `global block`ï¼Œå­˜å‚¨åœ¨ç¨‹åºçš„å…¨å±€æ•°æ®åŒºï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä»åˆ›å»ºåˆ°ç¨‹åºç»“æŸã€‚
  
  - å½“ `block` ä½¿ç”¨äº†å¤–éƒ¨çš„è‡ªåŠ¨å˜é‡ï¼ˆåŒ…æ‹¬ `ObjC` å¯¹è±¡å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼‰ï¼Œåœ¨æœªè¿›è¡Œ `copy` æ“ä½œçš„æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ª `stack block`ï¼Œå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸Šï¼Œè¶…å‡ºä½œç”¨åŸŸå³è¢«é”€æ¯ã€‚
  
  - å¦‚æœå¯¹ `block` è¿›è¡Œäº† `copy` æ“ä½œï¼Œæˆ–è€…æ˜¯ç”¨ `__block` ä¿®é¥°çš„è‡ªåŠ¨å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ª `block` æ˜¯ä¸€ä¸ª `malloc block`ï¼Œå­˜å‚¨åœ¨å †å†…å­˜ä¸Šï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œå†…å­˜ç®¡ç†ã€‚

[ğŸ‘‰ğŸ»](https://www.mikeash.com/pyblog/friday-qa-2009-08-14-practical-blocks.html)

:::

### __block

#### â“`block` å†…å¦‚ä½•ä¿®æ”¹å¤–éƒ¨å˜é‡

::: details ğŸ’¡

ä½¿ç”¨ `__block` ä¿®é¥°ç¬¦

```objc
__block int num = 0;
void (^myBlock)(void) = ^{
    num = 1;  
};

myBlock();
NSLog(@"Num: %d", num);  // è¿™é‡Œè¾“å‡º "Num: 1"
```

:::

#### â“`block` åœ¨æ•è·è‡ªåŠ¨å˜é‡ï¼Œå±€éƒ¨é™æ€å˜é‡ï¼Œå…¨å±€å˜é‡ï¼Œå…¨å±€é™æ€å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«

::: details ğŸ’¡

  - è‡ªåŠ¨å˜é‡ï¼ˆ`auto variables`ï¼‰ï¼šè¿™æ˜¯åœ¨æ–¹æ³•æˆ–å‡½æ•°ä¸­å¸¸è§çš„å±€éƒ¨å˜é‡ï¼Œå¦‚ `int num = 10`ã€‚è¿™ç§å˜é‡åœ¨ `block` ä¸­é»˜è®¤ä»¥å€¼ä¼ é€’å½¢å¼æ•è·ï¼Œå³ `block` æ•è·çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯å˜é‡æœ¬èº«ã€‚å¦‚æœè¦åœ¨ `block` ä¸­ä¿®æ”¹å±€éƒ¨å˜é‡çš„å€¼ï¼Œå¿…é¡»åœ¨å®šä¹‰å˜é‡æ—¶åŠ ä¸Š `__block` ä¿®é¥°ç¬¦ã€‚

  - å±€éƒ¨é™æ€å˜é‡ã€å…¨å±€å˜é‡ã€å…¨å±€é™æ€å˜é‡ï¼šè¿™äº›å˜é‡åœ¨ `block` ä¸­ä»¥æŒ‡é’ˆå½¢å¼æ•è·ï¼Œå³ `block` æ•è·çš„æ˜¯å¯¹è¿™äº›å˜é‡çš„æŒ‡é’ˆã€‚è¿™æ„å‘³ç€ï¼Œå¯ä»¥åœ¨ `block` ä¸­ç›´æ¥ä¿®æ”¹è¿™äº›å˜é‡çš„å€¼ï¼Œä¸éœ€è¦åŠ  `__block` ä¿®é¥°ç¬¦ã€‚

```objc
int globalVar = 4;
static int staticGlobalVar = 5;

void Test() {
    int localVar = 1;
    static int staticVar = 2;
    __block int blockVar = 3;

    void (^myBlock)(void) = ^{
        NSLog(@"localVar: %d", localVar);          // 1
        NSLog(@"staticVar: %d", staticVar);        // 2
        NSLog(@"blockVar: %d", blockVar);          // 3
        NSLog(@"globalVar: %d", globalVar);        // 4
        NSLog(@"staticGlobalVar: %d", staticGlobalVar);  // 5

        // localVar++;              // Error! "Variable is not assignable (missing __block type specifier)"
        staticVar++;
        blockVar++;
        globalVar++;
        staticGlobalVar++;
    };

    myBlock();
    
    NSLog(@"staticVar after block: %d", staticVar);        // 3
    NSLog(@"blockVar after block: %d", blockVar);          // 4
    NSLog(@"globalVar after block: %d", globalVar);        // 5
    NSLog(@"staticGlobalVar after block: %d", staticGlobalVar);  // 6
}
```

:::

#### â“`block` æ•è·å¤–éƒ¨å±€éƒ¨å˜é‡å®é™…ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆ

::: details ğŸ’¡

   `block` å¯ä»¥æ•è·å…¶å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½¿å¾—è¿™äº›å¤–éƒ¨å˜é‡å¯ä»¥åœ¨ `block` çš„æ‰§è¡Œä½“å†…éƒ¨è¢«è®¿é—®åˆ°ã€‚æ•è·çš„è¿‡ç¨‹å…¶å®æ˜¯åœ¨ `block` è¢«åˆ›å»ºæ—¶å‘ç”Ÿçš„ã€‚`block` ä¼šåˆ›å»ºå¯¹åº”çš„å˜é‡çš„ "æ‹·è´"ã€‚

  - å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹å˜é‡ï¼Œæ¯”å¦‚ `intã€floatï¼Œblock` ä¼šå¤åˆ¶å…¶å€¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ `heap`(å †) åº”ç”¨ä¸€æ®µå†…å­˜ï¼Œå°†å¤–éƒ¨çš„å˜é‡å€¼å¤åˆ¶ä¸€ä»½åˆ°è¿™ä¸ªå†…å­˜ä¸Šã€‚

  - å¯¹äºå¯¹è±¡ç±»å‹å˜é‡ï¼Œ`block` ä¼šä¿ç•™è¯¥å¯¹è±¡ï¼Œå¹¶å¤åˆ¶å¯¹è±¡æŒ‡é’ˆã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºå¼•ç”¨æ•è·ã€‚è¿™æ · `block` å¯¹è±¡å¯ä»¥åœ¨ç¨åçš„æ—¶é—´é‡Œéšæ—¶å¼•ç”¨åˆ°è¿™ä¸ªå˜é‡ã€‚

  `__block` å…³é”®å­—å¯ä»¥ç”¨äºè§£å†³ `block` å†…éƒ¨æ— æ³•ä¿®æ”¹å¤–éƒ¨å˜é‡çš„é—®é¢˜ã€‚å½“æ•è·ä¸€ä¸ª `__block` å˜é‡æ—¶ï¼Œ`block` å†…éƒ¨ä¼šä¿ç•™è¿™ä¸ª `__block` å˜é‡ã€‚åœ¨å †ä¸Šåˆ›å»ºçš„ `block` ä¼šåœ¨ `heap` ä¸­ç»´æŠ¤ä¸€ä¸ª `__block` å˜é‡çš„ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­åŒ…å«äº† `__block` å˜é‡çš„åœ°å€å’Œå…¶å€¼ï¼Œè¿™æ · `block` å°±å¯ä»¥é€šè¿‡æ“ä½œè¿™ä¸ªç»“æ„ä½“æ¥ä¿®æ”¹ `__block` å˜é‡çš„å€¼ã€‚

:::

> â“å¦‚æœ ä½¿ç”¨ `__block` æ•è·äº†å±€éƒ¨å˜é‡ï¼Œè¿™ä¸ª `block` ä½œä¸ºè¿”å›å€¼ `return` äº†ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡é‡Šæ”¾äº†ï¼Œæ€ä¹ˆåŠ

::: details ğŸ’¡

  åœ¨ä½¿ç”¨ `__block` æ•è·å±€éƒ¨å˜é‡çš„åŒæ—¶ï¼Œå¦‚æœè¿™ä¸ª `block` ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œé‚£ä¹ˆè¿™ä¸ªå±€éƒ¨å˜é‡å°±ä¼šè¢« `block` æ•è·åˆ°ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿå‘½å‘¨æœŸå°±å»¶é•¿åˆ°äº† `block` ç”Ÿå‘½å‘¨æœŸç»“æŸä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡ä¸ä¼šåœ¨ç¦»å¼€å®šä¹‰å®ƒçš„ä½œç”¨åŸŸæ—¶é‡Šæ”¾ï¼Œè€Œæ˜¯å°†åœ¨ `block` è¢«é‡Šæ”¾æ—¶æ‰é‡Šæ”¾ã€‚

  æ­£å¸¸æƒ…å†µä¸‹ `block` æ˜¯åˆ†é…åœ¨æ ˆä¸Šçš„ï¼Œæ ˆä¸Šçš„ `block` åœ¨ç¦»å¼€ä½œç”¨åŸŸåå°±ä¼šè¢«é”€æ¯ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ª `block` è¢«èµ‹å€¼ç»™äº†ä¸€ä¸ªå¼ºå¼•ç”¨çš„å˜é‡ï¼Œæˆ–è€…è¢«è¿”å›å‡ºå»çš„è¯ï¼Œå°±éœ€è¦å°†æ ˆä¸Šçš„ `block` å¤åˆ¶åˆ°å †ä¸Šï¼Œè¿™æ · `block` çš„ç”Ÿå‘½å‘¨æœŸå°±ä¼šå¾—åˆ°å»¶é•¿ï¼Œç›´åˆ°æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘å®ƒä¸ºæ­¢ã€‚

  å¯¹äºä½¿ç”¨ `__block` ä¿®é¥°çš„å±€éƒ¨å˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å­˜å‚¨åœ°å€ä¼šä»æ ˆå¤åˆ¶åˆ°å †ä¸Šã€‚æ‰€ä»¥ï¼Œè¿”å›çš„ `block` ä¸­æ•è·çš„æ˜¯ç§»åŠ¨åˆ°å †ä¸Šçš„ `__block` å˜é‡çš„åœ°å€ï¼Œè¿™ä¹Ÿç¡®ä¿äº†è¿”å›åï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°è®¿é—®å’Œä¿®æ”¹è¿™ä¸ª `__block` å˜é‡ã€‚

:::

#### â“`block` ä¿®æ”¹æ•è·å˜é‡é™¤äº†ç”¨ `__block` è¿˜å¯ä»¥æ€ä¹ˆåš

::: details ğŸ’¡

å¯ä»¥ä½¿ç”¨ `NS(Mutable)Object/Dictionary/Array` ç­‰ï¼Œè¿™äº›ç±»å‹çš„å®ä¾‹åœ¨è¢«æ•è·åä»ç„¶å¯ä»¥ä¿®æ”¹å†…å®¹ã€‚

```objc
NSMutableArray *array = [NSMutableArray array];
void (^myBlock)(void) = ^{
    [array addObject:@"Hello"];
};
myBlock();
NSLog(@"%@", array); // è¾“å‡º: ["Hello"]
```

:::

#### â“`block` ä¸­ä¿®æ”¹ `NSMutableArray` éœ€ä¸éœ€è¦æ·»åŠ  `__block`

::: details ğŸ’¡

> ä¸éœ€è¦ã€‚åœ¨ `Objective-C` ä¸­ï¼Œ`NSMutableArray` æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¯¹è±¡ï¼Œå³ä½¿ä¸ä½¿ç”¨ `__block`ï¼Œä¹Ÿå¯ä»¥åœ¨ `block` å†…éƒ¨æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹ `NSMutableArray` çš„å…ƒç´ ã€‚å› ä¸ºä¿®æ”¹çš„æ˜¯ `NSMutableArray` å¯¹è±¡çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ `NSMutableArray` å˜é‡æœ¬èº«ã€‚

```objc
NSMutableArray *array = [NSMutableArray array];
void (^myBlock)(void) = ^{
    // å‘ array æ·»åŠ äº†ä¸€ä¸ªå­—ç¬¦ä¸²
    [array addObject:@"Hello, World"];
};
myBlock();
NSLog(@"%@", array);  // è¾“å‡ºï¼š["Hello, World"]
```

âš ï¸ å¦‚æœå¸Œæœ›åœ¨ `block` ä¸­ä¿®æ”¹ `array` è¿™ä¸ªå˜é‡ï¼ˆæ¯”å¦‚ä½¿å…¶æŒ‡å‘ä¸€ä¸ªå…¨æ–°çš„ `NSMutableArray` å¯¹è±¡ï¼‰ï¼Œé‚£å°±éœ€è¦ä½¿ç”¨ `__block` äº†ã€‚

```objc
__block NSMutableArray *array = [NSMutableArray array];
void (^myBlock)(void) = ^{
    array = [NSMutableArray array];
    [array addObject:@"Hello, World"];
};
myBlock();
NSLog(@"%@", array);  // è¾“å‡ºï¼š["Hello, World"]
```

:::

### å†…å­˜ç®¡ç†

#### â“`block` å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„

::: details ğŸ’¡

`block` çš„å†…å­˜ç®¡ç†é»˜è®¤åˆ†ä¸ºä¸‰ä¸ªçº§åˆ«ï¼š`_NSConcreteGlobalBlock`ã€`_NSConcreteStackBlock`ã€`_NSConcreteMallocBlock`ã€‚

  - `__NSConcreteGlobalBlock__`ï¼šå±äºå…¨å±€åŒºï¼Œç±»ä¼¼äºå…¨å±€å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸä»åº”ç”¨å¼€å§‹ç›´åˆ°åº”ç”¨ç»“æŸã€‚

  - `__NSConcreteStackBlock__`ï¼šå­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­ï¼Œå½“è¶…å‡ºå…¶ä½œç”¨åŸŸåå°±ä¼šè¢«è‡ªåŠ¨é”€æ¯ã€‚

  - `__NSConcreteMallocBlock__`ï¼šå­˜æ”¾åœ¨å †å†…å­˜ä¸­ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†å…¶å†…å­˜ï¼Œå¯ä»¥é€šè¿‡ `retain` æ¥å¢åŠ å…¶å¼•ç”¨è®¡æ•°ï¼Œé€šè¿‡ `release` æ¥å‡å°‘å…¶å¼•ç”¨è®¡æ•°ï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œ`block` ä¼šè¢«é”€æ¯ã€‚

  åœ¨ä½¿ç”¨ `ARC` (Automatic Reference Counting) æ—¶ï¼Œå¯¹ `block` çš„å†…å­˜ç®¡ç†ä¼šç®€åŒ–è®¸å¤šã€‚å½“ `block` ä¸­å¼•ç”¨åˆ°äº†å¤–éƒ¨å˜é‡æ—¶ï¼Œ`block` å°†ä¼šè‡ªåŠ¨ä»æ ˆå¤åˆ¶åˆ°å †ä¸­ï¼ˆæœ‰å¤åˆ¶è¡Œä¸ºçš„ `block` éƒ½ä¼šè¿›å…¥å †åŒºï¼‰ï¼Œå¹¶ä¸”åœ¨å¼•ç”¨è®¡æ•°ä¸º 0 åä¼šè‡ªåŠ¨é”€æ¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†ã€‚

  æ³¨æ„ï¼šå¯¹äº `block` å†…éƒ¨åº”ç”¨åˆ°çš„å¯¹è±¡ï¼Œå¦‚æœä¸åŠ ç‰¹æ®Šå¤„ç†ï¼Œæ˜¯ä¼šå½¢æˆå¼ºå¼•ç”¨çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å¼•ç”¨å¾ªç¯å¹¶å¼•å‘å†…å­˜æ³„æ¼ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œç»å¸¸ä½¿ç”¨ `__weak` æ¥ä¿®é¥°å¼•ç”¨çš„å¯¹è±¡ï¼Œé¿å…äº§ç”Ÿå¾ªç¯å¼•ç”¨ã€‚

:::

#### â“`__block` vs `__weak`

::: details ğŸ’¡

  - `__block`ï¼šå®ƒç”¨äºå…è®¸åœ¨ `block` ä¸­æ”¹å˜å˜é‡çš„å€¼ã€‚
    > `__block` æ˜¯å­˜å‚¨ç±»å‹è¯´æ˜ç¬¦ï¼Œç”¨äºä¿®é¥°ä¸€ä¸ªå˜é‡ï¼Œè®©è¯¥å˜é‡èƒ½åœ¨ `block` ä¸­è¢«è¯»å–å’Œå†™å…¥ã€‚å¦‚æœæ²¡æœ‰ `__block`ï¼Œé‚£ä¹ˆ `block` å°±ä¸èƒ½ä¿®æ”¹è¯¥å˜é‡çš„å€¼ã€‚
    
  - `__weak`ï¼šå®ƒç”¨äºåˆ›å»ºä¸€ä¸ªå¼±å¼•ç”¨ã€‚
    > å¼±å¼•ç”¨æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¼•ç”¨ï¼Œå®ƒä¸ä¼šå¢åŠ è¢«å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚è¿™æ ·å¯ä»¥è§£å†³å¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œå½¢æˆå¼•ç”¨å¾ªç¯çš„é—®é¢˜ã€‚åœ¨å¤„ç† `block` å¯¹è±¡å¼•ç”¨ `self` æ—¶ï¼Œé€šå¸¸ä¼šå…ˆåˆ›å»ºä¸€ä¸ªå¼±å¼•ç”¨çš„ `self`ï¼Œç„¶ååœ¨ `block` ä¸­ä½¿ç”¨è¿™ä¸ªå¼±å¼•ç”¨ï¼Œä»è€Œé¿å…å¼•ç”¨å¾ªç¯ã€‚

:::

#### â“`__block` åœ¨ `ARC` å’Œé `ARC` æœ‰åŒºåˆ«å—

::: details ğŸ’¡

æœ‰åŒºåˆ«

  - åœ¨é `ARC` ç¯å¢ƒä¸‹ï¼Œ`__block` ä¸ä¼šæ”¹å˜å¯¹è±¡çš„æ‰€æœ‰æƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ª `__block` ä¿®é¥°çš„å¯¹è±¡ï¼Œ`block` ä¸ä¼šä¸ºè¿™ä¸ªå¯¹è±¡å¢åŠ å¼•ç”¨è®¡æ•°ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨ `block` æ‰§è¡Œåï¼ŒåŸæ¥çš„å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œé‚£ä¹ˆ `block` å†…çš„è¿™ä¸ªå¯¹è±¡å°±å˜æˆäº†æ‚¬æµ®æŒ‡é’ˆã€‚

  - åœ¨ `ARC` ç¯å¢ƒä¸‹ï¼Œ`__block` æœ‰å¦å¤–ä¸€ç§è¡Œä¸ºã€‚å®ƒä¼šä¿ç•™ `block` ä¸­ä½¿ç”¨åˆ°çš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ª `__block` ä¿®é¥°çš„å¯¹è±¡ï¼Œå½“ `block` æ‰§è¡Œæ—¶ï¼Œå°±ä¼šå¢åŠ è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚å› æ­¤ï¼Œåœ¨ `ARC` ä¸‹ï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨ `block` ä¸­å¼•ç”¨ `__block` ä¿®é¥°çš„å¯¹è±¡ï¼Œè€Œä¸å¿…æ‹…å¿ƒå®ƒä¼šè¢«æå‰é‡Šæ”¾ã€‚

ä¸€èˆ¬ä¼šé€‰æ‹© `__weak` ä»£æ›¿ `__block` æ¥é¿å…å¾ªç¯å¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼•ç”¨ `self` æˆ–è€…å…¶æˆå‘˜å˜é‡çš„æ—¶å€™ã€‚

:::

#### â“`block` ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨

::: details ğŸ’¡
    
  å½“åœ¨ä¸€ä¸ª `Objective-C` å¯¹è±¡çš„æ–¹æ³•ï¼ˆæˆ–è€…å±æ€§ï¼‰ä¸­å¼•ç”¨äº†ä¸€ä¸ª `block`ï¼Œè€Œè¿™ä¸ª `block` ä¸­åˆå¼•ç”¨äº†è¯¥å¯¹è±¡ï¼ˆä¸è®ºæ˜¯ç›´æ¥å¼•ç”¨è¿˜æ˜¯é—´æ¥å¼•ç”¨ï¼‰æ—¶ï¼Œå°±ä¼šå½¢æˆä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚è¿™æ˜¯ç”±äº `block` åœ¨æ•è·å¯¹è±¡æ—¶é»˜è®¤ä¸ºå¼ºå¼•ç”¨ï¼Œè€Œå¯¹è±¡æœ¬èº«åˆå¼ºå¼•ç”¨äº† `block`ï¼Œå½¢æˆäº†å¾ªç¯ã€‚

```objc
// å¾ªç¯å¼•ç”¨
__strong typeof(self) strongSelf = self;
self.myBlock = ^{
    [strongSelf doSomething];
};

// æ‰“ç ´å¾ªç¯å¼•ç”¨
__weak typeof(self) weakSelf = self;
self.myBlock = ^{   
    // ä¸´æ—¶åˆ›å»ºäº†ä¸€ä¸ªå¯¹ weakSelf çš„å¼ºå¼•ç”¨ï¼Œç¡®ä¿åœ¨ block æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç° weakSelf è¢«æ„å¤–é‡Šæ”¾çš„æƒ…å†µã€‚
    __strong typeof(weakSelf) strongSelf = weakSelf;
    [strongSelf doSomething];
};
```

:::

#### â“`UIView` åŠ¨ç”»å‡½æ•° `block` ç‰ˆæœ¬æ˜¯å¦éœ€è¦å¤„ç†å¾ªç¯å¼•ç”¨

::: details ğŸ’¡

åœ¨ `UIView` çš„åŠ¨ç”»å‡½æ•° `block` ç‰ˆæœ¬ä¸­ä½¿ç”¨ `self`ï¼Œå®é™…ä¸Šä¸ä¼šé€ æˆå¼•ç”¨å¾ªç¯ã€‚

```objc
// self ä¸æŒæœ‰ åŠ¨ç”» block
[UIView animateWithDuration:1.0 animations:^{
    self.myView.alpha = 0;
}];
```

:::

#### â“`block` ä¸€èˆ¬ä½¿ç”¨ `copy` ä¿®é¥°ï¼Œå¯ä»¥ä½¿ç”¨ `strong` å—

::: details ğŸ’¡

  `block` ä½¿ç”¨ `copy` ä¿®é¥°æ˜¯ä¸ºäº†ä¿æŒ `block` çš„å¼•ç”¨è®¡æ•°çš„æ­£ç¡®ã€‚`block` æœ¬èº«æ˜¯åœ¨å †æ ˆä¸Šåˆ†é…çš„ï¼Œ`copy` æ“ä½œå°†å…¶å¤åˆ¶åˆ°å †ä¸Šï¼Œå¯ä»¥ä¿è¯ `block` åœ¨æ–¹æ³•è¿”å›åä¸è¢«é”€æ¯ï¼Œä¿è¯å…¶æ­£ç¡®æ‰§è¡Œã€‚

  è™½ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ `strong` æ¥ä¿®é¥° `block`ï¼Œä½†æ˜¯è¿™æ ·åšå¹¶ä¸ä¼šå°† `block` ä»æ ˆå¤åˆ¶åˆ°å †ã€‚å› æ­¤ï¼Œå¦‚æœ `block` æ•è·äº†æ–¹æ³•å†…éƒ¨çš„å˜é‡ï¼Œå½“æ–¹æ³•è¿”å›åï¼Œè¿™äº›å˜é‡éƒ½å·²ç»è¢«é‡Šæ”¾ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚

:::

#### â“ä¸ºä»€ä¹ˆåœ¨ `block` å¤–éƒ¨ä½¿ç”¨ `__weak` ä¿®é¥°çš„åŒæ—¶éœ€è¦åœ¨å†…éƒ¨ä½¿ç”¨ `__strong` ä¿®é¥°
  
::: details ğŸ’¡

  ä½¿ç”¨ `__weak` ä¿®é¥°ç¬¦æ˜¯ä¸ºäº†é˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚ç”±äº `block` ä¼šæ•è·å…¶å†…éƒ¨ä½¿ç”¨çš„å˜é‡ï¼Œå¦‚æœ `block` å†…éƒ¨è®¿é—®äº† `self` æˆ–å…¶æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆä¼šå½¢æˆå¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚è€Œä½¿ç”¨ `__weak` ä¿®é¥°ç¬¦å¯ä»¥å°† `self` æˆ–æˆå‘˜å˜é‡å˜æˆå¼±å¼•ç”¨ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ã€‚

  `__weak` çš„ä¸è¶³ä¹‹å¤„ï¼šåœ¨ `block` æ‰§è¡ŒæœŸé—´ï¼Œè‹¥å¼±å¼•ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œé‚£ä¹ˆ `block` å†…éƒ¨å¯¹è¯¥å¯¹è±¡çš„è®¿é—®å°±ä¼šå¤±æ•ˆã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦åœ¨ `block` å†…éƒ¨ä½¿ç”¨ `__strong` ä¿®é¥°ç¬¦å°†å¼±å¼•ç”¨å˜é‡æå‡ä¸ºå¼ºå¼•ç”¨ã€‚

  è¿™æ ·åšå¯ä»¥ä¿è¯åœ¨ `block` æ‰§è¡ŒæœŸé—´ï¼Œè¿™ä¸ªè¢«æå‡çš„å¼ºå¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä¿è¯äº† `block` æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹è±¡çš„è®¿é—®å®‰å…¨ã€‚è€Œåœ¨ `block` æ‰§è¡Œå®Œæ¯•åï¼Œå¼ºå¼•ç”¨ä¹Ÿä¼šéšä¹‹é‡Šæ”¾ï¼Œå’Œåœ¨ `block` å¤–éƒ¨ä¿æŒæŒ‡å‘å¯¹è±¡çš„å¼±å¼•ç”¨å¹¶ä¸å­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚

```objc
__weak typeof(self) weakSelf = self;
[self doSomethingWithBlock:^{
    __strong typeof(self) strongSelf = weakSelf;
    [strongSelf doSomethingElse];  
    // åœ¨æ­¤å¤„ï¼Œè‹¥ self åœ¨ block æ‰§è¡ŒæœŸé—´é‡Šæ”¾ï¼Œç”±äºå­˜åœ¨ strongSelf çš„å¼ºå¼•ç”¨ï¼Œself æ‰€æŒ‡å‘çš„å¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ã€‚
}];
```

:::


#### â“`block` è®¿é—®å¯¹è±¡ç±»å‹çš„ `auto` å˜é‡æ—¶ï¼Œåœ¨ `ARC` å’Œ `MRC` ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«

::: details ğŸ’¡

  - åœ¨ `MRC` ä¸‹ï¼Œ`block` åªæ˜¯ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆæ‹·è´ï¼Œä¸ä¼šå¯¹å¯¹è±¡è¿›è¡Œ `retain` æ“ä½œï¼Œè¿™ä¼šå¯¼è‡´å¯èƒ½çš„å¯¹è±¡é‡Šæ”¾é”™è¯¯ã€‚

  - åœ¨ `ARC` ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œåœ¨ `block` è¢«åˆ›å»ºæ—¶ï¼Œä¼šå¯¹å®ƒæ‰€æ•è·çš„å¯¹è±¡å‘é€ä¸€æ¬¡ `retain` æ¶ˆæ¯ï¼ŒåŒæ—¶åœ¨ `block` è¢«é‡Šæ”¾æ—¶ï¼Œå‘é€ä¸€æ¬¡ `release` æ¶ˆæ¯ã€‚

:::

#### â“`block` ä¸­å¯ä»¥ä½¿ç”¨ `KVC` æ¥è®¿é—®æˆ–ä¿®æ”¹å®ä¾‹å˜é‡å—

::: details ğŸ’¡

åœ¨ `block` ä¸­å¯ä»¥ä½¿ç”¨ `KVC`(Key-Value Coding) è®¿é—®å’Œä¿®æ”¹å®ä¾‹å˜é‡ã€‚

  - è¢«è®¿é—®çš„å®ä¾‹å˜é‡æ˜¯å¦å­˜åœ¨å¯¹åº”çš„è®¿é—®å™¨æ–¹æ³•(`getter` å’Œ `setter`)ã€‚

  - è¢«è®¿é—®çš„å®ä¾‹å˜é‡åœ¨ç±»çš„æ¥å£ä¸­æ˜¯å¦æœ‰å®šä¹‰ï¼Œæˆ–è€…æœ‰æ—  `@property` å£°æ˜ã€‚

```objc
__weak typeof(self) weakSelf = self;
self.myBlock = ^{
    // ä½¿ç”¨ KVC è®¿é—®å®ä¾‹å˜é‡
    NSInteger value = [[weakSelf valueForKey:@"someValue"] integerValue];
    
    // ä½¿ç”¨ KVC ä¿®æ”¹å®ä¾‹å˜é‡
    [weakSelf setValue:@(123) forKey:@"someValue"];
};
```

:::

#### â“`GCD` ä¸­çš„ `block` æ˜¯åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Š

::: details ğŸ’¡

  `block` åˆå§‹åˆ›å»ºæ—¶æ˜¯åœ¨æ ˆä¸Šã€‚ä½†æ˜¯ï¼Œå½“è°ƒç”¨ `block` çš„ `copy` æ–¹æ³•æˆ–è€…æŠŠ `block` ä¼ é€’ç»™éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„ `GCD` æ–¹æ³•æ—¶ï¼Œ`block` ä¼šè¢«å¤åˆ¶åˆ°å †ä¸Šã€‚

  `GCD` æ˜¯ `Apple` æä¾›çš„ä¸€ç§å¤šæ ¸ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå…è®¸å°†ä»»åŠ¡å°è£…åˆ° `block` é‡Œé¢ï¼Œç„¶åæ”¾å…¥ `Dispatch Queue`ï¼ˆè°ƒåº¦é˜Ÿåˆ—ï¼‰ä¸­è¿›è¡Œå¼‚æ­¥æ‰§è¡Œã€‚ä¸ºäº†é¿å… `block` åœ¨æ‰§è¡Œæ—¶ç”±äºå˜é‡è¢«é‡Šæ”¾è€Œäº§ç”Ÿé”™è¯¯ï¼Œ`GCD` ä¼šæ‰‹åŠ¨å¯¹ `block` è¿›è¡Œå¤åˆ¶æ“ä½œï¼ŒæŠŠ `block` ä»æ ˆå¤åˆ¶åˆ°å †ä¸Šï¼Œè¿™æ ·å³ä¾¿ `block` çš„åˆ›å»ºç¯å¢ƒå·²ç»ä¸å­˜åœ¨ï¼Œ`block` ä¸­ä¹Ÿä»ç„¶èƒ½å¤Ÿè®¿é—®åˆ°åˆ›å»ºç¯å¢ƒçš„å˜é‡å€¼ã€‚
    
:::

------

## åˆ†ç±»

### â“`Category` vs `Extension`

::: details ğŸ’¡

  > `Category`(ç±»åˆ«)ï¼š`Objective-C` çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæä¾›äº†ä¸€ç§ç»™å·²å­˜åœ¨ç±»æ·»åŠ æ–¹æ³•çš„æœºåˆ¶.
    
  - `Category` : åªèƒ½æ·»åŠ æ–¹æ³•ï¼Œä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡(é™¤éé€šè¿‡å…³è”å¯¹è±¡)ã€‚åˆ†ç±»ä¸­çš„æ–¹æ³•æ˜¯è¿è¡Œæ—¶æ·»åŠ åˆ°æ–¹æ³•åˆ—è¡¨ä¸­çš„ã€‚
  
  - `Extension` : å¯ä»¥æ·»åŠ æ–¹æ³•å’Œè®¡ç®—å±æ€§ï¼Œä¹Ÿå¯ä»¥æ·»åŠ æ„é€ æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®ç°ä»¥ä¸€ä¸ªåè®®ã€‚ç¼–è¯‘æ—¶å·²ç»ç¡®å®šï¼Œä¸æ”¯æŒåŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚

:::

### â“`NSObject` æ·»åŠ  `Extension` ä¼šæ€ä¹ˆæ ·

::: details ğŸ’¡

å‘ `NSObject` æ·»åŠ  `Extension`(ç±»åˆ«)ä¼šä½¿ `Extension` ä¸­çš„æ–¹æ³•å¯¹ç»§æ‰¿è‡ª `NSObject` çš„æ‰€æœ‰å¯¹è±¡å¯è§å’Œå¯ç”¨ã€‚è¿™ä¼šå¯¹é¡¹ç›®äº§ç”Ÿå…¨å±€æ€§çš„å½±å“ã€‚

`Extension` å¯ä»¥ç”¨æ¥æ·»åŠ æ–°çš„æ–¹æ³•åˆ°ç°æœ‰çš„ç±»ä¸­ï¼Œä½†å®ƒæ²¡æœ‰è‡ªå·±çš„å®ä¾‹å˜é‡ï¼Œæ‰€ä»¥ä¸èƒ½å­˜å‚¨æ–°çš„çŠ¶æ€ã€‚åœ¨ä½¿ç”¨ `Extension` æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
    
  - å¦‚æœè¦†ç›–å·²æœ‰çš„æ–¹æ³•ï¼Œæ‰€æœ‰ç»§æ‰¿è‡ª `NSObject` çš„å¯¹è±¡éƒ½ä¼šå—åˆ°å½±å“ï¼Œå¯èƒ½å‡ºç°æ— æ³•é¢„çŸ¥çš„ç»“æœã€‚
  - å¦‚æœæ·»åŠ çš„æ–°æ–¹æ³•ä¸å…¶ä»–åº“æˆ–è€…æ¡†æ¶å®šä¹‰çš„æ–¹æ³•å‘ç”Ÿå†²çªï¼ŒåŒæ ·å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚

:::

### åŠ è½½é¡ºåº

#### â“å¦‚æœåˆ†ç±»ä¸­æ·»åŠ ä¸ç±»ç›¸åŒçš„æ–¹æ³•ç­¾åä¼šå‘ç”Ÿä»€ä¹ˆ
  
::: details ğŸ’¡
  
  å½“ä¸€ä¸ª `OC` çš„ç±»åˆ«ï¼ˆ`Category`ï¼‰å’Œä¸»ç±»éƒ½å®šä¹‰äº†ç›¸åŒç­¾åçš„æ–¹æ³•æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šä¼˜å…ˆè°ƒç”¨ç±»åˆ«çš„æ–¹æ³•ï¼Œè€Œå¿½ç•¥ä¸»ç±»ä¸­çš„åŒåæ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºåœ¨è¿è¡Œæ—¶çš„æ–¹æ³•è§£æè¿‡ç¨‹ä¸­ï¼Œåˆ†ç±»çš„æ–¹æ³•ä¼šè¢«å…ˆäºä¸»ç±»æ–¹æ³•åŠ å…¥åˆ°æ–¹æ³•åˆ—è¡¨ä¸­ã€‚

```objc
@interface MyClass : NSObject
- (void)print;
@end

@implementation MyClass
- (void)print {
    NSLog(@"print in MyClass");
}
@end

@interface MyClass (MyCategory)
- (void)print;
@end

@implementation MyClass (MyCategory)
- (void)print {
    NSLog(@"print in MyCategory");
}
@end

// è°ƒç”¨æ—¶
MyClass *myClass = [[MyClass alloc] init];
[myClass print]; // è¾“å‡ºï¼šprint in MyCategory
```

:::

#### â“ä¸¤ä¸ªåˆ†ç±»çš„ `load` æ–¹æ³•çš„åŠ è½½é¡ºåº

::: details ğŸ’¡

  ç±»å’Œåˆ†ç±»ä¸­çš„ `+load` æ–¹æ³•ä¼šåœ¨ç±»æˆ–åˆ†ç±»è¢«åŠ è½½åˆ°è¿è¡Œæ—¶æ—¶è°ƒç”¨ã€‚å¯¹äºåŒä¸€ä¸ªç±»çš„ä¸åŒåˆ†ç±»ï¼Œå„è‡ªçš„ `+load` æ–¹æ³•çš„è°ƒç”¨é¡ºåºä¸ç¼–è¯‘é¡ºåºæœ‰å…³ï¼Œæœ€åç¼–è¯‘çš„åˆ†ç±»çš„ `+load` æ–¹æ³•ä¼šè¢«å…ˆè°ƒç”¨ã€‚

  æ³¨æ„ï¼šè™½ç„¶ç¼–è¯‘é¡ºåºæ˜¯å½±å“ `+load` æ–¹æ³•è°ƒç”¨é¡ºåºçš„å› ç´ ä¹‹ä¸€ï¼Œä½†ä¸æ˜¯å”¯ä¸€çš„å†³å®šå› ç´ ã€‚åœ¨ä¸€ä¸ªå¤æ‚çš„é¡¹ç›®ä¸­ï¼Œç¼–è¯‘é¡ºåºå¯èƒ½ä¼šå—åˆ° `Xcode` ç¼–è¯‘è®¾ç½®ã€æ–‡ä»¶åå­—æ¯åºã€`Xcode` ç‰ˆæœ¬ã€ç”šè‡³ `macOS` ç³»ç»Ÿç‰ˆæœ¬çš„å½±å“ã€‚å› æ­¤ï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œ`Apple` å®˜æ–¹æ–‡æ¡£å»ºè®®ä¸è¦ä¾èµ–äº `+load` æ–¹æ³•çš„è°ƒç”¨é¡ºåºã€‚å¦‚æœé¡¹ç›®ä¸­å¤šä¸ª `+load` æ–¹æ³•ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦ä»”ç»†è®¾è®¡ä»£ç ï¼Œä»¥é¿å…å›  `+load` æ–¹æ³•è°ƒç”¨é¡ºåºå¼•èµ·çš„é—®é¢˜ã€‚

:::
 
#### â“ä¸€ä¸ªç±»ä¸­æœ‰ä¸ªå¤šä¸ªåˆ†ç±»éƒ½å®ç°äº†ç›¸åŒçš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨å“ªä¸ªæ–¹æ³•

::: details ğŸ’¡

  å½“ä¸€ä¸ªç±»æœ‰å¤šä¸ªåˆ†ç±»ï¼ˆ`Category`ï¼‰ï¼Œå¹¶ä¸”è¿™äº›åˆ†ç±»éƒ½å®ç°äº†ç›¸åŒçš„æ–¹æ³•æ—¶ï¼Œä¼šä¼˜å…ˆè°ƒç”¨æœ€åç¼–è¯‘çš„åˆ†ç±»ä¸­çš„æ–¹æ³•ã€‚ç¼–è¯‘å™¨æŒ‰ç…§ `.m` æ–‡ä»¶ç¼–è¯‘é¡ºåºæ¥åŠ è½½åˆ†ç±»ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªåˆ†ç±»éƒ½å®ç°äº†åŒä¸€æ–¹æ³•ï¼Œé‚£ä¹ˆé¡ºåºæ˜¯"ç¼–è¯‘é¡ºåºçš„é€†åº"ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åç¼–è¯‘çš„åˆ†ç±»ä¼šé¦–å…ˆè¢«åŠ è½½ï¼ŒåŒåæ–¹æ³•å°±ä¼šè¢«æœ€åç¼–è¯‘çš„é‚£ä¸ªåˆ†ç±»æ‰€è¦†ç›–ã€‚

  ä½†æ˜¯å…·ä½“è°ƒç”¨å“ªä¸ªæ–¹æ³•å¹¶ä¸æ˜¯ç¡®å®šçš„ï¼Œå› ä¸ºåˆ†ç±»çš„ç¼–è¯‘é¡ºåºå¯èƒ½ä¼šå› ä¸ºé¡¹ç›®é…ç½®çš„æ”¹å˜è€Œæ”¹å˜ï¼Œæ¯”å¦‚ç¼–è¯‘é€‰é¡¹çš„ä¿®æ”¹ã€æ–‡ä»¶åçš„ä¿®æ”¹ç­‰ã€‚æ‰€ä»¥ï¼Œå®é™…å¼€å‘ä¸­å¹¶ä¸å»ºè®®åœ¨ä¸åŒçš„åˆ†ç±»ä¸­å®ç°ç›¸åŒçš„æ–¹æ³•ï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·ä¸å¯é¢„è§çš„ `bug`ã€‚å¦‚æœéœ€è¦åœ¨åˆ†ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼Œåº”ç¡®ä¿æ–°æ·»åŠ çš„æ–¹æ³•ä¸ä¸»ç±»å’Œå…¶ä»–åˆ†ç±»çš„æ–¹æ³•ä¸å†²çªã€‚

:::

#### â“æ€ä¹ˆä¿è¯è‡ªå·±çš„ç±»ä¸€å®šèƒ½è°ƒç”¨åˆ°è‡ªå·±å†™çš„æ–¹æ³•

::: details ğŸ’¡

  åˆ†ç±»ï¼ˆ`Category`ï¼‰æ˜¯ä¸€ç§å¯ä»¥ä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–°æ–¹æ³•çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œåˆ†ç±»ä¸­çš„æ–¹æ³•ä¼šæ›¿æ¢æ‰åŸæ¥ç±»ä¸­åŒåçš„æ–¹æ³•ã€‚æ­¤ç‰¹æ€§åœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½å¼•èµ·ä¸ç¡®å®šçš„è¡Œä¸ºï¼Œæ¯”å¦‚å¯èƒ½æ— æ„é—´è¦†ç›–æ‰ä½ å†™çš„æ–¹æ³•ã€‚

é¢„é˜²æ–¹æ³•è¢«åˆ†ç±»è¦†ç›–çš„æ–¹æ³•ï¼š

  - **æ–¹æ³•å‘½åè§„èŒƒï¼š** å°½å¯èƒ½ä¸ºæ–¹æ³•å‘½åæ—¶ï¼Œæ·»åŠ å‰ç¼€ã€‚è¿™æ ·å¯ä»¥é¿å…å’Œç³»ç»Ÿé»˜è®¤çš„æ–¹æ³•æˆ–ä»–äººå†™çš„åˆ†ç±»ä¸­çš„æ–¹æ³•å†²çªã€‚

  - **ä½¿ç”¨å­ç±»åŒ–ä»£æ›¿åˆ†ç±»ï¼š** å¦‚æœä½ æ§åˆ¶çš„ç±»å¯èƒ½è¢«å…¶ä»–å¼€å‘è€…ä½¿ç”¨ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨å­ç±»ä»£æ›¿åˆ†ç±»ã€‚è¿™æ ·ï¼Œå³ä½¿æœ‰äººåˆ›å»ºäº†åŒåçš„åˆ†ç±»ï¼Œä¹Ÿä¸ä¼šå¯¹åŸç±»äº§ç”Ÿå½±å“ã€‚

  - **åœ¨æºä»£ç çº§åˆ«è¿›è¡Œæ£€æŸ¥ï¼š** åœ¨é¡¹ç›®ç¼–è¯‘çš„æ—¶å€™ï¼Œé€šè¿‡æ£€æŸ¥æ“ä½œæ¥è­¦å‘Šå’Œæš´éœ²ä»»ä½•é‡å®šä¹‰çš„æ–¹æ³•ã€‚

æ³¨æ„ï¼šä»¥ä¸Šçš„æ–¹å¼å¹¶ä¸èƒ½ `100%` çš„é¿å…åœ¨è¿è¡Œæ—¶è¢«è¦†ç›–çš„æƒ…å†µï¼Œå› ä¸º `Objective-C` æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–æ›¿æ¢æ–¹æ³•ã€‚è¿™ç§åŠ¨æ€æ€§æ˜¯ `Objective-C` çš„ä¸€å¤§ç‰¹æ€§ï¼Œä½†åŒæ—¶ä¹Ÿå¯èƒ½å¸¦æ¥é£é™©ã€‚æ‰€ä»¥ç¼–ç¨‹æ—¶åº”è¯¥éµå¾ªè‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ï¼Œé¿å…ä¸å¿…è¦çš„éº»çƒ¦ã€‚

:::
 
### åº•å±‚å®ç°
 
#### â“åˆ†ç±»æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¸ºä»€ä¹ˆä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•
 
::: details ğŸ’¡

  `Objective-C` ä¸­çš„åˆ†ç±» (`Category`) å®è´¨ä¸Šæ˜¯å¯¹ä¸€ä¸ªå­˜åœ¨çš„ç±»æ·»åŠ é¢å¤–çš„æ–¹æ³•ï¼Œè€Œä¸æ”¹å˜å®ƒçš„å£°æ˜å’Œå®šä¹‰ã€‚åˆ†ç±»æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡ `Objective-C` çš„åŠ¨æ€æ€§è´¨åˆå¹¶åˆ°ç±»ä¸Šçš„ï¼Œè¿™ä½¿å¾—å¯ä»¥éšæ„åœ°å‘ä»»ä½•ç±»æ·»åŠ æ–¹æ³•ã€‚

  åº•å±‚å®ç°ï¼šæ˜¯ä¸€ä¸ª `objc_category` ç»“æ„ä½“ï¼Œå®ƒåŒ…å«äº†ç±»å(`name`)ã€ç±»(`cls`)ã€ç±»åˆ«ä¸­æ‰€æœ‰æ–¹æ³•çš„åˆ—è¡¨(`method_list`)ã€ç±»åˆ«çš„åè®®åˆ—è¡¨(`protocol_list`)ã€ç±»åˆ«ä¸­æ‰€æœ‰çš„å±æ€§åˆ—è¡¨(`property_list`)ã€‚
    
  åŠ è½½è¿‡ç¨‹ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶çš„ `load` é˜¶æ®µè¿›è¡Œçš„ï¼Œæ‰€æœ‰ç±»å’Œåˆ†ç±»çš„ `+load` æ–¹æ³•ï¼ˆå¦‚æœæœ‰ï¼‰è¢«è°ƒç”¨ã€‚åœ¨è°ƒç”¨ `+load` æ–¹æ³•ä¹‹å‰ï¼Œ`runtime` ä¼šå…ˆå°†åˆ†ç±»çš„æ–¹æ³•ã€åè®®ã€å±æ€§åˆå¹¶åˆ°ç±»çš„æ•°æ®ç»“æ„ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåˆ†ç±»çš„æ–¹æ³•è¢«æ”¾åœ¨äº†åŸæ¥ç±»æ–¹æ³•åˆ—è¡¨çš„å‰é¢ï¼Œæ‰€ä»¥åœ¨ç±»å’Œåˆ†ç±»ä¸­æœ‰ç›¸åŒæ–¹æ³•åçš„æ–¹æ³•çš„æ—¶å€™ï¼Œåˆ†ç±»çš„æ–¹æ³•ä¼šè¢«ä¼˜å…ˆè°ƒç”¨ï¼ŒåŸç±»çš„æ–¹æ³•è¢«è¦†ç›–ã€‚

  åˆ†ç±»çš„æœ¬è´¨ï¼šåœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ¯ä¸€ä¸ªåˆ†ç±»ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ä½“ï¼ˆå¦‚ `_category_t`ï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†åˆ†ç±»åï¼Œåˆ†ç±»æ‰€åœ¨ç±»çš„åå­—ï¼Œä»¥åŠåˆ†ç±»ä¸­æ‰€æœ‰æ·»åŠ çš„æ–¹æ³•çš„åˆ—è¡¨ã€‚åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œè¿™ä¸ªç»“æ„æœ‰ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œåˆ†ç±»ä¸­çš„æ–¹æ³•ä¼šè¢«æ·»åŠ åˆ°ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­ã€‚å› æ­¤å¯ä»¥åœ¨åˆ†ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ã€‚
  
  åˆ†ç±»ä¸­çš„æ–¹æ³•ä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯å› ä¸ºåˆ†ç±»çš„æ–¹æ³•è¢«æ·»åŠ åˆ°æ–¹æ³•åˆ—è¡¨çš„é¡ºåºä¼˜å…ˆçº§æ›´é«˜ã€‚åœ¨ `Objective-C` æŸ¥æ‰¾æ–¹æ³•å®ç°çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§æ–¹æ³•åœ¨åˆ—è¡¨ä¸­çš„é¡ºåºï¼Œä»å‰å¾€åæŸ¥æ‰¾çš„ï¼Œå½“æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ–¹æ³•æ—¶ï¼Œå°±åœæ­¢æŸ¥æ‰¾ï¼Œå¹¶ä¸”è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æœåˆ†ç±»ä¸­çš„æ–¹æ³•ä¸åŸç±»ä¸­çš„æ–¹æ³•åŒåï¼Œåˆ†ç±»ä¸­çš„æ–¹æ³•å°±ä¼šè¢«ä¼˜å…ˆè°ƒç”¨ï¼Œä»è€Œè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ã€‚

:::

#### â“åˆ†ç±»ä¸­æœ‰ä¸ä¸»ç±»ç›¸åŒçš„æ–¹æ³•ï¼Œå¦‚æœæƒ³è¦è°ƒç”¨ä¸»ç±»ä¸­çš„æ–¹æ³•å¦‚ä½•å¤„ç†

::: details ğŸ’¡

  å¦‚æœåˆ†ç±»ä¸­çš„æ–¹æ³•ä¸ä¸»ç±»çš„æ–¹æ³•åç§°ç›¸åŒï¼Œç”±äºè¿è¡Œæ—¶ä¼šä¼˜å…ˆè°ƒç”¨åˆ†ç±»çš„æ–¹æ³•ï¼Œæ‰€ä»¥é€šå¸¸æ— æ³•ç›´æ¥è°ƒç”¨åˆ°ä¸»ç±»ä¸­çš„æ–¹æ³•ã€‚ä¸è¿‡æœ‰ä¸€ç§é—´æ¥çš„åŠæ³•å¯ä»¥å®ç°ã€‚å¯ä»¥åœ¨åˆ†ç±»æ–¹æ³•å†…éƒ¨é€šè¿‡ `NSInvocation` æˆ– `methodSignatureForSelector:` å’Œ `forwardInvocation:` çš„æ–¹å¼è°ƒç”¨ä¸»ç±»çš„åŸæ–¹æ³•ã€‚

```objc
#import "MyClass.h"

@implementation MyClass (MyCategory)
- (void)print {
    // è·å–ä¸»ç±»åŸæ–¹æ³•
    SEL origSel = @selector(print);
    Method origMethod = class_getInstanceMethod([self class], origSel);
    
    // æ„å»º NSInvocation
    NSInvocation *inv = [NSInvocation invocationWithMethodSignature:[self methodSignatureForSelector:origSel]];
    [inv setSelector:origSel];
    [inv setTarget:self];
    
    // è°ƒç”¨ NSInvocation
    [inv invoke];
    
    // è·å–è¿”å›å€¼
    NSString *returnValue;
    [inv getReturnValue:&returnValue];
    NSLog(@"%@", returnValue);
}
@end
```

:::
 
#### â“åˆ†ç±»ä¸­ä¸ºä»€ä¹ˆä¸èƒ½æ·»åŠ  `@property`

::: details ğŸ’¡

  `@property`ä¼šå‘Šè¯‰ç¼–è¯‘å™¨æˆ‘ä»¬åœ¨ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªå±æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªåå¤‡å­˜å‚¨ï¼ˆå®ä¾‹å˜é‡ï¼‰ï¼Œå¹¶ä¸”ä¸ºå±æ€§ç”Ÿæˆ `getter` å’Œ `setter` æ–¹æ³•ã€‚ç„¶è€Œï¼Œå¯¹äºåˆ†ç±»ï¼ˆ`Category`ï¼‰ï¼Œä¸€æ—¦å¯¹è±¡åœ¨è¿è¡Œæ—¶è¢«æ³¨å†Œï¼Œå°±ä¸èƒ½å†åŠ¨æ€åœ°æ·»åŠ å®ä¾‹å˜é‡ã€‚

  ä» `runtime` è§’åº¦æ¥çœ‹ï¼Œ è¿™æ˜¯ç”±äºç±»å‹çš„æ•°æ®å¸ƒå±€å·²ç»åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šå¹¶ä¸”æ³¨å†Œåˆ°äº† `Objective-C` çš„ `runtime` ç³»ç»Ÿä¸­ï¼Œè€Œåˆ†ç±»æ˜¯åœ¨è¿è¡Œæ—¶è¢«åŠ è½½ï¼Œæ‰€ä»¥æ— æ³•æ›´æ”¹åŸºç±»çš„æ•°æ®å¸ƒå±€ï¼Œä¹Ÿå°±æ— æ³•æ·»åŠ å®ä¾‹å˜é‡ã€‚

```objc
// ç±»ç»“æ„ä½“ï¼Œä¸­çš„ `ivar_list`ï¼ˆå®ä¾‹å˜é‡åˆ—è¡¨ï¼‰æ˜¯ç¡®å®š
struct objc_class {
    Class isa;
    Class super_class;
    const char *name;
    long version;
    long info;
    long instance_size;
    struct objc_ivar_list *ivars;
}

// åˆ†ç±»ç»“æ„ä½“ï¼Œåªæœ‰æ–¹æ³•åˆ—è¡¨ï¼Œåè®®åˆ—è¡¨å’Œå±æ€§åˆ—è¡¨ï¼Œå¹¶æ²¡æœ‰å®ä¾‹å˜é‡åˆ—è¡¨
struct category_t {
    const char *name;
    classref_t cls;
    struct method_list_t *instanceMethods;
    struct method_list_t *classMethods;
    struct protocol_list_t *protocols;
    struct property_list_t *instanceProperties;
};
```
  
  `Objective-C` åˆ†ç±»ä¸­ä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡ï¼Œä¹Ÿå°±ä¸èƒ½æ·»åŠ å¸¦æœ‰è‡ªåŠ¨ç”Ÿæˆçš„ `getter` å’Œ `setter` çš„ `@property`ã€‚ä½†æ˜¯å¯ä»¥åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§ï¼Œå¹¶é€šè¿‡å¯¹å·²æœ‰çš„å®ä¾‹å˜é‡æ‰‹åŠ¨ç¼–å†™ `getter` å’Œ `setter`ï¼Œæˆ–è€…ä½¿ç”¨å…³è”å¯¹è±¡(`Associated Objects`)æ¥æ¨¡æ‹Ÿå®ä¾‹å˜é‡ã€‚

  æ€»ç»“ï¼šä¹‹æ‰€ä»¥ä¸èƒ½åœ¨åˆ†ç±»ä¸­æ·»åŠ  `@property`ï¼Œæ˜¯å› ä¸ºåœ¨ç¼–è¯‘å™¨å±‚é¢å’Œ `runtime` å±‚é¢ä¸Šï¼Œ`Objective-C` çš„è®¾è®¡éƒ½ä¸å…è®¸åŠ¨æ€åœ°å‘ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ã€‚

:::

### â“åˆ†ç±»æ€ä¹ˆå®ç°ä¸€ä¸ª `weak` å±æ€§

::: details ğŸ’¡

  > åˆ†ç±»ï¼ˆ`Category`ï¼‰ä¸»è¦ç”¨äºç»™ç°æœ‰çš„ç±»æ·»åŠ æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä¸èƒ½ç›´æ¥æ·»åŠ å±æ€§ã€‚å¦‚æœä½ æƒ³åœ¨åˆ†ç±»ä¸­æ·»åŠ ä¸€ä¸ª `weak` å±æ€§ï¼Œéœ€è¦ä½¿ç”¨çš„å…³è”å¯¹è±¡ï¼ˆ`Associated Objects`ï¼‰æ¥å®ç°ã€‚

```objc
#import <objc/runtime.h>

@interface NSString (WeakProperty)

@property (nonatomic, weak) id weakProperty;

@end

@implementation NSString (WeakProperty)

- (void)setWeakProperty:(id)weakProperty {
    // ä½¿ç”¨ OBJC_ASSOCIATION_ASSIGN å®ƒè¡¨ç¤ºä¸€ä¸ªå¼±å¼•ç”¨ï¼Œä½†ä¸åƒ weak é‚£æ ·ä¼šè‡ªåŠ¨ç½® nilï¼Œéœ€è¦åœ¨é€‚å½“çš„æ—¶å€™ç½® nil
    objc_setAssociatedObject(self, @selector(weakProperty), weakProperty, OBJC_ASSOCIATION_ASSIGN);
}

- (id)weakProperty {
    return objc_getAssociatedObject(self, @selector(weakProperty));
}

@end
```

æ³¨ï¼šè¿™ç§æ–¹å¼å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šåœ¨åˆ†ç±»ä¸­æ·»åŠ å±æ€§ï¼Œåªæ˜¯æŠŠä¸€ä¸ªå¯¹è±¡å…³è”åˆ°äº†åˆ†ç±»çš„å®ä¾‹å¯¹è±¡ä¸Šï¼Œå¹¶æ²¡æœ‰æ”¹å˜ç±»çš„ç»“æ„ã€‚åœ¨å†…å­˜åˆ†é…ä¸Šï¼Œä¸»ç±»å¹¶ä¸çŸ¥é“æ–°å¢çš„è¿™ä¸ªå…³è”å¯¹è±¡ã€‚è¿™ç§æ–¹æ¡ˆäº§ç”Ÿçš„å½±å“ä»…é™äºå¯¹è±¡åœ¨ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä¸€æ—¦å¯¹è±¡é”€æ¯ï¼Œå…³è”çš„å¯¹è±¡ä¹Ÿå°±éšä¹‹é”€æ¯ã€‚

:::

------

## æ¶ˆæ¯å‘é€

### â“`OC` æ¶ˆæ¯å‘é€ vs `C++` è°ƒç”¨è™šæ–¹æ³•

::: details ğŸ’¡

æ¦‚å¿µçŸ¥è¯†ï¼š

  - `Objective-C` æ¶ˆæ¯å‘é€ï¼šæ˜¯ `Objective-C` è¿›è¡Œæ–¹æ³•è°ƒç”¨çš„æ–¹å¼ã€‚
    > å®ƒä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç¡®å®šåº”è¯¥è°ƒç”¨å¯¹è±¡çš„å“ªä¸ªæ–¹æ³•ã€‚å½“ç»™ `Objective-C` å¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæœç´¢æ¥æ”¶è€…çš„ç±»ä»¥åŠæ‰€æœ‰çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ä»¥å“åº”è¯¥æ¶ˆæ¯çš„æ–¹æ³•å¹¶è°ƒç”¨ã€‚

  - `C++` è™šæ–¹æ³•ï¼šæ˜¯ `C++` æ”¯æŒå¤šæ€æ€§çš„ä¸€ç§æ–¹å¼ã€‚
    > åœ¨ `C++` ä¸­ï¼Œå¦‚æœä¸€ä¸ªçˆ¶ç±»æŒ‡é’ˆæŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œå¹¶é€šè¿‡è¯¥æŒ‡é’ˆè°ƒç”¨è™šå‡½æ•°ï¼Œé‚£ä¹ˆè°ƒç”¨çš„å°†æ˜¯æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°å®ç°ã€‚è¿™æ˜¯é€šè¿‡ `C++` çš„è™šå‡½æ•°è¡¨ï¼ˆ`vtable`ï¼‰æ¥å®ç°çš„ï¼Œè™šå‡½æ•°è¡¨æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šçš„ã€‚

ä¸¤è€…åŒºåˆ«ï¼š

  - **åŠ¨æ€æ€§**ï¼š`Objective-C` çš„æ¶ˆæ¯å‘é€æ›´å…·æœ‰åŠ¨æ€æ€§ï¼Œå› ä¸ºå®ƒåœ¨è¿è¡Œæ—¶ç¡®å®šæ–¹æ³•è°ƒç”¨ï¼Œè€Œ `C++` çš„è™šå‡½æ•°åœ¨ç¼–è¯‘æ—¶å·²ç»ç¡®å®šã€‚

  - **çµæ´»æ€§**ï¼š`Objective-C` çš„æ¶ˆæ¯å‘é€æœºåˆ¶å…è®¸åœ¨è¿è¡Œæ—¶ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œè¿™ä½¿å¾— `Objective-C `å…·æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚

  - **æ€§èƒ½**ï¼šç”±äº `C++` çš„è™šå‡½æ•°è°ƒç”¨æ˜¯åœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šï¼Œå› æ­¤å®ƒçš„æ€§èƒ½ä¸Šä¼˜äº `Objective-C` çš„åŠ¨æ€æ¶ˆæ¯å‘é€ã€‚

  - **å®‰å…¨æ€§**ï¼š`C++` çš„ç±»å‹æ£€æŸ¥æ›´ä¸ºä¸¥æ ¼ï¼Œå› æ­¤è°ƒç”¨è™šæ–¹æ³•è¦æ¯” `Objective-C` å‘é€æ¶ˆæ¯æ›´å®‰å…¨ï¼Œåè€…å¦‚æœå‘é€äº†å¯¹è±¡æ— æ³•å“åº”çš„æ¶ˆæ¯å°±ä¼šåœ¨è¿è¡Œæ—¶å´©æºƒã€‚

:::

### â“æ¶ˆæ¯è½¬å‘æœºåˆ¶å’Œå…¶ä»–è¯­è¨€çš„æ¶ˆæ¯æœºåˆ¶ä¼˜åŠ£å¯¹æ¯”

::: details ğŸ’¡

  - **åŠ¨æ€æ€§**ï¼šæ¶ˆæ¯è½¬å‘æœºåˆ¶å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å¤„ç†æœªçŸ¥çš„æ¶ˆæ¯ã€‚è€Œå…¶ä»–ä¸€äº›è¯­è¨€ï¼Œå¦‚ `C++`, `Java`, `C#` ç­‰ï¼Œåœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶ä¸èƒ½åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å¤„ç†æœªçŸ¥çš„æ¶ˆæ¯ã€‚

  - **çµæ´»æ€§**ï¼šæ¶ˆæ¯è½¬å‘å¯ä»¥ä¸ä»…ä»…æ˜¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ï¼Œç”šè‡³å¯ä»¥åŠ¨æ€åœ°ä¸ºç±»ç”Ÿæˆæ–°çš„æ–¹æ³•ã€‚è¿™åœ¨å¾ˆå¤šå…¶ä»–è¯­è¨€ä¸­æ˜¯æ— æ³•åšåˆ°çš„ã€‚

  - **æ€§èƒ½**ï¼šæ¶ˆæ¯è½¬å‘æœºåˆ¶ç›¸å¯¹äºå…¶ä»–è¯­è¨€çš„æ¶ˆæ¯æœºåˆ¶ï¼Œå¦‚ `C++` çš„è™šå‡½æ•°ï¼Œæ€§èƒ½ä¸Šä¼šç¨å·®ä¸€äº›ã€‚å› ä¸º `Objective-C` æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡æŸ¥æ‰¾ç±»çš„æ–¹æ³•åˆ—è¡¨æ¥ç¡®å®šæ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šã€‚

  - **å®‰å…¨æ€§**ï¼šæ¶ˆæ¯è½¬å‘æœºåˆ¶å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€äº›éš¾ä»¥å‘ç°çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé”™è¯¯åœ°è½¬å‘äº†æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿è¡Œæ—¶å´©æºƒã€‚è€Œå…¶ä»–ä¸€äº›è¯­è¨€ï¼Œå¦‚ `Java`, `C#`, æ˜¯åœ¨ç¼–è¯‘æœŸå°±æ£€æŸ¥äº†æ–¹æ³•çš„è°ƒç”¨ï¼Œç›¸å¯¹æ¥è¯´æ›´åŠ å®‰å…¨ã€‚
  
:::

### â“`OC` æ˜¯å¦æ”¯æŒæ–¹æ³•é‡è½½

::: details ğŸ’¡

  `OC` ä¸æ”¯æŒæ–¹æ³•é‡è½½ã€‚æ–¹æ³•é‡è½½æŒ‡çš„æ˜¯åœ¨åŒä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åå­—ç›¸åŒï¼Œä½†å‚æ•°ä¸åŒçš„å¤šä¸ªæ–¹æ³•ã€‚

  `OC` æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå…¶æ–¹æ³•çš„è°ƒç”¨ä¸æ˜¯åœ¨ç¼–è¯‘æœŸå†³å®šçš„ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„ã€‚`OC` ä½¿ç”¨æ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼Œæ–¹æ³•è°ƒç”¨æ›´ä¾èµ–äºæ–¹æ³•çš„å”¯ä¸€æ€§ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–¹æ³•åå­—å®Œå…¨ç›¸åŒï¼ˆå³ä½¿å‚æ•°ç±»å‹ä¸åŒï¼‰ï¼Œç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ç³»ç»Ÿå°±æ— æ³•å‡†ç¡®æ‰¾åˆ°ä½ è¦è°ƒç”¨çš„æ–¹æ³•ã€‚

:::

### æ–¹æ³•æŸ¥æ‰¾

#### â“`SEL`ã€`_cmd`ã€`IMP` æ˜¯ä»€ä¹ˆ

::: details ğŸ’¡

  - `SEL`ï¼šæ˜¯ä¸€ä¸ªé€‰æ‹©å™¨çš„ç±»å‹ã€‚é€‰æ‹©å™¨æ˜¯æ–¹æ³•é€‰æ‹©å™¨çš„æŒ‡å®šç±»å‹ï¼Œå¯ä»¥æƒ³è±¡å®ƒå°±åƒæ–¹æ³•æˆ–å‡½æ•°çš„åå­—ã€‚`SEL`ç±»å‹çš„å˜é‡å°±æ˜¯ç”¨æ¥ä¿å­˜è¿™äº›æ–¹æ³•åçš„ã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸åŒçš„æ–¹æ³•å¯¹åº”ä¸åŒçš„ `SEL`ã€‚
    
    ```objc
    SEL methodSEL = @selector(methodName);
    ```
    
  - `_cmd`ï¼šæ˜¯ä¸€ä¸ªéšè—çš„å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰è°ƒç”¨çš„æ–¹æ³•çš„ `SEL`ã€‚æ¯ä¸ªæ–¹æ³•çš„å®ç°çš„ç¬¬äºŒä¸ªå‚æ•°`_cmd`ï¼Œå®ƒæ˜¯ä¸€ä¸ª `SEL` ç±»å‹çš„ï¼Œå³å½“å‰æ–¹æ³•çš„é€‰æ‹©å™¨ã€‚
    
    ```objc
    - (void)someMethod {
        NSLog(@"%@", NSStringFromSelector(_cmd)); // è¾“å‡º "someMethod"
    }
    ```
  
  - `IMP`ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¿™ä¸ªå‡½æ•°ä¼šå¤„ç†å‘é€åˆ°ç±»å®ä¾‹çš„æ¶ˆæ¯ã€‚`IMP` ç±»å‹çš„å‡½æ•°å®é™…ä¸Šå°±æ˜¯å¯¹è±¡æ–¹æ³•çš„å®ç°ï¼Œä¸€ä¸ª `IMP` å‡½æ•°ä¼šæ¥æ”¶ä¸¤ä¸ªéšè—çš„å‚æ•° `self` å’Œ `_cmd`ã€‚
    
:::

#### â“`OC` ä¸­æ˜¯å¦‚ä½•é€šè¿‡ `SEL` æ‰¾åˆ°å¯¹åº”çš„ `IMP` åœ°å€

::: details ğŸ’¡

  - **æŸ¥æ‰¾ç±»æ–¹æ³•åˆ—è¡¨**ï¼šå½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿé¦–å…ˆä¼šåœ¨è¯¥å¯¹è±¡çš„ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ä¸è¿™ä¸ª `selector` ç›¸å¯¹åº”çš„æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œ`selector` ä¼šè¢«æ˜ å°„åˆ°å…¶å¯¹åº”æ–¹æ³•çš„ `IMP`ã€‚

  - **åœ¨ç»§æ‰¿é“¾ä¸­æŸ¥æ‰¾**ï¼šå¦‚æœåœ¨å¯¹è±¡çš„ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨è¯¥ç±»çš„çˆ¶ç±»ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœåœ¨çˆ¶ç±»ä¸­æ‰¾åˆ°ï¼ŒåŒæ ·ç›´æ¥è°ƒç”¨å¯¹åº”çš„ `IMP`ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æ²¿ç€ç±»çš„ç»§æ‰¿é“¾æŸ¥æ‰¾ï¼Œç›´åˆ° `NSObject`ã€‚

  - **è°ƒç”¨åŠ¨æ€æ–¹æ³•è§£æ**ï¼šå¦‚æœåœ¨æ•´ä¸ªç»§æ‰¿é“¾ä¸Šéƒ½æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ç³»ç»Ÿä¼šç»™ä¸€ä¸ªâ€œè¡¥æ•‘â€çš„æœºä¼šï¼Œå³ä¼šè°ƒç”¨è¯¥ç±»çš„ `+resolveInstanceMethod:` æˆ– `+resolveClassMethod:` æ–¹æ³•ï¼ˆå–å†³äºæ˜¯å®ä¾‹æ–¹æ³•è¿˜æ˜¯ç±»æ–¹æ³•ï¼‰ã€‚å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­ä¸ºå¯¹åº”çš„ `selector` åŠ¨æ€æ·»åŠ å®ç°ã€‚

  - **æ¶ˆæ¯è½¬å‘**ï¼šå¦‚æœ `+resolveInstanceMethod:` æˆ– `+resolveClassMethod:` è¿”å› `NO` æˆ–è€…æ²¡æœ‰è¢«é‡å†™ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶å°±ä¼šå¯åŠ¨å®Œæ•´æ¶ˆæ¯è½¬å‘ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨ `- (void)forwardInvocation:(NSInvocation *)anInvocation;` æ–¹æ³•ã€‚å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•å†…å°†æ¶ˆæ¯è½¬å‘ç»™èƒ½å“åº”æ­¤æ¶ˆæ¯çš„å…¶ä»–å¯¹è±¡ã€‚

  - **æŠ›å‡ºå¼‚å¸¸**ï¼šå¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ²¡æœ‰æ‰¾åˆ°å¹¶æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šæŠ›å‡º `unrecognized selector` å¼‚å¸¸ã€‚

:::

#### â“`unrecognized selector` å¼‚å¸¸æ˜¯å¦‚ä½•å‘ç”Ÿï¼Œåº”è¯¥å¦‚ä½•é¿å…

::: details ğŸ’¡

  `unrecognized selector` å¼‚å¸¸æ˜¯ä¸€ä¸ªå¸¸è§è¿è¡Œæ—¶é”™è¯¯ï¼Œå½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€å®ƒä¸èƒ½å“åº”çš„æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚

  å½“è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨å‘è¿™ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚è¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨å¯¹è±¡çš„ç±»åŠå…¶æ‰€æœ‰çš„çˆ¶ç±»ä¸­å¯»æ‰¾ä¸è¿™ä¸ªæ¶ˆæ¯å¯¹åº”çš„æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨å®ƒã€‚å¦‚æœåœ¨æœ€åº•å±‚çš„çˆ¶ç±»ï¼ˆé€šå¸¸æ˜¯ `NSObject`ï¼‰ä¸­ä¹Ÿæ‰¾ä¸åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º `unrecognized selector` å¼‚å¸¸ã€‚

é¿å… `unrecognized selector` å¼‚å¸¸ï¼š

  - **æ£€æŸ¥å¯¹è±¡æ˜¯å¦èƒ½å“åº”æ­¤æ¶ˆæ¯**ï¼šåœ¨å‘å¯¹è±¡å‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œä½¿ç”¨ `respondsToSelector:` æ–¹æ³•æ£€æŸ¥è¿™ä¸ªå¯¹è±¡æ˜¯å¦èƒ½å“åº”è¿™ä¸ªæ¶ˆæ¯ã€‚

    ```objc
    if ([obj respondsToSelector:@selector(foo)]) {
        [obj foo];
    }
    ```

  - **ä½¿ç”¨å¼‚å¸¸å¤„ç†**ï¼š`Objective-C` æä¾›äº†å¼‚å¸¸å¤„ç†è¯­å¥ `@tryã€@catchã€@finally`ã€‚å¯ä»¥å°†å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç æ”¾åœ¨ `@try` å—ä¸­ï¼Œå°†å¤„ç†å¼‚å¸¸çš„ä»£ç æ”¾åœ¨ `@catch` å—ä¸­ã€‚

  - **æ¶ˆæ¯è½¬å‘**ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡æ— æ³•è¯†åˆ«å¼•å‘å¼‚å¸¸çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å¼•å‘å¼‚å¸¸ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ `- (void)forwardInvocation:(NSInvocation *)anInvocation;` æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å‘å…¶ä»–èƒ½å“åº”æ­¤æ¶ˆæ¯çš„å¯¹è±¡å‘é€è¯¥æ¶ˆæ¯ã€‚è¿™å°±ç›¸å½“äºå°†æ­¤æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚

:::

### ç±»æ–¹æ³•

#### â“`OC` ä¸­çš„ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«å’Œè”ç³»

::: details ğŸ’¡

æœ¬è´¨åŒºåˆ«ï¼š

  - å­˜å‚¨çš„ä½ç½®ï¼š
    * å®ä¾‹æ–¹æ³•åˆ—è¡¨å­˜å‚¨åœ¨ç±»å¯¹è±¡ï¼ˆ`Class`ï¼‰ä¸­ã€‚
    * ç±»æ–¹æ³•åˆ—è¡¨å­˜å‚¨åœ¨å…ƒç±»å¯¹è±¡ï¼ˆ`Meta-Class`ï¼‰ä¸­ã€‚

  - è°ƒç”¨è€…ï¼š
    * å®ä¾‹æ–¹æ³•ç”±å®ä¾‹å¯¹è±¡è°ƒç”¨ï¼Œå³ `[instanceObject exampleMethod];`ï¼Œå…¶ä¸­ `exampleMethod` æ˜¯å®ä¾‹å¯¹è±¡çš„æ–¹æ³•ã€‚
    * ç±»æ–¹æ³•ç”±ç±»å¯¹è±¡è°ƒç”¨ï¼Œå³ `[ClassObject exampleMethod];`ï¼Œå…¶ä¸­ `exampleMethod` æ˜¯ç±»æ–¹æ³•ã€‚

  - æ–¹æ³•æŸ¥æ‰¾è¿‡ç¨‹ï¼š
    * è°ƒç”¨å®ä¾‹æ–¹æ³•æ—¶ï¼Œ`runtime` ç³»ç»Ÿä¼šåœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•ã€‚
    * è°ƒç”¨ç±»æ–¹æ³•æ—¶ï¼Œ`runtime` ç³»ç»Ÿä¼šåœ¨å…ƒç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•ã€‚

  - `self` æŒ‡é’ˆï¼š
    * åœ¨å®ä¾‹æ–¹æ³•ä¸­ï¼Œ`self` æŒ‡å‘è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å®ä¾‹å¯¹è±¡ã€‚
    * åœ¨ç±»æ–¹æ³•ä¸­ï¼Œ`self` æŒ‡å‘è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ç±»å¯¹è±¡ã€‚

  - èƒ½è®¿é—®çš„å˜é‡ï¼š
    * å®ä¾‹æ–¹æ³•å¯ä»¥è®¿é—®å®ä¾‹å˜é‡å’Œé™æ€å˜é‡ã€‚
    * ç±»æ–¹æ³•åªèƒ½è®¿é—®é™æ€å˜é‡ã€‚

:::

#### â“åœ¨ç±»æ–¹æ³•ä¸­æ˜¯å¦å¯ä»¥ä½¿ç”¨ `self`

::: details ğŸ’¡

  å¯ä»¥åœ¨ç±»æ–¹æ³•ä¸­ä½¿ç”¨ `self`ã€‚ä½†åœ¨ç±»æ–¹æ³•ä¸­ï¼Œ`self` è¡¨ç¤ºçš„æ˜¯ç±»å¯¹è±¡æœ¬èº«ï¼Œè€Œä¸æ˜¯ç±»çš„å®ä¾‹ã€‚è¿™æ„å‘³ç€ä¸èƒ½ç”¨ `self` æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œåªèƒ½ç”¨å®ƒæ¥è°ƒç”¨å…¶ä»–ç±»æ–¹æ³•ã€‚

```objc
+ (void)aClassMethod {
    // è¿™é‡Œçš„ self æ˜¯ç±»å¯¹è±¡æœ¬èº«
    [self anotherClassMethod];
}
```

æ€»ç»“ï¼š`self` åœ¨ç±»æ–¹æ³•ä¸­æŒ‡çš„æ˜¯ç±»å¯¹è±¡æœ¬èº«ï¼Œç”¨æ¥è°ƒç”¨å…¶ä»–ç±»æ–¹æ³•ï¼›åœ¨å®ä¾‹æ–¹æ³•ä¸­æŒ‡çš„æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹å¯¹è±¡ï¼Œç”¨æ¥è®¿é—®å®ä¾‹å˜é‡æˆ–è°ƒç”¨å®ä¾‹æ–¹æ³•ã€‚

:::

### æ¶ˆæ¯å‘é€

#### â“`OC` ä¸­å¯¹è±¡æ¶ˆæ¯å‘é€çš„å¤§è‡´æµç¨‹

::: details ğŸ’¡

  - **æ¶ˆæ¯å‘é€è€…**ï¼šå½“è°ƒç”¨ä¸€ä¸ª `Objective-C` å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å‘è¿™ä¸ªå¯¹è±¡å‘é€äº†ä¸€æ¡æ¶ˆæ¯ã€‚
    > ä¾‹å¦‚ï¼Œ`[object methodWithParameter:parameter];`ï¼Œè¿™é‡Œçš„ `object` æ˜¯æ¶ˆæ¯çš„æ¥å—è€…ï¼Œ`methodWithParameter:` æ˜¯æ¶ˆæ¯çš„é€‰æ‹©å™¨ï¼ˆ`SEL`ï¼Œ`Selector`ï¼‰ã€‚

  - **åŠ¨æ€ç»‘å®š**ï¼šä¸æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å†³å®šå‡½æ•°åœ°å€ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®æ¥æ”¶è€…å’Œé€‰æ‹©å™¨æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°å®ç°ã€‚

  - **å¯»æ‰¾æ¥å—è€…**ï¼šæ˜ç¡®äº†æ¶ˆæ¯çš„æ¥æ”¶è€…åï¼Œä¼šåœ¨å¯¹åº”çš„ç±»ä»¥åŠå…¶çˆ¶ç±»ä¸­æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚å¦‚æœåœ¨æ¶ˆæ¯æ¥æ”¶è€…çš„ç±»ä¸­æ‰¾ä¸åˆ°å“åº”çš„æ–¹æ³•ï¼Œåˆ™ç»§ç»­å¾€å®ƒçš„çˆ¶ç±»ä¸­å¯»æ‰¾ã€‚

  - **æ¶ˆæ¯è½¬å‘**ï¼šå¦‚æœåˆ°äº†æ ¹ç±»ï¼ˆ`NSObject`ï¼‰éƒ½æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥å¯¹è±¡çš„ `doesNotRecognizeSelector:` æ–¹æ³•ï¼Œè¿›å…¥æ­¤æ–¹æ³•å°±ç®—å‡ºé”™äº†ï¼Œæœªå¯¹æ­¤æ–¹æ³•åšå¤„ç†çš„è¯ç¨‹åºä¼š `crash`ã€‚ä¸è¿‡ï¼Œ`NSObject` æä¾›äº†æœ€åæŒ½æ•‘çš„æœºä¼šï¼Œèµ°è¿›æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ–°çš„æ¥å—è€…æ¥å“åº”è¿™æ¡æ¶ˆæ¯ã€‚å¦‚æœæ¶ˆæ¯è½¬å‘ä¹Ÿæ²¡æœ‰å¤„ç†ï¼Œå°±çœŸçš„ä¼š `crash` äº†ã€‚

:::

#### â“åœ¨æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œ`æ–¹æ³•æŸ¥è¯¢-> åŠ¨æ€è§£æ-> æ¶ˆæ¯è½¬å‘` ä¹‹å‰åšäº†ä»€ä¹ˆ

::: details ğŸ’¡

  ä»…å½“é€šè¿‡å‘é€æ¶ˆæ¯è°ƒç”¨æ–¹æ³•å¤±è´¥çš„æ—¶å€™ï¼Œæ‰ä¼šå¯åŠ¨æ–¹æ³•æŸ¥æ‰¾ï¼ˆ`method lookup`ï¼‰ã€åŠ¨æ€è§£æï¼ˆ`dynamic resolution`ï¼‰å’Œæ¶ˆæ¯è½¬å‘ï¼ˆ`message forwarding`ï¼‰è¿™äº›æ­¥éª¤ã€‚

ä¹‹å‰æ“ä½œï¼š

  - **æ¶ˆæ¯å‘é€**ï¼šå®é™…ä¸Šæ˜¯è°ƒç”¨äº†è¿è¡Œæ—¶åº“ä¸­çš„ `objc_msgSend` å‡½æ•°ã€‚æ–¹æ³•çš„è°ƒç”¨è€…ï¼ˆå³æ¶ˆæ¯çš„æ¥æ”¶è€…ï¼‰å’Œæ–¹æ³•é€‰æ‹©å™¨ï¼ˆ`selector`ï¼‰éƒ½ä½œä¸º `objc_msgSend` çš„å‚æ•°ã€‚

  - **æŸ¥æ‰¾å¯¹è±¡çš„ç±»**ï¼š`objc_msgSend` éœ€è¦çŸ¥é“å¯¹è±¡çš„ç±»ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨é‡ŒæŸ¥æ‰¾å¯ä»¥å“åº”è¯¥æ¶ˆæ¯çš„æ–¹æ³•ã€‚å¯¹è±¡å†…éƒ¨æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒçš„ç±»ï¼Œ`objc_msgSend` å¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡é’ˆè·å–å¯¹è±¡çš„ç±»ã€‚

  - **ç¼“å­˜æŸ¥æ‰¾**ï¼š`Objective-C` è¿è¡Œæ—¶ç³»ç»Ÿä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå·²ç»å°†ä¸€éƒ¨åˆ†æ–¹æ³•çš„è°ƒç”¨ç»“æœç¼“å­˜èµ·æ¥ï¼Œæ‰€ä»¥ `objc_msgSend` ä¼šå…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ `selector` å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å¦‚æœç¼“å­˜ä¸­æœ‰ï¼Œåˆ™ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ç»“æŸæŸ¥æ‰¾æµç¨‹ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚

  - **æ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾**ï¼š`objc_msgSend` ä¼šåœ¨å¯¹è±¡çš„ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æœç´¢ `selector` å¯¹åº”çš„æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†æ–¹æ³•ç»“æœæ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶ç»“æŸæŸ¥æ‰¾æµç¨‹ã€‚

:::

#### â“å‘ä¸€ä¸ª `nil` å¯¹è±¡å‘é€æ¶ˆæ¯å°†ä¼šå‘ç”Ÿä»€ä¹ˆ

::: details ğŸ’¡

  å‘ `nil` å¯¹è±¡å‘é€æ¶ˆæ¯æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚è¿™ä¸€ç‰¹æ€§æ˜¯ `Objective-C` è¯­è¨€ä¸­çš„ä¸€é¡¹é‡è¦ç‰¹æ€§ï¼Œä½¿å…¶åœ¨å¤„ç†å¯¹è±¡çš„ç©ºæ€æ—¶æ›´åŠ çµæ´»ã€‚

å¯¹ä¸€ä¸ª `nil` å¯¹è±¡å‘é€æ¶ˆæ¯ï¼š
  
  - **æ–¹æ³•è¿”å›éå¯¹è±¡ç±»å‹**ï¼šå¦‚æœè¯¥æ¶ˆæ¯æ˜¯ä¸€ä¸ªè¿”å›éå¯¹è±¡ç±»å‹çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ `int`ï¼Œ`float`ï¼Œ`struct` ç­‰ï¼‰ï¼Œä¼šè¿”å›é›¶å€¼ï¼ˆ0ï¼Œ0.0ï¼Œç›¸åº”ç±»å‹çš„é›¶å€¼ç­‰ï¼‰ã€‚

  - **æ–¹æ³•è¿”å›å¯¹è±¡ç±»å‹**ï¼šå¦‚æœè¯¥æ¶ˆæ¯æ˜¯ä¸€ä¸ªè¿”å›å¯¹è±¡çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šè¿”å› `nil`ã€‚

  - **æ–¹æ³•ä¸è¿”å›å€¼**ï¼šå¦‚æœè¯¥æ¶ˆæ¯æ˜¯ä¸€ä¸ªä¸è¿”å›å€¼çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚

  è¿™ç§ç‰¹æ€§ä½¿å¾—å¯ä»¥åœ¨ä¸æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸º `nil` çš„æƒ…å†µä¸‹å‘å®ƒå‘é€æ¶ˆæ¯ï¼Œè¿™é€šå¸¸èƒ½ä½¿ä»£ç æ›´åŠ ç®€æ´ã€‚åè¿‡æ¥ï¼Œå¦‚æœåœ¨å…¶ä»–è¯­è¨€ï¼ˆä¾‹å¦‚ `Java` æˆ– `C#`ï¼‰é‚£æ ·ï¼Œåœ¨å‘å¯¹è±¡å‘é€æ¶ˆæ¯ä¹‹å‰æ€»æ˜¯å…ˆæ£€æŸ¥å®ƒæ˜¯å¦ä¸º `nil`ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šç¼–å†™å‡ºå¾ˆå¤šä¸å¿…è¦çš„ä»£ç ã€‚ç„¶è€Œï¼Œæ³¨æ„è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥å¿½ç•¥ `nil` æ£€æŸ¥ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ`nil` æ£€æŸ¥ä»ç„¶æ˜¯å¿…è¦çš„ã€‚

:::

#### â“ä¸€ä¸ªå¯¹è±¡å‘ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯æ˜¯å¦‚ä½•è½¬å‘çš„

::: details ğŸ’¡

  - åŠ¨æ€æ–¹æ³•è§£æï¼ˆ`Dynamic Method Resolution`ï¼‰
    > è¿è¡Œæ—¶ç³»ç»Ÿä¼šè°ƒç”¨ `+resolveInstanceMethod:`ï¼ˆå¯¹äºç±»æ–¹æ³•æ˜¯ `+resolveClassMethod:`ï¼‰ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¯ä»¥ä¸ºè¿™ä¸ªç±»åŠ¨æ€æ·»åŠ ä¸€ä¸ªæ–¹æ³•ã€‚å¦‚æœæ­¤æ–¹æ³•è¿”å› `YES`ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ç³»ç»Ÿä¼šé‡æ–°å‘é€æ¶ˆæ¯ã€‚

  - å¤‡æ´æ¥æ”¶è€…ï¼ˆ`Backup Receiver`ï¼‰
    > å¦‚æœç¬¬ä¸€æ­¥æœªå¤„ç†æ¶ˆæ¯ï¼ˆå³ `+resolveInstanceMethod:` è¿”å› `NO`ï¼‰ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ `-forwardingTargetForSelector:` æ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ›¿ä»£çš„å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›äº†ä¸€ä¸ªå®ä¾‹åï¼Œç³»ç»Ÿä¼šæŠŠè¿™æ¡æ¶ˆæ¯å‘é€ç»™è¿™ä¸ªå®ä¾‹ã€‚

  - å®Œæ•´æ¶ˆæ¯è½¬å‘ï¼ˆ`Complete Message Forwarding`ï¼‰
    > å¦‚æœ `-forwardingTargetForSelector:` è¿”å›äº† `nil`ï¼Œè¿è¡Œæ—¶å°±ä¼šè¿›å…¥å®Œæ•´çš„æ¶ˆæ¯è½¬å‘é˜¶æ®µã€‚é¦–å…ˆä¼šå‘é€ `-methodSignatureForSelector:` æ¶ˆæ¯æ¥è·å–æ–¹æ³•çš„è¿”å›å’Œå‚æ•°ç±»å‹ã€‚ç„¶åä¼šå‘é€ `-forwardInvocation:` æ¶ˆæ¯ã€‚å¯ä»¥åœ¨ `-forwardInvocation:` ä¸­è‡ªè¡Œå¤„ç†æ¶ˆæ¯ï¼Œæˆ–è€…è½¬å‘ç»™å…¶ä»–å¯¹è±¡å¤„ç†ã€‚

  - æ¶ˆæ¯è½¬å‘å¤±è´¥
    > å¦‚æœåœ¨ `-forwardInvocation:` ä¸­æœªå¤„ç†æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ä¼šè°ƒç”¨ `-doesNotRecognizeSelector:` æ–¹æ³•ï¼Œ é»˜è®¤ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

:::

#### â“å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ `[obj foo]` å’Œ `objc_msgSend()` å‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»

::: details ğŸ’¡

  `[obj foo]` è¿™ç§è¯­ä¹‰å®é™…ä¸Šæ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡è°ƒç”¨ `objc_msgSend(obj, @selector(foo))` æ¥å®ç°çš„ã€‚

  æ–¹æ³•(`methods`)çš„è°ƒç”¨è¢«ç§°ä¸ºå‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ã€‚å½“ä½¿ç”¨æ–¹æ‹¬å·è¯­æ³•å‘å¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œå¦‚ `[obj foo]`ï¼Œå®é™…ä¸Šè¿è¡Œæ—¶ç³»ç»Ÿä¼šå°†å…¶è½¬åŒ–ä¸º `objc_msgSend()` å‡½æ•°çš„è°ƒç”¨ã€‚

  `objc_msgSend()` æ˜¯ `runtime` åº“ä¸­çš„å‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°(`receiver`)æ˜¯è¦å‘é€æ¶ˆæ¯çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°(`selector`)æ˜¯è¦å‘é€çš„æ¶ˆæ¯(`method`)ã€‚ä¾‹å¦‚ï¼Œ`objc_msgSend(obj, @selector(foo))` å°±æ˜¯å‘ `obj` å¯¹è±¡å‘é€åä¸º `foo` çš„æ¶ˆæ¯ã€‚

:::

#### â“`_objc_msgForward` å‡½æ•°æ˜¯åšä»€ä¹ˆçš„

::: details ğŸ’¡

  > `_objc_msgForward` æ˜¯è¿è¡Œæ—¶ç³»ç»Ÿä¸­ç”¨äºå¯¹æ¶ˆæ¯è¿›è¡Œè½¬å‘ï¼ˆ`Message Forwarding`ï¼‰çš„å‡½æ•°ã€‚

  å½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨è¯¥å¯¹è±¡çš„ç±»ä»¥åŠå…¶çˆ¶ç±»é“¾ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å¯ä»¥å“åº”è¿™æ¡æ¶ˆæ¯çš„æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šè°ƒç”¨ `_objc_msgForward` å‡½æ•°è¿›è¡Œæ¶ˆæ¯è½¬å‘ã€‚ 

:::

> â“ç›´æ¥è°ƒç”¨å®ƒå°†ä¼šå‘ç”Ÿä»€ä¹ˆ

::: details ğŸ’¡
  
  ä¸€èˆ¬ä¸ä¼šç›´æ¥è°ƒç”¨ `_objc_msgForward` å‡½æ•°ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯ç”±è¿è¡Œæ—¶ç³»ç»Ÿåœ¨éœ€è¦è¿›è¡Œæ¶ˆæ¯è½¬å‘æ—¶è‡ªåŠ¨è°ƒç”¨çš„ã€‚

  å¦‚æœç›´æ¥è°ƒç”¨ `_objc_msgForward`ï¼Œé‚£ä¹ˆä¸€èˆ¬è€Œè¨€ï¼Œè¿™å°†ä¼šå¼•èµ· `unrecognized selector` å¼‚å¸¸ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å¤„ç†ä¸èƒ½è¯†åˆ«çš„é€‰æ‹©å™¨ï¼ˆå³æ–¹æ³•ï¼‰ã€‚å¦‚æœæ‰‹åŠ¨è°ƒç”¨å®ƒï¼Œç³»ç»Ÿä¼šåœ¨å°è¯•è¿›è¡Œæ¶ˆæ¯è½¬å‘æ—¶æ‰¾ä¸åˆ°èƒ½å“åº”æ­¤æ¶ˆæ¯çš„å¯¹è±¡æˆ–æ–¹æ³•ï¼Œä»è€Œå¼•å‘å¼‚å¸¸ã€‚åŸºæœ¬ä¸Šï¼Œç›´æ¥è°ƒç”¨ `_objc_msgForward` è€Œæ²¡æœ‰é€‚å½“çš„è½¬å‘ç›®æ ‡å’Œå¤„ç†æœºåˆ¶ï¼Œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

:::

#### â“æ€ä¹ˆåœ¨æ±‡ç¼–å®ç°ä¸­è®¡ç®—æ–¹æ³•è°ƒç”¨æ—¶é—´

::: details ğŸ’¡

> è®¡ç®—ä¸€ä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶é—´ï¼Œé€šå¸¸çš„æ–¹æ¡ˆæ˜¯åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰å’Œä¹‹åå„å–ä¸€æ¬¡ç³»ç»Ÿæ—¶é—´ï¼Œå¹¶è®¡ç®—æ—¶é—´å·®ã€‚ä¸è¿‡åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œè¿™éƒ¨åˆ†é€»è¾‘å°†å˜å¾—æ›´åŠ å¤æ‚ï¼Œä¸»è¦æºäºæ±‡ç¼–è¯­è¨€çš„ä½é˜¶æ€§è´¨ï¼Œä»¥åŠ `Objective-C` æ–¹æ³•è°ƒç”¨çš„åŠ¨æ€æ€§ã€‚

  è‹¥è¦åœ¨å‡½æ•°å…¥å£å’Œè¿”å›å¤„æ’å…¥è®¡æ—¶çš„ä»£ç ï¼Œç†è®ºä¸Šéœ€è¦ä¿®æ”¹ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™åœ¨å®é™…æ“ä½œä¸­è¾ƒä¸ºå›°éš¾ã€‚

  ä¸€ç§æ›´ä¸ºå¯è¡Œçš„æ–¹æ³•æ˜¯ `hook` å‡½æ•°çš„è°ƒç”¨ï¼Œåœ¨ `Objective-C` ä¸­ï¼Œå¯¹è±¡æ–¹æ³•è°ƒç”¨æœ€åå®é™…ä¸Šä¼šé€šè¿‡ `objc_msgSend` å‡½æ•°çš„æœºåˆ¶å®ç°ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç‰ˆæœ¬çš„ `objc_msgSend`ï¼Œå¹¶åœ¨è¿™ä¸ªå‡½æ•°ä¸­è®¡ç®—æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚

å¤§è‡´æ­¥éª¤ï¼š

  - åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œè·å–åŸå§‹çš„ `objc_msgSend` çš„å‡½æ•°æŒ‡é’ˆï¼Œå¹¶æŠŠå®ƒä¿å­˜ä¸‹æ¥ã€‚

  - ç¼–å†™ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ›¿ä»£ `objc_msgSend`ã€‚åœ¨è¿™ä¸ªæ–°å‡½æ•°ä¸­ï¼š
    * ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹æ—¶é—´ï¼Œè®¡ç®—å‡ºæ—¶é—´å·®ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚
    * æ‰§è¡ŒåŸæœ¬çš„ `objc_msgSend` å‡½æ•°ã€‚

  - ä½¿ç”¨ `Objective-C` çš„æ–¹æ³•äº¤æ¢æœºåˆ¶ï¼Œå°†æ–°çš„å‡½æ•°ä¸ `objc_msgSend` å‡½æ•°è¿›è¡Œäº¤æ¢ã€‚
  
æ³¨æ„ï¼šå› ä¸ºæ¶‰åŠåˆ°æ±‡ç¼–è¯­è¨€ï¼Œå¿…é¡»å…·å¤‡ç›¸åº”çš„ `ARM` æ±‡ç¼–çŸ¥è¯†ï¼Œè€Œä¸”è¦è€ƒè™‘åˆ°æŒ‡ä»¤é›†çš„ä¸åŒï¼Œé’ˆå¯¹ 32 ä½å’Œ 64 ä½å¯èƒ½éœ€è¦åˆ†åˆ«å¤„ç†ã€‚

:::
