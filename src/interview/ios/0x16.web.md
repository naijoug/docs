---
title: Web
icon: hashtag

index: true

---

<!-- more -->

------

## Web

### â“`Web` ç™»å½•æ—¶æ€ä¹ˆä¿æŒä¼šè¯çŠ¶æ€çš„

::: details ğŸ’¡

> åœ¨ `iOS` ä¸­ï¼Œé€šè¿‡ `WebKit` çš„ `WKWebView` è¿›è¡Œ `Web` ç™»å½•æ—¶ï¼Œä¼šè¯çŠ¶æ€é€šå¸¸ç”± `Web` æœåŠ¡å™¨é€šè¿‡ç”¨æˆ·çš„æ¯æ¬¡è¯·æ±‚ä¸­é™„å¸¦çš„ `Cookies` æ¥ä¿æŒã€‚å½“ç”¨æˆ·æˆåŠŸç™»å½•åï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç”¨æˆ·ä¼šè¯çš„ `Cookie` å¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨åç»­çš„æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™ä¸ª `Cookie` å¸¦ä¸Šï¼Œè®©æœåŠ¡å™¨çŸ¥é“è¿™ä¸ªè¯·æ±‚æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„ä¼šè¯ã€‚

  ä½†æ˜¯ `iOS` çš„ `WKWebView`å¹¶ä¸ä¼šåƒ `UIWebView` é‚£æ ·è‡ªåŠ¨ä¿å­˜å’Œå‘é€ `Cookie`ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨ç®¡ç† `Cookie`ã€‚
  
å…·ä½“åšæ³•ï¼š

  - ç™»å½•æˆåŠŸçš„å›è°ƒæˆ–è€…å…¶ä»–åˆé€‚çš„åœ°æ–¹ä¿å­˜æœåŠ¡å™¨é€šè¿‡ `Set-Cookie` å“åº”å¤´å‘é€è¿‡æ¥çš„ `Cookie`ã€‚å¯ä»¥é€šè¿‡ `WKNavigationDelegate` çš„æ¥å£è·å–åˆ°è¿™ä¸ªå“åº”å¤´ã€‚

  - åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œæ‰‹åŠ¨å°†ä¿å­˜çš„ `Cookie` æ”¾å…¥è¯·æ±‚å¤´é‡Œã€‚è¿™å¯ä»¥åœ¨ `WKNavigationDelegate` çš„ `decidePolicyForNavigationAction` æ¥å£ä¸­å¤„ç†ã€‚è·å–åˆ°è¯·æ±‚çš„ `URLRequest` åï¼Œä¿®æ”¹å…¶`HTTPHeaderFields` çš„ `Cookie` å­—æ®µï¼Œç„¶åç”¨ `WKWebView`çš„ `load` æ–¹æ³•å‘èµ·ä¸€ä¸ªæ–°çš„è¯·æ±‚ã€‚

æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œè·¨åŸŸè¯·æ±‚ä¸ä¼šæºå¸¦ `Cookie`ï¼Œå¦‚æœéœ€è¦åœ¨è·¨åŸŸè¯·æ±‚ä¸­ä¿æŒç”¨æˆ·ä¼šè¯ï¼Œéœ€è¦è®¾ç½® `NSHTTPCookie` çš„ `HTTPShouldHandleCookies` å­—æ®µä¸º `true`ã€‚

:::

### â“`Web` å’Œ `Native` æ€ä¹ˆå…±äº« `Cookie`

::: details ğŸ’¡

æ€»ä½“æ€è·¯é€šï¼šåœ¨ `Native` å±‚è¿›è¡Œç™»å½•ç­‰æ“ä½œåï¼Œè·å–æœåŠ¡ç«¯è¿”å›çš„ `Cookie`ï¼Œç„¶ååœ¨æ¯æ¬¡ `WebView` åŠ è½½è¯·æ±‚æ—¶ï¼Œå°† `Cookie` è®¾ç½®è¿› `request` çš„ `header`ã€‚

å…·ä½“æ­¥éª¤ï¼š

  - åœ¨åŸç”Ÿåº”ç”¨è·å–åˆ° `Cookie`ã€‚å¦‚æœæ˜¯é€šè¿‡ç½‘ç»œè¯·æ±‚æ¥è·å–æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¯·æ±‚æˆåŠŸåï¼Œä»`Response Headers` é‡Œè·å– `Set-Cookie` å­—æ®µçš„å€¼ã€‚

  - è·å–åˆ° `Cookie` ä¹‹åï¼Œå¯ä»¥å­˜å‚¨åˆ°åº”ç”¨çš„å­˜å‚¨ç©ºé—´ï¼ˆå¦‚ `UserDefault`)ã€‚

  - åœ¨ `WebView` å‘é€è¯·æ±‚ä¹‹å‰ï¼Œä»å­˜å‚¨ç©ºé—´è·å– `Cookie`ï¼Œå°†å…¶æ·»åŠ åˆ° `WKWebView` åŠ è½½è¯·æ±‚çš„ `header` ä¸­ã€‚åœ¨ `iOS` ä¸­ï¼Œå¯ä»¥å…ˆè·å–ä¸€ä¸ª `NSMutableURLRequest` çš„å®ä¾‹ï¼Œç„¶åé€šè¿‡ `setValue:forHTTPHeaderField:` æ–¹æ³•è®¾ç½® `Cookie`ï¼Œæœ€åé€šè¿‡ `WKWebView` çš„ `loadRequest` æ–¹æ³•åŠ è½½è¿™ä¸ªè¯·æ±‚ã€‚

::: code-tabs

@tab iOS(Swift)
```swift
let url = URL(string: "https://example.com")
var request = URLRequest(url: url)
request.setValue("cookieName=cookieValue", forHTTPHeaderField: "Cookie")
webView.load(request)
```

@tab Android(Java)
```java
String url = "https://example.com";
String cookieString = "cookieName=cookieValue; Domain=.example.com";
CookieManager.getInstance().setCookie(url, cookieString);
webView.loadUrl(url);
```

:::

### â“`Web` æ¸²æŸ“å’Œ `Native` æ¸²æŸ“æœ‰ä»€ä¹ˆå¼‚åŒç‚¹

::: details ğŸ’¡

ä¸åŒç‚¹ï¼š

  - æ¸²æŸ“æµç¨‹ï¼š
    * `Web` æ¸²æŸ“æµç¨‹ä¸€èˆ¬åŒ…æ‹¬è§£æ `HTML`ã€ç”Ÿæˆ `DOM` æ ‘ã€è§£æ `CSS`ã€ç”Ÿæˆ `CSSOM` æ ‘ã€ç”Ÿæˆæ¸²æŸ“æ ‘ã€å¸ƒå±€ï¼ˆè®¡ç®—å…ƒç´ çš„å‡ ä½•ä½ç½®ï¼‰ã€æ¸²æŸ“ï¼ˆå°†å…ƒç´ ç»˜åˆ¶åˆ°å±å¹•ï¼‰ç­‰æ­¥éª¤ã€‚
    * `Native` æ¸²æŸ“åˆ™æ˜¯é€šè¿‡æ„å»ºå’Œè°ƒç”¨æœ¬åœ°ç»„ä»¶ã€è°ƒç”¨ç³»ç»Ÿåº•å±‚ `API` æ¥ç›´æ¥åœ¨å±å¹•ä¸Šç»˜åˆ¶ç•Œé¢ã€‚

  - ç»˜å›¾æ€§èƒ½ï¼šç”±äº `Native` æ¸²æŸ“ç›´æ¥è°ƒç”¨ç³»ç»Ÿåº•å±‚ `API`ï¼Œé€šå¸¸ä¼šæ¯” `Web` æ¸²æŸ“æ›´å¿«ï¼Œå°¤å…¶æ˜¯åœ¨åŠ¨ç”»å’Œå¤æ‚ç”¨æˆ·äº¤äº’ç­‰åœºæ™¯ä¸‹ã€‚

  - è·¨å¹³å°èƒ½åŠ›ï¼š
    * `Web` æ¸²æŸ“åŸºäºæ ‡å‡†åŒ–çš„ `Web` æŠ€æœ¯ï¼Œå› æ­¤å…·æœ‰å¾ˆå¼ºçš„è·¨å¹³å°èƒ½åŠ›ã€‚
    * `Native` æ¸²æŸ“å¾€å¾€æ˜¯é’ˆå¯¹å•ä¸€å¹³å°çš„ï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€äº›è·¨å¹³å°çš„ `Native` æ¡†æ¶ï¼Œå¦‚ `React Native` å’Œ `Flutter`ã€‚
    
  - è®¿é—®ç³»ç»Ÿèƒ½åŠ›ï¼š
    * `Web` å¯ä»¥é€šè¿‡ `Web APIs` è®¿é—®ä¸€éƒ¨åˆ†ç³»ç»ŸåŠŸèƒ½ï¼Œä½†å…¶èƒ½åŠ›ç›¸å¯¹å—é™ã€‚
    * `Native` æ¸²æŸ“æ›´å®¹æ˜“è®¿é—®å’Œä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¦‚ç›¸æœºã€`GPS`ã€é™€èºä»ªç­‰ã€‚

ç›¸åŒç‚¹ï¼š

  - éƒ½æ˜¯é€šè¿‡æ›´æ”¹ `UI` çŠ¶æ€æ¥å“åº”ç”¨æˆ·æ“ä½œçš„ã€‚
  - éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨åŠ¨ç”»æ¥å¢å¼ºç”¨æˆ·ä½“éªŒã€‚
  - ä¸ºäº†ä¿è¯æµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œéƒ½éœ€è¦å°½é‡é¿å…åœ¨ä¸»çº¿ç¨‹ï¼ˆ`UI` çº¿ç¨‹ï¼‰ä¸­è¿›è¡Œé‡å‹ä»»åŠ¡ã€‚
    
:::

------

## WKWebView

### â“`WKWebView` ç™½å±é—®é¢˜å¦‚ä½•å‘ç”Ÿï¼Œè§£å†³æ–¹æ¡ˆ

::: details ğŸ’¡

ç™½å±é—®é¢˜å¼•èµ·åŸå› ï¼š

  - `WKWebView` åˆå§‹åŒ–åå› å†…å­˜å›æ”¶ç­‰åŸå› è¢«æå‰é‡Šæ”¾ã€‚
  - `WKWebView` åœ¨åˆå§‹åŒ–ã€åŠ è½½ `web` èµ„æºæ—¶ï¼Œç”±äº `CPU` å¤„ç†ä¸è¿‡æ¥äº§ç”Ÿçš„å¡é¡¿ã€‚

è§£å†³æ–¹æ¡ˆï¼š

  - å°† `WKWebView` å¼ºå¼•ç”¨ä»¥ä¿è¯å…¶åœ¨ `ViewController` ç”Ÿå‘½å‘¨æœŸå†…ä»¥åŠç½‘ç»œè¯·æ±‚è¿‡ç¨‹ä¸­ä¸è¢«é‡Šæ”¾ã€‚
    > æ¯”å¦‚åœ¨ `ViewController` ä¸­å®šä¹‰ `WKWebView` ä¸ºå…¨å±€å±æ€§ã€‚

  - åœ¨é€‚å½“çš„æ—¶æœºï¼Œä¾‹å¦‚åœ¨ `viewDidLoad()` å‡½æ•°ä¸­è¿›è¡Œ `WKWebView` çš„åˆå§‹åŒ–å’Œé¡µé¢åŠ è½½ã€‚é¿å…è¿‡æ—©åŠ è½½å¯¼è‡´ `WKWebView` æœªè¢«æ­£å¸¸åˆå§‹åŒ–å°±å·²ç»å¼€å§‹é¡µé¢åŠ è½½ã€‚

  - ä½¿ç”¨ `Key-Value Observing`ï¼ˆ`KVO`ï¼‰æ¥ç›‘å¬ `WKWebView` çš„ `loading`ã€`title`ã€`estimatedProgress`å±æ€§ï¼Œè·å– `WKWebView` çš„åŠ è½½çŠ¶æ€å¹¶åŠæ—¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚

    ```swift
    webView.addObserver(self, forKeyPath: #keyPath(WKWebView.estimatedProgress), options: .new, context: nil)
    webView.addObserver(self, forKeyPath: #keyPath(WKWebView.title), options: .new, context: nil)
    ```

  - å¦‚æœæ˜¯å› ä¸º `WKWebView` åœ¨åŠ è½½å¤§é‡ `web` èµ„æºæ—¶å‡ºç°å¡é¡¿ï¼Œå¯¼è‡´ç™½å±ï¼Œå¯ä»¥å°è¯•å¯¹ `web` èµ„æºåšä¸€äº›ä¼˜åŒ–ï¼Œå‡å°‘é¦–å±éœ€è¦åŠ è½½çš„èµ„æºã€‚

  - åˆç†è®¾ç½® `WKWebView` çš„ `Frame`ï¼Œä¸€å¼€å§‹è®¾ç½®ä¸ºä¸€åƒç´ ï¼Œç­‰ç½‘é¡µåŠ è½½å®Œæ¯•å†è®¾ç½®ä¸ºå…¨å±å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³é—®é¢˜ã€‚
     
  - Webå¼€å‘è€…å·¥å…·ï¼šç™½å±é—®é¢˜å¯èƒ½å’Œç½‘é¡µçš„åŠ è½½æ–¹å¼ä¹Ÿæœ‰å…³ç³»ï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œå¯ä»¥è¯·ç½‘é¡µå¼€å‘è€…å·¥å…·æŸ¥çœ‹å¯¹åº”çš„ç½‘é¡µï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„æŠ€æœ¯å¯¼è‡´ `WKWebView` æ— æ³•æ­£ç¡®è§£æã€‚
:::

### â“`WKWebView` ç¼“å­˜å’Œæ¸…ç†ç¼“å­˜çš„æ–¹æ³•

::: details ğŸ’¡

```swift
// ç¦æ­¢ç¼“å­˜
let url = URL(string: "https://www.website.com")!
var request = URLRequest(url: url)
request.cachePolicy = .reloadIgnoringLocalCacheData
wkWebView.load(request)

// æ¸…é™¤ç¼“å­˜
let dateFrom = Date(timeIntervalSince1970: 0)
var websiteDataTypes = Set<String>()
websiteDataTypes.insert(WKWebsiteDataTypeDiskCache)
websiteDataTypes.insert(WKWebsiteDataTypeMemoryCache)
WKWebsiteDataStore.default().removeData(ofTypes: websiteDataTypes, modifiedSince: dateFrom, completionHandler: {})
```

æ³¨æ„ï¼šæ¸…ç†ç¼“å­˜æ“ä½œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´å»å®Œæˆï¼Œç‰¹åˆ«æ˜¯å½“ç£ç›˜ä¸­çš„ç¼“å­˜æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œåº”å½“å¯¹å®ƒè¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚

:::

### â“`WKWebView` è®¾ç½® `userAgent` çš„æ–¹æ³•çŸ¥é“å—ï¼Œæœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜å—

::: details ğŸ’¡

  - ç›´æ¥é€šè¿‡ `WKWebView` çš„ `customUserAgent` å±æ€§æ¥è®¾ç½®ã€‚

    ```swift
    let webView = WKWebView()
    webView.customUserAgent = "Your Custom User Agent"
    ```

  - é€šè¿‡ `WKWebView` çš„ `evaluateJavaScript` æ–¹æ³•è·å–é»˜è®¤ `UserAgent`ï¼Œç„¶ååœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ è‡ªå®šä¹‰éƒ¨åˆ†ï¼š
    
    ```swift
    let webView = WKWebView()
    webView.evaluateJavaScript("navigator.userAgent") { (result, error) in
        if let userAgent = result as? String {
            webView.customUserAgent = userAgent + " Your Custom User Agent"
        }
    }
    ```

å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š

  - `UserAgent` è®¾ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼šæœ‰æ—¶å¯èƒ½ä¼šå‡ºç°è®¾ç½®äº† `customUserAgent` åæ²¡æœ‰ç«‹å³ç”Ÿæ•ˆçš„æƒ…å†µï¼Œè¿™é€šå¸¸æ˜¯å› ä¸º `WKWebView` è¿˜åœ¨åŠ è½½é¡µé¢æˆ–è€…è¿˜æ²¡æœ‰å¼€å§‹åŠ è½½é¡µé¢ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨åˆ›å»º `WKWebView` å®ä¾‹åç«‹å³è®¾ç½® `customUserAgent`ã€‚

  - `UserAgent` è®¾ç½®è¢«è¦†ç›–ï¼šæœ‰æ—¶å¯èƒ½ä¼šå‡ºç°è®¾ç½®äº† `customUserAgent` åï¼Œåç»­å†æ¬¡è®¾ç½® `customUserAgent` æ—¶å‰ä¸€æ¬¡çš„è®¾ç½®è¢«è¦†ç›–ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨è®¾ç½® `customUserAgent` å‰å…ˆè·å–å½“å‰çš„ `userAgent` ï¼Œç„¶åå°†æ–°çš„ `userAgent` æ·»åŠ åˆ°åŸæœ‰çš„ `userAgent` åé¢ã€‚

:::

### â“`customUserAgent` å’Œ `applicationNameForUserAgent` è®¾ç½® `userAgent` æœ‰ä»€ä¹ˆåŒºåˆ«å—

::: details ğŸ’¡

  - `customUserAgent`ï¼šå¯ä»¥è‡ªå®šä¹‰æ•´ä¸ª `userAgent` å­—ç¬¦ä¸²çš„å€¼ã€‚
    > æ¯”å¦‚å¯ä»¥æŠŠ `userAgent` è®¾ç½®ä¸ºä»»ä½•å€¼ï¼Œæµè§ˆå™¨ä¿¡æ¯ã€æ“ä½œç³»ç»Ÿä¿¡æ¯ç­‰éƒ½å¯ä»¥è¢«æ›¿æ¢æˆ–è€…çœç•¥ã€‚
    
  - `applicationNameForUserAgent`ï¼šå¯¹åº”äº `WKWebViewConfiguration` çš„å±æ€§ï¼Œç”¨äºè®¾ç½® `userAgent` å­—ç¬¦ä¸²çš„åç¼€ã€‚å°†å…¶è®¾ç½®ä¸ºç‰¹å®šå­—ç¬¦ä¸²åï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä¼šè¢«æ·»åŠ åˆ°æ•´ä¸ª `userAgent` çš„æœ«å°¾ï¼Œå½¢æˆæ–°çš„ `userAgent`ã€‚
    > è¿™ä¸ä¼šæ”¹å˜åŸæœ‰æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿçš„ä¿¡æ¯ã€‚
    
æ€»ç»“ï¼š`customUserAgent` å¯ä»¥ç”¨æ¥å…¨é¢è‡ªå®šä¹‰ `userAgent`ï¼Œè€Œ `applicationNameForUserAgent` åˆ™åªæ˜¯åœ¨é»˜è®¤çš„ `userAgent` å­—ç¬¦ä¸²åé¢è¿½åŠ äº†ä¸€å°æ®µè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ã€‚

:::

### â“`WKWebView` ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜å˜›

::: details ğŸ’¡

å¸¸è§é—®é¢˜ï¼š

  - `Cookie` ç®¡ç†é—®é¢˜ï¼šä½¿ç”¨ `WKWebView` çš„æ—¶å€™ï¼Œæœ‰æ—¶å¯èƒ½ä¼šé‡åˆ° `Cookie` åŒæ­¥é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º `iOS` çš„ `WKWebView` ç®¡ç† `Cookie` çš„æ–¹å¼ä¸ `UIWebView` å’Œ `Safari` ä¸åŒï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨ç®¡ç† `Cookie`ã€‚å¯ä»¥é€šè¿‡åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œå°†å­˜å‚¨åœ¨ `HTTPCookieStorage` çš„ `Cookie` å†™å…¥æ¯æ¬¡çš„è¯·æ±‚å¤´ä¸­ã€‚

  - å†…å­˜æ³„æ¼é—®é¢˜ï¼š`WKWebView` åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œç‰¹åˆ«æ˜¯åœ¨ `WKWebView` åŠ è½½ `JavaScript` å†…å®¹æ—¶ã€‚å¯¹æ­¤ï¼Œå¯ä»¥é‡‡å–åˆç†åœ°åˆ›å»ºå’Œé”€æ¯ `WKWebView` çš„æ–¹å¼æˆ–è€…å°† `WKWebView` è§†å›¾æ”¾åœ¨æ–°çš„ `Window` ä¸Šæ¥é¿å…ã€‚
    
  - `HTTPS` è¯ä¹¦é—®é¢˜ï¼šåœ¨ `WKWebView` ä¸­åŠ è½½è‡ªç­¾åè¯ä¹¦çš„ `https` ç«™ç‚¹æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæœªè¢«ä¿¡ä»»çš„æƒ…å†µã€‚åº”å¯¹ç­–ç•¥æ˜¯å®ç°ç›¸åº”çš„ `WKNavigationDelegate` ä¸­çš„æ–¹æ³•æ¥è‡ªå®šä¹‰å¤„ç†ã€‚

  - æ— æ³•ç›´æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼š`WKWebView` æ— æ³•åƒ `UIWebView` é‚£æ ·ç›´æ¥åŠ è½½æœ¬åœ°ç½‘é¡µæˆ–å…¶ä»–æ–‡æ¡£ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ `WKWebView` çš„åŠ è½½è¯·æ±‚æ–¹æ³•æ·»åŠ æœ¬åœ°æ–‡ä»¶çš„ `URL` è®¿é—®æœ¬åœ°æ–‡ä»¶ã€‚
    
:::

### â“`UIWebview` è¿ç§»åˆ° `WKWebView` è¿‡ç¨‹ä¸­æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜æˆ–è€…éº»çƒ¦å—ï¼Œæ€ä¹ˆè§£å†³çš„

::: details ğŸ’¡

ä¸€äº›å¸¸è§é—®é¢˜å’Œè§£å†³ç­–ç•¥ï¼š

  - `Cookie` ç®¡ç†æ–¹é¢ï¼Œ`UIWebView` ä¸æµè§ˆå™¨å…±äº« `Cookie` å­˜å‚¨ï¼Œä½† `WKWebView` æ²¡æœ‰è¿™æ ·çš„ç‰¹æ€§ã€‚ä¸€ä¸ªå¸¸è§çš„è§£å†³åŠæ³•æ˜¯åœ¨ `HTTP` è¯·æ±‚å¤´ä¸­æ‰‹åŠ¨æ·»åŠ  `Cookie`ã€‚

  - æœ¬åœ°æ–‡ä»¶åŠ è½½é—®é¢˜ã€‚`UIWebView` å¯ä»¥è½»æ¾åŠ è½½æœ¬åœ° `HTML` æ–‡ä»¶ï¼Œè€Œ `WKWebView` ä¸èƒ½ç›´æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è§£å†³æ–¹æ³•é€šå¸¸æ˜¯é€šè¿‡ `WKWebView` çš„ `loadFileURL` æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ã€‚

  - è®¿é—®å†å²è®°å½•ã€‚`UIWebView` æä¾›äº†ä¾¿æ·çš„ `backForwardList` æ–¹æ³•æ¥è·å¾—å†å²è®°å½•ï¼Œä½†æ˜¯åœ¨ `WKWebView` ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¾¿æ·æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆæ¯”å¦‚è‡ªå·±ç¼–å†™ä»£ç æ¥ç»´æŠ¤ä¸€ä¸ªå†å²è®°å½•ï¼‰æ¥æ›¿ä»£ã€‚

  - åœ¨ `WKWebView` ä¸­ï¼Œ`scrollView` çš„ `zoom` åŠŸèƒ½è¢«ç¦ç”¨äº†ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦æ”¯æŒç¼©æ”¾ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›å¥‡æŠ€æ·«å·§ï¼Œä¾‹å¦‚åœ¨æ¯æ¬¡åŠ è½½å®Œæ¯•åæ‰§è¡Œ `JavaScript` ä»£ç ï¼Œæ‰‹åŠ¨å¯ç”¨ `Pinch Zoom`ã€‚
    
  - å†…å­˜é—®é¢˜ã€‚`WKWebView` é€šå¸¸ä¼šä½¿ç”¨æ›´å¤šçš„å†…å­˜ï¼Œå¦‚æœä½ çš„åº”ç”¨åœ¨ä½å†…å­˜è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œå¯èƒ½éœ€è¦åšä¸€äº›å†…å­˜ä¼˜åŒ–ã€‚

  - ä¸€äº›æ—§çš„ `JavaScript` ä»£ç å¯èƒ½åœ¨ `WKWebView` ä¸Šæ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¯èƒ½éœ€è¦é‡æ–°è°ƒæ•´æˆ–ç¼–å†™ `JavaScript` ä»£ç ã€‚

  - åŸæœ‰çš„ `UIWebView Delegate` æ–¹æ³•åœ¨ `WKWebView` ä¸­å¯èƒ½ä¸å­˜åœ¨ç­‰ä»·çš„æ–¹æ³•ï¼Œéœ€è¦åšå‡ºç›¸åº”çš„è°ƒæ•´å’Œæ›¿æ¢ã€‚

:::

### â“`js` ä¸ `iOS` ç›¸äº’è°ƒç”¨çš„æ–¹æ¡ˆæœ‰å“ªäº›

::: details ğŸ’¡

  - `WKWebView`
    
    ::: code-tabs

    @tab js -> swift
    ```swift
    // iOS ç«¯
    class ViewController: UIViewController {
        func viewDidLoad() {
            super.viewDidLoad()
            // è®¾ç½®é…ç½®
            let config = WKWebViewConfiguration()
            // è®¾ç½®æ¶ˆæ¯æ§åˆ¶å™¨
            let userContentController = WKUserContentController()
            // æ·»åŠ æ¶ˆæ¯å¤„ç†ï¼Œéµå¾ª WKScriptMessageHandler åè®®, "AppModel" éœ€è¦ä¸ JS ç«¯åå•†ä¸€è‡´
            userContentController.add(self, name: "AppModel")
            config.userContentController = userContentController
            // ä½¿ç”¨æ­¤é…ç½®åˆå§‹åŒ–åˆ›å»º webview
            let webView = WKWebView(frame: view.bounds, configuration: config)
            view.addSubview(webView)
        }
    }
    // å®ç° WKScriptMessageHandler åè®®ï¼Œå¹¶å®ç°å…¶æ–¹æ³•
    extension ViewController: WKScriptMessageHandler {
        func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) {
            if message.name == "AppModel" {
                print("Message received: \(message.body)")
                // åœ¨æ­¤å¤„è§£æ message.body ä¸­çš„å†…å®¹ï¼Œå¹¶åšå‡ºç›¸åº”çš„æ“ä½œ
            }
        }
    }
    
    // JavaScript ç«¯
    // ç‚¹å‡»æŒ‰é’®è°ƒç”¨ native æ–¹æ³•
    function callNative() {
        window.webkit.messageHandlers.AppModel.postMessage({body: 'Hello, Native!'});
    }
    ```

    @tab swift -> js
    ```swift
    // å‘ JS æ³¨å…¥ä»£ç 
    let script = WKUserScript(source: "alert('Hello, JS!')", injectionTime: .atDocumentEnd, forMainFrameOnly: false)
    webView.configuration.userContentController.addUserScript(script)
    
    // è°ƒç”¨ JS æ–¹æ³•
    webView.evaluateJavaScript("doSomething();", completionHandler: { (result, error) in
        if let error = error {
            print(error)
        } else {
            print("Success")
        }
    })
    ```

  - `JavaScriptCore`: å¯ä»¥åœ¨ `iOS` åŸç”Ÿåº”ç”¨ä¸ `JavaScript` ä¹‹é—´ç›¸äº’æ‰ç”¨ï¼ŒåŒ…æ‹¬é€šè¿‡ `JSContext` å¯¹è±¡è½½å…¥ `JS` ä»£ç ï¼Œä½¿ `JS` èƒ½ç›´æ¥è®¿é—® `native` å¯¹è±¡çš„ç±»å’Œå®ä¾‹æ–¹æ³•ã€‚

  - ä½¿ç”¨æ··åˆå¼€å‘æ¡†æ¶ï¼šå¦‚ `React-Native`, `Ionic` ç­‰ã€‚åœ¨è¿™äº›æ¡†æ¶ä¸­ï¼Œé€šå¸¸æœ‰ä¸€å¥—æˆç†Ÿçš„æœºåˆ¶æ¥å®Œæˆ `JS` å’Œ `iOS` ä¹‹é—´çš„è°ƒç”¨ï¼Œæ¯”å¦‚ `React-Native` ä¸­çš„ `Bridge` æ¨¡å—ï¼Œ`Ionic` ä¸­çš„ `Cordova` æ’ä»¶ç­‰ã€‚

:::

### â“`js` äº¤äº’å‰ç«¯ä»£ç  `Android` å’Œ `iOS` ä¸ºä»€ä¹ˆè¦å†™ä¸¤å¥—ï¼Œæœ‰åŠæ³•ä¸€å¥—è§£å†³å—

::: details ğŸ’¡

  - ä» `JavaScript` è°ƒç”¨åŸç”Ÿä»£ç 
    
    * åœ¨ `Android` ä¸­ï¼Œé€šå¸¸æ˜¯åœ¨ `Java` ä»£ç ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶æ³¨å…¥åˆ° `WebView` ä¸­ï¼Œç„¶ååœ¨ `JavaScript` ä¸­ä½¿ç”¨è¯¥å¯¹è±¡çš„åç§°è°ƒç”¨å…¶æ–¹æ³•ã€‚
    
    * åœ¨ `iOS` ä¸­ï¼Œ`JavaScript` å¯ä»¥é€šè¿‡è°ƒç”¨ `webkit.messageHandlers.<name>.postMessage(<messageBody>)` æ¥è°ƒç”¨åŸç”Ÿä»£ç ï¼Œç„¶ååœ¨åŸç”Ÿä»£ç ä¸­å®ç°ç›¸åº”çš„ `WKScriptMessageHandler` çš„ `didReceive` æ–¹æ³•æ¥æ¥æ”¶è¿™ä¸ªè°ƒç”¨ã€‚
    
  - ä»åŸç”Ÿä»£ç è°ƒç”¨ `JavaScript`ï¼š`Android` å’Œ `iOS` éƒ½æ˜¯é€šè¿‡åœ¨åŸç”Ÿä»£ç ä¸­æ‰§è¡Œ `JavaScript` å­—ç¬¦ä¸²æ¥å®ç°çš„ã€‚
    
ç»Ÿä¸€æ–¹æ¡ˆï¼š
    
  - å¯ä»¥é€šè¿‡ä¸€äº›é€šç”¨çš„è®¾è®¡æ¨¡å¼æˆ–è€…å·¥å…·æ¥ä½¿å¾— `JavaScript` ç«¯çš„ä»£ç å°½å¯èƒ½ä¸€è‡´ã€‚
    > ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ `JavaScript` ä¸­å°è£…ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œæ ¹æ®ä¸åŒçš„å¹³å°è°ƒç”¨ä¸åŒçš„åº•å±‚æ–¹æ³•ï¼Œç„¶ååœ¨è¿™ä¸ªæ¥å£ä¸Šå±‚æä¾›ç»Ÿä¸€çš„ `API` ç»™å…¶ä»– `JavaScript` ä»£ç ä½¿ç”¨ã€‚

  - ä½¿ç”¨ç¬¬ä¸‰æ–¹è·¨å¹³å°å·¥å…·ï¼Œå¦‚ `React Native`ã€`Cordova` ç­‰ï¼Œå®ƒä»¬æä¾›äº†ç»Ÿä¸€çš„ `JavaScript API` æ¥è°ƒç”¨åŸç”ŸåŠŸèƒ½ï¼Œå¹¶å°†åº•å±‚çš„ `Android` å’Œ `iOS` çš„å·®å¼‚å°è£…èµ·æ¥ï¼Œä½¿å¾—å¯ä»¥ç”¨ä¸€å¥— `JavaScript` ä»£ç æ¥å¼€å‘ `Android` å’Œ `iOS` åº”ç”¨ã€‚
    
:::
