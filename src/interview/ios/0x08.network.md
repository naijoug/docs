---
title: ç½‘ç»œ
icon: hashtag

index: true

---

<!-- more -->

------

## URLSession

### â“`NSURLSession` vs `NSURLConnection`

::: details ğŸ’¡

`NSURLConnection` å’Œ `NSURLSession` éƒ½æ˜¯æä¾›çš„ç”¨äºç½‘ç»œè¯·æ±‚çš„ç±»ã€‚

- **NSURLConnection**ï¼š`iOS 7`ä¹‹å‰ç”¨äºå¤„ç† `HTTP`ã€`FTP`ç­‰åè®®çš„ç½‘ç»œè¯·æ±‚çš„ä¸»è¦ç±»ã€‚
    > æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼æ¥è·å–ç½‘ç»œæ•°æ®ã€‚ç”±äºåŒæ­¥è¯·æ±‚ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå› æ­¤å¼€å‘ä¸­ä¸€èˆ¬ä½¿ç”¨å¼‚æ­¥è¯·æ±‚ã€‚ç„¶è€Œï¼Œ`NSURLConnection` åœ¨ `iOS 9.0` ä¹‹åå·²ç»è¢«æ ‡è®°ä¸ºè¿‡æœŸã€‚

- **NSURLSession**ï¼š`iOS 7`ä¹‹åå¼•å…¥çš„æ–°çš„ç½‘ç»œè¯·æ±‚ç±»ï¼Œç”¨äºæ›¿ä»£`NSURLConnection`ã€‚
    > ç›¸æ¯”äº`NSURLConnection`ï¼Œ`NSURLSession`æä¾›äº†ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œä¾‹å¦‚åå°ä¸‹è½½ã€ä¸Šä¼ ä»»åŠ¡ç­‰ã€‚åŒæ—¶ï¼Œ`NSURLSession`æä¾›äº†æ›´ç°ä»£åŒ–ã€ç»„ä»¶åŒ–çš„æ¥å£ï¼Œä½¿å¾—ç½‘ç»œè¯·æ±‚çš„å¤„ç†æ›´ä¸ºæ–¹ä¾¿å’Œçµæ´»ã€‚
  
  `NSURLSession` æœ‰ `DataTask`ã€`UploadTask`ã€`DownloadTask`ä¸‰ç§ä»»åŠ¡ç±»å‹ï¼Œåˆ†åˆ«å¯¹åº”è·å–æ•°æ®ã€ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶çš„æ“ä½œã€‚å¯¹äºä»»åŠ¡çš„å¤„ç†ï¼Œ`NSURLSession` é‡‡ç”¨äº† `Block` çš„æ–¹å¼ï¼Œä½¿å¾—è¯·æ±‚çš„ç»“æœå¤„ç†åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œæ›´ä¸ºæ¸…æ™°ã€‚

:::

### â“URLSession è§£å†³äº† URLConnection ä»€ä¹ˆé—®é¢˜

::: details ğŸ’¡

- **åå°ä¼ è¾“**ï¼š`NSURLConnection` ä¸æ”¯æŒåœ¨åº”ç”¨é€€å‡ºåç»§ç»­ä¼ è¾“æ•°æ®ï¼Œ`NSURLSession` é€šè¿‡åˆ›å»ºåå°ä¼šè¯å¯ä»¥åœ¨åº”ç”¨å¤„äºåå°æˆ–è€…è¢«æ€æ­»åç»§ç»­è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚

- **è¯·æ±‚çš„æš‚åœå’Œç»­ä¼ **ï¼š`NSURLConnection` æ— æ³•åƒ `NSURLSession` é‚£æ ·æš‚åœå’Œç»­ä¼ ç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰æä¾›ç›¸åº”çš„æ–¹æ³•æˆ–è€…å¯¹åº”çš„æ“ä½œçŠ¶æ€ã€‚

- **ä»£ç†å›è°ƒ**ï¼š `NSURLConnection` ä½¿ç”¨ä»£ç†çš„æ–¹å¼è¿›è¡Œå›è°ƒï¼Œåœ¨å¤æ‚åº”ç”¨åœºæ™¯ä¸‹ï¼Œå¯èƒ½å¯¼è‡´ä»£ç†æ–¹æ³•æ··æ‚ï¼Œå˜å¾—éš¾ä»¥ç®¡ç†å’Œç»´æŠ¤ã€‚è€Œ `NSURLSession` åˆ™é‡‡ç”¨äº†åŸºäº `block` çš„å›è°ƒæ–¹å¼ï¼Œæ›´åŠ ç›´è§‚å’Œæ–¹ä¾¿ã€‚

- **é…ç½®ä¼šè¯**ï¼š`NSURLSession` æä¾›äº† `NSURLSessionConfiguration` ç±»ï¼Œå¯ä»¥ç”¨äºé…ç½®ä¼šè¯çš„è¡Œä¸ºï¼Œæ¯”å¦‚è¯·æ±‚è¶…æ—¶ã€èœ‚çªç½‘ç»œæ˜¯å¦è®¿é—®ã€`HTTP` æœ€å¤§å¹¶å‘æ•°ç­‰ï¼Œè€Œ `NSURLConnection` åˆ™æ— æ³•åšåˆ°è¿™äº›ã€‚

- **é‡ç”¨å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚**ï¼š`NSURLSession` é€šè¿‡ `NSURLSessionTask` å¯¹è±¡æ¥ç®¡ç†æ¯ä¸ªç½‘ç»œè¯·æ±‚ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯å¯ä»¥å–æ¶ˆã€æš‚åœå’Œæ¢å¤çš„ï¼Œè€Œ `NSURLConnection` åˆ™æ— æ³•åšåˆ°ã€‚

:::

### â“è¯´ä¸€ä¸‹ `NSURLSession` å…·ä½“çš„å®ç°åŸç†

::: details ğŸ’¡

- `NSURLSessionConfiguration`ï¼šè¿™æ˜¯ä¸€ä¸ªä¼šè¯é…ç½®å¯¹è±¡ï¼Œå®ƒå†³å®šäº†ä¼šè¯çš„è¡Œä¸ºæ¨¡å¼ã€‚
    > å¦‚ï¼šå…è®¸èœ‚çªè®¿é—®ã€cookie ç­–ç•¥ã€è¶…æ—¶è®¾ç½®ã€HTTP ç®¡é“åŒ–ç­‰ã€‚

- `NSURLSession`ï¼šè¿™æ˜¯ç½‘ç»œåŠ è½½çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚
    > å®ƒåè°ƒä¸€ç»„ç›¸å…³ç½‘ç»œæ•°æ®è½¬æ¢ä»»åŠ¡çš„å®Œæˆã€‚ä¼šè¯ä¸­åŒ…å«ä¸€ä¸ªä»£ç†ä»¥åŠä¸€ä¸ªç”¨æ¥ç›‘æ§ç‰¹å®šä»»åŠ¡ç»„çš„è¿›åº¦çš„å§”æ‰˜ã€‚

- `NSURLSessionTask`ï¼šä»»åŠ¡å¯¹è±¡è´Ÿè´£å¯åŠ¨å¹¶ç»´æŠ¤ç›¸å…³çš„ç½‘ç»œæ“ä½œï¼Œæä¾›äº†å¼€å§‹ã€æš‚åœã€å–æ¶ˆä»»åŠ¡çš„æ“ä½œï¼›å¹¶ä¸”å¯ä»¥æŸ¥çœ‹ä¼ è¾“è¿›åº¦ã€ç½‘ç»œçŠ¶æ€ç­‰ä¿¡æ¯ã€‚
    > ç»†åˆ†ä¸ºä¸‰ä¸ªå­ç±»ï¼Œåˆ†åˆ«æ˜¯ `NSURLSessionDataTask`ã€`NSURLSessionUploadTask`ã€`NSURLSessionDownloadTask`ï¼Œå¯¹åº”çš„æ˜¯æ•°æ®è·å–ä»»åŠ¡ã€ä¸Šä¼ ä»»åŠ¡å’Œä¸‹è½½ä»»åŠ¡ã€‚

- `NSURLSessionDelegate`ï¼šä¼šè¯ä»£ç†
    > ç›‘å¬æ•´ä¸ªä¼šè¯çš„äº‹ä»¶ï¼Œæ¯”å¦‚ä»»åŠ¡çš„å®Œæˆã€è®¤è¯è¯·æ±‚ã€åå°ä¸‹è½½å®Œæˆç­‰ã€‚

- `NSURLSessionTaskDelegate`ï¼šä»»åŠ¡ä»£ç†
    > ç›‘å¬ç‰¹å®šä»»åŠ¡çš„äº‹ä»¶ï¼Œä¾‹å¦‚ä¸Šä¼ è¿›åº¦ã€ä¸‹è½½è¿›åº¦ç­‰ã€‚

:::

### â“æ–­ç‚¹ç»­ä¼ æ€ä¹ˆå®ç°ï¼Œéœ€è¦è®¾ç½®ä»€ä¹ˆ

::: details ğŸ’¡

  > æ–­ç‚¹ç»­ä¼ ï¼šä¸»è¦æ˜¯åˆ©ç”¨ `HTTP` åè®®ä¸­çš„ `Range` è¯·æ±‚å¤´å­—æ®µï¼Œåœ¨å‘èµ·ç½‘ç»œè¯·æ±‚æ—¶è®¾ç½® `Range` å­—æ®µï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬éœ€è¦ä»å“ªä¸ªå­—èŠ‚å¼€å§‹æ¥æ”¶æ•°æ®ã€‚

å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

- åœ¨ç”¨æˆ·æš‚åœæˆ–è€…è¯·æ±‚å¤±è´¥ç­‰éœ€è¦æ–­ç‚¹ç»­ä¼ çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ä¿å­˜å·²ç»æ¥æ”¶åˆ°çš„æ•°æ®é•¿åº¦ã€‚
    > æ¯”å¦‚ä½¿ç”¨`NSURLSessionDownloadTask` è¿›è¡Œä¸‹è½½æ—¶ï¼Œå¯ä»¥è°ƒç”¨ `cancelByProducingResumeData:` æ–¹æ³•è·å–åˆ°ä¸€ä¸ª `NSData` å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†å·²ç»ä¸‹è½½æ•°æ®çš„é•¿åº¦ä»¥åŠèµ„æºçš„é“¾æ¥ç­‰ä¿¡æ¯ï¼Œå¯ä»¥ä¿å­˜åˆ°æœ¬åœ°ç”¨äºä»¥åæ¢å¤ä¸‹è½½ã€‚

- å½“éœ€è¦æ¢å¤ä¸‹è½½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª `NSData` å¯¹è±¡è°ƒç”¨ `NSURLSession` çš„ `downloadTaskWithResumeData:` æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª `NSURLSessionDownloadTask` å¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨ `resume` æ–¹æ³•ï¼Œå³å¯å®Œæˆæ–­ç‚¹ä¸‹è½½ã€‚

- å¦å¤–ä¸€ç§æ–¹æ³•åˆ™æ˜¯ï¼Œåœ¨è¯·æ±‚å¤´éƒ¨æ·»åŠ  `Range` å­—æ®µï¼Œå€¼ä¸º `bytes=å·²ä¸‹è½½é•¿åº¦-` è¿™æ ·åœ¨å‘å‡ºè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ¥æ”¶åˆ°è¿™ä¸ªå­—æ®µï¼Œç„¶åä»éœ€è¦çš„å­—èŠ‚å¼€å§‹è¿”å›æ•°æ®ã€‚è¿™ç§æ–¹å¼éœ€è¦è‡ªå·±å¤„ç†å·²ä¸‹è½½çš„æ•°æ®ï¼Œå°†æ–°ä¸‹è½½çš„æ•°æ®æ‹¼æ¥åˆ°å·²ä¸‹è½½çš„æ•°æ®åé¢ã€‚

æ³¨æ„ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰æœåŠ¡å™¨éƒ½æ”¯æŒæ–­ç‚¹ç»­ä¼ çš„ï¼Œè¿™éœ€è¦æœåŠ¡å™¨æ”¯æŒ `HTTP` åè®®ä¸­çš„ `Range` å­—æ®µã€‚

:::

### â“ç½‘ç»œå±‚çš„ä¼˜åŒ–æ–¹æ¡ˆæœ‰å“ªäº›

::: details ğŸ’¡

- æœåŠ¡ç«¯ä¼˜åŒ–
    * **æ•°æ®å‹ç¼©**ï¼šå¦‚æœéœ€è¦ä¼ è¾“çš„æ•°æ®å¾ˆå¤§ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ï¼Œä»è€Œæé«˜ä¼ è¾“é€Ÿåº¦ã€‚ä¸è¿‡è¿™æ ·å¯èƒ½ä¼šå¢åŠ  `CPU` çš„ä½¿ç”¨é‡ï¼Œå› æ­¤éœ€è¦é’ˆå¯¹å…·ä½“çš„åœºæ™¯è¿›è¡Œæƒè¡¡ã€‚
    * **ä½¿ç”¨CDN**ï¼šä½¿ç”¨å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰è¿›è¡Œæ•°æ®çš„åˆ†å‘ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½æœåŠ¡å™¨å‹åŠ›ï¼Œä¿éšœæ•°æ®ä¼ è¾“é€Ÿåº¦ã€‚

- ç½‘ç»œé€šè®¯ä¼˜åŒ–
    * **DNS é¢„è§£æ**ï¼šé¢„å…ˆè§£æå¯èƒ½éœ€è¦ç”¨åˆ°çš„åŸŸåï¼Œè¿™æ ·åœ¨éœ€è¦è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥çœå» `DNS` è§£æçš„æ—¶é—´ã€‚
    * **å‡å°‘é‡å®šå‘**ï¼šé‡å®šå‘ä¼šå¢åŠ ç½‘ç»œè¯·æ±‚çš„ `RTT`ï¼Œå³å¾€è¿”æ—¶é—´ï¼Œåˆç†è§„åˆ’ `API` ï¼Œå°½é‡å‡å°é‡å®šå‘ã€‚
    * **ä½¿ç”¨ HTTP/2**ï¼š`HTTP/2` ç›¸æ¯” `HTTP/1.1` åœ¨å¤šè·¯å¤ç”¨ã€æ•°æ®å‹ç¼©ã€æœåŠ¡å™¨æ¨é€ç­‰æ–¹é¢éƒ½æœ‰æ‰€ä¼˜åŒ–ï¼Œå¯ä»¥ç”¨æ¥æé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚

- å®¢æˆ·ç«¯ä¼˜åŒ–
    * **è¯·æ±‚åˆå¹¶**ï¼šå¦‚æœæœ‰å¤§é‡å°çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥å°è¯•å°†è¿™äº›è¯·æ±‚åˆå¹¶ï¼Œå°½å¯èƒ½åœ°å‡å°‘è¯·æ±‚æ•°é‡ï¼Œå› ä¸ºæ¯ä¸ªè¯·æ±‚åœ¨è¯·æ±‚å‘é€å’Œå“åº”æ¥æ”¶æ—¶éƒ½ä¼šæœ‰ä¸€å®šçš„å›ºå®šå¼€é”€ã€‚
    * **è°ƒæ•´è¶…æ—¶æ—¶é—´**ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒçš„å®é™…æƒ…å†µï¼Œåˆç†è®¾ç½®ç½‘ç»œè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ— æœç­‰å¾…ï¼Œæµªè´¹èµ„æºã€‚
    * **ä½¿ç”¨ç¼“å­˜**ï¼šå¯¹äºè·å–åˆ°çš„ç½‘ç»œæ•°æ®ï¼Œå¦‚æœå¯èƒ½å¤šæ¬¡ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œè¿™æ ·åœ¨ä¸‹æ¬¡éœ€è¦æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä»æœ¬åœ°è¯»å–ï¼Œé¿å…é‡æ–°å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚
    * **ä¼˜åŒ–å›¾ç‰‡åŠ è½½**ï¼šé’ˆå¯¹å›¾ç‰‡èµ„æºï¼Œå¯ä»¥ä¼˜åŒ–å›¾ç‰‡çš„å°ºå¯¸å’Œè´¨é‡ï¼Œé€‰æ‹©åˆé€‚çš„å›¾ç‰‡æ ¼å¼ï¼Œæˆ–ä½¿ç”¨ä¸€äº›å›¾ç‰‡åŠ è½½ä¸ç¼“å­˜çš„æ¡†æ¶ç­‰æ–¹å¼æ¥åŠ å¿«å›¾ç‰‡çš„åŠ è½½é€Ÿåº¦ã€‚

:::

### â“å¦‚ä½•è§£å†³ä¸¤ä¸ªç½‘ç»œè¯·æ±‚ä¹‹é—´çš„ä¾èµ–

::: details ğŸ’¡

- `DispatchGroup`ï¼šåˆ©ç”¨é˜Ÿåˆ—ç»„è¿›è¡Œç½‘ç»œè¯·æ±‚ä¹‹é—´çš„ä¾èµ–ã€‚
    > å¯ä»¥æŠŠä¸¤ä¸ªç½‘ç»œè¯·æ±‚æ·»åŠ åˆ°ä¸€ä¸ªé˜Ÿåˆ—åˆ†ç»„ä¸­ï¼Œç„¶ååˆ©ç”¨é˜Ÿåˆ—ç»„çš„ `notify` æ–¹æ³•ç›‘å¬åœ¨é˜Ÿåˆ—ç»„ä¸­æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåæ‰æ‰§è¡Œçš„æ–¹æ³•ã€‚

```swift
let dispatchGroup = DispatchGroup()

dispatchGroup.enter()
doSomething {
    // when task is done
    dispatchGroup.leave()
}
dispatchGroup.enter()
doSomethingElse {
    // when another task is done
    dispatchGroup.leave()
}

dispatchGroup.notify(queue: .main) {
    print("Both asynchronous tasks are complete!")
}
```

- `Operation` æ˜¯åŸºäº `GCD` æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œæä¾›äº†æ›´å¤šçš„å¯æ§åˆ¶æ€§ã€‚
    > åˆ©ç”¨å®ƒçš„ `addDependency` æ–¹æ³•ï¼Œå¯è½»æ˜“åˆ›å»ºä¾èµ–å…³ç³»ã€‚

```swift
let queue = OperationQueue()
let operation1 = BlockOperation {
  // your network request
}
let operation2 = BlockOperation {
  // Another network request
}
// operation2 åœ¨ operation1 å®Œæˆåæ‰æ‰§è¡Œ
operation2.addDependency(operation1)

queue.addOperations([operation1,operation2], waitUntilFinished: false)
```

:::

### â“è®¾è®¡ä¸€ä¸ªç½‘ç»œæ¡†æ¶     

::: details ğŸ’¡

è®¾è®¡åŸåˆ™ï¼š

  - è§£è€¦æ€§ï¼šç½‘ç»œæ¡†æ¶ä¸ä¸šåŠ¡ä»£ç ç›¸åˆ†ç¦»ï¼Œåšåˆ°å„éƒ¨åˆ†èŒè´£æ˜ç¡®ï¼Œé™ä½å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆç¨‹åº¦ã€‚
  - æ‰©å±•æ€§ï¼šåº”å¯¹ä¸šåŠ¡æˆ–éœ€æ±‚çš„å˜åŒ–ï¼Œæœ‰è‰¯å¥½çš„æ‰©å±•æ€§æ˜¯ååˆ†é‡è¦çš„ã€‚
  - å®‰å…¨æ€§ï¼šä¿è¯æ•°æ®çš„å®‰å…¨ä¼ è¾“ï¼ŒåŒ…æ‹¬æ•°æ®åŠ å¯†ï¼Œ`HTTPS` éªŒè¯ç­‰ã€‚
  - æ˜“ç”¨æ€§ï¼šç½‘ç»œè¯·æ±‚çš„å‘èµ·å’Œç»“æœçš„å¤„ç†åº”è¯¥å°½å¯èƒ½ç®€æ´æ˜äº†ã€‚

ä¸€ä¸ªç½‘ç»œæ¡†æ¶çš„ç®€å•è®¾è®¡ï¼š

- ç½‘ç»œé…ç½®ç±» `NetworkConfiguration`ï¼š
    > ç”¨äºå¤„ç†ä¸€äº›å…¨å±€çš„ç½‘ç»œé…ç½®ï¼Œæ¯”å¦‚ `BaseURL`ã€è¶…æ—¶æ—¶é—´ã€å…¬å…±çš„è¯·æ±‚å¤´ã€å…¬å…±çš„è¯·æ±‚å‚æ•°ç­‰ã€‚

- ç½‘ç»œè¯·æ±‚ç±» `NetworkRequest`ï¼š
    > è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡çš„åŸºç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ªè¯·æ±‚çš„æ‰€æœ‰å¿…è¦è¦ç´ ï¼Œä¾‹å¦‚ï¼š`URL`ã€`HTTP`æ–¹æ³•ï¼ˆ`GET`ã€`POST`...ï¼‰ã€`HTTP`å¤´ã€è¯·æ±‚å‚æ•°ç­‰ã€‚

    ä¹Ÿå¯ä»¥åˆ›å»ºè¿™ä¸ªç±»çš„å­ç±»ï¼Œæ¯”å¦‚ `JSONNetworkRequest`ã€`FormDataNetworkRequest` ç­‰ï¼Œå®ƒä»¬è¦†ç›–å’Œæ‰©å±•åŸºç±»ä¸€äº›è¡Œä¸ºä»¥é€‚åº”ç‰¹å®šç±»å‹çš„ç½‘ç»œè¯·æ±‚ã€‚

- ç½‘ç»œä¼šè¯ç±» `NetworkSession`ï¼š
    > è¿™ä¸ªç±»ç”¨æ¥æ‰§è¡Œ `NetworkRequest`ï¼Œå®ƒä¾èµ–äº `URLSession` ç­‰ç³»ç»Ÿç»„ä»¶æ‰§è¡Œå®é™…çš„ç½‘ç»œè¯·æ±‚ã€‚è¿™ä¸ªç±»ä¹Ÿæ˜¯å¤„ç†è¯ä¹¦æŒ‘æˆ˜ï¼Œæä¾› `URLSessionDelegate` ç­‰ç³»ç»Ÿå›è°ƒçš„åœ°æ–¹ã€‚

  è¿™ä¸ªç±»é€šå¸¸æ˜¯ä¸ªå•ä¾‹å¯¹è±¡ï¼Œæ‰€æœ‰çš„ `NetworkRequest` éƒ½ç”±å®ƒæ¥è´Ÿè´£å‘é€ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ª `NetworkSession` å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡å¯ä»¥æœ‰è‡ªå·±çš„ `URLSessionConfiguration`ã€‚

- ç»“æœå¤„ç† `NetworkResponse`ï¼š
    > ç”¨ä¸€ä¸ªç±»æˆ–è€…ç»“æ„ä½“æ¥å°è£…ç½‘ç»œè¯·æ±‚çš„è¿”å›ç»“æœï¼Œå®ƒä¸€èˆ¬åŒ…å«åŸå§‹çš„ `HTTPURLResponse` å¯¹è±¡ï¼Œè¯·æ±‚æ˜¯å¦æˆåŠŸçš„æ ‡å¿—ï¼Œè¯·æ±‚è¿”å›çš„æ•°æ®æˆ–è€…æ˜¯è¯·æ±‚å¤±è´¥çš„é”™è¯¯å¯¹è±¡ã€‚

    ```swift
    struct NetworkResponse {
        var response: HTTPURLResponse?
        var data: Data?
        var error: Error?
    }
    ```

- é”™è¯¯å®šä¹‰ `NetworkError`ï¼š
    > ç”¨æ¥åœ¨ç½‘ç»œè¯·æ±‚æ—¶äº§ç”Ÿé”™è¯¯æ—¶è¿”å›ç»™è°ƒç”¨è€…å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ `Swift` çš„ `Error` åè®®æ¥å®šä¹‰ã€‚

:::

> â“é‡è¿æœºåˆ¶å¦‚ä½•å¤„ç†

::: details ğŸ’¡

  > ç½‘ç»œé‡è¿æœºåˆ¶ä¸»è¦æ˜¯åœ¨ç½‘ç»œè¿æ¥å¤±è´¥æˆ–æ–­å¼€æ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œé‡æ–°è¿æ¥ã€‚
  
  ä»¥ä¸‹æ˜¯ä¸€äº›é€šç”¨çš„å¤„ç†æ­¥éª¤ï¼š

  - ç«‹å³é‡è¿ï¼šåœ¨ç½‘ç»œè¿æ¥æ–­å¼€åç«‹å³è¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆï¼Œå› ä¸ºæœ‰å¯èƒ½æ˜¯ç½‘ç»œç¯å¢ƒé—®é¢˜ï¼Œç«‹å³é‡è¿ä¹Ÿå¯èƒ½ä¼šå¤±è´¥ã€‚

  - å»¶æ—¶é‡è¿ï¼šè¿™æ˜¯ä¸€ä¸ªæ›´å¥½çš„ç­–ç•¥ï¼Œå³åœ¨åˆæ¬¡è¿æ¥æ–­å¼€å¾Œï¼Œä¸ç«‹å³é‡è¿ï¼Œè€Œæ˜¯é‡‡ç”¨é€æ­¥å¢åŠ çš„æ—¶é—´é—´éš”è¿›è¡Œé‡è¿ï¼Œä¾‹å¦‚åˆæ¬¡è¿æ¥å¤±è´¥å 2 ç§’åè¿›è¡Œç¬¬ä¸€æ¬¡é‡è¿ï¼Œå¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œåˆ™ 4 ç§’åè¿›è¡Œç¬¬äºŒæ¬¡é‡è¿ï¼Œä¾æ¬¡ç±»æ¨ï¼Œå¢åŠ é‡è¯•é—´éš”ã€‚

  - æœ€å¤§é‡è¿æ¬¡æ•°ï¼šè®¾ç½®ä¸€ä¸ªæœ€å¤§çš„é‡è¿æ¬¡æ•°ï¼Œä¾‹å¦‚ 3 æ¬¡æˆ– 5 æ¬¡ã€‚ä¸€æ—¦é‡è¿æ¬¡æ•°è¾¾åˆ°è¿™ä¸ªå€¼ï¼Œå°±ä¸å†è¿›è¡Œé‡è¿ï¼Œè€Œæ˜¯å°†é”™è¯¯æŠ¥å‘Šç»™ç”¨æˆ·ã€‚

  - ç½‘ç»œçŠ¶æ€æ£€æŸ¥ï¼šåœ¨è¿›è¡Œé‡è¿ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥å½“å‰çš„ç½‘ç»œçŠ¶æ€ï¼Œå¦‚æœç½‘ç»œä¸å¯ç”¨ï¼Œé‚£ä¹ˆå°±ä¸è¿›è¡Œé‡è¿ã€‚

  å¤§å¤šæ•°çš„ç½‘ç»œåº“ï¼Œä¾‹å¦‚ `OkHttp`ã€`AFNetworking`ã€`Alamofire` ç­‰ï¼Œéƒ½å†…ç½®äº†è¿™ç§ç½‘ç»œé‡è¯•çš„æœºåˆ¶ï¼Œåªéœ€è¦ç®€å•çš„é…ç½®å³å¯å¯ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿‡äºé¢‘ç¹çš„é‡è¿å¯èƒ½ä¼šåŠ é‡æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å®é™…æƒ…å†µåˆç†é…ç½®é‡è¿ç­–ç•¥ã€‚

:::

> â“çŠ¶æ€ç é”™è¯¯è½¬å‘æœºåˆ¶çš„å¤„ç†

::: details ğŸ’¡

  > çŠ¶æ€ç é”™è¯¯é€šå¸¸æ˜¯æŒ‡ç½‘ç»œè¯·æ±‚å·²ç»æˆåŠŸå®Œæˆï¼Œä½†æ˜¯æœåŠ¡ç«¯è¿”å›äº†ä¸€ä¸ªé”™è¯¯çš„çŠ¶æ€ç ï¼Œä¾‹å¦‚`HTTP` 400ï¼Œ403ï¼Œ404ï¼Œ500ç­‰é”™è¯¯ã€‚å¤„ç†è¿™ç±»é”™è¯¯çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨ `HTTP` é”™è¯¯ä¸­é—´ä»¶æˆ–è€…æ‹¦æˆªå™¨ã€‚ 

ä»¥ä¸‹æ˜¯ä¸€ç§å¯èƒ½çš„å¤„ç†æ­¥éª¤ï¼š

- åˆ¤æ–­ `HTTP` çŠ¶æ€ç ï¼š
    > åœ¨æ¥æ”¶åˆ°ç½‘ç»œè¯·æ±‚çš„å“åº”åï¼Œé¦–å…ˆæ£€æŸ¥ `HTTP` çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç åœ¨ 200-299 ä¹‹é—´ï¼Œé€šå¸¸è¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚å¦åˆ™ï¼Œå°±è¡¨ç¤ºå‘ç”Ÿäº†é”™è¯¯ã€‚

- åˆ›å»ºé”™è¯¯å¯¹è±¡ï¼š
    > æ ¹æ® `HTTP` çŠ¶æ€ç ï¼Œåˆ›å»ºä¸€ä¸ªè¡¨ç¤ºå…·ä½“é”™è¯¯çš„å¯¹è±¡ã€‚è¿™ä¸ªé”™è¯¯å¯¹è±¡é€šå¸¸ä¼šåŒ…å«é”™è¯¯çš„çŠ¶æ€ç ï¼Œä»¥åŠæœåŠ¡å™¨è¿”å›çš„é”™è¯¯ä¿¡æ¯ã€‚

- ä½¿ç”¨ä¸­é—´ä»¶æˆ–è€…æ‹¦æˆªå™¨ï¼š
    > åˆ›å»ºä¸€ä¸ªé”™è¯¯å¤„ç†ä¸­é—´ä»¶æˆ–è€…æ‹¦æˆªå™¨ã€‚è¿™ä¸ªä¸­é—´ä»¶çš„ä»»åŠ¡æ˜¯åœ¨æ¯ä¸ªç½‘ç»œè¯·æ±‚å®Œæˆåï¼Œæ£€æŸ¥è¯·æ±‚çš„ç»“æœã€‚å¦‚æœå‘ç°ç»“æœä¸­åŒ…å«äº† `HTTP` é”™è¯¯ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªé”™è¯¯è½¬å‘ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚

- é”™è¯¯å¤„ç†ï¼š
    > åœ¨åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œæ³¨å†Œé”™è¯¯å¤„ç†å‡½æ•°ã€‚è¿™äº›å¤„ç†å‡½æ•°ä¼šåœ¨æ¥æ”¶åˆ°ç”±ä¸­é—´ä»¶è½¬å‘çš„é”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚æ ¹æ®é”™è¯¯çš„å…·ä½“æƒ…å†µï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†ï¼Œä¾‹å¦‚æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œæˆ–è€…é‡æ–°æ‰§è¡Œç½‘ç»œè¯·æ±‚ã€‚

:::

### â“å¦‚ä½•é¿å…ç½‘ç»œå›è°ƒåœ°ç‹±

::: details ğŸ’¡

  > ç½‘ç»œå›è°ƒåœ°ç‹±æ˜¯ç”±äºå¤šä¸ªå¼‚æ­¥ç½‘ç»œè¯·æ±‚æ“ä½œåµŒå¥—é€ æˆçš„é—®é¢˜ï¼Œé€šå¸¸çœ‹åˆ°å¾ˆå¤šåµŒå¥—çš„ "å›è°ƒ" ä»£ç ã€‚
  
- **ä½¿ç”¨Promisesæˆ–è€…Futuresåº“ï¼š** è¿™äº›åº“è®©æ‚¨å¯ä»¥å°†å¼‚æ­¥æ“ä½œè¿é”åœ¨ä¸€èµ·ï¼Œè€Œä¸ç”¨åµŒå¥—ã€‚å®ƒä»¬é€šå¸¸å¼•å…¥äº†ä¸€ç§ç±»ä¼¼äºåŒæ­¥ç¼–ç¨‹çš„ç¼–ç¨‹é£æ ¼ï¼Œä½†ä»ç„¶éé˜»å¡ã€‚

- **ä½¿ç”¨Async/Awaitæ¨¡å¼ï¼š** è¿™æ˜¯æœ€è¿‘å‡ å¹´åœ¨å¾ˆå¤šè¯­è¨€ä¸­å…´èµ·çš„ä¸€ç§æ–°çš„ç¼–ç¨‹æ¨¡å¼ï¼Œå®ƒå¯ä»¥è®©ä½ ä»¥ä¸€ç§ç±»ä¼¼åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ã€‚ä¾‹å¦‚åœ¨`JS`ã€`C#`å’Œ`Python`ä¸­éƒ½æœ‰è¿™ç§æ¨¡å¼ã€‚

- **ä½¿ç”¨Reactiveç¼–ç¨‹åº“ï¼š** å¦‚`RxJava`ï¼Œ`RxSwift`ç­‰ï¼Œå¯ä»¥è®©ä½ å°†å¼‚æ­¥æ“ä½œè¡¨ç¤ºä¸ºæ•°æ®æµï¼Œç„¶åä½ å¯ä»¥å¯¹è¿™äº›æ•°æ®æµè¿›è¡Œå„ç§å„æ ·çš„ç»„åˆå’Œå¤„ç†ã€‚

- **ä½¿ç”¨åç¨‹ï¼š** åç¨‹æ˜¯å¯ä»¥æŒ‚èµ·å’Œæ¢å¤çš„å‡½æ•°ï¼Œå¾ˆé€‚åˆç”¨æ¥ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ã€‚æ¯”å¦‚ `Kotlin` ä¸­å°±å†…ç½®äº†åç¨‹æ”¯æŒã€‚

- **å°†å›è°ƒå‡½æ•°æå–æˆå•ç‹¬çš„å‡½æ•°æˆ–è€…æ–¹æ³•ï¼š** å°½é‡é¿å…åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ç¼–å†™è¿‡å¤šçš„åµŒå¥—ä»£ç ã€‚æ¯ä¸ªå›è°ƒå‡½æ•°éƒ½å¯ä»¥æå–æˆå•ç‹¬çš„å‡½æ•°æˆ–è€…æ–¹æ³•ã€‚

- **ä½¿ç”¨äº‹ä»¶é©±åŠ¨è®¾è®¡ï¼š** å°†æ¯ä¸ªæ“ä½œä½œä¸ºäº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶ç›‘å¬å’Œè§¦å‘æ¥å®Œæˆæ“ä½œï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…å›è°ƒåœ°ç‹±ã€‚

è®°ä½ï¼Œå¹¶æ²¡æœ‰ä¸€ç§ "æœ€å¥½çš„" é€‰æ‹©ï¼Œé€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„ï¼Œæ ¹æ®ä½ å½“å‰çš„è¯­è¨€ç¯å¢ƒï¼Œç¼–ç¨‹é£æ ¼å’Œä»»åŠ¡éœ€æ±‚æ¥é€‰æ‹©é€‚åˆè‡ªå·±çš„ç­–ç•¥ã€‚

:::

### `swift` å¦‚ä½•å®ç°è‡ªå·±çš„ `Promise` 

::: details ğŸ’¡

å®ç°è‡ªå·±çš„ `Promise` å®è´¨ä¸Šæ˜¯è¦åˆ›å»ºä¸€ä¸ªå¯ä»¥åŒ…è£…å¼‚æ­¥æ“ä½œï¼Œå¹¶èƒ½å¤Ÿåœ¨ä¹‹åè·å–å…¶ç»“æœçš„å¯¹è±¡ã€‚

```swift
// ä¸€ç§ç®€å•çš„ Promise å®ç°
class Promise<Value> {
    private var value: Value?
    private var error: Error?
    private var callbacks = [(Result<Value, Error>) -> Void]()

    func fulfill(_ value: Value) {
        self.value = value
        executeCallbacksIfNeeded()
    }

    func reject(_ error: Error) {
        self.error = error
        executeCallbacksIfNeeded()
    }

    // then æ–¹æ³•è¢«è°ƒç”¨æ¥æ·»åŠ ä¸€ä¸ªå°†åœ¨ Promise è§£å†³æ—¶è°ƒç”¨çš„å›è°ƒ
    func then(_ callback: @escaping (Result<Value, Error>) -> Void) {
        callbacks.append(callback)
        executeCallbacksIfNeeded()
    }

    // ä¸€æ—¦ Promise è¢«è§£å†³(fulfilled æˆ– rejected)ï¼Œå®ƒå°±ä¼šæ‰§è¡Œæ‰€æœ‰å›è°ƒå‡½æ•°ï¼Œå¹¶æ¸…ç©ºå›è°ƒé˜Ÿåˆ—
    private func executeCallbacksIfNeeded() {
        if let value = value {
            callbacks.forEach { $0(.success(value)) }
            callbacks = []
        } else if let error = error {
            callbacks.forEach { $0(.failure(error)) }
            callbacks = []
        }
    }
}

// ä½¿ç”¨ Promise
let promise = Promise<Int>()

promise.then { result in
    switch result {
    case .success(let value):
        print("Value: \(value)")
    case .failure(let error):
        print("Error: \(error)")
    }
}

// åœ¨å…¨å±€é˜Ÿåˆ—ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œ2ç§’åï¼Œ`fulfill` æ–¹æ³•å°† `Promise` çŠ¶æ€æ›´æ”¹ä¸ºå·²è§£å†³ï¼Œå¹¶æ‰“å°â€œValue: 5â€ã€‚
DispatchQueue.global().async {
    sleep(2) // simulate async operation
    promise.fulfill(5)
}
```

æé†’ä¸€ä¸‹ï¼Œè¿™åªæ˜¯ä¸€ç§åŸºç¡€çš„å®ç°æ–¹å¼ï¼Œå®é™…ä¸Šå¯èƒ½éœ€è¦è¿½åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚é”™è¯¯å¤„ç†ã€é“¾å¼è°ƒç”¨å’Œå¹¶å‘æ§åˆ¶ç­‰ã€‚

:::

------

## Web

### â“`WKWebView` ç¼“å­˜å’Œæ¸…ç†ç¼“å­˜çš„æ–¹æ³•

::: details ğŸ’¡

```swift
// ç¦æ­¢ç¼“å­˜
let url = URL(string: "https://www.website.com")!
var request = URLRequest(url: url)
request.cachePolicy = .reloadIgnoringLocalCacheData
wkWebView.load(request)

// æ¸…é™¤ç¼“å­˜
let dateFrom = Date(timeIntervalSince1970: 0)
var websiteDataTypes = Set<String>()
websiteDataTypes.insert(WKWebsiteDataTypeDiskCache)
websiteDataTypes.insert(WKWebsiteDataTypeMemoryCache)
WKWebsiteDataStore.default().removeData(ofTypes: websiteDataTypes, modifiedSince: dateFrom, completionHandler: {})
```

æ³¨æ„ï¼šæ¸…ç†ç¼“å­˜æ“ä½œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´å»å®Œæˆï¼Œç‰¹åˆ«æ˜¯å½“ç£ç›˜ä¸­çš„ç¼“å­˜æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œåº”å½“å¯¹å®ƒè¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚

:::