---
title: éŸ³è§†é¢‘
icon: hashtag

index: true

---

<!-- more -->

## reference

- [RTC-Developer](https://github.com/RTC-Developer)
- [2021.03.02 åœ¨çº¿æ•™å®¤ iOS ç«¯å£°éŸ³é—®é¢˜ç»¼åˆè§£å†³æ–¹æ¡ˆ](https://juejin.cn/post/6934987607088726053#heading-12)

<!-- ç¼–ç æ ¼å¼ -->

- [H264 vs H265](https://mattgadient.com/x264-vs-x265-vs-vp8-vs-vp9-examples/)
- [2019.07.05 iOSè§†é¢‘å‹ç¼©ç¬”è®°](https://www.jianshu.com/p/4f69c22c6dce)
- [File Size Issue with HEVC Encoder on iOS 11](https://medium.com/@jpetrichsr/file-size-issue-with-hevc-encoder-on-ios-11-f50104ace54f)

<!-- è¾¹ä¸‹è¾¹æ’­ -->

- [2021.04.21 å¼€å‘æ’­æ”¾å™¨æ¡†æ¶ä¹‹è¾¹ä¸‹è¾¹æ’­è¾¹å­˜æ–¹æ¡ˆ](https://github.com/yangKJ/KJPlayerDemo/wiki/%E5%BC%80%E5%8F%91%E6%92%AD%E6%94%BE%E5%99%A8%E6%A1%86%E6%9E%B6%E4%B9%8B%E8%BE%B9%E4%B8%8B%E8%BE%B9%E6%92%AD%E8%BE%B9%E5%AD%98%E6%96%B9%E6%A1%88)
- [2020.02.05 Understanding AVAssetResourceLoaderDelegate](https://github.com/2ZGroupSolutionsArticles/Article_EZ002)
- [2019.12.03 iOS AVPlayer è§†é¢‘ç¼“å­˜çš„è®¾è®¡ä¸å®ç°](http://chuquan.me/2019/12/03/ios-avplayer-support-cache/)
- [2019.04.23 AVPlayer è¾¹ä¸‹è¾¹æ’­ä¸æœ€ä½³å®è·µ](https://zltunes.github.io/2019/04/23/avplayer-best-practice/)
- [iOS å®ç°åœ¨çº¿è§†é¢‘è¾¹ä¸‹è¾¹æ’­](https://github.com/Kaibin/YYVideoPlayer)
- [2018.08.31 iOSçŸ­è§†é¢‘æ’­æ”¾ç¼“å­˜ä¹‹é“](https://segmentfault.com/a/1190000016228456)
    > [ShortMediaCache](https://github.com/dangercheng/ShortMediaCache)
- [2018.02.28 AVPlayer åˆä½“éªŒä¹‹è¾¹ä¸‹è¾¹æ’­ä¸è§†é¢‘ç¼“å­˜](http://xferris.cn/avplayer_cache/)
- [2017.06.13 Swift å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ VGPlayer](https://www.jianshu.com/p/1680978e1a7e)
    > [VGPlayer](https://github.com/VeinGuo/VGPlayer)
- [2017.03.31 å¯èƒ½æ˜¯ç›®å‰æœ€å¥½çš„ `AVPlayer` éŸ³è§†é¢‘ç¼“å­˜æ–¹æ¡ˆ](https://mp.weixin.qq.com/s/v1sw_Sb8oKeZ8sWyjBUXGA?#%23)
    > [VIMediaCache](https://github.com/vitoziv/VIMediaCache)
- [2016.09.03 Implementing AVAssetResourceLoaderDelegate: a How-To Guide](https://jaredsinclair.com/2016/09/03/implementing-avassetresourceload.html)
- [2016.07.12 CachingPlayerItem](https://github.com/neekeetab/CachingPlayerItem)
- [2016.05.24 iOSéŸ³é¢‘æ’­æ”¾ (ä¹)ï¼šè¾¹æ’­è¾¹ç¼“å­˜](https://msching.github.io/blog/2016/05/24/audio-in-ios-9/)

------

## æ¡†æ¶

### â“MetalKit

::: details ğŸ’¡

> `MetalKit`ï¼šAppleå¼€å‘çš„ä¸€ä¸ªä¸“é—¨ç”¨äº `iOS` å’Œ `macOS` è®¾å¤‡ä¸Šæ”¯æŒ `Metal` ç¼–ç¨‹æ¥å£çš„åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚æä¾›çš„ä¸ºäº†æå‡å›¾å½¢å’Œè®¡ç®—ä»»åŠ¡æ€§èƒ½çš„ç¡¬ä»¶åŠ é€Ÿ `API`ã€‚ä¸ `OpenGL` å’Œ `OpenGL ES` ç›¸æ¯”ï¼Œ`Metal` æä¾›äº†æ›´æ¥è¿‘ç¡¬ä»¶çš„ `API`ï¼Œå› æ­¤å¯ä»¥æä¾›æ›´é«˜çš„æ€§èƒ½å’Œæ›´ä½çš„å»¶è¿Ÿã€‚

ä¸»è¦åŠŸèƒ½ï¼š

  - å›¾å½¢æ¸²æŸ“ï¼šå¯ä»¥ç”¨äºç»˜åˆ¶ `2D` å’Œ `3D` å›¾å½¢ï¼Œå®ç°å›¾å½¢æ¸²æŸ“çš„ä»»åŠ¡ï¼Œå¦‚æ¸¸æˆå›¾å½¢ã€ç§‘å­¦è®¡ç®—å¯è§†åŒ–ç­‰ã€‚
  
  - åŠ è½½å’Œå¤„ç†çº¹ç†ï¼šå¯ä»¥ç”¨äºåŠ è½½å›¾åƒæ–‡ä»¶åˆ° `Metal` çº¹ç†ï¼Œä»¥åŠçº¹ç†ä¿¡æ¯çš„æŸ¥è¯¢å’Œä½¿ç”¨ã€‚

  - åŠ è½½ `3D` æ¨¡å‹ï¼šå¯ä»¥åŠ è½½ `3D` æ¨¡å‹æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸º `Metal` å¯ç†è§£çš„æ•°æ®æ ¼å¼ã€‚

  - æ˜¾ç¤ºç®¡ç†ï¼šæä¾›äº†ç”¨äºåœ¨ `iOS` å’Œ `macOS` ä¸Šåˆ›å»ºå’Œç®¡ç† `Metal` ç»˜å›¾å±‚çš„å·¥å…·ã€‚

  - å°è£…å¸¸è§ `Metal` æ•°æ®ç»“æ„ï¼šä¾‹å¦‚çŸ©é˜µå’Œå‘é‡ç­‰ï¼Œæ–¹ä¾¿ç”¨äºå›¾å½¢å’Œè®¡ç®—ä»»åŠ¡ã€‚

  - æ€§èƒ½è°ƒè¯•å·¥å…·ï¼šåŒ…å«äº†ç”¨äºç›‘æ§å’Œä¼˜åŒ– `Metal` åº”ç”¨æ€§èƒ½çš„å·¥å…·ã€‚

:::

### â“GPUImage

::: details ğŸ’¡

> `GPUImage` æ˜¯å¼€æºçš„å›¾åƒå’Œè§†é¢‘å¤„ç†æ¡†æ¶ï¼Œå¯¹è§†é¢‘å¤„ç†ã€äººåƒç¾é¢œã€å›¾åƒå¤„ç†ã€æ»¤é•œå¤„ç†ç­‰é¢†åŸŸæœ‰å¹¿æ³›åº”ç”¨ã€‚

  - åŠŸèƒ½å¼ºå¤§ï¼š`GPUImage` ä¸­å†…ç½®äº†è®¸å¤šæ»¤é•œï¼Œç”¨æˆ·å¯ä»¥å¯¹è§†é¢‘å’Œå›¾ç‰‡è¿›è¡Œå„ç§å„æ ·çš„åº”ç”¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°è‡ªå®šä¹‰çš„æ»¤é•œã€‚

  - é«˜æ€§èƒ½ï¼š`GPUImage` æ˜¯åŸºäº `OpenGL ES` æ„å»ºçš„ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨è®¾å¤‡çš„ `GPU` å¤„ç†å¤§é‡è®¡ç®—ä»»åŠ¡ï¼Œæ¯”ä½¿ç”¨ `CPU` å¤„ç†æ•ˆç‡æ›´é«˜ï¼Œå¯¹å®æ—¶è§†é¢‘å¤„ç†åœºæ™¯éå¸¸æœ‰åˆ©ã€‚

  - æ˜“ç”¨æ€§ï¼š`GPUImage` çš„ `API` è®¾è®¡å°è£…å¾—ç›¸å½“å®Œå–„ï¼Œä½¿ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼ŒåŒæ—¶æ–‡æ¡£å…¨é¢ï¼Œä¸Šæ‰‹å®¹æ˜“ã€‚

  - å¯Œæœ‰æ‰©å±•æ€§ï¼š`GPUImage` ä¹Ÿå…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ»¤é•œï¼Œç”¨æˆ·å¯ä»¥å®ç°è‡ªå·±çš„è®¾è®¡ï¼Œå…·æœ‰å¾ˆé«˜çš„çµæ´»æ€§ã€‚

  - è·¨å¹³å°ï¼š`GPUImage` æ—¢æœ‰é€‚ç”¨äº `iOS` çš„ç‰ˆæœ¬ï¼Œä¹Ÿæœ‰é€‚ç”¨äº `Android` çš„ç‰ˆæœ¬ï¼Œè¿™å¤§å¤§æ–¹ä¾¿äº†åœ¨å¤šå¹³å°å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€è‡´æ€§ã€‚

:::

### â“OpenGL vs OpenGL ES

::: details ğŸ’¡

> `OpenGL` (Open Graphics Library) å’Œ `OpenGL ES` (OpenGL for Embedded Systems) éƒ½æ˜¯ç”¨äºæ¸²æŸ“äºŒç»´å’Œä¸‰ç»´å›¾å½¢çš„è·¨å¹³å° `API` çš„ï¼Œç”± `Khronos Group` åˆ¶å®šå’Œç»´æŠ¤ã€‚è¿™ç§èƒ½åŠ›ä½¿å¾— `OpenGL` æˆä¸ºè™šæ‹Ÿç°å®ã€æ¸¸æˆã€ä¸‰ç»´ç»˜å›¾ç­‰é¢†åŸŸçš„æ ‡å‡†è§„èŒƒã€‚

ä¸»è¦åŒºåˆ«ï¼š
  > `OpenGL ES` æ˜¯ä¸“é—¨ä¸ºåµŒå…¥å¼è®¾å¤‡ï¼ˆä¾‹å¦‚æ‰‹æœºæˆ–è€…åµŒå…¥å¼ç³»ç»Ÿï¼‰è®¾è®¡çš„ï¼Œç›¸æ¯” `OpenGL`ï¼Œ`OpenGL ES` åˆ é™¤äº†ä¸€äº›ä¸å¸¸ç”¨æˆ–è€…ä¸é€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„ç‰¹æ€§ä»¥å‡å°‘ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œä»è€Œåœ¨ä¿è¯æ€§èƒ½çš„åŸºç¡€ä¸Šè¾¾åˆ°å¯¹ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ã€‚

  - åŠŸèƒ½å’Œå¤æ‚æ€§ï¼š`OpenGL` æ›´ä¸ºå…¨é¢å’Œå¤æ‚ï¼Œæœ‰æ›´å¤šçš„å‡½æ•°å’Œé€‰é¡¹å¯ä¾›ä½¿ç”¨ã€‚è€Œ `OpenGL ES` æ˜¯ä¸€ä¸ªæ›´ç²¾ç®€çš„ç‰ˆæœ¬ï¼Œå»æ‰äº†ä¸€äº›åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šä¸å¸¸éœ€è¦æˆ–è€…æ€§èƒ½æ¶ˆè€—è¾ƒå¤§çš„åŠŸèƒ½ï¼Œå¦‚ç«‹æ–¹ä½“è´´å›¾ã€å¤šçº¹ç†ç­‰ã€‚

  - ç³»ç»Ÿèµ„æºå ç”¨ï¼šç”±äº `OpenGL ES` è®¾è®¡å¾—æ›´ä¸ºç²¾ç®€ï¼Œå› æ­¤å®ƒå¯¹ç³»ç»Ÿå†…å­˜å’Œå¤„ç†å™¨çš„éœ€æ±‚é€šå¸¸è¾ƒ `OpenGL` æ›´ä½ã€‚
    
  - å¹³å°æ”¯æŒï¼š`OpenGL` å¹¿æ³›ç”¨äºæ¡Œé¢ç³»ç»Ÿå’Œé«˜æ€§èƒ½è®¡ç®—è®¾å¤‡ï¼Œå¦‚ `Windows`ï¼Œ`macOS` å’Œ `Linux` ç³»ç»Ÿã€‚è€Œ `OpenGL ES` åˆ™ä¸»è¦ç”¨äºåµŒå…¥å¼è®¾å¤‡å’Œç§»åŠ¨è®¾å¤‡ï¼Œå¦‚ `Android`ã€`iOS` å’ŒæŸäº›æ¸¸æˆæœºã€‚

  - ç‰ˆæœ¬æ›´æ–°ï¼š`OpenGL ES` çš„ç‰ˆæœ¬æ›´æ–°é€šå¸¸ä¼šè·Ÿéš `OpenGL` çš„æ›´æ–°ï¼Œä½†åœ¨æŸäº›ç‰¹æ€§ä¸Šå¯èƒ½ä¼šæœ‰å¼‚æ­¥ã€‚ä¾‹å¦‚ï¼Œ`OpenGL ES 3.0` æ˜¯åœ¨ `OpenGL 4.2` ä¹‹åæ¨å‡ºçš„ï¼Œä½†å¹¶æœªåŒ…å« `OpenGL 4.2` çš„å…¨éƒ¨æ–°ç‰¹æ€§ã€‚


`OpenGL` å¤„ç†æµç¨‹ï¼š
  > æ³¨æ„ï¼š`OpenGL` æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå®ƒä¼šä¿å­˜è®¾ç½®çš„æ‰€æœ‰çŠ¶æ€ï¼Œç›´åˆ°å°†å…¶æ”¹å˜ä¸ºæ­¢ã€‚å› æ­¤ï¼Œåœ¨ç»˜åˆ¶è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¤„ç† `OpenGL` çŠ¶æ€ä»¥é˜²æ­¢ä»å‰çš„è®¾ç½®å½±å“åˆ°åé¢çš„æ¸²æŸ“ã€‚
  
  - **é¡¶ç‚¹å¤„ç†**ï¼šåŸå§‹é¡¶ç‚¹åæ ‡ä¼šé€šè¿‡ä¸€ç³»åˆ—çš„æ“ä½œå˜æ¢åˆ°å±å¹•åæ ‡ç³»ã€‚è¿™äº›æ“ä½œåŒ…æ‹¬å˜æ¢ï¼ˆæ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»ï¼‰ã€è£å‰ªï¼ˆå»é™¤ä¸åœ¨è§†é‡å†…çš„é¡¶ç‚¹ï¼‰ç­‰ã€‚å¯ä»¥ç”¨è‡ªå®šä¹‰çš„é¡¶ç‚¹ç€è‰²å™¨ï¼ˆ`Vertex Shader`ï¼‰ç¨‹åºè¿›è¡Œå¤„ç†çš„ã€‚

  - **å›¾å…ƒè£…é…**ï¼šåœ¨æ‰€æœ‰çš„é¡¶ç‚¹è¢«å¤„ç†å `OpenGL` å¼€å§‹å°†è¿™äº›é¡¶ç‚¹è£…é…æˆå›¾å½¢åŸºå…ƒï¼ˆå¦‚ç‚¹ã€çº¿ã€é¢ï¼‰ã€‚

  - **å…‰æ …åŒ–**ï¼šå›¾å…ƒåœ¨å±å¹•ä¸Šè¢«åˆ’åˆ†ä¸ºä¸€ç³»åˆ—çš„ç‰‡å…ƒï¼ˆåƒç´ ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšå…‰æ …åŒ–ã€‚
  
  - **ç‰‡å…ƒå¤„ç†**ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œç‰‡å…ƒç€è‰²å™¨ï¼ˆ`Fragment Shader`ï¼‰ä¼šå¤„ç†æ¯ä¸ªç‰‡å…ƒï¼Œæ¯”å¦‚å¯¹ç‰‡å…ƒæ·»åŠ é¢œè‰²ã€çº¹ç†æˆ–æ‰§è¡Œæ›´å¤æ‚çš„æ•ˆæœã€‚
  
  - **æ·±åº¦æµ‹è¯•å’Œæ··åˆ**ï¼š`OpenGL` å¯¹è¿™äº›ç‰‡å…ƒè¿›è¡Œæ·±åº¦æµ‹è¯•ï¼Œåˆ¤æ–­å“ªäº›ç‰‡å…ƒæ˜¯çœŸæ­£å¯è§çš„ã€‚ä¸Šé¢çš„æ‰€æœ‰é˜¶æ®µéƒ½åªç”¨æ¥ç”Ÿæˆä¸€å †ç‰‡å…ƒï¼Œä»¥åŠæ¯ä¸ªç‰‡å…ƒå¯¹åº”çš„æ·±åº¦å€¼ã€‚æœ€åå¦‚æœå¼€å¯æ··åˆï¼Œè¿˜ä¼šæ ¹æ®æºä¸ç›®æ ‡çš„ `alpha` å€¼æ¥è®¡ç®—æœ€åçš„é¢œè‰²å€¼ã€‚

:::

### â“AVFoundation vs GPUImage vs OpenGL ES vs MetalKit

::: details ğŸ’¡

  - `AVFoundation`ï¼š`Apple` å¼€å‘çš„ä¸€ä¸ªç”¨äºå¤„ç†éŸ³é¢‘å’Œè§†é¢‘çš„æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸€å¥—ä¸°å¯Œçš„ `API` å’Œå·¥å…·ï¼Œå¯ä»¥ç”¨äºæ’­æ”¾å’Œåˆ›å»ºéŸ³é¢‘å’Œè§†é¢‘ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¤„ç†å®æ—¶çš„éŸ³é¢‘è§†é¢‘æµå’Œç®¡ç†è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒè§†é¢‘ç¼–è¾‘ï¼Œè§†é¢‘æ•è·ï¼Œè§†é¢‘è§£ç ç­‰åŠŸèƒ½ã€‚

  - `GPUImage`ï¼šä¸€ä¸ªå¼€æºçš„å›¾åƒå’Œè§†é¢‘å¤„ç†åº“ï¼Œå®ƒåˆ©ç”¨ `GPU`ï¼ˆå›¾å½¢å¤„ç†å™¨ï¼‰æ¥å¤„ç†å›¾åƒå’Œè§†é¢‘ï¼Œå› æ­¤åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶èƒ½å®ç°éå¸¸é«˜çš„æ•ˆç‡ã€‚å®ƒæä¾›äº†å¤§é‡çš„å†…ç½®æ»¤é•œå’Œæ•ˆæœï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ»¤é•œã€‚

  - `OpenGL ES`ï¼šä¸€ä¸ªç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„ `2D` å’Œ `3D` å›¾å½¢APIï¼ˆå¦‚æ‰‹æœºï¼Œå¹³æ¿ç”µè„‘ç­‰ï¼‰ã€‚ç”± `Khronos Group` å¼€å‘ï¼Œå¹¶ä¸”æ˜¯ `OpenGL` çš„å­é›†ã€‚å®ƒè¢«å¹¿æ³›ç”¨äºæ¸¸æˆå’Œå…¶ä»–éœ€è¦é«˜æ•ˆæ¸²æŸ“ `3D` å›¾å½¢çš„åº”ç”¨ã€‚

  - `MetalKit`ï¼š`Apple` æä¾›çš„ä¸€ä¸ªç”¨äºåœ¨ `iOS` è®¾å¤‡ä¸Šæ›´é«˜æ•ˆåœ°ç›´æ¥è®¿é—® `GPU` çš„æ¡†æ¶ã€‚å®ƒè¢«è®¾è®¡ç”¨äºåˆ›å»ºå¯¹æ¸²æŸ“æ€§èƒ½æœ‰é«˜è¦æ±‚çš„å›¾å½¢åº”ç”¨ï¼Œä¾‹å¦‚æ¸¸æˆã€‚æ¯”èµ· `OpenGL ES` æä¾›äº†æ›´ä½çš„ `API` æŠ½è±¡å±‚ï¼Œè¿™è®©å¼€å‘è€…èƒ½å¤Ÿæ›´ç›´æ¥åœ°æ§åˆ¶ç¡¬ä»¶ï¼Œå› æ­¤èƒ½å¤Ÿè·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚

:::

### â“FFmpeg

::: details ğŸ’¡

> `FFmpeg`æ˜¯ä¸€ä¸ªå¼€æºçš„éŸ³è§†é¢‘å¤„ç†è½¯ä»¶ï¼Œç”¨äºå¤„ç†éŸ³é¢‘ã€è§†é¢‘ã€æ•°æ®ç­‰å¤šåª’ä½“å†…å®¹ã€‚å®ƒæä¾›äº†å½•åˆ¶ã€è½¬æ¢å’ŒæµåŒ–éŸ³è§†é¢‘çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚

ä¸€å¥—å¯ä»¥ç”¨æ¥è§£ç ã€ç¼–ç ã€ä¼ è¾“å¤šåª’ä½“æ•°æ®çš„åº“ï¼š

  - `libavcodec`ï¼šç”¨äºç¼–ç /è§£ç çš„åº“ï¼Œæ”¯æŒä¼—å¤šçš„ç¼–ç è§£ç å™¨ã€‚
  - `libavformat`ï¼šç”¨äºå¤šåª’ä½“æ•°æ®å°è£…å’Œè§£å°è£…çš„åº“ï¼Œæ”¯æŒä¼—å¤šçš„å°è£…å’Œè§£å°è£…æ ¼å¼ï¼Œå¦‚ `MP4ã€FLVã€MOV` ç­‰ã€‚
  - `libavutil`ï¼šåŒ…å«è®¸å¤šå·¥å…·å‡½æ•°çš„åº“ï¼Œä¸ºå…¶ä»– `FFmpeg` çš„åº“æˆ–åº”ç”¨ç¨‹åºæä¾›ä½¿ç”¨ã€‚
  - `libavfilter`ï¼šè§†é¢‘å’ŒéŸ³é¢‘è¿‡æ»¤å™¨çš„åº“ï¼Œå¯ç”¨äºå›¾åƒçš„ç¼©æ”¾ï¼Œè£å‰ªï¼Œé¢œè‰²è½¬æ¢ç­‰ã€‚
  - `libswscale`ï¼šå¤„ç†å›¾åƒç¼©æ”¾å’Œåƒç´ æ ¼å¼è½¬æ¢çš„åº“ã€‚
  - `libswresample`ï¼šå¤„ç†éŸ³é¢‘é‡é‡‡æ ·ã€é‡æ··åˆå’Œæ ¼å¼è½¬æ¢çš„åº“ã€‚

ä¸€äº›å¯¹éŸ³è§†é¢‘æ•°æ®å¤„ç†çš„å‘½ä»¤è¡Œå·¥å…·ï¼š

  - `ffmpeg`ï¼šå¯ä»¥å¯¹å¤šåª’ä½“æ•°æ®è¿›è¡Œè½¬ç ï¼Œæˆªå–è§†é¢‘ç‰‡æ®µï¼Œæå–éŸ³é¢‘ï¼Œè¿›è¡Œè§†é¢‘å‰ªè¾‘ç­‰ã€‚
  - `ffplay`ï¼šå¯ä»¥æ’­æ”¾éŸ³é¢‘å’Œè§†é¢‘ã€‚
  - `ffprobe`ï¼šå¯ä»¥æŸ¥çœ‹å¤šåª’ä½“æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚
    
    ```shell
    # å°†ä¸€ä¸ª mp4 è§†é¢‘è½¬ç ä¸º avi æ ¼å¼
    ffmpeg -i input.mp4 output.avi
    ```

:::


### â“OpenCV

::: details ğŸ’¡

> `OpenCV`(Open Source Computer Vision)ï¼šä¸€ä¸ªå¼€æºçš„è®¡ç®—æœºè§†è§‰åº“ã€‚åŒ…å«äº†å¤§é‡çš„è®¡ç®—æœºè§†è§‰ã€æ•°å­—å›¾åƒå¤„ç†ä»¥åŠä¸€äº›é€šç”¨çš„ç§‘å­¦è®¡ç®—çš„ç›¸å…³çš„å‡½æ•°åº“ã€‚æ”¯æŒå¤šç§è¯­è¨€ï¼Œå¦‚ `C++ã€Pythonã€Java` ç­‰ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ `Windowsã€Linuxã€macOSã€iOSã€Android` ç­‰å¤šç§æ“ä½œç³»ç»Ÿã€‚

æ ¸å¿ƒæ¨¡å—ï¼š

  - å›¾åƒå¤„ç†ï¼šåŒ…æ‹¬æ»¤æ³¢ã€é”åŒ–ã€è‰²å½©ç©ºé—´è½¬æ¢ã€ç›´æ–¹å›¾å‡è¡¡åŒ–ç­‰ã€‚
  - å›¾åƒåˆ†å‰²ï¼šå¦‚è¾¹ç¼˜æ£€æµ‹å’Œåˆ‡å‰²ç®—æ³•ã€‚
  - è§†é¢‘åˆ†æï¼šæ¯”å¦‚å…‰æµæ³•ã€èƒŒæ™¯/å‰æ™¯åˆ†å‰²ç­‰ã€‚
  - å¯¹è±¡è¯†åˆ«ï¼šæ¯”å¦‚é¢éƒ¨å’Œçœ¼ç›è¯†åˆ«ã€‚
  - æœºå™¨å­¦ä¹ ï¼šæ”¯æŒ `KMeans`ã€`SVM`ã€ç¥ç»ç½‘ç»œç­‰ç®—æ³•ã€‚

```py
# ä½¿ç”¨ OpenCV è¿›è¡Œé¢éƒ¨å’Œçœ¼ç›è¯†åˆ«

import cv2
# åŠ è½½ Haar çº§è”åˆ†ç±»å™¨çš„ XML æ–‡ä»¶
face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')
eye_cascade = cv2.CascadeClassifier('haarcascade_eye.xml')
# è¯»å–å›¾ç‰‡
img = cv2.imread('your_face_image.jpg')
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
# æ£€æµ‹å›¾åƒä¸­çš„é¢éƒ¨å’Œçœ¼ç›
faces = face_cascade.detectMultiScale(gray, 1.3, 5)
for (x,y,w,h) in faces:
    img = cv2.rectangle(img,(x,y),(x+w,y+h),(255,0,0),2)
    roi_gray = gray[y:y+h, x:x+w]
    roi_color = img[y:y+h, x:x+w]
    eyes = eye_cascade.detectMultiScale(roi_gray)
    for (ex,ey,ew,eh) in eyes:
        cv2.rectangle(roi_color,(ex,ey),(ex+ew,ey+eh),(0,255,0),2)

cv2.imshow('img',img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

:::

------

## ç¼–ç 

### â“ç¡¬ç¼–ç  vs è½¯ç¼–ç 

::: details ğŸ’¡

ç¡¬ç¼–ç ï¼ˆç¡¬ä»¶ç¼–ç ï¼‰ï¼šé€šè¿‡ç¡¬ä»¶æ¥è¿›è¡Œåª’ä½“æ•°æ®çš„ç¼–ç å’Œè§£ç ã€‚
  > è¿™äº›ç¡¬ä»¶åŒ…æ‹¬ç”¨äºç¼–ç è§£ç ï¼ˆ`Codec`ï¼‰çš„ä¸“é—¨èŠ¯ç‰‡æˆ–è€… `GPU` ç­‰ã€‚
  
  - ä¼˜ç‚¹ï¼šç¡¬ç¼–ç é€šå¸¸æ¯”è½¯ç¼–ç å¿«ï¼Œå› ä¸ºç¡¬ä»¶ç¼–ç å™¨æ˜¯ä¸“é—¨è®¾è®¡ç”¨äºç¼–ç /è§£ç çš„ï¼Œå®ƒä»¬çš„ç®—æ³•ä¼˜åŒ–çº§åˆ«æ¯”è½¯ä»¶æ›´é«˜ï¼›æ¶ˆè€—çš„ `CPU` èµ„æºè¾ƒå°‘ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å·¥ä½œéƒ½åœ¨ç‰¹å®šçš„ç¡¬ä»¶ä¸Šæ‰§è¡Œã€‚
  - ç¼ºç‚¹ï¼šçµæ´»æ€§å·®ï¼Œä¾èµ–äºç¡¬ä»¶çš„èƒ½åŠ›ï¼Œé’ˆå¯¹ä¸ªåˆ«è§†é¢‘ç¼–ç /è§£ç æŠ€æœ¯å¯èƒ½æ²¡æœ‰ç­‰æ•ˆçš„ç¡¬ä»¶æ”¯æŒã€‚

è½¯ç¼–ç ï¼ˆè½¯ä»¶ç¼–ç ï¼‰ï¼šåœ¨ `CPU` ä¸Šè¿›è¡Œç¼–ç å’Œè§£ç çš„è¿‡ç¨‹ã€‚
  > è½¯ç¼–ç ä¸ä¾èµ–äºç‰¹å®šçš„ç¡¬ä»¶ï¼Œè€Œæ˜¯ä¾èµ– `CPU` å’Œç¼–ç /è§£ç è½¯ä»¶ï¼ˆä¾‹å¦‚`FFmpeg`ï¼Œ`x264`ç­‰ï¼‰ã€‚
  
  - ä¼˜åŠ¿ï¼šçµæ´»æ€§é«˜ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°ä¼˜åŒ–å’Œå‡çº§ï¼Œä»¥é€‚åº”æ–°çš„ç¼–ç æ ‡å‡†å’Œæ ¼å¼ã€‚è€Œä¸”é€šå¸¸è½¯ç¼–ç åœ¨è§†é¢‘è´¨é‡å’Œå‹ç¼©æ•ˆç‡æ–¹é¢è¡¨ç°æ›´å¥½ã€‚
  - ç¼ºç‚¹ï¼šè€—è´¹çš„ `CPU` èµ„æºè¾ƒå¤šï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿååº”æ…¢æˆ–è€…å…¶ä»–ä»»åŠ¡å˜æ…¢ã€‚

åº”ç”¨ï¼šé€‰æ‹©ç¡¬ç¼–ç å’Œè½¯ç¼–ç éœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚å†³å®šã€‚

  - å¦‚æœæ˜¯åœ¨ç”µæ± ä¾›ç”µçš„è®¾å¤‡ä¸Šè¿›è¡Œå®æ—¶è§†é¢‘æµå¤„ç†ï¼Œå¯èƒ½æ›´å€¾å‘äºä½¿ç”¨ç¡¬ç¼–ç ï¼Œå› ä¸ºå®ƒå¯¹ç”µæ± ä½¿ç”¨çš„å½±å“æ›´å°ã€‚
  - å¦‚æœéœ€è¦æœ€é«˜çš„è§†é¢‘è´¨é‡å’Œæœ€å°çš„æ–‡ä»¶å¤§å°ï¼Œå¯èƒ½ä¼šé€‰æ‹©è½¯ç¼–ç ã€‚

:::

### â“FBOã€H264ã€H265

::: details ğŸ’¡

  - `FBO`(Frame Buffer Object): å¸§ç¼“å†²å¯¹è±¡ï¼Œæ˜¯ `OpenGL` çš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨æ¥ç®¡ç†å¸§ç¼“å†²åŒºã€‚
    > å¸§ç¼“å†²åŒºä¿å­˜äº†æ¸²æŸ“æ“ä½œçš„ä¸­é—´æˆ–æœ€ç»ˆç»“æœã€‚ä½¿ç”¨ `FBO` å¯ä»¥æŠŠæ¸²æŸ“ç»“æœä¿å­˜åˆ°ä¸€ä¸ªçº¹ç†å¯¹è±¡ä¸­ï¼Œåç»­å¯ä»¥ç›´æ¥ç”¨æ¥è¿›è¡Œæ¸²æŸ“ã€‚`FBO` è®©å¼€å‘è€…æ›´æ–¹ä¾¿çš„åœ¨ `GPU` ä¸Šè¿›è¡Œæ¸²æŸ“ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç”¨æ¥å¤„ç†å›¾ç‰‡å’Œè§†é¢‘ã€‚

  - `H264`: ä¸€ç§è§†é¢‘ç¼–è§£ç æ ‡å‡†ï¼Œä¹Ÿå« `AVC`ï¼ˆAdvanced Video Codingï¼Œé«˜çº§è§†é¢‘ç¼–ç ï¼‰ã€‚
    > `H264` æä¾›äº†ä¸€ç§é«˜è´¨é‡ã€æœ‰æ•ˆçš„è§†é¢‘å‹ç¼©æ–¹å¼ï¼Œå®ƒæ¯”ä¹‹å‰çš„ç¼–è§£ç æ ‡å‡†å¦‚ `MPEG-2` å’Œ `MPEG-4` è¦å¥½å¾ˆå¤šã€‚`H264` ç¼–è§£ç å™¨åœ¨é‡‡é›†å’Œæ’­æ”¾è§†é¢‘æ—¶ä¼šå¹¿æ³›ç”¨åˆ°ï¼Œå®ƒæ˜¯ç›®å‰äº’è”ç½‘ä¸Šçš„ä¸»æµè§†é¢‘ç¼–ç æ ¼å¼ã€‚

  - `H265`: `H264` çš„åç»§è€…ï¼Œä¹Ÿå« `HEVC`ï¼ˆHigh Efficiency Video Codingï¼Œé«˜æ•ˆè§†é¢‘ç¼–ç ï¼‰ã€‚
    > `H265` æä¾›äº†æ›´é«˜çš„æ•°æ®å‹ç¼©ç‡ï¼Œå®ƒå¯ä»¥åœ¨ä¿æŒç›¸åŒè§†é¢‘è´¨é‡çš„åŒæ—¶ï¼Œå°†æ–‡ä»¶å¤§å°å‹ç¼©åˆ° `H264` çš„ä¸€åŠå·¦å³ï¼Œæˆ–è€…ç”¨ç›¸åŒçš„æ–‡ä»¶å¤§å°æä¾›æ›´å¥½çš„è§†é¢‘è´¨é‡ã€‚`H265` çš„å¤æ‚åº¦ä¹Ÿæ›´é«˜ï¼Œæ‰€ä»¥éœ€è¦æ›´å¤šçš„ `CPU` å’Œ `GPU` èµ„æºæ¥ç¼–è§£ç ã€‚

:::

### â“è®¡ç®— PCM æ—¶é•¿

::: details ğŸ’¡

> `PCM`ï¼ˆPulse Code Modulationï¼‰æ˜¯ä¸€ç§æ•°å­—åŒ–éŸ³é¢‘çš„æ–¹å¼ã€‚

`PCM` æ•°æ®æ—¶é•¿è®¡ç®—å…¬å¼ï¼š`æ—¶é—´ï¼ˆç§’ï¼‰= æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰ / (é‡‡æ ·ç‡ * ä½æ·±åº¦/8 * é€šé“æ•°)`

  - æ•°æ®å¤§å°ï¼š`PCM` æ–‡ä»¶çš„å¤§å°(å­—èŠ‚ï¼‰
  - é‡‡æ ·ç‡ï¼šå½•éŸ³è®¾å¤‡åœ¨ä¸€ç§’é’Ÿå†…å¯¹å£°éŸ³ä¿¡å·çš„é‡‡æ ·æ¬¡æ•°ï¼Œé€šå¸¸æ˜¯44.1kHzï¼Œ48kHzæˆ–96kHzã€‚
  - ä½æ·±åº¦ï¼šå½•éŸ³è®¾å¤‡åœ¨å¯¹æ¯æ¬¡é‡‡æ ·çš„å£°éŸ³ä¿¡å·è¿›è¡Œæ¨¡æ‹Ÿè½¬æ•°å­—çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿè®°å½•çš„å£°éŸ³ä¿¡å·çš„ç²¾åº¦ï¼Œé€šå¸¸æ˜¯16ä½æˆ–24ä½ã€‚
  - é€šé“æ•°ï¼šéŸ³é¢‘çš„å£°é“æ•°ï¼Œå¦‚å•å£°é“ï¼ˆ`Mono`ï¼‰ä¸º1ï¼Œç«‹ä½“å£°ï¼ˆ`Stereo`ï¼‰ä¸º2ã€‚

ğŸŒ° æœ‰ä¸€ä¸ª 5MB çš„ `PCM` æ–‡ä»¶ï¼Œé‡‡æ ·ç‡ä¸º 44.1kHzï¼Œé‡‡æ ·ä½æ·±åº¦ä¸º 16 ä½ï¼Œä¸ºç«‹ä½“å£°éŸ³é¢‘ã€‚
  > `æ—¶é—´ = 5 * 1024 * 1024 (å­—èŠ‚) / (44.1 * 1024 * 16/8 * 2) â‰ˆ 30ç§’`

:::

------

## å‹ç¼©

### â“`JPEG` çš„å‹ç¼©è¿‡ç¨‹

::: details ğŸ’¡

> `JPEG`ï¼ˆ`Joint Photographic Experts Group`ï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„å›¾åƒå‹ç¼©æ ‡å‡†ï¼Œä¸»è¦åº”ç”¨äºæ•°å­—æ‘„å½±å’Œç½‘ç»œå›¾åƒã€‚

å‹ç¼©è¿‡ç¨‹ï¼š

  - é¢œè‰²ç©ºé—´è½¬æ¢ï¼šå°†å›¾åƒçš„é¢œè‰²ç©ºé—´ä» `RGB` è½¬æ¢åˆ° `YCbCr`ã€‚`Y` æ˜¯æŒ‡äº®åº¦ï¼Œ`Cb` å’Œ `Cr` æ˜¯æŒ‡è‰²åº¦ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘äººçœ¼å¯¹è‰²å½©çš„æ•æ„Ÿåº¦ã€‚

  - åˆ†å—ï¼šå°†å›¾åƒåˆ’åˆ†ä¸º 8x8 çš„å°å—ï¼Œæ¯ä¸€ä¸ª 8x8 çš„å°å—è¿›è¡Œç‹¬ç«‹çš„å¤„ç†ã€‚

  - ç¦»æ•£ä½™å¼¦å˜æ¢ï¼ˆ`DCT`ï¼‰ï¼šå¯¹æ¯ä¸ª 8x8 çš„åƒç´ å—åº”ç”¨ç¦»æ•£ä½™å¼¦å˜æ¢ï¼Œå°†å…¶ä¸­çš„åƒç´ å€¼ä»ç©ºé—´åŸŸè½¬æ¢åˆ°é¢‘åŸŸã€‚åœ¨é¢‘åŸŸä¸­ï¼Œå›¾ç‰‡ä¿¡æ¯ä¸»è¦é›†ä¸­åœ¨ä½é¢‘éƒ¨åˆ†ï¼Œé«˜é¢‘éƒ¨åˆ†å¯ä»¥è¿›è¡Œå‰”é™¤ä»¥è¾¾åˆ°å‹ç¼©çš„ç›®çš„ã€‚

  - é‡åŒ–ï¼šé€šè¿‡é‡åŒ–è¡¨å¯¹ `DCT` å˜æ¢åçš„ç³»æ•°è¿›è¡Œé‡åŒ–ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æœ‰æŸçš„ï¼Œé€šå¸¸ä¼šä¸¢å¤±ä¸€äº›é«˜é¢‘ä¿¡æ¯ã€‚

  - é‡æ–°æ’åºï¼šå°†é‡åŒ–åçš„ç³»æ•°æŒ‰ç…§ç‰¹å®šçš„é¡ºåºé‡æ’ï¼Œé€šå¸¸æ˜¯æ²¿ç€å¯¹è§’çº¿çš„æ–¹å‘ã€‚

  - ç†µç¼–ç ï¼šä½¿ç”¨å“ˆå¤«æ›¼ç¼–ç å¯¹é‡æ’åçš„ç³»æ•°è¿›è¡Œç¼–ç ï¼Œè¯¥è¿‡ç¨‹æ˜¯æ— æŸçš„ï¼Œç”¨äºè¿›ä¸€æ­¥å‡å°æ–‡ä»¶å¤§å°ã€‚

æ³¨ï¼š`JPEG` å‹ç¼©ç®—æ³•çš„æœ€åä¸¤æ­¥ä½¿å¾—å‹ç¼©è¿‡ç¨‹ä¸å¯é€†ï¼Œä¹Ÿå°±æ˜¯æ— æ³•æ¢å¤åˆ°åŸå§‹çš„å›¾åƒã€‚å°½ç®¡å¦‚æ­¤ï¼Œ`JPEG` ç®—æ³•ä»è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿåœ¨å‹ç¼©å›¾åƒæ–‡ä»¶å¤§å°çš„åŒæ—¶ä¿ç•™è¶³å¤Ÿçš„è§†è§‰ä¿¡æ¯ã€‚

:::

### â“ä¸»æµçš„è§†é¢‘å‹ç¼©åè®®

::: details ğŸ’¡

  - `H.264/AVC`ï¼šé«˜çº§è§†é¢‘ç¼–ç ï¼ˆ`Advanced Video Coding`ï¼‰ï¼Œä¹Ÿè¢«èª‰ä¸ºæ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å‹ç¼©æ ‡å‡†ï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨äºç½‘ç»œè§†é¢‘ã€è§†é¢‘ä¼šè®®ã€æ•°å­—ç”µè§†ã€è“å…‰å…‰ç›˜ç­‰é¢†åŸŸã€‚
  - `H.265/HEVC`ï¼šé«˜æ•ˆè§†é¢‘ç¼–ç ï¼ˆ`High Efficiency Video Coding`ï¼‰ï¼Œæ˜¯ `H.264` çš„åç»­ç‰ˆæœ¬ï¼Œå¯¹æ¯” `H.264`ï¼Œå®ƒåœ¨ä¿è¯ç›¸åŒç”»è´¨çš„æƒ…å†µä¸‹ï¼Œå¯è¾¾åˆ°æ›´é«˜çš„å‹ç¼©æ•ˆç‡ã€‚
  - `AV1`ï¼šå¼€æºã€å…ç‰ˆæƒè´¹çš„è§†é¢‘ç¼–ç æ ¼å¼ï¼Œç”±å¼€æ”¾åª’ä½“è”ç›Ÿ `AOMedia` å¼€å‘ï¼Œæä¾›æ¯” `H.265` é«˜å‡º 20% çš„å‹ç¼©æ•ˆç‡ã€‚

  - `VP8`ï¼šæ˜¯`Google`å‘å¸ƒçš„å¼€æºè§†é¢‘å‹ç¼©æ ¼å¼ï¼Œç”±äºå…¶é«˜æ•ˆçš„å‹ç¼©ç®—æ³•ï¼Œè¢«å¹¿æ³›åº”ç”¨äº `Web` è§†é¢‘ã€‚
  - `VP9`ï¼šç”± `Google` å¼€å‘çš„ä¸€ä¸ªå¼€æºã€å…ç‰ˆæƒè´¹çš„è§†é¢‘å‹ç¼©æ ‡å‡†ï¼Œæ˜¯ `VP8` çš„æ”¹è¿›ç‰ˆï¼Œä¸»è¦ç”¨äºç½‘ç»œè§†é¢‘æµå’Œ `WebRTC` é¢†åŸŸã€‚

  - `MPEG-2`ï¼šä¸»è¦ç”¨äºæ•°å­—è§†é¢‘å¹¿æ’­å’Œ `DVD` è§†é¢‘çš„æ ‡å‡†ï¼Œå‹ç¼©æ•ˆç‡è¾ƒä½ï¼Œä½†åœ¨å…¼å®¹æ€§å’Œè´¨é‡æ–¹é¢æœ‰å¾ˆå¥½çš„è¡¨ç°ã€‚
  - `MPEG-4`ï¼šæ˜¯ä¸€ç§ç”¨äºæ—¶é—´åŸºæœ¬åª’ä½“ï¼ˆå¦‚éŸ³é¢‘ã€è§†é¢‘ï¼‰çš„å›½é™…ç¼–ç æ ‡å‡†ï¼ŒåŒ…å«å¤šç§ç¼–ç æ–¹æ³•ï¼ˆæ¯”å¦‚`DivX`ï¼Œ`Xvid`ç­‰ï¼‰ã€‚

:::

### â“è§†é¢‘å‹ç¼©çš„åŸç†

::: details ğŸ’¡

> è§†é¢‘å‹ç¼©æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºå‡å°‘æ•°æ®é‡ä»¥ä¾¿åœ¨ç½‘ç»œä¸Šæµç•…åœ°ä¼ è¾“è§†é¢‘æˆ–åœ¨å­˜å‚¨è®¾å¤‡ä¸ŠèŠ‚çœç©ºé—´ã€‚

åŸºæœ¬åŸç†ï¼š

  - ç©ºé—´å‹ç¼©ï¼šä¹Ÿè¢«ç§°ä¸ºå¸§å†…ç¼–ç ï¼Œä¸»è¦é’ˆå¯¹è§†é¢‘å¸§å†…éƒ¨è¿›è¡Œå‹ç¼©ã€‚æ¯”å¦‚é€šè¿‡è½¬æ¢é¢œè‰²ç©ºé—´ï¼Œé‡åŒ–ï¼Œå˜æ¢ç¼–ç ç­‰æ–¹æ³•å¯¹å¸§å†…ä¿¡æ¯è¿›è¡Œå‹ç¼©ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸»è¦åˆ©ç”¨äº†äººç±»è§†è§‰ç³»ç»Ÿå¯¹æŸäº›ä¿¡æ¯ï¼ˆä¾‹å¦‚é«˜é¢‘ä¿¡æ¯ï¼Œè‰²åº¦ä¿¡æ¯ï¼‰çš„ä¸æ•æ„Ÿæ€§ï¼Œæ¥ç§»é™¤è¿™äº›æˆ‘ä»¬çœ‹ä¸åˆ°æˆ–è€…çœ‹ä¸æ¸…çš„ä¿¡æ¯ã€‚

  - æ—¶é—´å‹ç¼©ï¼šä¹Ÿè¢«ç§°ä¸ºå¸§é—´ç¼–ç ï¼Œä¸»è¦é’ˆå¯¹è¿ç»­å¸§é—´è¿›è¡Œå‹ç¼©ã€‚å› ä¸ºåœ¨ä¸€æ®µè¿ç»­çš„è§†é¢‘å¸§ä¸­ï¼Œå­˜åœ¨å¤§é‡çš„å†—ä½™ä¿¡æ¯ã€‚æ¯”å¦‚åœ¨å‰åå¸§ä¸­ï¼ŒèƒŒæ™¯å’Œä¸»ä½“çš„å¤§éƒ¨åˆ†åŒºåŸŸå¹¶æœªå‘ç”Ÿå˜åŠ¨ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡é¢„æµ‹çš„æ–¹æ³•ï¼Œæ‰¾å‡ºå½“å‰å¸§ä¸å‰åå¸§çš„å·®å¼‚ï¼Œè€Œåªå­˜å‚¨è¿™äº›å·®å¼‚ä¿¡æ¯å³å¯ã€‚

  - ç†µç¼–ç ï¼šåœ¨å‰ä¸¤æ­¥å‹ç¼©åï¼Œå¾—åˆ°çš„æ•°æ®ä¸­ï¼Œä¸€äº›å€¼å‡ºç°å¾—éå¸¸é¢‘ç¹ï¼Œè€Œä¸€äº›åˆ™å¾ˆå°‘å‡ºç°ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥èµ‹äºˆè¿™äº›é¢‘ç¹å‡ºç°çš„å€¼è¾ƒçŸ­çš„ç¼–ç ï¼Œè€Œèµ‹äºˆè¾ƒå°‘å‡ºç°çš„å€¼è¾ƒé•¿çš„ç¼–ç ï¼Œä»¥æ­¤é™ä½æ•°æ®çš„å¹³å‡é•¿åº¦ï¼Œè·å¾—æ›´é«˜çš„å‹ç¼©æ•ˆæœã€‚è¿™å°±æ˜¯ç†µç¼–ç çš„åŸç†ï¼Œå¸¸ç”¨çš„ç†µç¼–ç æ–¹æ³•æœ‰å“ˆå¤«æ›¼ç¼–ç å’Œç®—æœ¯ç¼–ç ç­‰ã€‚
    
:::

------

## æ»¤é•œ

### â“æ»¤é•œå®ç°åŸç†

::: details ğŸ’¡

> æ»¤é•œçš„å®ç°åŸç†ï¼šæ˜¯å¯¹å›¾åƒä¸Šçš„æ¯ä¸€ä¸ªåƒç´ è¿›è¡Œå¤„ç†ä»¥è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚å¤„ç†çš„æ–¹å¼å–å†³äºæ»¤é•œçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šè°ƒæ•´æ˜æš—ã€é¢œè‰²ã€å¯¹æ¯”åº¦ç­‰ï¼Œä»¥åŠæ›´å¤æ‚çš„æ“ä½œå¦‚æ¨¡ç³Šç­‰ã€‚

ä¸»è¦æ­¥éª¤ï¼š

  - å¯¹å›¾ç‰‡çš„æ¯ä¸€ä¸ªåƒç´ è¿›è¡Œè¿­ä»£ã€‚
  - åœ¨æ¯ä¸ªåƒç´ ä¸Šåº”ç”¨ä¸€ä¸ªå‡½æ•°æˆ–è€…ç®—æ³•ã€‚æœ€ç®€å•çš„ä¾‹å­å¯èƒ½å°±æ˜¯è°ƒæ•´åƒç´ çš„ `RGB` å€¼æ¥æ”¹å˜å›¾ç‰‡é¢œè‰²ã€‚
  - å°†å¤„ç†åçš„åƒç´ å€¼é‡æ–°ç»„åˆæˆå›¾ç‰‡ã€‚

```swift
// ä½¿ç”¨ Core Image åœ¨ä¸­åˆ›å»ºæ»¤é•œçš„
let ciImage = CIImage(image: image)

// åˆ›å»ºæ»¤é•œï¼šå†…ç½®çš„ "CIColorMonochrome" æ»¤é•œ - å°†å›¾ç‰‡è½¬å˜ä¸ºå•è‰²å›¾åƒã€‚
let filter = CIFilter(name: "CIColorMonochrome")
// è®¾ç½®æ»¤é•œçš„è¾“å…¥
filter?.setValue(ciImage, forKey: kCIInputImageKey)
// è·å–æ»¤é•œçš„è¾“å‡º
let result = filter?.value(forKey: kCIOutputImageKey) as? CIImage
// åˆ›å»ºä»æ ¸å¿ƒå›¾åƒè½¬æ¢æˆ UIImage çš„ CIContext 
let ciContext = CIContext(options: nil)
// å°†å›¾ç‰‡æ•°æ®å¯¼å‡ºä¸º CGImageï¼Œç„¶åè½¬åŒ–ä¸º UIImage
if let output = ciContext.createCGImage(result!, from: (result?.extent)!) {
    let resultImage = UIImage(cgImage: output)
}
```

:::

### â“å¦‚ä½•å®ç°åˆ†å‰²æ»¤é•œ

::: details ğŸ’¡

> åˆ†å‰²æ»¤é•œçš„åŸºæœ¬æ€è·¯ï¼šå¯¹å›¾ç‰‡ä¸Šçš„æ¯ä¸ªåƒç´ è¿›è¡Œè¿­ä»£ï¼Œå¹¶åœ¨æ¯ä¸ªåƒç´ ä¸Šæ ¹æ®å…¶ä½ç½®æˆ–æŸç§è§„åˆ™åº”ç”¨ä¸åŒçš„æ»¤é•œæ•ˆæœã€‚

```swift
// ä¸€å¼ å›¾ç‰‡ä¸€åŠåº”ç”¨é»‘ç™½æ•ˆæœï¼Œå¦ä¸€åŠä¿æŒåŸæ ·

// åŸå§‹å›¾ç‰‡
let originalCIImage = CIImage(image: originalUIImage)!

// åˆ›å»ºä¸€ä¸ªé»‘ç™½æ»¤é•œ
let bwFilter = CIFilter(name: "CIColorMonochrome")!
bwFilter.setValue(originalCIImage, forKey: kCIInputImageKey)
let bwCIImage = bwFilter.outputImage!

let totalWidth = originalCIImage.extent.width
let slicePoint = totalWidth / 2

// åˆ›å»ºä¸€ä¸ª CIBlendWithMask æ»¤é•œ - æ ¹æ®æ©ç å›¾åƒï¼ˆåœ¨æ¨¡æ¿å›¾åƒä¸­ï¼‰ç»„åˆä¸¤ä¸ªå›¾åƒ
let blendFilter = CIFilter(name: "CIBlendWithMask")!
blendFilter.setValue(bwCIImage, forKey: kCIInputImageKey)
blendFilter.setValue(originalCIImage, forKey: kCIInputBackgroundImageKey)

let maskImage = CIImage(color: CIColor(red: 1, green: 1, blue: 1))
let mask = maskImage.cropped(to: CGRect(
     x: 0,
     y: 0,
     width: slicePoint,
     height: originalCIImage.extent.height))

blendFilter.setValue(mask, forKey: kCIInputMaskImageKey)

let outputImage = blendFilter.outputImage!
let finalImage = UIImage(ciImage: outputImage)
```

:::

### â“ç¾é¢œç˜¦è„¸ç­‰åŠŸèƒ½æ€ä¹ˆå®ç°çš„

::: details ğŸ’¡

> ç¾é¢œç˜¦è„¸ç­‰åŠŸèƒ½çš„å®ç°æ˜¯é€šè¿‡å›¾åƒå¤„ç†å’Œè®¡ç®—æœºè§†è§‰æŠ€æœ¯æ¥å®ç°çš„ã€‚

å®ç°æ­¥éª¤ï¼š

  - äººè„¸æ£€æµ‹ï¼šé¦–å…ˆéœ€è¦å®šä½åˆ°å›¾ç‰‡ä¸­äººè„¸çš„ä½ç½®ï¼Œè¿™å¯ä»¥é€šè¿‡åŒ…æ‹¬ `Haar` ç‰¹å¾ã€`HOG` ç‰¹å¾ç»“åˆæ”¯æŒå‘é‡æœº(`SVM`)ä»¥åŠæ·±åº¦å­¦ä¹ ç­‰æŠ€æœ¯æ¥å®ç°ã€‚

  - ç‰¹å¾ç‚¹å®šä½ï¼šå®šä½åˆ°äººè„¸çš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€è¦å®šä½å‡ºäººè„¸ä¸Šçš„å…³é”®ç‰¹å¾ç‚¹ï¼Œå¦‚çœ¼ç›ã€é¼»å­ã€å˜´å·´ã€è„¸é¢Šç­‰ä½ç½®ã€‚è¿™åŒæ ·å¯ä»¥é€šè¿‡æœºå™¨å­¦ä¹ æˆ–è€…æ·±åº¦å­¦ä¹ çš„ç®—æ³•æ¥å®ç°ã€‚

  - å›¾åƒæ»¤æ³¢ç¾é¢œï¼šå¯¹å›¾åƒè¿›è¡Œæ»¤æ³¢å¤„ç†ï¼Œå¦‚å‡å€¼æ»¤æ³¢ã€é«˜æ–¯æ»¤æ³¢ã€åŒè¾¹æ»¤æ³¢ç­‰ï¼Œå¯ä»¥å»é™¤çš®è‚¤ä¸Šçš„ç‘•ç–µã€çš±çº¹ï¼Œä½¿å¾—çš®è‚¤çœ‹èµ·æ¥æ›´åŠ å…‰æ»‘æ¸…æ™°ã€‚

  - è‰²å½©è°ƒæ•´ï¼šé€šè¿‡è°ƒæ•´å›¾åƒçš„äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ã€è‰²è°ƒç­‰ï¼Œå¯ä»¥ä½¿å¾—çš®è‚¤çœ‹èµ·æ¥æ›´åŠ å¥åº·æœ‰æ´»åŠ›ã€‚

  - ç¾å‹ç˜¦è„¸ï¼šé€šè¿‡å›¾åƒçš„ä»¿å°„å˜æ¢æˆ–è€…å‡ ä½•å˜æ¢ï¼Œå¯ä»¥æ”¹å˜è„¸éƒ¨æˆ–è€…èº«ä½“çš„å½¢çŠ¶ï¼Œè¾¾åˆ°ç¾å‹æˆ–è€…ç˜¦èº«çš„æ•ˆæœã€‚

  - è„¸å½¢è°ƒæ•´ï¼šå¯ä»¥é€šè¿‡æ‰¾åˆ°è„¸éƒ¨çš„å…³é”®ç‚¹å®šä½ï¼Œå†è¿›è¡Œé€‚å½“çš„åƒç´ ç§»åŠ¨å’Œè°ƒæ•´ï¼Œè¾¾åˆ°ç˜¦è„¸çš„æ•ˆæœã€‚

  - æ€»ä½“æ¸²æŸ“ï¼šå°†ä»¥ä¸Šæ­¥éª¤åˆå¹¶ï¼Œå¯¹åŸå§‹å›¾åƒè¿›è¡Œæ¸²æŸ“ï¼Œç”Ÿæˆæœ€ç»ˆçš„ç¾é¢œç˜¦è„¸çš„æ•ˆæœã€‚

:::

------

## ç›´æ’­

### â“ç›´æ’­æ•´ä½“æµç¨‹

::: details ğŸ’¡

  - **ä¿¡å·é‡‡é›†**ï¼šä½¿ç”¨æ‰‹æœºã€ç”µè„‘æˆ–ä¸“ç”¨è®¾å¤‡é‡‡é›†éŸ³è§†é¢‘ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸éœ€è¦è°ƒç”¨è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£ç­‰ç¡¬ä»¶è®¾å¤‡è¿›è¡Œå®æ—¶éŸ³è§†é¢‘å½•åˆ¶ã€‚

  - **ç¼–ç ä¸å‹ç¼©**ï¼šå°†é‡‡é›†åˆ°çš„éŸ³è§†é¢‘ä¿¡å·è¿›è¡Œç¼–ç å’Œå‹ç¼©ï¼Œè½¬æˆå¯ä»¥ç½‘ç»œä¼ è¾“çš„æµåª’ä½“æ ¼å¼ï¼Œå¦‚ `H264, H265, VP8, VP9` ç­‰è§†é¢‘ç¼–ç å’Œ `AACã€MP3` ç­‰éŸ³é¢‘ç¼–ç ã€‚

  - **ä¸Šä¼ æ¨æµ**ï¼šå°†ç¼–ç åçš„éŸ³è§†é¢‘æ•°æ®é€šè¿‡ç½‘ç»œå‘é€åˆ°ç›´æ’­æœåŠ¡å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç¨³å®šã€è¿ç»­çš„ç½‘ç»œè¿æ¥æ¥ä¿è¯ä¿¡å·çš„å®æ—¶æ€§ã€‚

  - **æœåŠ¡å™¨æ¥æ”¶ä¸è½¬å‘**ï¼šç›´æ’­æœåŠ¡å™¨æ¥æ”¶åˆ°ç›´æ’­æ•°æ®åï¼Œä¼šè¿›è¡Œä¸€äº›å¿…è¦çš„å¤„ç†ï¼Œå¦‚è½¬ç ã€å½•åˆ¶ã€æ’æ’­å¹¿å‘Šç­‰ï¼Œç„¶åè½¬å‘ç»™è§‚çœ‹çš„ç”¨æˆ·ã€‚

  - **è§‚ä¼—æ‹‰æµ&è§£ç **ï¼šè§‚ä¼—ç«¯æ‹‰å–ç›´æ’­æµæ•°æ®ï¼Œç„¶åè§£ç æ’­æ”¾ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿéœ€è¦ç¨³å®šçš„ç½‘ç»œç¯å¢ƒï¼Œå¹¶ä¸”è¦è§£å†³è§†é¢‘æ’­æ”¾çš„åŒæ­¥å’Œæ—¶å»¶é—®é¢˜ã€‚

  - **äº¤äº’åé¦ˆ**ï¼šè§‚ä¼—ä¸ä¸»æ’­è¿›è¡Œäº’åŠ¨ï¼Œå¦‚å‘å¼¹å¹•ã€é€ç¤¼ç‰©ã€è¯„è®ºç­‰ï¼Œè¿™äº›éƒ½éœ€è¦å®æ—¶åé¦ˆåˆ°ç›´æ’­ç•Œé¢ä¸Šã€‚

:::

### â“è§†é¢‘ä» `é‡‡é›† -> æ˜¾ç¤º -> ä¿å­˜` æ•´ä¸ªæµç¨‹

::: details ğŸ’¡

  - **é‡‡é›†**ï¼šè§†é¢‘çš„é‡‡é›†é€šå¸¸ç”±æ‘„åƒå¤´å®Œæˆï¼Œæ‘„åƒå¤´å°†å®æ—¶åœºæ™¯è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ã€‚æ­¤è¿‡ç¨‹æ¶‰åŠåˆ°å›¾åƒé‡‡é›†è®¾å¤‡çš„å·¥ä½œåŸç†ï¼Œä»¥åŠå…‰å­¦å’Œæ„Ÿå…‰åŸç†ç­‰å†…å®¹ã€‚

  - **é¢„å¤„ç†**ï¼šé‡‡é›†åˆ°çš„æ•°å­—ä¿¡å·è¿›è¡Œé¢„å¤„ç†ï¼Œè¿™åŒ…æ‹¬é¢œè‰²ç©ºé—´è½¬æ¢ï¼Œé™å™ªå¤„ç†ï¼Œæ˜æš—å¤„ç†ç­‰æ­¥éª¤ï¼Œç›®çš„æ˜¯æé«˜è§†é¢‘çš„æ„ŸçŸ¥è´¨é‡ã€‚

  - **ç¼–ç **ï¼šç¼–ç é˜¶æ®µå°†é¢„å¤„ç†åçš„è§†é¢‘æ•°æ®è½¬æ¢ä¸ºç‰¹å®šæ ¼å¼ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«å­˜å‚¨æˆ–ä¼ è¾“ã€‚ç¼–ç é€šå¸¸éœ€è¦è€ƒè™‘å‹ç¼©çš„éœ€è¦ï¼Œç”¨æ¥å‡å°‘è§†é¢‘æ•°æ®çš„å¤§å°ï¼ŒåŒ…å« `H264ï¼ŒH265ï¼ŒVP8ï¼ŒVP9` ç­‰ç¼–ç æ ¼å¼ã€‚

  - **å°è£…**ï¼šç¼–ç åçš„è§†é¢‘æ•°æ®éœ€è¦è¿›è¡Œå°è£…ï¼Œå°è£…æ•°æ®åŒ…æ‹¬éŸ³é¢‘æµã€è§†é¢‘æµä»¥åŠå­—å¹•ç­‰ï¼Œå¸¸è§çš„å°è£…æ ¼å¼æœ‰ `MP4ï¼ŒFLVï¼ŒMKVï¼ŒAVIï¼ŒMOV` ç­‰ã€‚

  - **ä¼ è¾“**ï¼šè§†é¢‘æ•°æ®é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°æœåŠ¡å™¨æˆ–è€…ä¼ è¾“åˆ°å…¶ä»–è®¾å¤‡ã€‚å¯ä»¥ä½¿ç”¨ `RTMPï¼ŒHLSï¼ŒHTTP-FLV` ç­‰ä¼ è¾“åè®®ã€‚

  - **è§£ç **ï¼šæ¥æ”¶ç«¯æ”¶åˆ°è§†é¢‘æ•°æ®åï¼Œå…ˆè§£å°è£…ï¼Œç„¶åå°†éŸ³é¢‘å’Œè§†é¢‘æ•°æ®è§£ç å›åŸå§‹æ ¼å¼ã€‚

  - **åå¤„ç†**ï¼šè§£ç åçš„æ•°æ®å¯ä»¥è¿›è¡Œä¸€å®šçš„åå¤„ç†ï¼Œå¦‚é€šè¿‡ç¡¬ä»¶åŠ é€Ÿæé«˜æ’­æ”¾æ€§èƒ½ï¼Œæˆ–è€…å¯¹å›¾åƒè¿›è¡Œå¢å¼ºå¤„ç†ç­‰ã€‚

  - **æ˜¾ç¤º**ï¼šå°†è§£ç åçš„è§†é¢‘æ•°æ®æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚

  - **ä¿å­˜**ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥å°†è§†é¢‘æ•°æ®ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨è®¾å¤‡ä¸­ã€‚æ­¤æ—¶ï¼Œè§†é¢‘æ•°æ®é€šå¸¸ä»¥æŸç§æ–‡ä»¶æ ¼å¼ä¿å­˜ï¼Œå¯ä»¥æ˜¯å·²ç»ç¼–ç å’Œå°è£…çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸå§‹çš„æœªç¼–ç æ ¼å¼ã€‚

:::

### â“RTMP vs WebRTC

::: details ğŸ’¡

æ¦‚å¿µï¼š

  - `RTMP`(Real Time Messaging Protocol)ï¼šå³å®æ—¶æ¶ˆæ¯ä¼ é€åè®®ï¼Œæ˜¯ä¸ºäº†è§£å†³éŸ³è§†é¢‘æ•°æ®åœ¨ç½‘ç»œä¸Šé«˜æ•ˆä¼ è¾“è€Œç”Ÿçš„ä¸€ä¸ªåè®®ã€‚RTMPæ˜¯ä¸€ç§è®¾è®¡ç”¨æ¥è¿›è¡Œå®æ—¶ä¿¡æ¯ä¼ è¾“çš„ç½‘ç»œåè®®ï¼Œä¸»è¦ç”¨æ¥åœ¨Flash/AIRå¹³å°å’Œæ”¯æŒRTMPåè®®çš„æµåª’ä½“/äº¤äº’æœåŠ¡å™¨ä¹‹é—´è¿›è¡ŒéŸ³è§†é¢‘å’Œæ•°æ®é€šä¿¡ã€‚RTMPæµåª’ä½“æœåŠ¡å™¨æœ‰Red5ã€Nginxã€Adobe Media Serverç­‰ã€‚ä¸»è¦ç”¨äºç›´æ’­ç³»ç»Ÿã€‚

  - `WebRTC`(Web Real-Time Communication)ï¼šä¸€é¡¹å®æ—¶é€šè®¯æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œåº”ç”¨æˆ–è€…ç½‘ç«™ä¸å€ŸåŠ©ä¸­é—´åª’ä»‹ï¼Œå»ºç«‹æµè§ˆå™¨ä¹‹é—´ç‚¹å¯¹ç‚¹ï¼ˆPeer-to-Peerï¼‰é«˜è´¨é‡è§†é¢‘éŸ³é¢‘æˆ–è€…æ•°æ®é€šé“ã€‚å¯ä»¥ç”¨äºè§†é¢‘ä¼šè®®ï¼Œæ–‡ä»¶ä¼ è¾“ç­‰ã€‚WebRTCæ˜¯å¼€æºçš„ï¼Œä¸”å…¼å®¹æ€§è‰¯å¥½ï¼Œä¸å°‘ç°ä»£çš„ç½‘ç»œæµè§ˆå™¨ï¼ˆå¦‚Chromeï¼ŒFirefoxï¼‰éƒ½åŸç”Ÿæ”¯æŒWebRTCã€‚

åŒºåˆ«ï¼š

  - ç½‘ç»œä¼ è¾“ï¼šWebRTCæ”¯æŒP2Pï¼ŒRTMPä¸æ”¯æŒã€‚WebRTCå¯ä»¥åœ¨åŒä¸€å±€åŸŸç½‘å†…æ‰“é€šP2Pè¿æ¥ï¼Œä¼ è¾“æ•ˆç‡é«˜ã€‚è€ŒRTMPåªèƒ½èµ°æœåŠ¡å™¨ä¸­è½¬ã€‚

  - å®æ—¶æ€§ï¼šWebRTCä¼˜äºRTMPï¼Œä¸€èˆ¬ç½‘é¡µç›´æ’­é‡‡ç”¨WebRTCåè®®ï¼Œæ‰‹æœºç›´æ’­é‡‡ç”¨RTMPåè®®ã€‚

  - æ˜“ç”¨æ€§ï¼šWebRTCåªéœ€è¦æµè§ˆå™¨å°±å¯ä»¥ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–çš„æ’ä»¶ã€‚è€ŒFlashéœ€è¦æ’ä»¶æ”¯æŒï¼Œä½¿ç”¨ç›¸å¯¹å¤æ‚ã€‚

  - å…¼å®¹æ€§ï¼šWebRTCåªæ”¯æŒéƒ¨åˆ†æµè§ˆå™¨ï¼Œè€ŒRTMPåŸºæœ¬æ‰€æœ‰æµè§ˆå™¨éƒ½å¯ä»¥æ”¯æŒã€‚

  - å»¶æ—¶ï¼šWebRTCçš„å»¶æ—¶è¾ƒä½ï¼Œé€šå¸¸å¯ä»¥åœ¨æ¯«ç§’çº§åˆ«ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿåé¦ˆçš„åº”ç”¨ã€‚è€ŒRTMPçš„å»¶æ—¶è¾ƒé«˜ï¼Œé€šå¸¸åœ¨å‡ ç§’åˆ°åå‡ ç§’ä¸ç­‰ã€‚

:::

#### RTM & RTC & RTMP

::: details ğŸ’¡

  - RTM (Real-Time Messaging) : å®æ—¶æ¶ˆæ¯(ä¿¡ä»¤)
    > ä¼ è¾“æ•°æ® : æ¶ˆæ¯æ–‡æœ¬æˆ–åŠ å¯†æ•°æ®
    > å®æ—¶æ¶ˆæ¯åœºæ™¯ : æ¶ˆæ¯å‘é€ã€å‘¼å«é‚€è¯·
    
  - RTC (Real-Time Communication) : å®æ—¶é€šä¿¡
    > ä¼ è¾“æ•°æ® : éŸ³è§†é¢‘æ•°æ®
    > å®æ—¶é€šä¿¡åœºæ™¯ : è¯­éŸ³é€šè¯ã€è§†é¢‘é€šè¯ã€éŸ³é¢‘äº’åŠ¨ç›´æ’­ã€è§†é¢‘äº’åŠ¨ç›´æ’­ 

  - RTMP/RTMPS (Real-Time Transmit Protocol Security) : å®æ—¶ä¼ è¾“åè®®

:::

------

## éŸ³è§†é¢‘

### æ¦‚å¿µçŸ¥è¯†

#### â“CMTime

::: details ğŸ’¡

> `CMTime`ï¼š`Core Media` æ¡†æ¶ä¸­çš„ä¸€ä¸ª `C` ç»“æ„ï¼Œç”¨äºåœ¨å¤šåª’ä½“å¤„ç†ä¸­è¡¨è¾¾æ—¶é—´ã€‚è¿™ä¸ªç»“æ„æä¾›äº†æ¯”æµ®ç‚¹æ•°æ›´å‡†ç¡®æ›´çµæ´»çš„æ—¶é—´è¡¨è¾¾æ–¹å¼ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºæ—¶é—´ï¼Œæ—¶é—´èŒƒå›´å’Œæ—¶é—´æ˜ å°„ã€‚

ç»“æ„ï¼š

  - `value`: ä¸€ä¸ª 64 ä½æ•´æ•°è¡¨ç¤ºæ—¶é—´å€¼ã€‚
  - `timescale`: ä¸€ä¸ª 32 ä½æ•´æ•°ï¼Œè¡¨ç¤ºæ¯ç§’ä¸­çš„å¸§æ•°ã€‚
  - `flags`: è¡¨æ˜è¿™ä¸ªæ—¶é—´æ˜¯æœ‰æ•ˆçš„ï¼Œè¿˜æ˜¯ä¸ç¡®å®šçš„ï¼Œæˆ–è€…æ˜¯æ­£å‘çš„ï¼Œè¿˜æ˜¯åå‘çš„ã€‚
  - `epoch`: å®ƒç”¨äºè¡¨è¿°è¶…è¿‡äº†æ ‡å‡†çš„â€œæ¯ç§’å¸§æ•°â€ï¼Œä¸€èˆ¬åº”ç”¨ä¸­ä¸ä¼šä½¿ç”¨ã€‚


å…¬å¼ï¼š`æ—¶é—´ = value / timescale (å•ä½ï¼šç§’)`

:::

#### â“SampleBuffer vs PixelBuffer

::: details ğŸ’¡

  - `CMSampleBufferRef` : `Core Media` æ¡†æ¶ä¸­è¢«ç”¨æ¥ç®¡ç†éŸ³é¢‘ã€è§†é¢‘ã€å­—å¹•ç­‰æ ·æœ¬çš„é›†åˆã€‚
    > ä¸€ä¸ª `SampleBuffer` åŒ…å«ä¸€åˆ°å¤šä¸ªæ ·æœ¬ä»¥åŠæè¿°è¿™äº›æ ·æœ¬çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚æ˜¾ç¤ºæ—¶é—´æˆ³ã€è§£ç æ—¶é—´æˆ³ã€æŒç»­æ—¶é—´ã€å¸§é€Ÿç‡ç­‰ã€‚`SampleBuffer` åœ¨æ›´é«˜çš„å±‚çº§ç®¡ç†æ•°æ®ï¼ŒåŒ…å«äº†è§£å‹ç¼©å’Œæ’­æ”¾åª’ä½“æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚

  - `CVPixelBufferRef` : `Core Video` æ¡†æ¶ä¸­è¢«ç”¨æ¥ç®¡ç†å›¾åƒæ•°æ®ã€‚
    > ä¸€ä¸ª `PixelBuffer` è¡¨ç¤ºä¸€ä¸ªè§†é¢‘å¸§ï¼Œå®ƒåŒ…å«äº†è§†é¢‘å¸§çš„åŸå§‹åƒç´ æ•°æ®ã€‚`PixelBuffer` æ˜¯åœ¨æ›´ä½çš„å±‚çº§å¤„ç†æ•°æ®ï¼Œä»…ä»…åŒ…å«äº†åƒç´ ä¿¡æ¯ï¼Œæ²¡æœ‰æ—¶é—´æˆ³ã€æŒç»­æ—¶é—´ç­‰å…ƒæ•°æ®ã€‚

  > ä¸¤è€…åŒºåˆ«ï¼š`SampleBuffer` æ˜¯å¯¹åŒ…å«éŸ³é¢‘ã€è§†é¢‘ã€å­—å¹•ç­‰æ ·æœ¬çš„é›†åˆçš„å°è£…ï¼ŒåŒ…å«äº†æ’­æ”¾åª’ä½“æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œ`PixelBuffer` æ˜¯å¯¹è§†é¢‘å¸§çš„åŸå§‹åƒç´ æ•°æ®çš„å°è£…ï¼Œæ›´å…³æ³¨å›¾åƒå±‚é¢çš„ç»†èŠ‚ã€‚

:::

### éŸ³é¢‘å¤„ç†

#### â“`iOS` ä¸­éŸ³é¢‘é™ç‡¥å¦‚ä½•å¤„ç†

::: details ğŸ’¡

  - ä½¿ç”¨ç³»ç»Ÿçš„ `AVAudioEngine` ç±»æ¥è¿›è¡Œå¤„ç†
    
   ```swift
   let audioEngine = AVAudioEngine()
   let mixer = audioEngine.mainMixerNode // æ··é¢‘å™¨èŠ‚ç‚¹
   mixer.outputVolume = 0.5 // è®¾ç½®è¾“å‡ºéŸ³é¢‘çš„åŠéŸ³å¤§å°
   ```

  - ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ `AudioKit` è¿›è¡Œå™ªéŸ³é™ä½

   ```swift
   import AudioKit
    
   let noise = AKWhiteNoise() // åˆ›å»ºä¸€ä¸ªç™½å™ªå£°
   noise.amplitude = 0.2 // è°ƒæ•´å™ªå£°å¹…åº¦
   AudioKit.output = noise
   try? AudioKit.start()
   noise.start()
   ```

  - `Novocaine` æ˜¯ä¸€ç§å¼ºå¤§ä½†ç®€å•çš„éŸ³é¢‘å¤„ç†åº“ã€‚`Novocaine` åº“æœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥æä¾›é™å™ªå¤„ç†çš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒæä¾›äº†ä½å»¶è¿Ÿçš„éŸ³é¢‘è¾“å…¥å’Œè¾“å‡ºï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†éŸ³é¢‘æ•°æ®æµè¾“å…¥åˆ° `DSP` ä»£ç ä¸­è¿›è¡Œå¤„ç†åå†è¾“å‡ºã€‚
    
    ```swift
    // å£°æ˜ä¸€ä¸ª Novocaine éŸ³é¢‘å¤„ç†å¯¹è±¡
    let audioManager = Novocaine.audioManager()
    
    // è®¾ç½®éŸ³é¢‘è¾“å…¥å›è°ƒ
    audioManager.setInputBlock { (numberFrames, samples) in
        // 'samples' è¿™é‡Œæ˜¯ä¸€ä¸ªæŒ‡å‘è¾“å…¥éŸ³é¢‘æ•°æ®ç‰‡æ®µçš„æŒ‡é’ˆï¼Œ
        // å¯ä»¥å°†è¿™äº›æ•°æ®ä¼ å…¥é™å™ªç®—æ³•è¿›è¡Œå¤„ç†
        // ä¾‹å¦‚ï¼šyourNoiseReductionAlgorithm(samples)
    }
    
    // å¼€å§‹è¿è¡Œ
    audioManager.play()
    ```

  - `WebRTC`ï¼šç”± `Google` å¼€å‘ï¼Œç”¨äºéŸ³é¢‘å’Œè§†é¢‘çš„å®æ—¶é€šä¿¡ã€‚æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„éŸ³é¢‘å¤„ç†å¼•æ“ï¼ŒåŒ…æ‹¬é™å™ªã€å›å£°æ¶ˆé™¤ç­‰åŠŸèƒ½ã€‚

  - `EZAudio`ï¼šä¸€ä¸ª `iOS` å’Œ `macOS` çš„éŸ³é¢‘æ¡†æ¶ï¼Œæä¾›äº†æ–¹ä¾¿çš„éŸ³é¢‘åˆ†æå’Œå¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„éŸ³é¢‘è¾“å…¥ã€è¾“å‡ºå’Œæ··éŸ³åŠŸèƒ½ï¼Œç»“åˆä¸€äº› `DSP` æŠ€æœ¯ï¼Œå¦‚æ»¤æ³¢å™¨ï¼Œå¯¹éŸ³é¢‘è¿›è¡Œé™å™ªå¤„ç†ã€‚

  - `Superpowered`ï¼šä¸€ä¸ªé«˜æ€§èƒ½ã€ä½åŠŸè€—çš„è·¨å¹³å°éŸ³é¢‘å¼•æ“ã€‚ä¸ºå¼€å‘è€…æä¾›ä¸€ç³»åˆ—éŸ³é¢‘ç›¸å…³çš„`API`ï¼Œå¦‚è§£ç ã€æ··éŸ³ã€æ»¤æ³¢ã€`Echo`æ¶ˆé™¤ç­‰ã€‚

:::

### è§†é¢‘å¤„ç†

#### â“`iOS` ä¸­è§†é¢‘åˆæˆå¦‚ä½•å¤„ç†

::: details ğŸ’¡

> ä½¿ç”¨ `AVMutableComposition` ç±»æ¥åˆæˆå¤šä¸ªè§†é¢‘ç‰‡æ®µ

```swift
import AVFoundation

// åˆ›å»ºä¸€ä¸ª AVMutableComposition å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ–°çš„å¯å˜ç¼–è¾‘ç¯å¢ƒï¼š
let mixComposition = AVMutableComposition()
// è·å–éœ€è¦åˆæˆçš„è§†é¢‘èµ„æ–™å¹¶åˆ›å»ºå¯¹åº”çš„ AVAsset å¯¹è±¡
let videoAssetA = AVAsset(url: URL(fileURLWithPath: "path/to/video_a.mp4"))
let videoAssetB = AVAsset(url: URL(fileURLWithPath: "path/to/video_b.mp4"))
// åˆ›å»º AVMutableCompositionTrack å¯¹è±¡å¹¶æ·»åŠ è§†é¢‘æ–‡ä»¶ï¼š
if let compositionVideoTrack = mixComposition.addMutableTrack(withMediaType: AVMediaType.video, preferredTrackID: CMPersistentTrackID(kCMPersistentTrackID_Invalid)),
    let sourceTrackA = videoAssetA.tracks(withMediaType: AVMediaType.video).first,
    let sourceTrackB = videoAssetB.tracks(withMediaType: AVMediaType.video).first {
        do {
            try compositionVideoTrack.insertTimeRange(CMTimeRangeMake(start: CMTime.zero, duration: videoAssetA.duration), of: sourceTrackA, at: CMTime.zero)
            try compositionVideoTrack.insertTimeRange(CMTimeRangeMake(start: CMTime.zero, duration: videoAssetB.duration), of: sourceTrackB, at: videoAssetA.duration)
        } catch {
            print(error)
        }
}
// åˆ›å»º AVAssetExportSession å¯¹è±¡ï¼Œè®¾ç½®è¾“å‡ºæ ¼å¼å’Œè·¯å¾„ï¼Œç„¶åå¼€å§‹å¯¼å‡º
let outputFilePath = "path/to/output.mp4"
let outputFileURL = URL(fileURLWithPath: outputFilePath)
if let exporter = AVAssetExportSession(asset: mixComposition, presetName: AVAssetExportPresetHighestQuality) {
    exporter.outputURL = outputFileURL
    exporter.outputFileType = AVFileType.mp4
    exporter.shouldOptimizeForNetworkUse = true
    exporter.exportAsynchronously {
        switch exporter.status {
        case .completed:
            print("Export complete")
        case .failed:
            print("Failed: \(exporter.error?.localizedDescription ?? "unknown error")")
        case .cancelled:
            print("Cancelled")
        default:
            print("Unknown")
        }
    }      
}
```

:::

#### â“`iOS` ä¸­è§†é¢‘å¦‚ä½•æ·»åŠ æ°´å°

::: details ğŸ’¡

```swift
// 1> AVMutableCompositionï¼šç®¡ç†æ‰€æœ‰çš„éŸ³é¢‘ã€è§†é¢‘å’Œæ—¶é—´çº¿èµ„æº
let mixComposition = AVMutableComposition()
guard let videoTrack = mixComposition.addMutableTrack(withMediaType: .video, preferredTrackID: Int32(kCMPersistentTrackID_Invalid)) else { return }
    
// 2> ä»åŸå§‹è§†é¢‘èµ„æºè·å–è½¨é“ï¼Œå¹¶æ·»åŠ åˆ° composition ä¸­
guard let assetTrack = asset.tracks(withMediaType: .video).first else { return }
do {
    try videoTrack.insertTimeRange(CMTimeRangeMake(start: CMTime.zero, duration: asset.duration),
                                   of: assetTrack,
                                   at: CMTime.zero)
} catch {
    print("Failed to load video track")
    return
}

// 3> åˆ›å»ºä¸€ä¸ª CALayer ç”¨äºæ˜¾ç¤ºæ°´å°å¹¶æ·»åŠ åˆ° composition çš„ layer ä¸­
let size = videoTrack.naturalSize
let watermarkLayer = CATextLayer()
watermarkLayer.string = "Watermark"
watermarkLayer.foregroundColor = UIColor.red.cgColor
watermarkLayer.fontSize = 40
watermarkLayer.frame = CGRect(x: size.width / 2, y: size.height / 2, width: size.width / 2, height: size.height / 2)
watermarkLayer.opacity = 0.5

let parentLayer = CALayer()
let videoLayer = CALayer()
parentLayer.frame = CGRect(x: 0, y: 0, width: size.width, height: size.height)
videoLayer.frame = CGRect(x: 0, y: 0, width: size.width, height: size.height)
parentLayer.addSublayer(videoLayer)
parentLayer.addSublayer(watermarkLayer)

let videoComposition = AVMutableVideoComposition()
videoComposition.animationTool = AVVideoCompositionCoreAnimationTool(postProcessingAsVideoLayer: videoLayer, in: parentLayer)
videoComposition.renderSize = size
videoComposition.frameDuration = CMTime(value: 1, timescale: 30)

// 4> åˆ›å»º AVAssetExportSession æ¥å¯¼å‡ºå¸¦æœ‰æ°´å°çš„è§†é¢‘
guard let exporter = AVAssetExportSession(asset: mixComposition, presetName: AVAssetExportPresetHighestQuality) else { return }
exporter.videoComposition = videoComposition
exporter.outputFileType = .mp4
let outputURL = // å¯¼å‡ºè·¯å¾„
exporter.outputURL = outputURL
exporter.shouldOptimizeForNetworkUse = true

exporter.exportAsynchronously(completionHandler: {
    switch exporter.status {
    case .completed:
        print("Exported successfully")
    case .failed, .cancelled:
        print("Failed: \(exporter.error)")
    default:
        break
    }
})
```

:::

#### â“`iOS` ä¸­çš„å€é€Ÿæ’­æ”¾ä¸å¯¼å‡º

::: details ğŸ’¡

  - ä¸¤å€é€Ÿæ’­æ”¾è§†é¢‘

    ```swift
    import AVFoundation
    
    // AVPlayer çš„ rate å±æ€§å¯ä»¥ç”¨æ¥æ§åˆ¶è§†é¢‘çš„æ’­æ”¾é€Ÿåº¦
    let player = AVPlayer(url: url)
    player.rate = 2.0 // 2å€é€Ÿåº¦
    player.play()
    ```

  - ä¸¤å€é€Ÿå¯¼å‡ºè§†é¢‘
    
    ```swift
    import AVFoundation
    
    func exportDoubleSpeedVideo(inputUrl: URL, outputUrl: URL, completion: @escaping (Bool, Error?) -> Void) {
        let asset = AVURLAsset(url: inputUrl)
        let composition = AVMutableComposition()
      
        // å¤„ç†è§†é¢‘è½¨
        if let videoTrack = asset.tracks(withMediaType: .video).first,
            let compositionVideoTrack = composition.addMutableTrack(withMediaType: .video,
                                                               preferredTrackID: kCMPersistentTrackID_Invalid) {
            try? compositionVideoTrack.insertTimeRange(videoTrack.timeRange, of: videoTrack, at: .zero)
            // å°† compositionTrack çš„ preferredRate è®¾ä¸º 2.0ï¼Œè§†é¢‘ä»¥ä¸¤å€é€Ÿæ’­æ”¾
            compositionVideoTrack.preferredRate = 2.0
        }
        
        // å¤„ç†éŸ³é¢‘è½¨
        if let audioTrack = asset.tracks(withMediaType: .audio).first,
            let compositionAudioTrack = composition.addMutableTrack(withMediaType: .audio,
                                                               preferredTrackID: kCMPersistentTrackID_Invalid) {
            try? compositionAudioTrack.insertTimeRange(audioTrack.timeRange, of: audioTrack, at: .zero)
            // éŸ³é¢‘ä»¥ä¸¤å€é€Ÿæ’­æ”¾
            compositionAudioTrack.preferredRate = 2.0
        }
        
        // å¯¼å‡ºä¸¤å€é€Ÿè§†é¢‘
        let exportSession = AVAssetExportSession(asset: composition, presetName: AVAssetExportPresetHighestQuality)
        exportSession?.outputURL = outputUrl
        exportSession?.outputFileType = .mp4
        exportSession?.exportAsynchronously(completionHandler: {
            switch exportSession?.status {
            case .completed:
                completion(true, nil)
            case .cancelled, .failed:
                completion(false, exportSession?.error)
            default:
                completion(false, nil)
            }
        })
    }
    ```

:::

### æ’­æ”¾å™¨

#### â“ç¼“å­˜æœºåˆ¶

::: details ğŸ’¡



:::

#### â“è¾¹æ’­è¾¹ä¸‹

::: details ğŸ’¡



:::

#### â“è®¾è®¡ä¸€ä¸ªé€šç”¨è§†é¢‘æ’­æ”¾å™¨

::: details ğŸ’¡



:::
