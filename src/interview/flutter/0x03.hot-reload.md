---
title: Hot Reload - “热重载”
icon: hashtag

index: true

---

<!-- more -->

### ❓`AOT` vs `JIT` 

::: details 💡 

`AOT`（Ahead-of-time Compilation）和`JIT`（Just-In-Time Compilation）是两种编译方式，它们都用于将高级语言编译为可以直接执行的机器语言，但编译时间和方式有所不同。

- `AOT`(Ahead Of Time) : 提前编译或运行前编译，程序运行前已经编译成对应平台的机器码，可以直接运行。
    > `AOT` 的优点：运行时可以直接执行，不会有编译的额外开销，有更快的启动速度、更高的执行效率，更小的内存占用等优势。缺点：`AOT` 直接编译机器码，所以对平台有依赖，即不同的平台需要编译不同的二进制程序，并且修改和 `debug` 相对麻烦。

- `JIT`(Just In Time) : 即时编译或运行时编译，程序运行时编译成运行平台的机器码，提高运行效率。
    > `JIT` 是一种“动态编译”技术，它并不是在打包时就完成编译，而是在运行时根据需要将某些热点代码（频繁执行或重要性很高的代码）编译成机器码后缓存起来，下次运行直接调用，大大减少了解释执行的次数，提高了执行效率。并且，因为可以在运行期进行优化，所以某些性能优化策略在 `JIT` 下会表现得更好。问题在于对于非热点代码执行效率相较 `AOT` 要低，因其额外的编译时间开销，可能会导致更慢的应用程序启动和更大的内存占用。

:::

### ❓`Hot Reload` vs `Hot Restart` vs `Hot Update`

::: details 💡 

- `Hot Reload`（热重载）：在不停止应用程序的情况下注入更新的源代码文件，`Flutter` 框架会在运行时接收更改并重新构建视图。热重载在更改代码后几乎实时更新用户界面，大大提升了开发效率。

- `Hot Restart`（热重启）：与热重载相比，热重启会将应用程序重置为其初始状态，但不需要重新编译整个应用程序。主要用于主动更改全局状态或应用程序实现的情况。与热重载相比，它花费的时间要多一些，但仍然比完全重启应用程序要短。

- `Hot Update`（热更新）：热更新主要是指在应用上线之后，对应用进行更新升级，而无需用户去应用市场重新下载安装。主要是通过下载差异包，用新包覆盖旧包中需要更新的部分实现。热更新可以及时修复线上问题，并且不需要审核。但是由于不同地区的政策法规问题，热更新并不是在所有平台上都可以使用。

总结：`Hot Reload`（热重载）和 `Hot Restart`（热重启）主要针对开发者在开发阶段；`Hot Update`（热更新）主要针对的是应用发布后的版本更新。

:::

### ❓`Flutter` 是如何实现热重载的

::: details 💡 

- `Dart` 语言：支持即时（`JIT`）编译，使得开发者可以在程序运行时修改代码。一旦代码发生变化，`Dart` 的即时编译器就会编译这些变化的代码，然后把新生成的字节码直接插入到正在运行的 `Dart` 虚拟机中。

- `Flutter` 的 `Widgets` 框架：`Widget` 和 `Element` 两个对象分别负责描述界面和实际构建界面，在热重载过程中，重新执行 `build` 方法来构建新的 `Widget` 树，老的 `Element` 树会尽可能地复用，这样既保证了状态的保存，也能够正确的显示新的 `UI`。

- 热重载时，`Dart` 会重新执行 `main()` 函数，`Flutter` 框架将新生成的 `Widget Tree` 与旧的 `Element Tree` 进行对比，并根据对比结果更新 `UI`。在这个革新过程中，应用的状态将会被保留。

:::
