---
title: Thread - â€œå¤šçº¿ç¨‹â€
icon: hashtag

index: true

---

<!-- more -->

### â“`Dart` æ˜¯ä¸æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ˜¯å¦‚ä½•è¿è¡Œçš„

::: details ğŸ’¡ 

> `Dart` æ˜¯å•çº¿ç¨‹æ‰§è¡Œæ¨¡å‹ï¼Œå®ƒçš„å¹¶å‘æ¨¡å‹åŸºäºâ€œäº‹ä»¶å¾ªç¯â€ã€‚

`Dart` ä½¿ç”¨å•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¨¡å‹ï¼Œæ‰€æœ‰çš„ `Dart` ä»£ç åœ¨ä¸€ä¸ªç§°ä¸º `Isolate` çš„å•çº¿ç¨‹æ‰§è¡Œç¯å¢ƒä¸­è¿è¡Œã€‚æ¯ä¸ª `Isolate` æœ‰è‡ªå·±çš„å†…å­˜å †ï¼Œä¸åŒçš„ `Isolate` ä¹‹é—´ä¸èƒ½å…±äº«å†…å­˜ï¼Œåªèƒ½é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¥äº¤äº’ã€‚

  äº‹ä»¶å¾ªç¯å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¤§å¾ªç¯ï¼Œåœ¨è¿™ä¸ªå¾ªç¯ä¸­ï¼Œ`Dart` è¯­è¨€ä¼šä¸æ–­å»æ£€æŸ¥äº‹ä»¶é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·äº¤äº’ã€`I/O`ã€è®¡æ—¶å™¨ç­‰ï¼‰å°±å¤„ç†äº‹ä»¶ï¼Œäº‹ä»¶å¤„ç†å®Œåå†å»æ£€æŸ¥ä¸‹ä¸€ä¸ªäº‹ä»¶ï¼Œå¦‚æœäº‹ä»¶é˜Ÿåˆ—ä¸ºç©ºåˆ™ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚

  ç”±äº `Dart` æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥é’ˆå¯¹æŸä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼Œå‡å¦‚è¿™ä¸ªä»»åŠ¡ç‰¹åˆ«è€—æ—¶ï¼Œä¼šå æ®çº¿ç¨‹å¤§é‡æ—¶é—´ï¼Œå…¶ä»–ä»»åŠ¡å°±æ— æ³•å¾—åˆ°åŠæ—¶çš„å¤„ç†ï¼Œå› æ­¤ `Dart` ä¸­æœ‰ `Microtask` å’Œ `Event` ä¸¤ç§ä»»åŠ¡é˜Ÿåˆ—ï¼Œ`Microtask` é˜Ÿåˆ—ä¼˜å…ˆçº§é«˜äº `Event` é˜Ÿåˆ—ã€‚æ‰§è¡Œé¡ºåºä¸ºï¼šå…ˆæ‰§è¡Œæ‰€æœ‰ `Microtask` ä»»åŠ¡ï¼Œç„¶åå†å¤„ç†ä¸€ä¸ª `Event` ä»»åŠ¡ï¼Œå†æ‰§è¡Œæ­¤ `Event` äº§ç”Ÿçš„æ‰€æœ‰ `Microtask`ï¼Œä¾æ­¤ç±»æ¨ã€‚

:::

### â“`Dart` å¤šä»»åŠ¡å¦‚ä½•å¹¶è¡Œçš„

::: details ğŸ’¡ 

  `Dart` æœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œå®ƒä¾èµ–äºäº‹ä»¶å¾ªç¯å’Œå¼‚æ­¥ç¼–ç¨‹ä»¥ä¾¿åœ¨å•ä¸€çº¿ç¨‹ä¸­å®Œæˆå°½å¯èƒ½å¤šçš„ä»»åŠ¡ã€‚å¯¹äºéœ€è¦å¹¶è¡Œè®¡ç®—æˆ–è€…è¯¸å¦‚æ–‡ä»¶è¯»å†™ç­‰é˜»å¡æ€§æ“ä½œï¼Œ`Dart` æä¾›äº† `Isolate` çš„æ¦‚å¿µã€‚

  `Isolate` å¯ä»¥è¢«çœ‹ä½œæ˜¯ `Dart` çš„è½»é‡çº§çº¿ç¨‹ã€‚æ¯ä¸ª `Isolate` æœ‰å…¶è‡ªå·±çš„å†…å­˜å †å¹¶ä¸”ä¸ä¸å…¶ä»– `Isolate` å…±äº«å†…å­˜ã€‚è¿™é¿å…äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å¸¸è§é—®é¢˜ï¼Œå¦‚çº¿ç¨‹é”å®šå’Œæ•°æ®ç´Šä¹±ç­‰ï¼Œå¹¶å¢å¼ºäº†å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œå› ä¸ºå†…å­˜ä¸å…±äº«ï¼Œæ‰€ä»¥ `Isolates` ä¹‹é—´åªèƒ½é€šé€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ã€‚

  `Dart` çš„å¹¶å‘å®ç°ï¼šåœ¨å•çº¿ç¨‹ä¸­å¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚æœéœ€è¦ä»»åŠ¡å¹¶è¡Œè®¡ç®—åˆ™å¯ä»¥åˆ›å»ºå¤šä¸ª `Isolates` æ¥æ‰§è¡Œä»»åŠ¡ã€‚

æ³¨æ„ï¼šè™½ç„¶æ¯ä¸ª `Isolate` æœ‰è‡ªå·±çš„äº‹ä»¶é˜Ÿåˆ—ï¼Œä½†æ˜¯åˆ›å»ºã€å¯åŠ¨å’Œç®¡ç† `Isolate` éœ€è¦ç›¸å¯¹è¾ƒé‡çš„èµ„æºï¼ˆæ¯”å¦‚å†…å­˜å’Œè®¡ç®—æ—¶é—´ï¼‰ï¼Œå¹¶ä¸”æ¶ˆæ¯ä¼ é€’å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿæœ‰ä¸€äº›å¼€é”€ã€‚æ‰€ä»¥åœ¨ç¡®å®éœ€è¦çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨ `Isolate` è¿›è¡Œå¹¶å‘æ“ä½œï¼Œä¾‹å¦‚å¤„ç† `CPU` å¯†é›†å‹ä»»åŠ¡æˆ–è€…è¿›è¡Œå¤§é‡çš„ `I/O` æ“ä½œã€‚

:::

### â“`Future` ä¸ `microtask` ä¸¤è€…çš„æ‰§è¡Œé¡ºåº

::: details ğŸ’¡ 

`Dart` ä¸­çš„äº‹ä»¶é˜Ÿåˆ—ï¼š

  - äº‹ä»¶é˜Ÿåˆ— `Event Queue`
  - å¾®ä»»åŠ¡é˜Ÿåˆ— `Microtask Queue`

åŒºåˆ«ï¼š

  - `Future` æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ° `Event Queue` ä¸­ï¼Œç„¶åæŒ‰ç…§äº‹ä»¶é¡ºåºæ¥å¤„ç†ã€‚

  - `Microtask` æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ° `Microtask Queue` ä¸­ã€‚
  
  

è¿è¡Œæœºåˆ¶ï¼š
  > `Microtask Queue` çš„ä¼˜å…ˆçº§é«˜äº `Event Queue`ï¼Œæ‰§è¡Œé¡ºåºä¸€èˆ¬æ¥è¯´ï¼Œ`Microtask` ä¼šåœ¨ `Future` ä¹‹å‰æ‰§è¡Œã€‚

  - äº‹ä»¶å¾ªç¯ä» `Microtask Queue` ä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœ `Microtask Queue` ä¸­æœ‰ä»»åŠ¡ï¼Œé‚£ä¹ˆä¸€ç›´æ‰§è¡Œåˆ° `Microtask Queue` ä¸ºç©ºã€‚

  - å½“ `Microtask Queue` ä¸ºç©ºæ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šæ£€æŸ¥ `Event Queue`ï¼Œå¦‚æœæœ‰ä»»åŠ¡ï¼Œé‚£ä¹ˆå–å‡ºä¸€ä¸ªæ‰§è¡Œï¼Œç„¶åå†å»æ‰§è¡Œ `Microtask Queue` ä¸­çš„ä»»åŠ¡ã€‚

:::

### â“`Isolate` `compute` æ˜¯å¦‚ä½•è¿è¡Œçš„

::: details ğŸ’¡ 

- `Isolate`: å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç‹¬ç«‹è¿è¡Œçš„æ‰§è¡Œçº¿ç¨‹ï¼Œå®ƒæœ‰è‡ªå·±çš„å†…å­˜ï¼ˆå †å’Œæ ˆï¼‰ï¼Œå¹¶è¿è¡Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚`Isolate` å¯ä»¥è¿è¡Œé‡å¤æˆ–è€…æŒç»­çš„ä»»åŠ¡ã€‚
    > ä¾‹å¦‚è®¡æ—¶å™¨æˆ–è€…ç›‘å¬æŸä¸ªç‰¹å®šèµ„æºçš„å˜åŒ–ï¼Œå®ƒæœ‰è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸”å¯ä»¥ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°æ˜¾å¼åœ°è¢«åœæ­¢ã€‚

    ```dart
    import 'dart:isolate';
    
    void printMessage(String message) {
      print(message);
    }
    
    void main() {
      Isolate.spawn(printMessage, 'Hello, Isolate!');
    }
    ```
    
- `compute`ï¼šè¿™ä¸ªå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `Isolate`ï¼Œæ‰§è¡Œç»™å®šçš„å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœã€‚å½“è®¡ç®—å®Œæˆåï¼Œè¿™ä¸ª `Isolate` ä¼šè¢«è‡ªåŠ¨é”€æ¯ã€‚

- `compute`: `Flutter` æä¾›çš„ä¾¿æ·å‡½æ•°ï¼Œå®ƒåœ¨å†…éƒ¨ä½¿ç”¨ `Isolate`ï¼Œå¹¶è¿”å› `Future`ï¼Œæ‰§è¡Œç»“æŸï¼Œåˆ›å»ºçš„ `Isolate` å°±ä¼šè¢«é”€æ¯ã€‚æ›´é€‚ç”¨äºå¤„ç†å•æ¬¡è€—æ—¶è®¡ç®—ä»»åŠ¡ã€‚
    > ä¾‹å¦‚ä¸€ä¸ªå¤æ‚çš„æ’åºã€è¿‡æ»¤æ“ä½œã€‚
    
    ```dart
    import 'dart:isolate';
    
    int longRunningCalculation(int value) {
      // This could be a CPU-intensive operation that lasts a long time.
      return value * 2;
    }
    
    void main() async {
      int result = await compute(longRunningCalculation, 10);
      print(result);  // Will print: 20
    }
    ```

:::
