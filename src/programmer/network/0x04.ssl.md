---
title: SSL
icon: hashtag

index: true

---

<!-- more -->

## reference

- [acme.sh](https://github.com/acmesh-official/acme.sh)
    > A pure Unix shell script implementing ACME client protocol
- [Letâ€™s Encrypt](https://letsencrypt.org/) ğŸ‘‰ğŸ» [ğŸ™](https://github.com/letsencrypt)
    > A free, automated, and open certificate authority.
    
------

- [FreeSSL](https://freessl.cn/) : ä¸€ä¸ªæä¾›å…è´¹HTTPSè¯ä¹¦ç”³è¯·çš„ç½‘ç«™
- [KeyManager](https://keymanager.org/) : æä¾›å®‰å…¨ä¾¿æ·çš„è¯ä¹¦ç”³è¯·å’Œç®¡ç†
- [SSLè¯ä¹¦æ ¼å¼è½¬æ¢å·¥å…·](https://csr.chinassl.net/convert-ssl.html)
- [Certbot](https://certbot.eff.org/)
- [keytool](https://docs.oracle.com/javase/7/docs/technotes/tools/windows/keytool.html)

## Concept

  | - | -
  | -- | --
  | SSL       | (Secure Sockets Layer) å®‰å…¨å¥—æ¥å±‚
  | TLS       | (Transport Layer Security) ä¼ è¾“å±‚å®‰å…¨ (å‡çº§ç‰ˆ SSL)
  | OpenSSL   | SSL çš„ä¸€ä¸ªå¼€æºå®ç°
  | X.509     | ä¸€ç§è¯ä¹¦æ ‡å‡† (å®šä¹‰è¯ä¹¦æ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹)
  | PKCS      | (Public Key Cryptography Standards) å…¬é’¥åŠ å¯†æ ‡å‡†
  | CA        | (Certificate Authority) æƒå¨è¯ä¹¦é¢å‘æœºæ„
  | CSR       | (Certificate Signing Request) è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œç”¨äºå‘ CA (æƒå¨è¯ä¹¦é¢å‘æœºæ„)è´­ä¹° SSL è¯ä¹¦
  | cert      | è¯ä¹¦

- è¯ä¹¦ç±»åˆ«

  | è¯ä¹¦ç±»åˆ« | è¯´æ˜
  | -- | --
  | DV (Domain Validation)        | ä¸ªä½“ç”¨æˆ· (é‚®ä»¶è®¤è¯)
  | OV (Organization Validation)  | ä¼ä¸šç”¨æˆ· (ç”µè¯è®¤è¯)
  | EV (Extended Validation)      | é«˜çº§ç”¨æˆ· (ä»¥ä¸Šä¸¤ç§éªŒè¯ & é‡‘èæœºæ„çš„å¼€å‘è®¸å¯è¯)

- ç¼–ç æ ¼å¼

  | ç¼–ç æ ¼å¼ | å…¨ç§° | å¸¸ç”¨äº | æ ¼å¼
  | --- | --- | --- | ---
  | PEM | Privacy Enhanced Mail          | Linux (Apache) | æ–‡æœ¬æ ¼å¼ : (å¼€å¤´: `-----BEGIN` å†…å®¹: BASE64ç¼–ç  ç»“å°¾: `-----END`)
  | DER | Distinguished Encoding Rules   | Windows (Java) | äºŒè¿›åˆ¶æ ¼å¼ (ä¸å¯è¯»)

- æ‰©å±•å

  | æ–‡ä»¶æ‰©å±•å | ç¼–ç  | å…¨ç§° | è¯´æ˜
  | --- | --- | --- | ---
  | .pem | PEM        | Privacy Enhanced Mail         | X.509 è¯ä¹¦
  | .der | DER        | Distinguished Encoding Rules  | X.509 è¯ä¹¦
  | .crt | PEM > DER  | Certificate                   | X.509 è¯ä¹¦
  | .cer | PEM < DER  | Certificate                   | X.509 è¯ä¹¦
  | .key | PEM or DER | Key                           | ä¸æ˜¯è¯ä¹¦, å­˜æ”¾ç§˜é’¥(å…¬é’¥ or ç§é’¥)
  | .csr | PEM or DER | Certificate Signing Request   | ä¸æ˜¯è¯ä¹¦, è¯ä¹¦ç­¾åè¯·æ±‚(å‘æƒå¨è¯ä¹¦é¢å‘æœºæ„è·å¾—ç­¾åè¯ä¹¦çš„ç”³è¯·), æ ¸å¿ƒå†…å®¹: å…¬é’¥
  | .p12 | PEM or DER | PKCS#12                       | åŒ…å«è¯ä¹¦(.crt) & ç§é’¥(.key), ä½¿ç”¨å¯†ç åŠ å¯†
  | .pfx | PEM or DER | Predecessor of PKCS#12        | (== .p12), ä¸€èˆ¬æµè§ˆå™¨ä½¿ç”¨
  | .jks | PEM or DER | Java Key Storage              | (== .p12), keytool (Java å·¥å…·) ç”Ÿæˆ, Java ä¸“åˆ©

## OpenSSL

- openssl.cnf

  | System | cnf
  | -- | --
  | Linux : `/usr/local/ssl/openssl.cnf`
  | macOS : `/System/Library/OpenSSL/openssl.cnf` or `/private/etc/ssl/openssl.cnf`

  ```bash
  $ openssl version # OpenSSL ç‰ˆæœ¬ä¿¡æ¯
  $ openssl version -a # OpenSSL ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯
  $ openssl -h # æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
  #   Options :
  #       -in         : è¾“å…¥æ–‡ä»¶
  #       -out        : è¾“å‡ºæ–‡ä»¶
  #       -inform     : è¾“å…¥æ–‡ä»¶æ ¼å¼(é»˜è®¤: PEM)
  #       -outform    : è¾“å‡ºæ–‡ä»¶æ ¼å¼(é»˜è®¤: PEM)
  #       -inkey      : è¾“å…¥çš„ç§é’¥æ–‡ä»¶
  #       -outkey     : è¾“å‡ºçš„ç§é’¥æ–‡ä»¶
  #       -passin     : è¾“å…¥æ–‡ä»¶å¯†ç (ç”¨äºè§£å¯†å·²åŠ å¯†è¾“å…¥æ–‡ä»¶)
  #       -passout    : è¾“å‡ºæ–‡ä»¶å¯†ç (ç”¨äºåŠ å¯†è¾“å‡ºæ–‡ä»¶)
  #       -pubin      : è¯»å…¥å…¬é’¥(é»˜è®¤: ç§é’¥)
  #       -pubout     : è¾“å‡ºå…¬é’¥(é»˜è®¤: ç§é’¥)
  #       -text       : ä»¥æ–‡æœ¬å½¢å¼æ‰“å°å†…å®¹
  #       -nodes      : don't DES encrypt, ä¸åŠ å¯†è¾“å‡ºç§˜é’¥
  #       -noout      : don't output, ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œä»…åšéªŒè¯
  #       -nokeys     : don't output private keys, ä¸è¾“å‡ºç§é’¥
  #       -nocerts    : don't output certificates, ä¸è¾“å‡ºè¯ä¹¦

  ## Standard 

  $ openssl ca 
  # openssl ca
  #   > CA ç­¾åè¯ä¹¦
  #       -config : é…ç½®æ–‡ä»¶ (openssl.cnf)

  $ openssl x509 -in cert.pem -text -noout # æŸ¥çœ‹ PEM æ ¼å¼è¯ä¹¦ä¿¡æ¯
  $ openssl x509 -in cert.der -inform der -text -noout # æŸ¥çœ‹ DER æ ¼å¼è¯ä¹¦ä¿¡æ¯
  $ openssl x509 -in cert.pem -outform der -out cert.der # PEM è¯ä¹¦ -> DER è¯ä¹¦
  $ openssl x509 -in cert.der -inform der -outform pem -out cert.pem # DER è¯ä¹¦ -> PEM è¯ä¹¦
  # openssl x509
  #   > X.509 æ ¼å¼è¯ä¹¦

  $ openssl req -in test.csr -text -noout # æŸ¥çœ‹ .csr è¯ä¹¦ç­¾åè¯·æ±‚ä¿¡æ¯
  $ openssl req -new -key RSA.key -out CSR.csr # ä½¿ç”¨å·²æœ‰ç§é’¥ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚
  $ openssl req -new -out CSR.csr -newkey rsa:2048 -nodes -keyout CSR.key # å‘æƒå¨è¯ä¹¦é¢å‘æœºæ„ç”³è¯·è¯ä¹¦ç­¾åè¯·æ±‚(åŒæ—¶ç”Ÿæˆç§é’¥)
  $ openssl req -new -x509 -days 365 -keyout test.key -out test.crt # ç”Ÿæˆè‡ªç­¾åçš„ X.509 è¯ä¹¦(æœ‰æ•ˆæœŸ: 1å¹´)
  # openssl req [options] <infile >outfile
  #   > è¯ä¹¦ç­¾åè¯·æ±‚ | ç”Ÿæˆè¯ä¹¦è¯·æ±‚
  #       -new : æ–°å»ºè¯·æ±‚
  #       -x509 : ç”Ÿæˆ X.509 æ ¼å¼çš„è¯ä¹¦
  #       -days : ç”Ÿæˆè¯ä¹¦çš„å¤©æ•°
  #       -extensions : ç”Ÿæˆè¯ä¹¦çš„æ‰©å±•
  #       -newkey rsa:bits : ç”Ÿæˆä¸€ä¸ª RSA çš„ç§˜é’¥
  #       -keyout : ç”Ÿæˆç§˜é’¥è¾“å‡ºæ–‡ä»¶

  $ openssl pkcs12 -in input.der -out output.pem -nodes # DER æ ¼å¼ ---> PEM æ ¼å¼
  $ openssl pkcs12 -export -in test.crt -inkey pvt.key -certfile CA.crt -out keystore.p12 # ç”Ÿæˆ keystore æ–‡ä»¶
  $ openssl pkcs12 -in keystore.p12 -clcerts -out public_key.pem  # å¯¼å‡ºå…¬é’¥
  $ openssl pkcs12 -in keystore.p12 -nocerts -nodes -out private_key.pem   # å¯¼å‡ºéåŠ å¯†ç§é’¥
  $ openssl pkcs12 -in myp12file.p12 -nocerts -nodes # åªæ˜¾ç¤ºä¸åŠ å¯†çš„ç§é’¥(ä¸æ˜¾ç¤ºè¯ä¹¦)
  # openssl pkcs12 [options]
  #   > PKCS#12
  #       -export : è¾“å‡º PKCS12 æ–‡ä»¶
  #       -inkey : ç§é’¥è¾“å…¥æ–‡ä»¶(å¦‚æœç§é’¥è¾“å…¥æ–‡ä»¶ä¸æ˜¯ -in è¾“å…¥æ–‡ä»¶)
  #       -certfile : æ·»åŠ è¯ä¹¦æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¯ä¹¦
  #       -clcerts : åªå¯¼å‡ºå®¢æˆ·ç«¯è¯ä¹¦
  #       -cacerts : åªå¯¼å‡º CA è¯ä¹¦

  $ openssl genrsa -out RSA.key 1024 # ç”Ÿæˆ RSA ç§˜é’¥(åŒ…å«ç§é’¥&å…¬é’¥)æ–‡ä»¶ (é»˜è®¤ : PEM æ ¼å¼)
  $ openssl genrsa -des3 -out root.key 2048 # ç”Ÿæˆ DES åŠ å¯†çš„çš„ç§˜é’¥æ–‡ä»¶
  # openssl genrsa [args] [numbits]
  #   > ç”Ÿæˆ RSA ç§˜é’¥ 
  #       [args]:
  #           -des3 : 3 æ¬¡ DES åŠ å¯†
  #       [numbits] : åŠ å¯†ä½æ•°

  $ openssl rsa -in test.key -text -noout # æŸ¥çœ‹ PEM æ ¼å¼ RSA åŠ å¯†ç§˜é’¥ä¿¡æ¯
  $ openssl rsa -in test.key -text -noout -inform der # æŸ¥çœ‹ DER æ ¼å¼ RSA åŠ å¯†ç§˜é’¥ä¿¡æ¯
  $ openssl rsa -in RSA.key -out PUB.key -pubout  # ä» RSA ç§˜é’¥ä¸­æå–å…¬é’¥
  $ openssl rsa -in RSA.key -out PVT.key          # ä» RSA ç§˜é’¥ä¸­æå–ç§é’¥(== RSA.key)
  $ openssl rsa -in RSA.key -text -noout          # è¾“å‡ºç§é’¥ä¿¡æ¯
  $ openssl rsa -in PUB.key -text -noout -pubin   # è¾“å‡ºå…¬é’¥ä¿¡æ¯
  $ openssl rsa -in RSA.key -des3 -out DES3.key   # åŠ å¯†ç§é’¥
  # openssl rsa [-ciphername] [-check] [-engine id] [-in file] [-inform fmt] [-modulus] [-noout] [-out file] [-outform fmt] [-passin src] [-passout src] [-pubin] [-pubout] [-sgckey] [-text]
  #   > RSA ç§˜é’¥ 
  #       -check : éªŒè¯ RSA ç§˜é’¥
  #       -pubin : å…¬é’¥è¾“å…¥
  #       -pubout : å…¬é’¥è¾“å‡º

  $ openssl rsautl -encrypt -inkey PUB.key -pubin -in test.txt -out encrypt.txt # å…¬é’¥åŠ å¯†æ–‡ä»¶
  $ openssl rsautl -decrypt -inkey PVT.key -in encrypt.txt -out decrypted.txt # ç§é’¥è§£å¯†æ–‡ä»¶
  # openssl rsautl [options]
  #   > RSA å·¥å…·
  #       -encrypt : ä½¿ç”¨å…¬é’¥åŠ å¯†
  #       -decrypt : ä½¿ç”¨ç§é’¥è§£å¯†

  ## Message Digest : ä¿¡æ¯æ‘˜è¦

  ## Cipher : ç§˜é’¥åŠ å¯†

  ```

## keytool
> Key and Certificate Management Tool

- `KeyStore` : æœåŠ¡å™¨ç§˜é’¥å­˜æ”¾å®¹å™¨ (å…¬é’¥ & ç§é’¥ & è¯ä¹¦)
- `TrustStore` : æœåŠ¡å™¨ä¿¡ä»»ç§˜é’¥å­˜æ”¾å®¹å™¨ (CAå…¬é’¥)
- keystore ä½ç½®
  | keystore | ä½ç½®
  | -- | --
  | JDK è‡ªå¸¦ | `$JAVA_HOME/jre/lib/security/cacerts`
  | é»˜è®¤ç”Ÿæˆ | `~/.keystore`

  ``` bash
  $ keytool -h # æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
  $ keytool [OPTION]...
  #   Options :
  #       -v          : è¯¦ç»†è¾“å‡º
  #       -alias      : åˆ«å
  #       -sigalg     : ç­¾åç®—æ³•åç§°
  #       -file       : è¾“å‡ºæ–‡ä»¶å
  #       -keystore   : å¯†é’¥åº“åç§° (é»˜è®¤: ~/.keystore)
  #       -storetype  : å¯†é’¥åº“ç±»å‹
  #       -storepass  : ç§˜é’¥åº“å£ä»¤(å¯†ç )
  #       -dname      : 

  $ keytool -certreq -alias test.com -keystore keystore.jks -file test.csr # é€šè¿‡ç§˜é’¥æ–‡ä»¶åˆ›å»ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶(CSR)
  # keytool -certreq [OPTION]...          
  #   > ç”Ÿæˆè¯ä¹¦è¯·æ±‚
  #       -file : è¾“å‡ºçš„æ–‡ä»¶å

  $ keytool -changealias -alias one -destalias two -keystore keystore.jks # ä¿®æ”¹åˆ«å one ä¸º two
  # keytool -changealias [OPTION]...        
  #   > æ›´æ”¹æ¡ç›®çš„åˆ«å

  $ keytool -delete -alias test -keystore keystore.jks # åˆ é™¤æŒ‡å®šåˆ«å
  # keytool -delete [OPTION]...            
  #   > åˆ é™¤æ¡ç›®

  $ keytool -export -alias test -keystore keystore.jks -file test.cer # ä»ç§˜é’¥åº“ä¸­å¯¼å‡ºåˆ«åä¸º test çš„è¯ä¹¦
  # keytool -exportcert (== -export) [OPTION]...         
  #   > å¯¼å‡ºè¯ä¹¦

  $ keytool -genkey -alias test -keyalg RSA -keysize 2048 -keystore keystore.jks 
  $ keytool -genkey -alias test.com -dname "CN=NG,OU=Test,O=Test,L=ChaoYang,ST=BeiJing,C=CN" -storetype PKCS12 -keyalg RSA -keysize 2048 -keystore keystore.p12 -validity 365
  $ keytool -genkey \
            -deststoretype pkcs12 \
            -alias CA_ROOT \
            -validity 3500 \
            -keystore CA_ROOT.keystore \
            -keyalg RSA \
            -keysize 2048 \
            -storepass 123456
  # keytool -genkeypair (== -genkey) [OPTION]...       
  #   > ç”Ÿæˆå¯†é’¥å¯¹
  #       -keyalg : ç§˜é’¥ç®—æ³•
  #       -keysize : ç§˜é’¥ä½é•¿åº¦

  $ keytool -genseckey 
  # keytool -genseckey [OPTION]...          
  #   > ç”Ÿæˆå¯†é’¥

  $ keytool -gencert 
  # keytool -gencert [OPTION]...            
  #   > æ ¹æ®è¯ä¹¦è¯·æ±‚ç”Ÿæˆè¯ä¹¦
  $ keytool -import -trustcacerts -alias test.com -file test.com.crt -keystore keystore.jks
  # keytool -importcert (== -import) [OPTION]...     
  #   > å¯¼å…¥è¯ä¹¦æˆ–è¯ä¹¦é“¾
  #       -trustcacerts : å—ä¿¡ä»»çš„ CA è¯ä¹¦
  #       -file : è¯ä¹¦æ–‡ä»¶(CA é¢å‘çš„è¯ä¹¦)

  $ keytool -importpass
  # keytool -importpass [OPTION]...         
  #   > å¯¼å…¥å£ä»¤

  $ keytool -importkeystore
  # keytool -importkeystore [OPTION]...     
  #   > ä»å…¶ä»–å¯†é’¥åº“å¯¼å…¥ä¸€ä¸ªæˆ–æ‰€æœ‰æ¡ç›®

  $ keytoll -keypasswd 
  # keytool -keypasswd [OPTION]...          
  #   > æ›´æ”¹æ¡ç›®çš„å¯†é’¥å£ä»¤

  $ keytool -list -v -keystore keystore.jks # æŸ¥çœ‹ keystore åˆ—è¡¨
  $ keytool -list -v -keystore keystore.jks -alias test # æŸ¥çœ‹æŒ‡å®šåˆ«å
  # keytool -list [OPTION]...               
  #   > åˆ—å‡ºå¯†é’¥åº“ä¸­çš„æ¡ç›®

  $ keytool -printcert -v -file test.crt # æŸ¥çœ‹è¯ä¹¦å†…å®¹
  # keytool -printcert [OPTION]...          
  #   > æ‰“å°è¯ä¹¦å†…å®¹

  $ keytool -printcertreq -v -file test.csr # æŸ¥çœ‹è¯ä¹¦è¯·æ±‚å†…å®¹
  # keytool -printcertreq [OPTION]...       
  #   > æ‰“å°è¯ä¹¦è¯·æ±‚çš„å†…å®¹

  $ keytool -printcrl 
  # keytool -printcrl [OPTION]...           
  #   > æ‰“å° CRL æ–‡ä»¶çš„å†…å®¹

  $ keytool -storepasswd -new [NEW_PW] -keystore keystore.jks # ä¿®æ”¹ keystore å¯†ç 
  # keytool -storepasswd [OPTION]...        
  #   > æ›´æ”¹å¯†é’¥åº“çš„å­˜å‚¨å£ä»¤
  ```

## Letâ€™s Encrypt
> A free, automated, and open certificate authority.

- ç”Ÿæˆè¯ä¹¦ä½ç½® : `/etc/letsencrypt/live/$domain`
- ç”Ÿæˆæ–‡ä»¶è¯´æ˜
  | æ–‡ä»¶ | è¯´æ˜
  | --- | ---
  | `privkey.pem`     | è¯ä¹¦çš„ç§é’¥
  | `cert.pem`        | æœåŠ¡å™¨è¯ä¹¦
  | `chain.pem`       | æµè§ˆå™¨éªŒè¯æœåŠ¡å™¨è¯ä¹¦æ‰€éœ€çš„è¯ä¹¦(æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦)
  | `fullchain.pem`   | æ‰€æœ‰è¯ä¹¦(åŒ…å«ä¸Šé¢ä¸¤ä¸ªè¯ä¹¦), ç¬¬ä¸€ä¸ªæ˜¯æœåŠ¡å™¨è¯ä¹¦

  ```bash
  $ certbot certonly # ç”Ÿäº§è¯ä¹¦
  $ certbot certonly --standalone -d example.com
  $ certbot certonly --webroot -w /var/www/example -d example.com
  # certbot certonly 
  #   > ç”Ÿæˆè¯ä¹¦
  #       --standalone    
  #       --webroot  
  $ certbot renew --dry-run     

  # å¯¼å‡º Java Keytool ä½¿ç”¨çš„ PKCS#12 ç§˜é’¥åº“æ–‡ä»¶
  $ openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out keystore.p12 -name tomcat -CAfile chain.pem -caname root
  ```

  