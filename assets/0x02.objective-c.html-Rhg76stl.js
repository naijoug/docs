import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as e,o,c as p,a as c,b as n,e as i,d as l,f as s}from"./app-l4r5h6ev.js";const u={},d=s(`<h2 id="concept" tabindex="-1"><a class="header-anchor" href="#concept" aria-hidden="true">#</a> concept</h2><ul><li>Foundation &amp; Core Foundation</li></ul><table><thead><tr><th>framework</th><th>说明</th></tr></thead><tbody><tr><td><code>Foundation</code></td><td>OC 对象</td></tr><tr><td><code>Core Foundation</code></td><td>C 结构体类型</td></tr></tbody></table><ul><li><code>__bridge</code> &amp; <code>__bridge_retained</code> &amp; <code>__bridge_transfer</code></li></ul><table><thead><tr><th>桥接方法</th><th>说明</th></tr></thead><tbody><tr><td><code>__bridge</code></td><td></td></tr><tr><td><code>__bridge_retained</code></td><td><code>Foundation -&gt; Core Foundation</code></td></tr><tr><td><code>__bridge_transfer</code></td><td><code>Core Foundation -&gt; Foundation</code></td></tr></tbody></table><ul><li>id &amp; instancetype</li></ul><table><thead><tr><th>类型</th><th>相同点</th><th>不同点</th></tr></thead><tbody><tr><td><code>id</code></td><td>可以表示任何对象</td><td>可以用在返回值和参数类型上</td></tr><tr><td><code>instancetype</code></td><td>可以表示任何对象</td><td>只能用在返回值类型上，编译器会检测 instancetype 的真实类型</td></tr></tbody></table><ul><li>load &amp; initialize</li></ul><table><thead><tr><th>方法</th><th>调用时机</th><th>子类实现</th><th>分类实现</th><th>调用顺序</th></tr></thead><tbody><tr><td><code>load</code></td><td>第一次装载进内存时调用</td><td>不会覆盖父类</td><td>不会覆盖原始类</td><td><code>父类 -&gt; 子类 -&gt; 分类</code></td></tr><tr><td><code>initialize</code></td><td>第一次使用这个类时调用</td><td>会覆盖父类</td><td>会覆盖原始类</td><td><code>父类 or 子类 or 分类</code></td></tr></tbody></table><ul><li>@property</li></ul><table><thead><tr><th>属性</th><th>特性</th><th>说明</th></tr></thead><tbody><tr><td><code>readwrite</code></td><td>可读可写</td><td>生成 getter 方法和 setter 方法</td></tr><tr><td><code>readonly</code></td><td>只读</td><td>只会生成 getter 方法，不会生成 setter 方法</td></tr><tr><td><code>retain</code></td><td>持有</td><td>setter 方法将传入参数先持有(retain count +1)，再赋值</td></tr><tr><td><code>nonatomic</code></td><td>非原子</td><td>非线程安全，编译更快</td></tr><tr><td><code>atomic</code></td><td>原子</td><td>原子操作，保证线程安全</td></tr><tr><td><code>assign</code></td><td>赋值</td><td>setter 方法将传入参数赋值给实例变量</td></tr><tr><td><code>weak</code></td><td>弱引用</td><td>对象被销毁时，会被设置nil</td></tr><tr><td><code>strong</code></td><td>强引用</td><td></td></tr><tr><td><code>copy</code></td><td>复制</td><td>类似 strong，在赋值时进行 copy 而不是 retain，用于不可变对象，防止使用过程中被篡改(如：字符串，block)</td></tr><tr><td><code>unsafe_unretained</code></td><td>不安全的不持有</td><td>类似 weak，对象销毁时，不会被设置为 nil，比 weak 效率更高</td></tr><tr><td><code>nonnull</code></td><td>不为空</td><td></td></tr><tr><td><code>nullable</code></td><td>可为空</td><td></td></tr></tbody></table><ul><li><code>@synthesize</code> &amp; <code>@dynamic</code></li></ul><table><thead><tr><th>修饰符</th><th>说明</th></tr></thead><tbody><tr><td><code>@synthesize</code></td><td>编译器自动生成 getter 和 setter</td></tr><tr><td><code>@dynamic</code></td><td>显式表示不希望编译器生成 getter 和 setter</td></tr></tbody></table><ul><li>category &amp; extension</li></ul><table><thead><tr><th>类型</th><th>加载时机</th><th>说明</th></tr></thead><tbody><tr><td>category</td><td>运行时</td><td>分类，用于扩展现有类功能</td></tr><tr><td>extension</td><td>编译时</td><td>一种特殊的(匿名) category，只能存在原始类 .m 文件中</td></tr></tbody></table><ul><li><code>#include</code> &amp; <code>#import</code> &amp; <code>@class</code></li></ul><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>#include</code></td><td>C/C++ 导入关键字</td></tr><tr><td><code>#import</code></td><td>OC 导入关键字，只导入一次，不会重复导入</td></tr><tr><td><code>@class</code></td><td>头文件引用类</td></tr></tbody></table><ul><li>协变 &amp; 逆变</li></ul><blockquote><p>iOS 9，泛型使用</p></blockquote><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>__covariant</code></td><td>协变，子类转父类</td></tr><tr><td><code>__contravariant</code></td><td>逆变，父类转子类</td></tr></tbody></table><h2 id="kvc-kvo" tabindex="-1"><a class="header-anchor" href="#kvc-kvo" aria-hidden="true">#</a> KVC &amp; KVO</h2><ul><li><code>KVC</code>（Key Value Coding） <blockquote><p>是一种间接更改对象状态的方式，使用字符串来描述对象需要更改的属性(以字符串的形式向对象发送消息)。</p></blockquote></li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code>valueForKey<span class="token punctuation">:</span>                <span class="token comment">// 获取对象的属性值</span>
setValue<span class="token punctuation">:</span>ForKey<span class="token punctuation">:</span>            <span class="token comment">// 修改对象的属性值</span>

<span class="token comment">// 键路径(Key Path) : 类似属性的链式访问</span>
valueForKeyPath<span class="token punctuation">:</span>            <span class="token comment">// 通过</span>
setValue<span class="token punctuation">:</span>forKeyPath<span class="token punctuation">:</span>        <span class="token comment">// </span>

<span class="token comment">// 批处理</span>
dictionaryWithValuesForKeys<span class="token punctuation">:</span>    <span class="token comment">// </span>
dictionaryWithObjects<span class="token punctuation">:</span>forKeys<span class="token punctuation">:</span>  <span class="token comment">// </span>
setValuesForKeysWithDictionary<span class="token punctuation">:</span> <span class="token comment">// </span>

<span class="token comment">// 键路径的运算符</span>
<span class="token comment">//   在键路径中，可以引用一些运算符来进行一些运算，例如获取一组值的平均值、最小值、最大值或者总数。</span>
<span class="token comment">//1. 例如，计算Student中Book的总数</span>
NSNumber <span class="token operator">*</span>count <span class="token operator">=</span> <span class="token punctuation">[</span>student<span class="token punctuation">.</span>books valueForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;@count&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   
<span class="token comment">//或者</span>
NSNumber <span class="token operator">*</span>count <span class="token operator">=</span> <span class="token punctuation">[</span>student valueForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;books.@count&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//2. 计算Student中所有Book的价钱(price)总和</span>
NSNumber <span class="token operator">*</span>sum <span class="token operator">=</span> <span class="token punctuation">[</span>student<span class="token punctuation">.</span>books valueForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;@sum.price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//或者</span>
NSNumber <span class="token operator">*</span>sum <span class="token operator">=</span> <span class="token punctuation">[</span>student valueForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;books.@sum.price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//3. 找出Student中Book的所有不同价位(排除相同价位)</span>
NSArray <span class="token operator">*</span>prices <span class="token operator">=</span> <span class="token punctuation">[</span>student<span class="token punctuation">.</span>books valueForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;@distinctUnionOfObjects.price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//或者</span>
NSArray <span class="token operator">*</span>prices <span class="token operator">=</span> <span class="token punctuation">[</span>student valueForKeyPath<span class="token punctuation">:</span><span class="token string">@&quot;books.@distinctUnionOfObjects.price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>KVO</code> (Key Value Observing) <blockquote><p>KVO 是一种非常重要的机制，它允许监听对象的属性的变化。</p></blockquote></li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">/**
    注册监听器
        anObserver ：监听器对象
        keyPath ：监听的属性
        options ：决定了当属性改变时，要传递什么数据给监听器
*/</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addObserver<span class="token punctuation">:</span><span class="token punctuation">(</span>NSObject <span class="token operator">*</span><span class="token punctuation">)</span>anObserver forKeyPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>keyPath options<span class="token punctuation">:</span><span class="token punctuation">(</span>NSKeyValueObservingOptions<span class="token punctuation">)</span>options context<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>context

<span class="token comment">/** 
    监听器需要实现监听方法
        keyPath ：监听的属性
        object ：谁的属性改变了
        change ：属性改变时传递过来的信息（取决于添加监听器时的options参数）
*/</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> observeValueForKeyPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>keyPath ofObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>object change<span class="token punctuation">:</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span>change context<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>context

<span class="token comment">/** 移除监听器 */</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>removeObserver<span class="token punctuation">:</span><span class="token punctuation">(</span>NSObject <span class="token operator">*</span><span class="token punctuation">)</span>observer forKeyPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>keyPath

<span class="token comment">// 手动设定KVO</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setAge<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>age <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> willChangeValueForKey<span class="token punctuation">:</span><span class="token string">@&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    _age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> didChangeValueForKey<span class="token punctuation">:</span><span class="token string">@&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>age <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>automaticallyNotifiesObserversForKey<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>key <span class="token punctuation">{</span>
    <span class="token comment">// 如果监测到键值为age,则指定为非自动监听对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>key isEqualToString<span class="token punctuation">:</span><span class="token string">@&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> NO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">super</span> automaticallyNotifiesObserversForKey<span class="token punctuation">:</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="block" tabindex="-1"><a class="header-anchor" href="#block" aria-hidden="true">#</a> Block</h2>`,26),r={href:"http://fuckingblocksyntax.com/",target:"_blank",rel:"noopener noreferrer"},k=s(`<div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 定义 block</span>
<span class="token comment">//      本地变量</span>
<span class="token function">returnType</span> <span class="token punctuation">(</span><span class="token operator">^</span>blockName<span class="token punctuation">)</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token function">returnType</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//      属性</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">,</span> nullability<span class="token punctuation">)</span> <span class="token function">returnType</span> <span class="token punctuation">(</span><span class="token operator">^</span>blockName<span class="token punctuation">)</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//      方法参数类型</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>someMethodThatTakesABlock<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token function">returnType</span> <span class="token punctuation">(</span><span class="token operator">^</span>nullability<span class="token punctuation">)</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">)</span><span class="token punctuation">)</span>blockName<span class="token punctuation">;</span>
<span class="token comment">//      方法调用参数</span>
<span class="token punctuation">[</span>someObject someMethodThatTakesABlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">returnType</span> <span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//      C 函数参数类型</span>
<span class="token keyword">void</span> <span class="token function">SomeFunctionThatTakesABlock</span><span class="token punctuation">(</span><span class="token function">returnType</span> <span class="token punctuation">(</span><span class="token operator">^</span>blockName<span class="token punctuation">)</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//      定义一个类型</span>
<span class="token keyword">typedef</span> <span class="token function">returnType</span> <span class="token punctuation">(</span><span class="token operator">^</span>TypeName<span class="token punctuation">)</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
TypeName blockName <span class="token operator">=</span> <span class="token operator">^</span><span class="token function">returnType</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Block 内存机制</li></ul><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>NSMallocBlock</code></td><td>存储于堆区</td></tr><tr><td><code>NSStackBlock</code></td><td>存储于栈区</td></tr><tr><td><code>NSGlobalBlock</code></td><td>存储于程序数据区</td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>blk<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

blk <span class="token function">returnBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">^</span><span class="token punctuation">{</span> <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;val = %d&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改 Block 之外的局部变量，需要使用 __block 关键字</span>
    __block <span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 强引用 block : 存放在堆上</span>
    __strong blk strongPointerBlock <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span> <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;val = %d&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">strongPointerBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;strongPointerBlock: %@&quot;</span><span class="token punctuation">,</span> strongPointerBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 弱应用 block : 存放在栈上</span>
    __weak blk weakPointerBlock <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span> <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;val = %d&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">weakPointerBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;weakPointerBlock: %@&quot;</span><span class="token punctuation">,</span> weakPointerBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 弱引用 copy block : 存放在堆上</span>
    blk copyBlock <span class="token operator">=</span> <span class="token punctuation">[</span>weakPointerBlock copy<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">copyBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;copyBlock: %@&quot;</span><span class="token punctuation">,</span> copyBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 临时 block : 存放在栈上</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;tempBlock %@&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span> <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;val = %d&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// block 作为返回值 : 存放在栈上</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;returnBlock: %@&quot;</span><span class="token punctuation">,</span> <span class="token function">returnBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Block vs 函数指针</li></ul><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Block</td><td>一个函数对象，包含函数信息，有类型限制</td></tr><tr><td>函数指针</td><td>是一个地址，不具备函数原型信息，没有类型限制</td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 定义函数指针</span>
<span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义 Block</span>

<span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 调用函数指针</span>
<span class="token function">block</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 调用 Block</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>解除循环引用 <ol><li>局部变量默认都是强引用的，离开其所在的作用域之后就会被释放</li><li>使用 <code>__weak</code> 关键字，可以将局部变量声明为弱引用</li><li>在 Block 中引用 <code>weakSelf</code>，则 Block 不会再对 <code>self</code> 做强引用</li></ol></li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> NSMutableArray <span class="token operator">*</span>myBlocks<span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token punctuation">(</span><span class="token operator">^</span>sum<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> sum<span class="token punctuation">:</span>x y<span class="token punctuation">:</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 形成循环引用</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>myBlocks addObject<span class="token punctuation">:</span>sum<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 修改 block 解除循环引用</span>
__weak DemoObj <span class="token operator">*</span>weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token punctuation">(</span><span class="token operator">^</span>sum<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>weakSelf sum<span class="token punctuation">:</span> x y<span class="token punctuation">:</span> y<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="copy" tabindex="-1"><a class="header-anchor" href="#copy" aria-hidden="true">#</a> Copy</h2><ul><li>深复制 &amp; 潜复制 <blockquote><p>只有不可变对象创建不可变副本(copy)才是浅复制，其他都是深复制</p></blockquote></li></ul><table><thead><tr><th>复制类型</th><th>说明</th></tr></thead><tbody><tr><td>深复制</td><td>内容拷贝，源对象和副本指向的是不同的两个对象；源对象引用计数器不变，副本计数器设置为1</td></tr><tr><td>浅复制</td><td>指针拷贝，源对象和副本指向的是同一个对象；对象的引用计数器+1</td></tr></tbody></table><ul><li><code>Copy</code> &amp; <code>MutableCopy</code><blockquote><p>使用 <code>copy</code> 或 <code>mutableCopy</code> 方法可以创建一个对象的副本</p></blockquote></li></ul><table><thead><tr><th>复制类型</th><th>说明</th></tr></thead><tbody><tr><td><code>copy</code></td><td>需要实现<code>NSCopying</code>协议，创建的是不可变副本(如<code>NSString</code>、<code>NSArray</code>、<code>NSDictionary</code>)</td></tr><tr><td><code>mutableCopy</code></td><td>需要先实现<code>NSMutableCopying</code>协议，创建的是可变副本(如<code>NSMutableString</code>、<code>NSMutableArray</code>、<code>NSMutableDictionary</code>)</td></tr></tbody></table><table><thead><tr><th>源对象</th><th>复制方式</th><th>副本</th></tr></thead><tbody><tr><td>NSArray NSMutableArray</td><td>copy</td><td>NSArray</td></tr><tr><td></td><td>mutableCopy</td><td>NSMutableArray</td></tr><tr><td>NSDictionary NSMutableDictionary</td><td>copy</td><td>NSDictionary</td></tr><tr><td></td><td>mutableCopy</td><td>NSMutableDictionary</td></tr><tr><td>NSString NSMutableString</td><td>copy</td><td>NSString</td></tr><tr><td></td><td>mutableCopy</td><td>NSMutableString</td></tr></tbody></table><ul><li>自定义类添加复制功能 <blockquote><p>如果想自定义 <code>copy</code>, 那么就必须遵守 <code>NSCopying</code>, 并且实现 <code>copyWithZone:</code> 方法</p><p>如果想自定义 <code>mutableCopy</code>, 那么就必须遵守 <code>NSMutableCopying</code>, 并且实现 <code>mutableCopyWithZone:</code> 方法</p></blockquote></li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 以copy为例,建议用[self class]代替直接类名</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>copyWithZone<span class="token punctuation">:</span><span class="token punctuation">(</span>NSZone <span class="token operator">*</span><span class="token punctuation">)</span>zone <span class="token punctuation">{</span>
    id copy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> class<span class="token punctuation">]</span> allocWithZone<span class="token punctuation">:</span> zone<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 属性的初始化.....</span>
    <span class="token keyword">return</span> copy<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 自定义对象的copyWithZone</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>copyWithZone<span class="token punctuation">:</span><span class="token punctuation">(</span>NSZone <span class="token operator">*</span><span class="token punctuation">)</span>zone <span class="token punctuation">{</span>
    Person <span class="token operator">*</span>p   <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> class<span class="token punctuation">]</span> allocWithZone<span class="token punctuation">:</span> zone<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>  
    p<span class="token punctuation">.</span>name      <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    p<span class="token punctuation">.</span>age       <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>age<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="foundation" tabindex="-1"><a class="header-anchor" href="#foundation" aria-hidden="true">#</a> Foundation</h2><h3 id="nsobject" tabindex="-1"><a class="header-anchor" href="#nsobject" aria-hidden="true">#</a> NSObject</h3><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 判断是否为aClass或者aClass的子类的实例</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>isKindOfClass<span class="token punctuation">:</span><span class="token punctuation">(</span>Class<span class="token punctuation">)</span>aClass
<span class="token comment">// 判断是否为aClass的实例(不包括aClass的子类)</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>isMemberOfClass<span class="token punctuation">:</span><span class="token punctuation">(</span>Class<span class="token punctuation">)</span>aClass
<span class="token comment">// 判断对象是否实现了aProtocol协议</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>conformsToProtocol<span class="token punctuation">:</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span>aProtocol
<span class="token comment">// 判断这个类的对象是否拥有参数提供的方法</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>instancesRespondToSelector<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector
<span class="token comment">// 判断对象是否拥有参数提供的方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>respondsToSelector<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector
<span class="token comment">// 延迟调用参数提供的方法，方法所需参数用withObject传入</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>performSelector<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector withObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>anArgument afterDelay<span class="token punctuation">:</span><span class="token punctuation">(</span>NSTimeInterval<span class="token punctuation">)</span>delay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nil-nil-nsnull" tabindex="-1"><a class="header-anchor" href="#nil-nil-nsnull" aria-hidden="true">#</a> nil &amp; NIL &amp; NSNull</h3><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>nil</code></td><td>一个空地址，可以存放在集合中</td></tr><tr><td><code>NIL</code></td><td>等价于 <code>nil</code></td></tr><tr><td><code>NSNull</code></td><td>一个指向 <code>nil</code> 的对象，不能存放在集合中</td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token operator">+</span> <span class="token punctuation">(</span>NSNull <span class="token operator">*</span><span class="token punctuation">)</span>null<span class="token punctuation">;</span>
<span class="token comment">// [NSNull null]总是返回一样的值，所以可以用==将该值与其他值进行比较</span>
    
NSMutableDictionary <span class="token operator">*</span>dict <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableDictionary dictionary<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>dict setValue<span class="token punctuation">:</span><span class="token punctuation">[</span>NSNull null<span class="token punctuation">]</span> forKey<span class="token punctuation">:</span><span class="token string">@&quot;work number&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
id value <span class="token operator">=</span> <span class="token punctuation">[</span>dict valueForKey<span class="token punctuation">:</span><span class="token string">@&quot;work number&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token punctuation">[</span>NSNull null<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;work number doesn&#39;t exist.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nsnumber-nsvalue" tabindex="-1"><a class="header-anchor" href="#nsnumber-nsvalue" aria-hidden="true">#</a> NSNumber &amp; NSValue</h3><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>NSNumber</code></td><td>将基本数据类型包装成对象</td></tr><tr><td><code>NSValue</code></td><td>可以包装任意值(包括结构体)</td></tr></tbody></table><h3 id="nsstring-nsmutablestring" tabindex="-1"><a class="header-anchor" href="#nsstring-nsmutablestring" aria-hidden="true">#</a> NSString &amp; NSMutableString</h3><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>NSString</code></td><td>不可变的,不能删除字符或者添加字符。</td></tr><tr><td><code>NSMutableString</code></td><td>NSString 的子类，可变字符串</td></tr></tbody></table><h3 id="nsarray-nsmutablearray" tabindex="-1"><a class="header-anchor" href="#nsarray-nsmutablearray" aria-hidden="true">#</a> NSArray &amp; NSMutableArray</h3><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>NSArray</code></td><td>用来存储对象的有序列表，它是不可变的</td></tr><tr><td><code>NSMutableArray</code></td><td>NSArray 的子类，可变有序列表，可以添加和删除</td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 让集合里面的所有元素都执行 aSelector 这个方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>makeObjectsPerformSelector<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>makeObjectsPerformSelector<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector withObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>argument<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nsdictionary-nsmutabledictionary" tabindex="-1"><a class="header-anchor" href="#nsdictionary-nsmutabledictionary" aria-hidden="true">#</a> NSDictionary &amp; NSMutableDictionary</h3><blockquote><p>注 : key 需要实现 <code>NSCopying</code> 协议</p></blockquote><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>NSDictionary</code></td><td>不可变的键值对存储对象</td></tr><tr><td><code>NSMutableDictionary</code></td><td>NSDictionary 的子类，可变对象</td></tr></tbody></table><h3 id="nsattributedstring" tabindex="-1"><a class="header-anchor" href="#nsattributedstring" aria-hidden="true">#</a> NSAttributedString</h3><table><thead><tr><th>属性名</th><th>说明</th></tr></thead><tbody><tr><td><code>NSKernAttributeName</code></td><td>调整字句 (kerning 字句调整)</td></tr><tr><td><code>NSFontAttributeName</code></td><td>设置字体</td></tr><tr><td><code>NSForegroundColorAttributeName</code></td><td>设置文字颜色</td></tr><tr><td><code>NSParagraphStyleAttributeName</code></td><td>设置段落样式</td></tr><tr><td><code>NSBackgroundColorAttributeName</code></td><td>设置背景颜色</td></tr><tr><td><code>NSStrokeColorAttributeName</code></td><td>设置文字描边颜色，需要和<code>NSStrokeWidthAttributeName</code>设置描边宽度，这样就能使文字空心.</td></tr><tr><td><code>NSStrokeWidthAttributeName</code></td><td>设置描边宽度</td></tr><tr><td><code>NSStrikethroughStyleAttributeName</code></td><td>添加删除线，(<code>strikethrough</code> 删除线)</td></tr><tr><td><code>NSUnderlineStyleAttributeName</code></td><td>添加下划线</td></tr><tr><td><code>NSShadowAttributeName</code></td><td>设置阴影，单独设置不好使，必须和其他属性搭配才好使。</td></tr><tr><td><code>NSVerticalGlyphFormAttributeName</code></td><td>该属性所对应的值是一个 <code>NSNumber</code> 对象(整数)。0 表示横排文本。1 表示竖排文本。在 <code>iOS</code> 中，总是使用横排文本，0 以外的值都未定义。</td></tr><tr><td><code>NSObliquenessAttributeName</code></td><td>设置字体倾斜。(<code>Skew</code> 斜)</td></tr><tr><td><code>NSExpansionAttributeName</code></td><td>设置文本扁平化</td></tr></tbody></table><h3 id="cgpoint-cgsize-cgrect" tabindex="-1"><a class="header-anchor" href="#cgpoint-cgsize-cgrect" aria-hidden="true">#</a> CGPoint &amp; CGSize &amp; CGRect</h3><pre><code>&gt; 定义位置 ：\`CoreGraphics/CGGeometry.h\`
</code></pre><table><thead><tr><th>结构体</th><th>创建方法</th><th>说明</th></tr></thead><tbody><tr><td><code>CGPoint</code></td><td><code>CGPointMake()</code></td><td>平面中的一个点 (x, y) 的位置</td></tr><tr><td><code>CGSize</code></td><td><code>CGSizeMake()</code></td><td>宽度和高度</td></tr><tr><td><code>CGRect</code></td><td><code>CGRectMake()</code></td><td>位置和宽高</td></tr></tbody></table><h3 id="nsrange" tabindex="-1"><a class="header-anchor" href="#nsrange" aria-hidden="true">#</a> NSRange</h3><blockquote><p>这个结构体用来表示一个范围</p></blockquote><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 创建 NSRange 变量</span>
<span class="token comment">// 例：“I love objective-c” 中的 “obj” 可以用 location 为 7，length 为 3 的范围来表示</span>
<span class="token comment">// 1. 直接给成员赋值</span>
NSRange range<span class="token punctuation">;</span>
range<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
range<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 应用 C 语言的聚合结构赋值机制</span>
NSRange range <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//或者 </span>
NSRange range <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
<span class="token comment">// 3. Foundation 框架提供的快捷函数 NSMakeRange</span>
NSRange range <span class="token operator">=</span> <span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nsdate" tabindex="-1"><a class="header-anchor" href="#nsdate" aria-hidden="true">#</a> NSDate</h3><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code>NSDateFormatter <span class="token operator">*</span>formatter  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSDateFormatter alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
formatter<span class="token punctuation">.</span>dateFormat        <span class="token operator">=</span> <span class="token string">@&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 将 NSString 转换为 NSDate</span>
NSDate <span class="token operator">*</span>date                <span class="token operator">=</span> <span class="token punctuation">[</span>formatter dateFromString<span class="token punctuation">:</span><span class="token string">@&quot;2018-10-29 00:00:00&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 将 NSDate 转换为 NSString</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>formatter stringFromDate<span class="token punctuation">:</span> date<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nsassert" tabindex="-1"><a class="header-anchor" href="#nsassert" aria-hidden="true">#</a> NSAssert</h3><blockquote><p>断言<code>NSAssert</code>仅在 debug 版本起作用，用于检查“不应该”发生的情况。可以把<code>NSAssert</code>看成一个在任何系统状态下都可以安全使用的无害测试手段</p></blockquote><h3 id="nspredicate" tabindex="-1"><a class="header-anchor" href="#nspredicate" aria-hidden="true">#</a> NSPredicate</h3><blockquote><p>谓词，用于判断条件表达式的求值返回真或假的过程</p></blockquote><ul><li><p>特点</p><ul><li>谓词中的匹配指令使用大写字母</li><li>谓词中可以使用格式字符串</li><li>如果通过对象的 key path 指定匹配条件，需要使用 %K</li></ul></li><li><p>逻辑指令</p><ol><li><code>&amp;&amp;</code></li><li><code>||</code></li><li><code>！</code></li><li><code>&lt;</code></li><li><code>&lt;=</code></li><li><code>==</code></li><li><code>&gt;</code></li><li><code>&gt;=</code></li><li><code>BETWEEN {}</code></li></ol></li><li><p>字符串匹配</p></li></ul><table><thead><tr><th>字符串匹配</th><th>说明</th></tr></thead><tbody><tr><td><code>BEGANWITH</code></td><td>以指定字符开始</td></tr><tr><td><code>ENDSWITH</code></td><td>以指定字符结束</td></tr><tr><td><code>CONTAINS</code></td><td>包含指定字符，可使用修饰符，<code>c</code> 不区分大小写， <code>d</code> 不区分注音符号</td></tr><tr><td><code>LIKE</code></td><td>使用通配符匹配， <code>？</code> 一个字符，<code>*</code> 0个或多个字符</td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 1. 简单示例</span>
NSPredicate <span class="token operator">*</span>predicate  <span class="token operator">=</span> <span class="token punctuation">[</span>NSPredicate predicateWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;self CONTAINS &#39;1&#39;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
NSString <span class="token operator">*</span>text          <span class="token operator">=</span> <span class="token string">@&quot;1234&quot;</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>predicate evaluateWithObject<span class="token punctuation">:</span> text<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 过滤年龄大于5 &amp; 小于15，并且名字包含 1 的用户</span>
<span class="token comment">//  1&gt; 传统方法</span>
NSMutableArray <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableArray arrayWithCapacity<span class="token punctuation">:</span> personList<span class="token punctuation">.</span>count<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>NSInteger i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> personList<span class="token punctuation">.</span>count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Person <span class="token operator">*</span>person <span class="token operator">=</span> personList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span>age <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> person<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token number">15</span> <span class="token operator">&amp;&amp;</span> NSNotFound <span class="token operator">!=</span> <span class="token punctuation">[</span>person<span class="token punctuation">.</span>name rangeOfString<span class="token punctuation">:</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>location<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>result addObject<span class="token punctuation">:</span> person<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token comment">//  2&gt; 谓词方法</span>
NSPredicate <span class="token operator">*</span>predicate <span class="token operator">=</span> <span class="token punctuation">[</span>NSPredicate predicateWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;name CONTAINS &#39;1&#39; &amp;&amp; %K BETWEEN {%d, %d}&quot;</span><span class="token punctuation">,</span> <span class="token string">@&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
NSArray <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token punctuation">[</span>personList filteredArrayUsingPredicate<span class="token punctuation">:</span> predicate<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nstimer-cadisplaylink" tabindex="-1"><a class="header-anchor" href="#nstimer-cadisplaylink" aria-hidden="true">#</a> NSTimer &amp; CADisplayLink</h3><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>NSTimer</td><td></td></tr><tr><td>CADisplayLink</td><td></td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 每隔 ti 秒，调用一次 aTarget 的 aSelector 方法，yesOrNo 决定了是否重复执行这个任务</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>NSTimer <span class="token operator">*</span><span class="token punctuation">)</span>scheduledTimerWithTimeInterval<span class="token punctuation">:</span><span class="token punctuation">(</span>NSTimeInterval<span class="token punctuation">)</span>ti
     								  target<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>aTarget 
    								selector<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector 
    								userInfo<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>userInfo 
    								 repeats<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>YesOrNo<span class="token punctuation">;</span>
<span class="token comment">// 通过 invalidate 方法可以停止定时器的工作，一旦定时器被停止了，就不能再次执行任务。只能再创建一个新的定时器才能执行新的任务</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>invalidate<span class="token punctuation">;</span>

<span class="token comment">// NSTimer 启动定时器</span>
<span class="token punctuation">[</span>NSTimer scheduledTimerWithTimeInterval<span class="token punctuation">:</span><span class="token number">0.1</span> target<span class="token punctuation">:</span><span class="token keyword">self</span> selector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>setNeedsDisplay<span class="token punctuation">)</span> userInfo<span class="token punctuation">:</span>nil repeats<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 每次屏幕刷新 就会触发事件</span>
CADisplayLink <span class="token operator">*</span>link <span class="token operator">=</span> <span class="token punctuation">[</span>CADisplayLink displayLinkWithTarget<span class="token punctuation">:</span><span class="token keyword">self</span> selector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>setNeedsDisplay<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>link addToRunLoop<span class="token punctuation">:</span><span class="token punctuation">[</span>NSRunLoop mainRunLoop<span class="token punctuation">]</span> forMode<span class="token punctuation">:</span>NSDefaultRunLoopMode<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="memory-management" tabindex="-1"><a class="header-anchor" href="#memory-management" aria-hidden="true">#</a> Memory Management</h2><h3 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> Reference</h3><h3 id="basic" tabindex="-1"><a class="header-anchor" href="#basic" aria-hidden="true">#</a> Basic</h3><ul><li><p>ARC特点</p><ol><li>不允许调用<code>release</code>、<code>retain</code>、<code>retainCount</code></li><li>允许重写<code>dealloc</code>，但是不允许调用<code>[super dealloc]</code></li><li><code>@property</code>的参数 <ul><li><code>strong</code> : 成员变量是强指针（适用于OC对象类型）</li><li><code>weak</code> : 成员变量是弱指针（适用于OC对象类型）</li><li><code>assign</code> : 适用于非OC对象类型</li></ul></li><li>以前的<code>retain</code>改为用<code>strong</code></li></ol></li><li><p>Compiler Flags</p><table><thead><tr><th>编译标识</th><th>说明</th></tr></thead><tbody><tr><td><code>-fobjc-arc</code></td><td>MRC 项目中，对使用 ARC 文件的标识</td></tr><tr><td><code>-fno-objc-arc</code></td><td>ARC 项目中，对使用 MRC 文件的标识</td></tr></tbody></table></li></ul><h3 id="arc-mrc-autoreleasepool" tabindex="-1"><a class="header-anchor" href="#arc-mrc-autoreleasepool" aria-hidden="true">#</a> ARC &amp; MRC &amp; @autoreleasepool</h3><blockquote><p>ARC 中是使用散列表实现的，64位系统中，包含64张 <code>SideTables</code>，包含 <code>自旋锁 &amp; 引用计数表 &amp;弱引用表</code>，引用计数表中的 <code>分离锁</code> 可以将一张表拆成多部分，实现并发操作。</p></blockquote><p>ARC 编译阶段 : 在合适的地方插入 <code>retain</code> 和 <code>release</code> ARC 运行时阶段 : 处理 <code>weak</code> 修饰变量，引用计数为0时，将其设为 <code>nil</code></p><h3 id="autoreleasepool-实现" tabindex="-1"><a class="header-anchor" href="#autoreleasepool-实现" aria-hidden="true">#</a> @autoreleasepool 实现</h3><blockquote><p><code>AutoreleasePoolPage</code> 使用双向链表实现，当链表容量满了，会在链表的顶端指向下一张表。</p></blockquote><h3 id="悬垂指针-野指针" tabindex="-1"><a class="header-anchor" href="#悬垂指针-野指针" aria-hidden="true">#</a> 悬垂指针 &amp; 野指针</h3><table><thead><tr><th>指针</th><th>说明</th></tr></thead><tbody><tr><td><strong>悬垂指针</strong></td><td>指针内存已经释放，但指针还存在，会出现 <code>BAD_ACCESS</code> 错误。</td></tr><tr><td><strong>野指针</strong></td><td>没有进行初始化的指针</td></tr></tbody></table><h3 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h3><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// MRC 下 retain 和 copy 属性的 set 实现</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> retain<span class="token punctuation">)</span> NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_name <span class="token operator">!=</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">[</span>_name release<span class="token punctuation">]</span><span class="token punctuation">;</span>
		_name <span class="token operator">=</span> <span class="token punctuation">[</span>name retain<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_name <span class="token operator">!=</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">[</span>_name release<span class="token punctuation">]</span><span class="token punctuation">;</span>
		_name <span class="token operator">=</span> <span class="token punctuation">[</span>name copy<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="instrument-内存检测原理" tabindex="-1"><a class="header-anchor" href="#instrument-内存检测原理" aria-hidden="true">#</a> Instrument 内存检测原理</h3><table><thead><tr><th>工具</th><th>说明</th></tr></thead><tbody><tr><td><code>Leaks</code></td><td>检测是否未写 <code>release</code> (ARC 已经不常见)，C 代码是否未写 <code>free</code></td></tr><tr><td><code>Allocations</code></td><td>主要思路是在一个时间切片内检测对象的声明周期以观察内存是否会无限增长。通过 <code>hook</code> 掉 <code>alloc，dealloc，retain，release</code> 等方法，来记录对象的生命周期。</td></tr></tbody></table><h2 id="multithread" tabindex="-1"><a class="header-anchor" href="#multithread" aria-hidden="true">#</a> Multithread</h2><h3 id="ios-的三种多线程技术" tabindex="-1"><a class="header-anchor" href="#ios-的三种多线程技术" aria-hidden="true">#</a> iOS 的三种多线程技术</h3><table><thead><tr><th>多线程技术</th><th>说明</th></tr></thead><tbody><tr><td><code>NSTread</code></td><td>创建线程简单，管理线程困难</td></tr><tr><td><code>GCD</code></td><td>基于 C 语言的 API，使用 block 定义任务，使用方便</td></tr><tr><td><code>NSOperation</code></td><td>基于 GCD 封装的面向对象 API，提供更多线程管理特性(如：限制最大并发数量、操作之间的依赖关系)</td></tr></tbody></table><h3 id="nstread" tabindex="-1"><a class="header-anchor" href="#nstread" aria-hidden="true">#</a> NSTread</h3><blockquote><p><code>NSThread</code> 的多线程不会自动使用 <code>@autoreleasepool</code></p></blockquote><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 开启后台执行任务的方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>performSelectorInBackground<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector withObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>arg
<span class="token comment">// 在后台线程中通知主线程执行任务的方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>performSelectorOnMainThread<span class="token punctuation">:</span><span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>aSelector withObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>arg waitUntilDone<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>wait
<span class="token comment">// 获取线程信息</span>
<span class="token punctuation">[</span>NSThread currentThread<span class="token punctuation">]</span>
<span class="token comment">// 线程休眠</span>
<span class="token punctuation">[</span>NSThread sleepForTimeInterval<span class="token punctuation">:</span><span class="token number">2.0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gcd" tabindex="-1"><a class="header-anchor" href="#gcd" aria-hidden="true">#</a> GCD</h3><blockquote><p>GCD 的函数都是以 dispatch (分派、调度)开头的</p></blockquote><ul><li><code>dispatch_queue_t</code> : 队列</li><li><code>dispatch_sync</code> : 同步操作</li><li><code>dispatch_async</code> : 异步操作</li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 栅栏函数 : 控制任务的执行顺序</span>
<span class="token function">dispatch_barrier_async</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;barrier&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 延迟函数 : 控制任务延迟执行</span>
<span class="token function">dispatch_after</span><span class="token punctuation">(</span><span class="token function">dispatch_time</span><span class="token punctuation">(</span>DISPATCH_TIME_NOW<span class="token punctuation">,</span> <span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> NSEC_PER_SEC<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dispatch_get_global_queue</span><span class="token punctuation">(</span>DISPATCH_QUEUE_PRIORITY_DEFAULT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>NSThread currentThread<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 单次函数 : 只执行一次</span>
<span class="token keyword">static</span> dispatch_once_t onceToken<span class="token punctuation">;</span>
<span class="token function">dispatch_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>onceToken<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;onece&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 快速迭代（开多个线程并发完成迭代操作）</span>
<span class="token function">dispatch_apply</span><span class="token punctuation">(</span>subpaths<span class="token punctuation">.</span>count<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">(</span>size_t index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 队列组函数</span>
dispatch_group_t group <span class="token operator">=</span> <span class="token function">dispatch_group_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 队列组中的任务执行完毕之后，执行该函数</span>
<span class="token function">dispatch_group_notify</span><span class="token punctuation">(</span>dispatch_group_t group<span class="token punctuation">,</span> dispatch_queue_t queue<span class="token punctuation">,</span> dispatch_block_t block<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 进入群组和离开群组</span>
<span class="token function">dispatch_group_enter</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行该函数后，后面异步执行的block会被gruop监听</span>
<span class="token function">dispatch_group_leave</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//异步block中，所有的任务都执行完毕，最后离开群组</span>

<span class="token comment">// 信号量函数</span>
<span class="token function">dispatch_semaphore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nsoperation" tabindex="-1"><a class="header-anchor" href="#nsoperation" aria-hidden="true">#</a> NSOperation</h3><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 定义队列</span>
<span class="token keyword">self</span><span class="token punctuation">.</span>myQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSOperationQueue alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 操作调用的方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>operationAction<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>obj <span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@ - obj : %@&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>NSThread currentThread<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 注：一旦将操作添加到队列，操作就会立即被调度执行</span>

<span class="token comment">// 1. NSInvocationOperation(调度操作)</span>
NSInvocationOperation <span class="token operator">*</span>op <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSInvocationOperation alloc<span class="token punctuation">]</span> initWithTarget<span class="token punctuation">:</span> <span class="token keyword">self</span> selector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>operationAction<span class="token punctuation">:</span><span class="token punctuation">)</span> object<span class="token punctuation">:</span><span class="token string">@&quot;Invocation Operation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>myQueue addOperation<span class="token punctuation">:</span>op<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 2. NSBlockOperation(块操作)</span>
NSBlockOperation <span class="token operator">*</span>op <span class="token operator">=</span> <span class="token punctuation">[</span>NSBlockOperation blockOperationWithBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> operationAction<span class="token punctuation">:</span><span class="token string">@&quot;Block Operation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>myQueue addOperation<span class="token punctuation">:</span>op<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lock" tabindex="-1"><a class="header-anchor" href="#lock" aria-hidden="true">#</a> Lock</h3><blockquote><p>多线程锁，保证线程安全，确保同一时刻只有一个线程访问共享资源。</p></blockquote><table><thead><tr><th>多线程锁</th><th>说明</th></tr></thead><tbody><tr><td><code>NSLock</code></td><td></td></tr><tr><td><code>NSCondition</code></td><td></td></tr><tr><td><code>NSConditionLock</code></td><td>条件锁，满足条件才加锁</td></tr><tr><td><code>NSRecursiveLock</code></td><td>递归锁，在一个线程中可以反复加锁</td></tr><tr><td><code>NSDistributedLock</code></td><td>分布式锁，同时操作同一张表中的不同部分</td></tr><tr><td><code>dispatch_semaphore</code></td><td>GCD 信号量实现加锁</td></tr><tr><td><code>pthread_mutex</code></td><td>互斥锁，</td></tr><tr><td><code>pthread_mutex(recursive)</code></td><td>递归锁，</td></tr><tr><td><code>@synchronized(self) { ... }</code></td><td>同步锁，</td></tr><tr><td><code>OSSpinLock</code></td><td>自旋锁，不停探测锁是否被释放 (不推荐，会造成优先级反转)</td></tr><tr><td><code>pthread_rwlock</code></td><td></td></tr><tr><td><code>POSIX Conditions</code></td><td></td></tr><tr><td><code>os_unfair_lock</code></td><td></td></tr></tbody></table><ul><li><p>锁的分类</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>互斥锁</td><td>进入休眠，锁被释放之后，被唤醒</td></tr><tr><td>自旋锁</td><td>进入轮询，锁被释放之后，立刻执行 (效率高于互斥锁，代价高)</td></tr><tr><td>条件锁</td><td></td></tr><tr><td>递归锁</td><td></td></tr><tr><td>分布式锁</td><td></td></tr></tbody></table></li></ul><h3 id="经典面试题" tabindex="-1"><a class="header-anchor" href="#经典面试题" aria-hidden="true">#</a> 经典面试题</h3><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 代码一</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">dispatch_sync</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 代码二</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">dispatch_sync</span><span class="token punctuation">(</span><span class="token function">dispatch_get_global_queue</span><span class="token punctuation">(</span>DISPATCH_QUEUE_PRIORITY_HIGH<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 代码三</span>
dispatch_queue_t queue <span class="token operator">=</span> <span class="token function">dispatch_queue_create</span><span class="token punctuation">(</span><span class="token string">&quot;serialQueue&quot;</span><span class="token punctuation">,</span> DISPATCH_QUEUE_SERIAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">dispatch_async</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch_sync</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 代码四</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_global_queue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">dispatch_sync</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 代码五</span>
<span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_global_queue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务1</span>
    <span class="token function">dispatch_sync</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务2</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务4</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务5</span>
<span class="token comment">// 代码六</span>


<span class="token comment">// 说明:</span>
<span class="token comment">// 代码一 : 输出 [1] (死锁 = 主队列 + 同步函数)</span>
<span class="token comment">// 代码二 : 输出 [1 2 3]</span>
<span class="token comment">// 代码三 : 输出 [1 2 5] (2 5 顺序不一定 ; 3 4 死锁 = 串行队列 + 同步函数)</span>
<span class="token comment">// 代码四 : 输出 [1 2 5 3 4] (2 5 顺序不一定)</span>
<span class="token comment">// 代码五 : 输出 [1 4] (1 4 顺序不一定)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// 以下代码输出什么？</span>
__block <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_global_queue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;i=%d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// : i &gt;= 1000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,87);function m(v,b){const a=e("ExternalLinkIcon");return o(),p("div",null,[c(" more "),d,n("ul",null,[n("li",null,[n("a",r,[i("How Do I Declare A Block in Objective-C?"),l(a)])])]),k])}const y=t(u,[["render",m],["__file","0x02.objective-c.html.vue"]]);export{y as default};
