import{_ as o}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as c,o as l,c as i,b as n,e,d as t,a as r,f as a}from"./app-gtYUf9e2.js";const p={},d={href:"https://github.com/apple-oss-distributions/objc4/blob/objc4-876/runtime",target:"_blank",rel:"noopener noreferrer"},u=n("h2",{id:"runtime-æ˜¯ä»€ä¹ˆ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#runtime-æ˜¯ä»€ä¹ˆ","aria-hidden":"true"},"#"),e(),n("code",null,"runtime"),e(" æ˜¯ä»€ä¹ˆ")],-1),m={href:"https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide",target:"_blank",rel:"noopener noreferrer"},b=a('<blockquote><p>The Objective-C language defers as many decisions as it can from compile time and link time to runtime. Whenever possible, it does things dynamically. This means that the language requires not just a compiler, but also a runtime system to execute the compiled code. The runtime system acts as a kind of operating system for the Objective-C language; itâ€™s what makes the language work.</p><p>Objective-C è¯­è¨€å°½å¯èƒ½åœ°å°†è®¸å¤šå†³ç­–ä»ç¼–è¯‘æ—¶é—´å’Œé“¾æ¥æ—¶é—´æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ã€‚å®ƒå°±ä¼šå°½å¯èƒ½åœ°åŠ¨æ€åœ°æ‰§è¡Œä»»åŠ¡ã€‚ è¿™æ„å‘³ç€è¯¥è¯­è¨€ä¸ä»…éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œè€Œä¸”è¿˜éœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿæ¥æ‰§è¡Œç¼–è¯‘è¿‡çš„ä»£ç ã€‚ è¿è¡Œæ—¶ç³»ç»Ÿå°±åƒæ˜¯ Objective-C è¯­è¨€çš„æ“ä½œç³»ç»Ÿï¼›è¿™æ˜¯è¯­è¨€è¿è¡Œå·¥ä½œçš„åŸç†æ‰€åœ¨ã€‚</p></blockquote><p>è¿™æ®µè¯´æ˜å¯ä»¥åˆ†ä¸‰æ®µç†è§£</p><ul><li><code>OC</code> çš„è®¾è®¡è€…ä¸ºäº†è®©å®ƒå…·å¤‡åŠ¨æ€èƒ½åŠ›ï¼Œæ‰€ä»¥å°†åªè¦å¯ä»¥åŠ¨æ€å¤„ç†çš„ä»»åŠ¡éƒ½è¿ç§»åˆ°è¿è¡Œæ—¶ã€‚</li><li>ç¼–è¯‘å™¨åªå®Œæˆäº†éƒ¨åˆ†ä»£ç ç¼–è¯‘é“¾æ¥å·¥ä½œï¼Œè¿˜å‰©ä¸€éƒ¨åˆ†éœ€è¦è¿è¡Œæ—¶å¤„ç†ï¼Œæ‰€ä»¥éœ€è¦è®¾è®¡è¿™ä¸ª <code>runtime</code> æ¥è¿›è¡Œä»£ç çš„åŠ¨æ€å¤„ç†ã€‚</li><li>å°† <code>runtime</code> çœ‹åš <code>OC</code> è¯­è¨€çš„æ“ä½œç³»ç»Ÿã€‚æ“ä½œç³»ç»Ÿæ˜¯è®¡ç®—æœºè¿è¡Œçš„æ ¸å¿ƒï¼Œç”¨æ¥è¿›è¡Œç³»ç»Ÿèµ„æºåˆ†é…ï¼Œå„ç§ä»»åŠ¡è°ƒåº¦ï¼Œæ˜¯è®¡ç®—æœºå¯ä»¥æ­£å¸¸è¿è¡Œçš„å…³é”®ã€‚è¯´æ˜äº† <code>runtime</code> å¯¹äº <code>OC</code> è¯­è¨€çš„é‡è¦æ€§ï¼Œä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚</li></ul><p>è¿™ä¹Ÿå¾ˆå¥½åœ°è§£é‡Šäº†â€œä¸ºä»€ä¹ˆæ˜¯ OC æ˜¯ä¸€ä¸ªåŠ¨æ€è¯­è¨€ï¼Ÿâ€ã€‚</p><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> reference</h2>',5),k={href:"https://github.com/apple-oss-distributions/objc4",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/RetVal/objc-runtime",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/nst/iOS-Runtime-Headers",target:"_blank",rel:"noopener noreferrer"},_=n("blockquote",null,[n("p",null,"iOS Objective-C headers as derived from runtime introspection")],-1),g={href:"https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide",target:"_blank",rel:"noopener noreferrer"},f={href:"https://github.com/steipete/Aspects",target:"_blank",rel:"noopener noreferrer"},S=n("blockquote",null,[n("p",null,"Delightful, simple library for aspect oriented programming in Objective-C and Swift.")],-1),C=n("hr",null,null,-1),j={href:"https://juejin.cn/post/6844904052778598408",target:"_blank",rel:"noopener noreferrer"},y={href:"https://www.jianshu.com/p/30de582dbeb7",target:"_blank",rel:"noopener noreferrer"},O=n("a",{href:"%E2%9C%85"},null,-1),w={href:"https://www.jianshu.com/p/1bf78e1b3594",target:"_blank",rel:"noopener noreferrer"},x=n("blockquote",null,[n("p",null,"ä½œè€…çš„ Slogan : æ±‡ç¼–æ˜¯æ£€éªŒä¸€åˆ‡è¯­æ³•ç³–çš„å”¯ä¸€æ ‡å‡†")],-1),q={href:"https://shannonchenchn.github.io/2018/03/16/objc-runtime-learning-notes/",target:"_blank",rel:"noopener noreferrer"},N=n("a",{href:"%E2%9C%85"},null,-1),P={href:"https://nemocdz.github.io/post/why-is-metaclass-in-objective-c/",target:"_blank",rel:"noopener noreferrer"},E=a("<blockquote><p>ä½œè€…ä»è‡ªå·±é‡åˆ°çš„ä¸€ä¸ªé¢è¯•é¢˜å‡ºå‘ï¼ŒæŒ‰ç…§ç¬¬ä¸€æ€§åŸç†è¿›è¡Œé—®é¢˜æ¨å¯¼ã€‚ ğŸ‘‰ğŸ» é¦–å…ˆå»ç ”ç©¶äº† <code>OC</code> ä¸­çš„æºç ï¼Œæ¢³ç†äº† <code>isa</code>ã€<code>MetaClass</code> å…³ç³»ã€‚ ğŸ‘‰ğŸ» åœ¨æœç´¢ <code>MetaClass</code> çš„è¿‡ç¨‹ï¼Œå‘ç°äº† <code>Python</code> ä¸­ä¹Ÿæœ‰è¿™ä¸ªè®¾è®¡ã€‚è¿›è€Œäº†è§£åˆ°æ˜¯æºäº <code>Smalltalk</code> çš„è®¾è®¡ï¼Œè€Œ <code>OC</code> å°±æ˜¯å€Ÿé‰´çš„ <code>Smalltalk</code> çš„è®¾è®¡æ€æƒ³ã€‚ ğŸ‘‰ğŸ» è¿›ä¸€æ­¥æ€è€ƒå¦‚æœæ²¡æœ‰ <code>MetaClass</code> æ˜¯å¦å¯è¡Œã€‚åœ¨å®è§‚æˆé¢æ€è€ƒäº†é¢å‘å¯¹è±¡çš„ä¸¤ç§è®¾è®¡æ€æƒ³ï¼Œä»¥ <code>C++</code> (å€Ÿé‰´ <code>Simula</code>)ä¸ºä»£è¡¨çš„<em>ç±»çš„åˆ’åˆ†</em>ï¼Œè¿˜æœ‰ä»¥ <code>OC</code> (å€Ÿé‰´ <code>Smalltalk</code>)ä¸ºä»£è¡¨çš„<code>æ¶ˆæ¯ä¼ é€’</code>ã€‚</p></blockquote>",1),L={href:"http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/",target:"_blank",rel:"noopener noreferrer"},M={href:"https://blog.sunnyxx.com/2014/11/06/runtime-nuts",target:"_blank",rel:"noopener noreferrer"},R={href:"http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/",target:"_blank",rel:"noopener noreferrer"},I={href:"https://blog.ibireme.com/2013/11/26/objective-c-messaging/",target:"_blank",rel:"noopener noreferrer"},F=a(`<h2 id="concept" tabindex="-1"><a class="header-anchor" href="#concept" aria-hidden="true">#</a> concept</h2><ul><li><p><code>instance -&gt; class -&gt; method -&gt; SEL -&gt; IMP -&gt; å®ç°å‡½æ•°</code></p></li><li><p><code>objc_msgSend</code> : Objective-C æ¶ˆæ¯ä¼ é€’å‡½æ•° <code>id objc_msgSend(id self, SEL op, ... );</code></p></li><li><p>SEL &amp; IMP</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>SEL</code></td><td>æ–¹æ³•é€‰æ‹©å™¨ (æ–¹æ³•çš„ ID)</td></tr><tr><td><code>IMP</code></td><td>å‡½æ•°æŒ‡é’ˆï¼Œæ–¹æ³•å®ç°çš„æŒ‡é’ˆ</td></tr></tbody></table><ul><li>åå°„</li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">/** SEL åå°„ */</span>
<span class="token comment">//  String -&gt; SEL</span>
SEL selector <span class="token operator">=</span> <span class="token function">NSSelectorFromString</span><span class="token punctuation">(</span><span class="token string">@&quot;setName:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>stu performSelector<span class="token punctuation">:</span>selector withObject<span class="token punctuation">:</span><span class="token string">@&quot;Kobe&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//  SEL -&gt; String</span>
<span class="token function">NSStringFromSelector</span><span class="token punctuation">(</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>setName<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**  Class åå°„ */</span>
<span class="token comment">//  String -&gt; Class</span>
Class class <span class="token operator">=</span> <span class="token function">NSClassFromString</span><span class="token punctuation">(</span><span class="token string">@&quot;Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Student <span class="token operator">*</span>student <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>class alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//  Class -&gt; String</span>
Class class <span class="token operator">=</span> <span class="token punctuation">[</span>Student class<span class="token punctuation">]</span><span class="token punctuation">;</span>
NSString <span class="token operator">*</span>className <span class="token operator">=</span> <span class="token function">NSStringFromClass</span><span class="token punctuation">(</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** Protocol åå°„ */</span>
<span class="token comment">//  String -&gt; Protocol</span>
Protocol protocol <span class="token operator">=</span> <span class="token function">NSProtocolFromString</span><span class="token punctuation">(</span><span class="token string">@&quot;People&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  Protocol -&gt; String</span>
NSString <span class="token operator">*</span>protocolName <span class="token operator">=</span> <span class="token function">NSStringFromProtocol</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="oc-çš„åŠ¨æ€ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#oc-çš„åŠ¨æ€ç‰¹æ€§" aria-hidden="true">#</a> OC çš„åŠ¨æ€ç‰¹æ€§</h2><ul><li><p>åŠ¨æ€ç±»å‹ï¼ˆDynamic typingï¼‰</p><ul><li><code>isKindOfClass:</code> : åˆ¤æ–­æŸä¸€å¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»æˆ–å…¶å­ç±»çš„å®ä¾‹</li><li><code>isMemberOfClass:</code> : åˆ¤æ–­æŸä¸€å¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å®ä¾‹</li></ul></li><li><p>åŠ¨æ€ç»‘å®šï¼ˆDynamic bindingï¼‰</p><ul><li>ä¼ ç»Ÿå‡½æ•° : ç¼–è¯‘æ—¶æœŸï¼Œå°†å‡½æ•°å‚æ•°å’Œå®ç°æ‰“åŒ…åˆ°æºç </li><li>OCçš„æ¶ˆæ¯æœºåˆ¶ : è¿è¡Œæ—¶ï¼Œæ‰å»åŠ¨æ€æŸ¥æ‰¾ä¸å®ä¾‹ç»‘å®šçš„å±æ€§å’Œæ–¹æ³•</li></ul></li><li><p>åŠ¨æ€åŠ è½½ï¼ˆDynamic loadingï¼‰</p><ul><li>æ ¹æ®éœ€æ±‚åŠ¨æ€åŠ è½½èµ„æº(å¦‚ : @2x,@3xå›¾ç‰‡çš„åŠ è½½)\`</li></ul></li></ul><h2 id="runtime-struct" tabindex="-1"><a class="header-anchor" href="#runtime-struct" aria-hidden="true">#</a> Runtime Struct</h2><table><thead><tr><th>ç»“æ„ä½“</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>objc_object</code></td><td>objc å¯¹è±¡ <code>id</code>ï¼Œisa æŒ‡é’ˆåŒ…å«æŒ‡å‘å¯¹è±¡çš„åœ°å€</td></tr><tr><td><code>objc_class</code></td><td>objc å¯¹è±¡çš„ç±» <code>Class</code></td></tr><tr><td><code>class_data_bits_t</code></td><td>åŒ…å« <code>class_rw_t</code> ä¿¡æ¯</td></tr><tr><td><code>class_rw_t</code></td><td>rw : å¯è¯»å¯å†™ï¼Œç±»åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šçš„æ–¹æ³•ã€å±æ€§ã€åè®® (åŒ…å«æŒ‡å‘ <code>class_ro_t</code>çš„æŒ‡é’ˆ)</td></tr><tr><td><code>class_ro_t</code></td><td>ro : åªè¯»ï¼Œç±»åœ¨ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„æ–¹æ³•ã€å±æ€§ã€åè®®</td></tr><tr><td><code>cache_t</code></td><td>ç¼“å­˜å·²ç»ä½¿ç”¨è¿‡çš„æ–¹æ³•</td></tr><tr><td><code>bucket_t</code></td><td>ç¼“å­˜ä½¿ç”¨çš„å“ˆå¸Œè¡¨ç»“æ„ä½“ (<code>key: SEL ; value: IMP</code>)</td></tr></tbody></table><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token keyword">struct</span> class_rw_t <span class="token punctuation">{</span> <span class="token comment">// å¯è¯»å¯å†™</span>
    uint32_t flags<span class="token punctuation">;</span>
    uint32_t version<span class="token punctuation">;</span>

    <span class="token keyword">const</span> class_ro_t <span class="token operator">*</span>ro<span class="token punctuation">;</span>           <span class="token comment">// æŒ‡å‘åªè¯»çš„ç»“æ„ä½“,å­˜æ”¾ç±»åˆå§‹ä¿¡æ¯</span>
    
    method_array_t methods<span class="token punctuation">;</span>         <span class="token comment">// æ–¹æ³•åˆ—è¡¨ï¼ˆç±»å¯¹è±¡å­˜æ”¾å¯¹è±¡æ–¹æ³•ï¼Œå…ƒç±»å¯¹è±¡å­˜æ”¾ç±»æ–¹æ³•ï¼‰</span>
    property_array_t properties<span class="token punctuation">;</span>    <span class="token comment">// å±æ€§åˆ—è¡¨</span>
    protocol_array_t protocols<span class="token punctuation">;</span>     <span class="token comment">// åè®®åˆ—è¡¨</span>

    Class firstSubclass<span class="token punctuation">;</span>
    Class nextSiblingClass<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">struct</span> class_ro_t <span class="token punctuation">{</span> <span class="token comment">// åªè¯» </span>
    uint32_t flags<span class="token punctuation">;</span>
    uint32_t instanceStart<span class="token punctuation">;</span>
    uint32_t instanceSize<span class="token punctuation">;</span>
    uint32_t reserved<span class="token punctuation">;</span>

    <span class="token keyword">const</span> uint8_t <span class="token operator">*</span> ivarLayout<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> name<span class="token punctuation">;</span>
    method_list_t <span class="token operator">*</span> baseMethodList<span class="token punctuation">;</span>     <span class="token comment">// æ–¹æ³•åˆ—è¡¨</span>
    protocol_list_t <span class="token operator">*</span> baseProtocols<span class="token punctuation">;</span>    <span class="token comment">// åè®®åˆ—è¡¨</span>
    <span class="token keyword">const</span> ivar_list_t <span class="token operator">*</span> ivars<span class="token punctuation">;</span>          <span class="token comment">// æˆå‘˜å˜é‡åˆ—è¡¨</span>

    <span class="token keyword">const</span> uint8_t <span class="token operator">*</span> weakIvarLayout<span class="token punctuation">;</span>
    property_list_t <span class="token operator">*</span>baseProperties<span class="token punctuation">;</span>    <span class="token comment">// å±æ€§åˆ—è¡¨</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10);function V(A,D){const s=c("ExternalLinkIcon");return l(),i("div",null,[n("blockquote",null,[n("p",null,[e("å‚è€ƒæºç  "),n("a",d,[e("objc-876"),t(s)])])]),r(" more "),u,n("p",null,[n("a",m,[e("Objective-C Runtime Programming Guide"),t(s)])]),b,n("ul",null,[n("li",null,[n("a",k,[e("objc4"),t(s)])]),n("li",null,[n("a",h,[e("A debuggable objc runtime"),t(s)])]),n("li",null,[n("a",v,[e("iOS-Runtime-Headers"),t(s)]),e(" : iOS è¿è¡Œæ—¶å¤´æ–‡ä»¶(åŒ…æ‹¬ç§æœ‰ API) "),_]),n("li",null,[n("a",g,[e("Objective-C Runtime Programming Guide"),t(s)])]),n("li",null,[n("a",f,[e("Aspects"),t(s)]),S])]),C,n("ul",null,[n("li",null,[n("a",j,[e("2020-01-23 Aspectsæ·±åº¦è§£æ-iOSé¢å‘åˆ‡é¢ç¼–ç¨‹"),t(s)])]),n("li",null,[n("a",y,[e("2019-08-05 RuntimeåŸç†æ¢ç©¶"),t(s)])]),n("li",null,[O,e(),n("a",w,[e("2019-03-07 OCå¯¹è±¡çš„æœ¬è´¨"),t(s)]),x]),n("li",null,[n("a",q,[e("2018-03-16 è¯» objc4 æºç ï¼Œæ·±å…¥ç†è§£ Objective-C Runtime"),t(s)])]),n("li",null,[N,e(),n("a",P,[e("2017-09-15 Why is MetaClass in Objective-Cï¼Ÿ"),t(s)]),e(" ğŸ’¯ "),E]),n("li",null,[n("a",L,[e("2016-06-15 Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†"),t(s)])]),n("li",null,[n("a",M,[e("2014-11-06 ç¥ç»ç—…é™¢objc runtimeå…¥é™¢è€ƒè¯•"),t(s)])]),n("li",null,[n("a",R,[e("2014-11-05 Objective-C Runtime"),t(s)])]),n("li",null,[n("a",I,[e("2013-11-26 Objective-C ä¸­çš„æ¶ˆæ¯ä¸æ¶ˆæ¯è½¬å‘"),t(s)])])]),F])}const B=o(p,[["render",V],["__file","index.html.vue"]]);export{B as default};
