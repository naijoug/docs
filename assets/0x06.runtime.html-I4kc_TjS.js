import{_ as u}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o as r,c as k,a as o,b as s,e as n,d as e,w as c,f as t}from"./app-g9d4Q3j1.js";const m="/docs/assets/objc-class-diagram-0JRmvx1z.jpg",b="/docs/assets/objc-superclass-eWcnfwH-.png",h={},v=s("blockquote",null,[s("p",null,"Runtime: è¿è¡Œæ—¶")],-1),_=s("h2",{id:"reference",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#reference","aria-hidden":"true"},"#"),n(" reference")],-1),g={href:"https://juejin.cn/post/6844904052778598408",target:"_blank",rel:"noopener noreferrer"},y={href:"https://www.jianshu.com/p/30de582dbeb7",target:"_blank",rel:"noopener noreferrer"},w=s("a",{href:"%E2%9C%85"},null,-1),j={href:"https://www.jianshu.com/p/1bf78e1b3594",target:"_blank",rel:"noopener noreferrer"},f=s("blockquote",null,[s("p",null,"ä½œè€…çš„ Slogan : æ±‡ç¼–æ˜¯æ£€éªŒä¸€åˆ‡è¯­æ³•ç³–çš„å”¯ä¸€æ ‡å‡†")],-1),S={href:"https://shannonchenchn.github.io/2018/03/16/objc-runtime-learning-notes/",target:"_blank",rel:"noopener noreferrer"},O={href:"http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/",target:"_blank",rel:"noopener noreferrer"},C={href:"http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/",target:"_blank",rel:"noopener noreferrer"},q={href:"https://blog.ibireme.com/2013/11/26/objective-c-messaging/",target:"_blank",rel:"noopener noreferrer"},z=s("a",{href:""},null,-1),x={href:"https://minilv.github.io/2018/07/01/ias-class-metaClass/",target:"_blank",rel:"noopener noreferrer"},M=s("a",{href:""},null,-1),A={href:"https://halfrost.com/objc_runtime_isa_class",target:"_blank",rel:"noopener noreferrer"},N=s("a",{href:""},null,-1),I={href:"https://juejin.cn/post/6844904074630922254",target:"_blank",rel:"noopener noreferrer"},T=s("blockquote",null,[s("p",null,[n("ä½œè€…å…ˆé€šè¿‡ "),s("code",null,"Google"),n(" æŸ¥è¯¢åˆ°äº† "),s("code",null,"metaclass"),n(" æºäº "),s("code",null,"SmallTalk"),n(" è¯­è¨€ã€‚ ğŸ‘‰ğŸ» è¿›ä¸€æ­¥æºç ä¸­å»ç ”ç©¶ "),s("code",null,"objc_msgSend"),n(" ä¸ºä»€ä¹ˆéœ€è¦ "),s("code",null,"metaclass")])],-1),P=s("a",{href:""},null,-1),L={href:"https://www.leewong.cn/2018/05/02/why-metaclass",target:"_blank",rel:"noopener noreferrer"},E=s("a",{href:"%E2%9C%85"},null,-1),V={href:"https://nemocdz.github.io/post/why-is-metaclass-in-objective-c/",target:"_blank",rel:"noopener noreferrer"},B=t("<blockquote><p>ä½œè€…ä»è‡ªå·±é‡åˆ°çš„ä¸€ä¸ªé¢è¯•é¢˜å‡ºå‘ï¼ŒæŒ‰ç…§ç¬¬ä¸€æ€§åŸç†è¿›è¡Œé—®é¢˜æ¨å¯¼ã€‚ ğŸ‘‰ğŸ» é¦–å…ˆå»ç ”ç©¶äº† <code>OC</code> ä¸­çš„æºç ï¼Œæ¢³ç†äº† <code>isa</code>ã€<code>MetaClass</code> å…³ç³»ã€‚ ğŸ‘‰ğŸ» åœ¨æœç´¢ <code>MetaClass</code> çš„è¿‡ç¨‹ï¼Œå‘ç°äº† <code>Python</code> ä¸­ä¹Ÿæœ‰è¿™ä¸ªè®¾è®¡ã€‚è¿›è€Œäº†è§£åˆ°æ˜¯æºäº <code>Smalltalk</code> çš„è®¾è®¡ï¼Œè€Œ <code>OC</code> å°±æ˜¯å€Ÿé‰´çš„ <code>Smalltalk</code> çš„è®¾è®¡æ€æƒ³ã€‚ ğŸ‘‰ğŸ» è¿›ä¸€æ­¥æ€è€ƒå¦‚æœæ²¡æœ‰ <code>MetaClass</code> æ˜¯å¦å¯è¡Œã€‚åœ¨å®è§‚æˆé¢æ€è€ƒäº†é¢å‘å¯¹è±¡çš„ä¸¤ç§è®¾è®¡æ€æƒ³ï¼Œä»¥ <code>C++</code> (å€Ÿé‰´ <code>Simula</code>)ä¸ºä»£è¡¨çš„ â€œç±»çš„åˆ’åˆ†â€ï¼Œè¿˜æœ‰ä»¥ <code>OC</code> (å€Ÿé‰´ <code>Smalltalk</code>)ä¸ºä»£è¡¨çš„ â€œæ¶ˆæ¯ä¼ é€’â€ã€‚</p></blockquote>",1),W=t('<hr><h2 id="å¯¹è±¡æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡æ¨¡å‹" aria-hidden="true">#</a> å¯¹è±¡æ¨¡å‹</h2><h3 id="â“oc-çš„å¯¹è±¡æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#â“oc-çš„å¯¹è±¡æ¨¡å‹" aria-hidden="true">#</a> â“<code>OC</code> çš„å¯¹è±¡æ¨¡å‹</h3><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p>Objective-C ç±»å›¾</p></blockquote><figure><img src="'+m+`" alt="objc-class-diagram" tabindex="0" loading="lazy"><figcaption>objc-class-diagram</figcaption></figure><ul><li><p>å®ä¾‹å¯¹è±¡ï¼ˆ<code>Instance Object</code>ï¼‰ï¼šå®ä¾‹å¯¹è±¡æ˜¯æ ¹æ®æŸä¸ªç±»åˆ›å»ºå‡ºæ¥çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><blockquote><p>æ¯ä¸ªå®ä¾‹å¯¹è±¡åŒ…å«äº†ä¸€ç»„å®ä¾‹å˜é‡ (<code>Instance Variables</code> æˆ– <code>iVars</code>)ï¼Œè¿™äº›å®ä¾‹å˜é‡æ˜¯å®šä¹‰åœ¨å®ƒçš„ç±»å’Œç¥–å…ˆç±»é‡Œçš„ã€‚</p></blockquote><ul><li>æ¯ä¸ªå®ä¾‹å¯¹è±¡è¿˜æœ‰ä¸€ä¸ª <code>isa</code> æŒ‡é’ˆï¼ŒæŒ‡å‘å®ƒçš„ç±»å¯¹è±¡</li></ul></li><li><p>ç±»å¯¹è±¡ï¼ˆ<code>Class Object</code>ï¼‰ï¼šç±»å¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªç‰¹å®šçš„ç±»ã€‚</p><blockquote><p>å®ƒåŒ…å«äº†ä¸€ç»„å®ä¾‹æ–¹æ³• (<code>Instance Methods</code>)ï¼Œåœ¨å®ƒçš„ä»»ä½•å®ä¾‹å¯¹è±¡è¢«å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ç±»å¯¹è±¡ä¹ŸåŒ…å«äº†ä¸€ç»„å®ä¾‹å˜é‡çš„å£°æ˜ï¼ˆä½†æ˜¯å¹¶ä¸åŒ…å«å®ä¾‹å˜é‡çš„å€¼ï¼Œè¿™äº›å€¼ä¿å­˜åœ¨å®ä¾‹å¯¹è±¡é‡Œï¼‰ã€‚</p></blockquote><p>ç±»å¯¹è±¡åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼š</p><ul><li><code>isa</code> æŒ‡é’ˆæŒ‡å‘å®ƒçš„å…ƒç±»å¯¹è±¡</li><li><code>superclass</code> æŒ‡é’ˆæŒ‡å‘å®ƒçš„çˆ¶ç±»å¯¹è±¡ã€‚</li></ul></li><li><p>å…ƒç±»å¯¹è±¡ï¼ˆ<code>MetaClass Object</code>ï¼‰ï¼šå…ƒç±»å¯¹è±¡ä»£è¡¨äº†ç±»å¯¹è±¡ã€‚</p><blockquote><p>å…ƒç±»å¯¹è±¡åŒ…å«äº†ä¸€ç»„ç±»æ–¹æ³• (<code>Class Method</code>)ï¼Œå½“ç»™ç±»å‘é€æ¶ˆæ¯ï¼ˆä¸æ˜¯ç»™ç±»çš„å®ä¾‹å‘é€æ¶ˆæ¯ï¼‰æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p></blockquote><p>å…ƒç±»å¯¹è±¡åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼š</p><ul><li><code>isa</code> æŒ‡é’ˆæŒ‡å‘æ ¹å…ƒç±»å¯¹è±¡</li><li><code>superclass</code> æŒ‡é’ˆæŒ‡å‘å®ƒçš„&quot;çˆ¶å…ƒç±»&quot;</li></ul></li><li><p>æ ¹ç±»å¯¹è±¡ (<code>Root Class Object</code>)ï¼šæ ¹ç±»å¯¹è±¡æ˜¯æ‰€æœ‰ç±»å¯¹è±¡çš„çˆ¶ç±»ã€‚</p><p>æ ¹ç±»å¯¹è±¡çš„åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼š</p><ul><li><code>isa</code> æŒ‡é’ˆæŒ‡å‘è‡ªèº«ï¼Œå½¢æˆé—­ç¯ã€‚</li><li><code>superclass</code> æŒ‡é’ˆæŒ‡å‘ <code>nil</code>ã€‚</li></ul></li><li><p>æ ¹å…ƒç±»å¯¹è±¡ï¼ˆ<code>Root MetaClass Object</code>ï¼‰ï¼šæ ¹å…ƒç±»å¯¹è±¡(<code>NSObject</code> çš„ç±»å¯¹è±¡)æ˜¯æ‰€æœ‰å…ƒç±»å¯¹è±¡çš„çˆ¶ç±»ï¼Œ</p><p>æ ¹å…ƒç±»å¯¹è±¡çš„åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼š</p><ul><li><code>isa</code> æŒ‡é’ˆæŒ‡å‘è‡ªèº«ï¼Œå½¢æˆé—­ç¯ã€‚</li><li><code>superclass</code> æŒ‡é’ˆæŒ‡å‘æ ¹ç±»å¯¹è±¡ã€‚</li></ul></li></ul><p>æ€»ç»“ï¼šä»»ä½•æ—¶å€™ç»™å¯¹è±¡å‘æ¶ˆæ¯ï¼Œå®é™…ä¸Šéƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¨¡å‹å¯»æ‰¾å’Œè°ƒç”¨æ–¹æ³•ã€‚è™½ç„¶è¿™ä¸ªæ¨¡å‹å¯èƒ½åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦æ—¶æœ‰äº›å¤æ‚ï¼Œä½†æ˜¯ç†è§£äº†å®ƒï¼Œå°±èƒ½æ›´å¥½åœ°ç†è§£ <code>Objective-C</code> çš„é¢å‘å¯¹è±¡ç‰¹æ€§å’Œæ¶ˆæ¯å‘é€æœºåˆ¶ã€‚</p></details><h3 id="è¿è¡Œæ—¶-realizeclass-ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œæ—¶-realizeclass-ä½œç”¨" aria-hidden="true">#</a> è¿è¡Œæ—¶ <code>realizeClass</code> ä½œç”¨</h3><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p><code>realizeClass</code> æ–¹æ³•æ˜¯è¿è¡Œæ—¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºåŠ è½½ç±»ã€‚</p></blockquote><p>ä¸»è¦ä½œç”¨ï¼š</p><ul><li><p>åˆ†é…ç±»å’Œå…ƒç±»çš„å†…å­˜ï¼šæ¯ä¸ªç±»å®é™…ä¸Šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç±»è‡ªèº«å’Œå…ƒç±»ï¼ˆ<code>metaclass</code>ï¼‰ã€‚å…ƒç±»åŒ…å«ç±»æ–¹æ³•çš„ä¿¡æ¯ï¼Œè€Œç±»åŒ…å«å®ä¾‹æ–¹æ³•å’Œå®ä¾‹å˜é‡çš„ä¿¡æ¯ã€‚</p></li><li><p>è®¾ç½®ç±»ä¿¡æ¯ï¼šå°†ç±»çš„ <code>superclass</code>ã€å®ä¾‹å¤§å°ç­‰ä¿¡æ¯è®¾ç½®åˆ°ç±»ç»“æ„ä½“ä¸­ã€‚å¯¹äºå…ƒç±»ï¼Œå®ƒçš„ <code>superclass</code> è®¾ç½®ä¸ºçˆ¶ç±»çš„å…ƒç±»ã€‚</p></li><li><p>å°†æ–¹æ³•åˆ—è¡¨ã€åè®®åˆ—è¡¨ã€å±æ€§åˆ—è¡¨æ·»åŠ åˆ°ç±»ä¸­ï¼šè¿™äº›æ­¥éª¤æ˜¯é€šè¿‡æŒ‚è½½æ–¹æ³•åˆ—è¡¨ã€åè®®åˆ—è¡¨ã€å±æ€§åˆ—è¡¨åˆ°ç±»çš„ç›¸å…³å­—æ®µæ¥å®ç°çš„ã€‚<code>Objective-C</code> æ”¯æŒåŠ¨æ€æ·»åŠ æ–¹æ³•ã€åè®®å’Œå±æ€§ï¼Œè¿™ä¸€ä¸ªæ­¥éª¤éå¸¸é‡è¦ã€‚</p></li><li><p>å°†ç±»æ³¨å†Œåˆ°è¿è¡Œæ—¶ç³»ç»Ÿï¼šè¿è¡Œæ—¶ç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰ç±»çš„åˆ—è¡¨ã€‚è¿™ä¸ªæ­¥éª¤å°†æ–°å®ç°çš„ç±»æ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚</p></li></ul></details><h3 id="isa" tabindex="-1"><a class="header-anchor" href="#isa" aria-hidden="true">#</a> isa</h3><h4 id="â“isa-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“isa-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> â“<code>isa</code> æ˜¯ä»€ä¹ˆ</h4><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p><code>isa</code>ï¼š <code>OC</code> å¯¹è±¡çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæ˜¯æ¯ä¸ª <code>OC</code> å¯¹è±¡çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œç”¨äºæŒ‡å‘è¯¥å¯¹è±¡çš„ç±»å¯¹è±¡ã€‚</p></blockquote><p><code>Objective-C</code> çš„å¯¹è±¡æ¨¡å‹ä¸­ï¼Œå¯¹è±¡åˆ†ä¸ºå®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡ã€å…ƒç±»ã€æ ¹å…ƒç±»å¯¹è±¡ã€‚</p><ul><li><p>å®ä¾‹å¯¹è±¡: å®ä¾‹å¯¹è±¡çš„ <code>isa</code> æŒ‡å‘å®ƒçš„ç±»å¯¹è±¡ï¼›å®ä¾‹å¯¹è±¡ä¸»è¦å­˜å‚¨å®ä¾‹å˜é‡çš„å€¼ã€‚</p></li><li><p>ç±»å¯¹è±¡: ç±»å¯¹è±¡çš„ <code>isa</code> æŒ‡å‘å…ƒç±»å¯¹è±¡ï¼›ç±»å¯¹è±¡ä¸»è¦å­˜å‚¨å®ä¾‹æ–¹æ³•ã€å±æ€§ã€ä»¥åŠéµå®ˆçš„åè®®ç­‰ä¿¡æ¯ã€‚</p></li><li><p>å…ƒç±»å¯¹è±¡: å…ƒç±»å¯¹è±¡çš„ <code>isa</code> æŒ‡å‘æ ¹å…ƒç±»å¯¹è±¡ï¼›å…ƒç±»å¯¹è±¡ä¸»è¦å­˜å‚¨ç±»æ–¹æ³•ç­‰ä¿¡æ¯ã€‚</p></li><li><p>æ ¹å…ƒç±»å¯¹è±¡: æ ¹å…ƒç±»å¯¹è±¡çš„ <code>isa</code> æŒ‡å‘æ ¹ç±»å¯¹è±¡ï¼›æ ¹ç±»å¯¹è±¡çš„ <code>isa</code> æŒ‡å‘è‡ªå·±ã€‚</p></li></ul><p>å½“å‘é€æ¶ˆæ¯ç»™ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<code>runtime</code> é€šè¿‡è¿™ä¸ªå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆæ‰¾åˆ°å®ƒçš„ç±»å¯¹è±¡ï¼Œç„¶ååœ¨ç±»å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚</p></details><h4 id="â“ç±»ç»“æ„ä½“çš„ç»„æˆ-isa-æŒ‡é’ˆæŒ‡å‘äº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“ç±»ç»“æ„ä½“çš„ç»„æˆ-isa-æŒ‡é’ˆæŒ‡å‘äº†ä»€ä¹ˆ" aria-hidden="true">#</a> â“ç±»ç»“æ„ä½“çš„ç»„æˆ <code>isa</code> æŒ‡é’ˆæŒ‡å‘äº†ä»€ä¹ˆ</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p>å…ˆç»™å‡ºç­”æ¡ˆ <code>isa</code> æŒ‡é’ˆæ˜¯æŒ‡å‘ç±»å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½åŒ…å« <code>isa</code> æŒ‡é’ˆï¼Œé€šè¿‡è¿™ä¸ªæŒ‡é’ˆå¯ä»¥æ‰¾åˆ°ç±»å¯¹è±¡ã€‚</p><p>å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶(æ¶ˆæ¯å‘é€)ï¼Œè¿è¡Œæ—¶å…ˆåœ¨å½“å‰æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œé€šè¿‡ <code>isa</code> æŒ‡é’ˆæŸ¥æ‰¾ç±»å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨æ–¹æ³•ï¼Œå¦‚æœè¿˜ä¸å­˜åœ¨ä¼šé€šè¿‡çˆ¶ç±»æŒ‡é’ˆè¿›ä¸€æ­¥å¾€ä¸ŠæŸ¥æ‰¾ï¼Œæœ€åè¿˜æ˜¯æ‰¾ä¸åˆ°å°±ä¼šæŠ›å‡ºæœªæ‰¾åˆ°å¼‚å¸¸ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// id å°±æ˜¯ objc_object</span>
<span class="token keyword">struct</span> objc_object <span class="token punctuation">{</span>
  Class _Nonnull isa<span class="token punctuation">;</span>         <span class="token comment">// æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Class å°±æ˜¯ objc_class</span>
<span class="token keyword">struct</span> objc_class <span class="token punctuation">{</span>
  Class _Nonnull isa<span class="token punctuation">;</span>         <span class="token comment">// æŒ‡å‘å…ƒç±»</span>
  Class _Nullable superclass<span class="token punctuation">;</span> <span class="token comment">// æŒ‡å‘çˆ¶ç±»</span>
  cache_t cache<span class="token punctuation">;</span>              <span class="token comment">// æ–¹æ³•ç¼“å­˜</span>
  class_data_bits_t bits<span class="token punctuation">;</span>     <span class="token comment">// åŒ…å«æ–¹æ³•åˆ—è¡¨å’Œå…¶ä»–ä¿¡æ¯</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h4 id="â“isa-æŒ‡é’ˆé‡Œé¢éƒ½å­˜äº†ä»€ä¹ˆ-32-å’Œ-64-ä½åˆ†åˆ«è®²ä¸€ä¸‹" tabindex="-1"><a class="header-anchor" href="#â“isa-æŒ‡é’ˆé‡Œé¢éƒ½å­˜äº†ä»€ä¹ˆ-32-å’Œ-64-ä½åˆ†åˆ«è®²ä¸€ä¸‹" aria-hidden="true">#</a> â“<code>isa</code> æŒ‡é’ˆé‡Œé¢éƒ½å­˜äº†ä»€ä¹ˆï¼Œ32 å’Œ 64 ä½åˆ†åˆ«è®²ä¸€ä¸‹</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>isa</code> æŒ‡é’ˆæ˜¯ <code>Objective-C</code> å¯¹è±¡çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå®ƒå†³å®šäº†å¯¹è±¡çš„ç±»å‹ã€‚</p><ul><li><p>åœ¨ <strong>32</strong> ä½ç³»ç»Ÿä¸‹ï¼Œè¿™ä¸ª <code>isa</code> æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ™®é€šçš„æŒ‡é’ˆï¼Œå­˜å‚¨ç€å¯¹è±¡ï¼ˆæˆ–è€…è¯´æ˜¯ç±»å®ä¾‹ï¼‰çš„ç±»ï¼ˆ<code>Class</code>ï¼‰çš„ä¿¡æ¯ï¼Œä¸€èˆ¬å æ® 4 ä¸ªå­—èŠ‚ã€‚</p><blockquote><p>é€šè¿‡è¿™ä¸ªæŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å¯¹è±¡æ‰€å±çš„ç±»ï¼ˆä¹Ÿå°±æ˜¯å¯¹è±¡çš„å…ƒç±»ï¼ˆ<code>Metaclass</code>ï¼‰ï¼‰ï¼Œä»¥æ­¤æ¥è°ƒç”¨å¯¹è±¡çš„ç±»æ–¹æ³•ã€‚é€šè¿‡å¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å¯¹è±¡æ‰€å±ç±»çš„ä¿¡æ¯ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ç±»çš„å…·ä½“ä¿¡æ¯æ‰¾åˆ°è¯¥å¯¹è±¡èƒ½å“åº”çš„æ‰€æœ‰æ–¹æ³•ï¼Œå‘ä¸€ä¸ª <code>Objective-C</code> å¯¹è±¡å‘æ¶ˆæ¯æ—¶ï¼Œå°±æ˜¯é€šè¿‡æŸ¥æ‰¾ <code>isa</code> æŒ‡é’ˆæ¥å®Œæˆçš„ã€‚</p></blockquote></li><li><p>åœ¨ <strong>64</strong> ä½ç³»ç»Ÿä¸‹ï¼ˆä»…é’ˆå¯¹ä¼˜åŒ–è¿‡çš„ <code>iOS</code> ç³»ç»Ÿ, <code>iOS 9.0</code> ä»¥åï¼‰ï¼Œä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œ <code>isa</code> çš„å­˜å‚¨ç»“æ„åšäº†æ”¹å˜ï¼Œæ·»åŠ äº†ä¸€ç§å«åš <code>isa</code> æ··ç”¨ï¼ˆ<code>ISA Masking</code>ï¼‰çš„æŠ€æœ¯ã€‚<code>isa</code> æŒ‡é’ˆé™¤äº†å­˜å‚¨äº†ç±»çš„ä¿¡æ¯å¤–ï¼Œè¿˜ä¼šå­˜å‚¨å¯¹è±¡æ˜¯å¦æ­£åœ¨è¢« <code>dealloc</code>ï¼Œä»¥åŠæ˜¯å¦æœ‰å…³è”å¯¹è±¡(<code>Associated Object</code>)ç­‰ä¿¡æ¯ã€‚</p><blockquote><p>å¦‚æœåƒåœ¨ 32 ä½ç³»ç»Ÿä¸‹é‚£æ ·ç›´æ¥è®¿é—® <code>isa</code> å°±å¯èƒ½å–åˆ°é”™è¯¯çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ 64 ä½ç³»ç»Ÿä¸‹ï¼Œéœ€è¦é€šè¿‡ä¸€äº›ç‰¹å®šçš„æ–¹å¼æ¥è·å–å…·ä½“çš„ <code>isa</code> å€¼ï¼Œä¾‹å¦‚ä½¿ç”¨å¯¹è±¡æä¾›çš„ <code>object_getClass()</code> æ–¹æ³•æ¥è·å–ã€‚</p></blockquote></li></ul></details><h4 id="â“classã€objc-getclassã€object-getclass-ä¸‰ä¸ªæ–¹æ³•çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#â“classã€objc-getclassã€object-getclass-ä¸‰ä¸ªæ–¹æ³•çš„åŒºåˆ«" aria-hidden="true">#</a> â“<code>class</code>ã€<code>objc_getClass</code>ã€<code>object_getClass</code> ä¸‰ä¸ªæ–¹æ³•çš„åŒºåˆ«</h4>`,14),J={class:"hint-container details"},R=t("<summary>ğŸ’¡</summary><ul><li><p><code>class</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œä¸»è¦åœ¨å®ä¾‹å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œç”¨äºè·å–å®ä¾‹å¯¹è±¡çš„ç±»ã€‚</p></li><li><p><code>objc_getClass</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç±»åå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¿”å›çš„æ˜¯å¯¹åº”çš„ç±»å¯¹è±¡ã€‚</p><blockquote><p>å¦‚æœè¿™ä¸ªç±»åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­å¹¶æœªè¢«æ³¨å†Œï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä¼šè¿”å› <code>nil</code>ã€‚</p></blockquote></li><li><p><code>object_getClass</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå®ä¾‹å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p><blockquote><p>å½“å‚æ•°æ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡æ—¶ï¼Œè¿”å›çš„æ˜¯è¿™ä¸ªå®ä¾‹å¯¹è±¡çš„ç±»ï¼›å½“å‚æ•°æ˜¯ä¸€ä¸ªç±»å¯¹è±¡æ—¶ï¼ˆåŒ…æ‹¬å…ƒç±»å¯¹è±¡å’Œæ ¹ç±»å¯¹è±¡ï¼‰ï¼Œè¿”å›çš„æ˜¯è¿™ä¸ªç±»å¯¹è±¡çš„å…ƒç±»ã€‚</p></blockquote></li></ul>",2),K=s("div",{class:"language-objc line-numbers-mode","data-ext":"objc"},[s("pre",{class:"language-objc"},[s("code",null,[n("NSObject "),s("span",{class:"token operator"},"*"),n("object "),s("span",{class:"token operator"},"="),n(),s("span",{class:"token punctuation"},"["),s("span",{class:"token punctuation"},"["),n("NSObject alloc"),s("span",{class:"token punctuation"},"]"),n(" init"),s("span",{class:"token punctuation"},"]"),s("span",{class:"token punctuation"},";"),n(`
`),s("span",{class:"token function"},"NSLog"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'@"%@"'),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token punctuation"},"["),n("object class"),s("span",{class:"token punctuation"},"]"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n("               "),s("span",{class:"token comment"},'// è¾“å‡º "NSObject"'),n(`
`),s("span",{class:"token function"},"NSLog"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'@"%@"'),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token function"},"objc_getClass"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"NSObject"'),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n("    "),s("span",{class:"token comment"},'// è¾“å‡º "NSObject"'),n(`
`),s("span",{class:"token function"},"NSLog"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'@"%@"'),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token function"},"object_getClass"),s("span",{class:"token punctuation"},"("),n("object"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n("      "),s("span",{class:"token comment"},'// è¾“å‡º "NSObject"'),n(`
`),s("span",{class:"token function"},"NSLog"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'@"%@"'),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token function"},"object_getClass"),s("span",{class:"token punctuation"},"("),n("NSObject"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n("    "),s("span",{class:"token comment"},'// è¾“å‡º "NSObject (meta-class)"'),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),H=s("div",{class:"language-swift line-numbers-mode","data-ext":"swift"},[s("pre",{class:"language-swift"},[s("code",null,[s("span",{class:"token keyword"},"let"),n(" object "),s("span",{class:"token operator"},"="),n(),s("span",{class:"token class-name"},"NSObject"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),n(`
`),s("span",{class:"token function"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token function"},"type"),s("span",{class:"token punctuation"},"("),n("of"),s("span",{class:"token punctuation"},":"),n(" object"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),n("             "),s("span",{class:"token comment"},'// è¾“å‡º "NSObject"'),n(`
`),s("span",{class:"token function"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token function"},"objc_getClass"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string-literal"},[s("span",{class:"token string"},'"NSObject"')]),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),n("    "),s("span",{class:"token comment"},'// è¾“å‡º "Optional(NSObject)"'),n(`
`),s("span",{class:"token function"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token function"},"object_getClass"),s("span",{class:"token punctuation"},"("),n("object"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},")"),n("      "),s("span",{class:"token comment"},'// è¾“å‡º "Optional(NSObject)"'),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),U=t(`<h3 id="super" tabindex="-1"><a class="header-anchor" href="#super" aria-hidden="true">#</a> super</h3><h4 id="â“super-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“super-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> â“<code>super</code> æ˜¯ä»€ä¹ˆ</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>super</code> å¹¶ä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåœ¨ <code>OC</code> è¿›è¡Œæ¶ˆæ¯è°ƒç”¨æ—¶ï¼Œå…¶å®æ˜¯æœ‰ä¸¤ä¸ªéšè—å‚æ•°çš„ï¼Œä¸€ä¸ªæ˜¯æ¥æ”¶è€…(receiver)ï¼Œä¸€ä¸ªæ˜¯æ–¹æ³•é€‰æ‹©å™¨(selector)ã€‚</p><p>å¸¸è§çš„ <code>self</code> è¡¨ç¤ºçš„æ˜¯æ¥æ”¶è€…ã€‚è€Œ <code>super</code> å…¶å®æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ ‡ç¤ºç¬¦ï¼Œå½“å‘é€ç»™ <code>super</code> ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œè°ƒç”¨è€…ä»ç„¶æ˜¯ <code>self</code> ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¼šä»å½“å‰ç±»çš„çˆ¶ç±»å¼€å§‹æŸ¥æ‰¾æ–¹æ³•ã€‚</p></details><blockquote><p>â“<code>super</code> çš„åº•å±‚å®ç°</p></blockquote><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>OC</code> ä¸­ <code>super</code> çš„å®ç°æ˜¯é€šè¿‡ <code>runtime</code> çš„ <code>objc_msgSendSuper</code> å’Œ <code>objc_msgSendSuper_stret</code> ä¸¤ä¸ªå‡½æ•°æ¥å®Œæˆçš„ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ç¼–è¯‘å™¨é‡åˆ° <code>[super method]</code> è¿™ç§å½¢å¼çš„è°ƒç”¨æ—¶ï¼Œä¼šè½¬åŒ–ä¸º <code>objc_msgSendSuper(super_cls, sel)</code> çš„å½¢å¼ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// super ç»“æ„ä½“</span>
<span class="token keyword">struct</span> objc_super <span class="token punctuation">{</span>
  __unsafe_unretained id receiver<span class="token punctuation">;</span>        <span class="token comment">// æ¶ˆæ¯çš„æ¥æ”¶è€…</span>
  __unsafe_unretained Class super_class<span class="token punctuation">;</span>  <span class="token comment">// çˆ¶ç±»(å¼€å§‹æŸ¥æ‰¾çš„ç±»)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// objc_msgSendSuper</span>
<span class="token keyword">void</span> <span class="token function">objc_msgSendSuper</span><span class="token punctuation">(</span><span class="token keyword">struct</span> objc_super <span class="token operator">*</span><span class="token keyword">super</span><span class="token punctuation">,</span> SEL op<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>objc_msgSendSuper</code>: è¯¥å‡½æ•°ç”¨äºå‘çˆ¶ç±»å‘é€æ¶ˆæ¯ã€‚è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>objc_super</code> ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„ä½“ä¸­åŒ…å«äº†æ¥æ”¶è€…ï¼ˆä¹Ÿå°±æ˜¯å½“å‰çš„ <code>self</code> å¯¹è±¡ï¼‰å’Œå…¶çˆ¶ç±»ã€‚è¯¥å‡½æ•°ä¼šåœ¨æ¥æ”¶è€…çš„çˆ¶ç±»ï¼ˆä»¥åŠçˆ¶ç±»çš„ç»§æ‰¿é“¾ï¼‰ä¸­æŸ¥æ‰¾æ–¹æ³•çš„å®ç°å¹¶è°ƒç”¨ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token keyword">struct</span> objc_super superInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span>receiver <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>super_class <span class="token operator">=</span> <span class="token function">class_getSuperclass</span><span class="token punctuation">(</span><span class="token function">object_getClass</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">objc_msgSendSuper</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>superInfo<span class="token punctuation">,</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>someMethod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>objc_msgSendSuper_stret</code>: è¯¥å‡½æ•°ä¸ <code>objc_msgSendSuper</code> ç±»ä¼¼ï¼Œ<code>stret</code> è¡¨ç¤º <code>Structure Return</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°ç”¨äºå‘è¿”å›å€¼ä¸ºç»“æ„ä½“çš„çˆ¶ç±»æ–¹æ³•å‘é€æ¶ˆæ¯ã€‚åœ¨æŸäº› <code>CPU</code> æ¶æ„ï¼ˆå¦‚ <code>x86</code>ï¼‰ä¸­ï¼Œç»“æ„ä½“å¯èƒ½é€šè¿‡å¯„å­˜å™¨æˆ–å†…å­˜æ¥è¿”å›ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªä¸“é—¨çš„å‡½æ•°æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚</p></li></ul></details><h4 id="â“supperclass-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#â“supperclass-äº†è§£å—" aria-hidden="true">#</a> â“<code>supperclass</code> äº†è§£å—</h4><details class="hint-container details"><summary>ğŸ’¡</summary><figure><img src="`+b+`" alt="objc-superclass" tabindex="0" loading="lazy"><figcaption>objc-superclass</figcaption></figure><blockquote><p><code>superclass</code> æŒ‡çš„æ˜¯ä¸€ä¸ªç±»çš„çˆ¶ç±»ã€‚åœ¨ç±»çš„ç»§æ‰¿é“¾ä¸­ï¼Œä¸€ä¸ªç±»é™¤äº†æ ¹ç±»ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œè¿™ä¸ªçˆ¶ç±»å°±è¢«ç§°ä¸º <code>superclass</code>ã€‚</p></blockquote><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// Person.h - &quot;Person&quot; çš„ superclass å°±æ˜¯ &quot;NSObject&quot;</span>
<span class="token keyword">@interface</span> Person <span class="token punctuation">:</span> NSObject
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>talk<span class="token punctuation">;</span>
<span class="token keyword">@end</span>

<span class="token comment">// Employee.h - &quot;Employee&quot; çš„ superclass å°±æ˜¯ &quot;Person&quot;</span>
<span class="token keyword">@interface</span> Employee <span class="token punctuation">:</span> Person
<span class="token keyword">@end</span>

<span class="token comment">// Employee.m</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">&quot;Employee.h&quot;</span></span>

<span class="token keyword">@implementation</span> Employee
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>talk <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> talk<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Call superclass method</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;And I&#39;m an employee!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">@end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="metaclass" tabindex="-1"><a class="header-anchor" href="#metaclass" aria-hidden="true">#</a> metaclass</h3><h4 id="â“metaclass-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“metaclass-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> â“<code>metaClass</code> æ˜¯ä»€ä¹ˆ</h4><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p>åœ¨ <code>Objective-C</code> ä¸­æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŠ¨æ€ç±»å‹ï¼Œå³â€œç±»â€ã€‚å› æ­¤æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥è¿”å›å®ƒçš„ç±»ã€‚è€Œè¿™ä¸ªç±»ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿæœ‰è‡ªå·±çš„ç±»ï¼Œå³å…ƒç±»ï¼ˆ<code>metaClass</code>ï¼‰ã€‚</p></blockquote><p>å…ƒç±»å­˜å‚¨äº†ç±»æ–¹æ³•çš„ä¿¡æ¯ï¼Œå°±åƒå¸¸è§„çš„ç±»å¯¹è±¡å­˜å‚¨å®ä¾‹æ–¹æ³•çš„ä¿¡æ¯ä¸€æ ·ã€‚å½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿå°†ä¼šåœ¨ç±»å’Œè¶…ç±»ä¸­æŸ¥æ‰¾å¯ä»¥å“åº”è¿™æ¡æ¶ˆæ¯çš„æ–¹æ³•ã€‚è€Œå½“å‘ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨å…ƒç±»å’Œå…¶è¶…ç±»ä¸­æŸ¥æ‰¾å¯ä»¥å“åº”è¿™æ¡æ¶ˆæ¯çš„æ–¹æ³•ã€‚</p><p><code>metaClass</code> ä¸»è¦æ˜¯ç”¨äºå¤„ç†ç±»æ–¹æ³•çš„è°ƒç”¨ã€‚ä¸€ä¸ªå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆæŒ‡å‘å®ƒçš„ç±»ï¼Œè€Œç±»å¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆæŒ‡å‘<code>metaClass</code>ã€‚<code>metaClass</code> çš„ç±»ç»“æ„å’Œç±»å¯¹è±¡çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨ã€‚</p></details><h4 id="â“ä¸ºä»€ä¹ˆè¦è®¾è®¡-metaclass" tabindex="-1"><a class="header-anchor" href="#â“ä¸ºä»€ä¹ˆè¦è®¾è®¡-metaclass" aria-hidden="true">#</a> â“ä¸ºä»€ä¹ˆè¦è®¾è®¡ <code>metaClass</code></h4><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>metaClass</code>ï¼ˆå…ƒç±»ï¼‰çš„è®¾è®¡æ˜¯ä¸ºäº†æ”¯æŒç±»æ–¹æ³•ã€‚</p><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»ï¼Œè¿™ä¸ªç±»åŒ…å«äº†è¯¥å¯¹è±¡çš„æ‰€æœ‰å®ä¾‹æ–¹æ³•ã€‚è¿™äº›å®ä¾‹æ–¹æ³•æ˜¯å­˜å‚¨åœ¨å…¶å¯¹åº”çš„ç±»å¯¹è±¡ä¸­çš„ã€‚é‚£ä¹ˆé—®é¢˜æ˜¯ï¼Œç±»æ–¹æ³•åº”è¯¥å­˜å‚¨åœ¨å“ªå„¿å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å…ƒç±»ï¼ˆ<code>metaClass</code>ï¼‰ã€‚</p><p>æ¯ä¸ªç±»å¯¹è±¡ï¼Œé™¤äº†åŒ…å«å®ä¾‹æ–¹æ³•ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘å…ƒç±»çš„ <code>isa</code> æŒ‡é’ˆã€‚å…ƒç±»å°±åƒæ˜¯ç±»å¯¹è±¡çš„â€œç±»â€ï¼Œå®ƒåŒ…å«äº†ç±»æ–¹æ³•çš„åˆ—è¡¨ï¼Œå› æ­¤ï¼Œå½“å‘é€ä¸€ä¸ªç±»æ–¹æ³•ç»™ç±»å¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨å…ƒç±»ä¸­æŸ¥æ‰¾è¯¥æ–¹æ³•ã€‚</p><p>æ›´è¿›ä¸€æ­¥è¯´ï¼Œ<code>metaClass</code> çš„å­˜åœ¨ï¼Œè®©æ— è®ºæ˜¯æ“ä½œå®ä¾‹è¿˜æ˜¯ç±»ï¼Œåœ¨ä»£ç å±‚é¢ä¸Šéƒ½æœ‰ç»Ÿä¸€çš„è¡Œä¸ºï¼ˆå‘é€æ¶ˆæ¯ï¼‰ï¼Œå®é™…ä¸Šç®€åŒ–äº†è¯­è¨€ä½¿ç”¨ä¸Šçš„å¤æ‚åº¦ã€‚åœ¨ <code>Objective-C</code> ä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œæ— è®ºæ˜¯å®ä¾‹å¯¹è±¡è¿˜æ˜¯ç±»å¯¹è±¡ï¼Œç”šè‡³å…ƒç±»å¯¹è±¡ï¼Œè¿™éƒ½å¾—ç›Šäº <code>metaClass</code> çš„å­˜åœ¨ã€‚</p></details><h4 id="â“åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»çš„æ–¹æ³•-objc-allocateclasspair-çš„æ–¹æ³•åå°¾éƒ¨ä¸ºä»€ä¹ˆæ˜¯-pair-æˆå¯¹" tabindex="-1"><a class="header-anchor" href="#â“åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»çš„æ–¹æ³•-objc-allocateclasspair-çš„æ–¹æ³•åå°¾éƒ¨ä¸ºä»€ä¹ˆæ˜¯-pair-æˆå¯¹" aria-hidden="true">#</a> â“åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»çš„æ–¹æ³• <code>objc_allocateClassPair</code> çš„æ–¹æ³•åå°¾éƒ¨ä¸ºä»€ä¹ˆæ˜¯ <code>Pair</code>(æˆå¯¹)</h4><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p><code>objc_allocateClassPair</code> è¿™ä¸ªåç§°ä¸­çš„ <code>Pair</code> æŒ‡çš„æ˜¯å®ƒåœ¨è¿è¡Œæ—¶åˆ›å»ºç±»æ—¶ï¼Œä¸€æ¬¡ä¼šåˆ›å»ºä¸¤ä¸ªç›¸å…³çš„ç±»ï¼Œè€Œä¸åªæ˜¯ä¸€ä¸ªã€‚ä¸€ä¸ªæ˜¯åˆ›å»ºçš„ç±»ï¼Œå¦ä¸€ä¸ªæ˜¯å…ƒç±»ï¼ˆ<code>metaClass</code>ï¼‰ã€‚</p></blockquote><p>åœ¨ <code>Objective-C</code> ä¸­ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å…ƒç±»ã€‚ä¸€ä¸ªç±»å‚¨å­˜äº†æ‰€æœ‰çš„å®ä¾‹æ–¹æ³•ï¼ˆåœ¨å¯¹è±¡å®ä¾‹ä¸Šè°ƒç”¨çš„æ–¹æ³•ï¼‰ï¼Œç›¸å¯¹åº”çš„å…ƒç±»åˆ™ä¿å­˜äº†æ‰€æœ‰çš„ç±»æ–¹æ³•ï¼ˆåœ¨ç±»æœ¬èº«ä¸Šè°ƒç”¨çš„æ–¹æ³•ï¼‰ã€‚</p><p>ç”¨ <code>objc_allocateClassPair</code> åˆ›å»ºä¸€ä¸ªæ–°ç±»çš„æ—¶å€™ï¼Œ<code>Cocoa</code> ä¸ºä½ åŒæ—¶åˆ›å»ºäº†é¢å¤–çš„ä¸€ä¸ªå…ƒç±»ã€‚å› æ­¤æ­¤æ–¹æ³•åˆ›å»ºçš„æ˜¯ä¸€ä¸ª &quot;ç±»å¯¹&quot; æˆ– &quot;ç±»é…å¯¹&quot;ï¼ŒåŒ…å«äº†ä¸€ä¸ªç±»å’Œæ­¤ç±»çš„å…ƒç±»ã€‚è¿™ä¹Ÿå°±æ˜¯æ–¹æ³•åä¸­ <code>Pair</code> ä¸€è¯çš„å«ä¹‰ã€‚</p></details><hr><h2 id="å±æ€§" tabindex="-1"><a class="header-anchor" href="#å±æ€§" aria-hidden="true">#</a> å±æ€§</h2><h3 id="â“ä¸ºä»€ä¹ˆå¯¹è±¡æ–¹æ³•æ²¡æœ‰ä¿å­˜çš„å¯¹è±¡ç»“æ„ä½“é‡Œ-è€Œæ˜¯ä¿å­˜åœ¨ç±»å¯¹è±¡çš„ç»“æ„ä½“é‡Œ" tabindex="-1"><a class="header-anchor" href="#â“ä¸ºä»€ä¹ˆå¯¹è±¡æ–¹æ³•æ²¡æœ‰ä¿å­˜çš„å¯¹è±¡ç»“æ„ä½“é‡Œ-è€Œæ˜¯ä¿å­˜åœ¨ç±»å¯¹è±¡çš„ç»“æ„ä½“é‡Œ" aria-hidden="true">#</a> â“ä¸ºä»€ä¹ˆå¯¹è±¡æ–¹æ³•æ²¡æœ‰ä¿å­˜çš„å¯¹è±¡ç»“æ„ä½“é‡Œï¼Œè€Œæ˜¯ä¿å­˜åœ¨ç±»å¯¹è±¡çš„ç»“æ„ä½“é‡Œ</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>åœ¨ <code>Objective-C</code> ä¸­ï¼Œæ¯ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆ<code>Instance</code>ï¼‰éƒ½æœ‰ä¸€ä¸ª <code>isa</code> æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒçš„ç±»å¯¹è±¡ï¼ˆ<code>Class</code>ï¼‰ï¼Œç±»å¯¹è±¡ä¸­ä¿å­˜äº†è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡æ–¹æ³•ï¼ˆ<code>instance methods</code>ï¼‰ã€‚å½“åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•æ—¶ï¼Œ<code>Objective-C</code> è¿è¡Œæ—¶ç³»ç»Ÿä¼šé€šè¿‡è¿™ä¸ªå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆæ‰¾åˆ°ç±»å¯¹è±¡ï¼Œè¿›è€Œæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å¹¶æ‰§è¡Œã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡å…±äº«åŒä¸€ä»½æ–¹æ³•çš„è®¾è®¡ã€‚</p><p>è¿™ç§è®¾è®¡ä¸‹ï¼Œæ— è®ºä¸€ä¸ªç±»æœ‰å¤šå°‘ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªç±»çš„æ–¹æ³•éƒ½åªéœ€è¦åœ¨å†…å­˜ä¸­ä¿å­˜ä¸€ä»½ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°èŠ‚çœå†…å­˜ã€‚</p><p>è€Œå¯¹äºç±»æ–¹æ³•ï¼ˆ<code>class methods</code>ï¼‰ï¼Œå®ƒä»¬åˆ™è¢«ä¿å­˜åœ¨å…ƒç±»å¯¹è±¡ï¼ˆ<code>Meta-class</code>ï¼‰ä¸­ã€‚æ¯ä¸ªç±»å¯¹è±¡åŒæ ·æœ‰ä¸€ä¸ª <code>isa</code> æŒ‡é’ˆæŒ‡å‘å…¶å¯¹åº”çš„å…ƒç±»å¯¹è±¡ï¼Œè¿™æ ·åœ¨è°ƒç”¨ç±»æ–¹æ³•æ—¶å°±å¯ä»¥é€šè¿‡ç±»å¯¹è±¡æ‰¾åˆ°å…ƒç±»å¯¹è±¡ï¼Œè¿›è€Œæ‰¾åˆ°å¯¹åº”çš„ç±»æ–¹æ³•å¹¶æ‰§è¡Œã€‚</p></details><h3 id="â“class-copyivarlist-vs-class-copypropertylist" tabindex="-1"><a class="header-anchor" href="#â“class-copyivarlist-vs-class-copypropertylist" aria-hidden="true">#</a> â“<code>class_copyIvarList</code> vs <code>class_copyPropertyList</code></h3><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>class_copyIvarList</code> å’Œ <code>class_copyPropertyList</code> éƒ½æ˜¯ç”¨äºè·å–ç›¸å…³ä¿¡æ¯çš„å‡½æ•°ï¼Œä½†å®ƒä»¬è·å–åˆ°çš„ä¿¡æ¯å¹¶ä¸å®Œå…¨ç›¸åŒã€‚</p><ul><li><p><code>class_copyIvarList</code> ç”¨äºè¿”å›ä¸€ä¸ªæŒ‡å‘ç±»å®ä¾‹å˜é‡åˆ—è¡¨çš„æŒ‡é’ˆã€‚</p><blockquote><p>è¿™ä¸ªåˆ—è¡¨åŒ…æ‹¬äº†ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å®ä¾‹å˜é‡ï¼ŒåŒ…æ‹¬å±æ€§ç”Ÿæˆçš„å®ä¾‹å˜é‡ã€‚æ‰€ä»¥è¿™æ„å‘³ç€ï¼Œå³ä½¿ä¸€ä¸ªå®ä¾‹å˜é‡æ˜¯ç”± <code>@property</code> å£°æ˜çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>class_copyIvarList</code> è·å–åˆ°è¿™ä¸ªå˜é‡ã€‚</p></blockquote></li><li><p><code>class_copyPropertyList</code> åªèƒ½è·å–åˆ°ç±»ä¸­ç”¨ <code>@property</code> å£°æ˜çš„å±æ€§åˆ—è¡¨ã€‚</p><blockquote><p>å¦‚æœç±»ä¸­æœ‰é <code>@property</code> å£°æ˜çš„å®ä¾‹å˜é‡ï¼Œ <code>class_copyPropertyList</code> æ˜¯æ— æ³•è·å–åˆ°è¿™äº›å®ä¾‹å˜é‡çš„ã€‚</p></blockquote></li></ul><p>æ€»ç»“ï¼šæŒ‰ç…§è·å–åˆ°çš„ä¿¡æ¯çš„å¤šå°‘æ’åºï¼Œ <code>class_copyIvarList</code> &gt; <code>class_copyPropertyList</code>ã€‚</p><p>æ³¨æ„ï¼šè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨é‡Šæ”¾è¿™ä¸ªæ•°ç»„ï¼ˆä½¿ç”¨<code>free</code>å‡½æ•°ï¼‰ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚</p></details><h3 id="â“class-ro-t-vs-class-rw-t" tabindex="-1"><a class="header-anchor" href="#â“class-ro-t-vs-class-rw-t" aria-hidden="true">#</a> â“<code>class_ro_t</code> vs <code>class_rw_t</code></h3><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>class_ro_t</code> å’Œ <code>class_rw_t</code> æ˜¯ <code>Runtime</code> å†…éƒ¨ç”¨æ¥å­˜å‚¨ç±»çš„ä¿¡æ¯çš„ç»“æ„ä½“ã€‚</p><ul><li><p><code>class_ro_t</code> ä¸»è¦å­˜å‚¨äº†ç±»çš„åªè¯»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åï¼ŒåŸºç±»åï¼Œå®ä¾‹å˜é‡åˆ—è¡¨å’Œç±»çš„å±æ€§åˆ—è¡¨ç­‰åªè¯»ä¿¡æ¯ã€‚</p><blockquote><p>æ‰€æœ‰æŒ‡é’ˆéƒ½æ˜¯åªè¯»çš„ã€‚</p></blockquote></li><li><p><code>class_rw_t</code> ä¸»è¦å­˜å‚¨äº†ç±»çš„å¯å†™ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„æ–¹æ³•åˆ—è¡¨ï¼Œåè®®åˆ—è¡¨å’Œåˆ†ç±»åˆ—è¡¨ç­‰å¯å˜ä¿¡æ¯ã€‚</p><blockquote><p>å…¶ä¸­çš„æŒ‡é’ˆæ˜¯å¯å˜çš„ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å’Œåˆ é™¤æ–¹æ³•ç­‰ä¿¡æ¯ã€‚</p></blockquote></li></ul><p>åœ¨ç±»åˆå§‹åŒ–æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆå¯¹åº”çš„ <code>class_ro_t</code> ç»“æ„ä½“ï¼Œå¹¶é€šè¿‡<code>class_rw_t</code> ç»“æ„ä½“è·å–ã€‚è€Œåœ¨è¿è¡Œæ—¶ï¼Œå¦‚æœå¯¹ç±»çš„æ–¹æ³•ï¼Œåè®®ç­‰è¿›è¡Œæ·»åŠ æˆ–è€…åˆ é™¤æ“ä½œï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¼šä¿å­˜åœ¨ <code>class_rw_t</code> ä¸­ã€‚</p><p>æ€»ç»“ï¼š<code>class_ro_t</code> å­˜å‚¨çš„æ˜¯ç¼–è¯‘æ—¶æœŸçš„ç±»ä¿¡æ¯ï¼Œ<code>class_rw_t</code> å­˜å‚¨çš„æ˜¯è¿è¡Œæ—¶æœŸçš„ç±»ä¿¡æ¯ã€‚</p></details><h3 id="â“èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡" tabindex="-1"><a class="header-anchor" href="#â“èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡" aria-hidden="true">#</a> â“èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>ä¸å¯ä»¥ã€‚ä¸€æ—¦ä¸€ä¸ªç±»è¢«ç¼–è¯‘å’Œè¿è¡Œï¼Œå°±ä¸èƒ½å†å‘è¿™ä¸ªç±»æ·»åŠ å®ä¾‹å˜é‡ã€‚</p><p>å› ä¸ºåœ¨ <code>Objective-C</code> ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­æ‰€å ç”¨çš„ç©ºé—´æ˜¯å›ºå®šçš„ï¼Œè¿™ä¸ªç©ºé—´å–å†³äºè¿™ä¸ªç±»çš„å®ä¾‹å˜é‡çš„æ€»å¤§å°ã€‚å¦‚æœå…è®¸åœ¨è¿è¡Œæ—¶æ·»åŠ å®ä¾‹å˜é‡ï¼Œå°±ä¼šå¯¼è‡´å·²ç»å­˜åœ¨çš„å¯¹è±¡éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè¿™æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚æ‰€ä»¥ï¼Œ<code>Objective-C</code> è§„å®šï¼Œåªèƒ½åœ¨ç¼–è¯‘é˜¶æ®µæ·»åŠ å®ä¾‹å˜é‡ã€‚</p><p>ä¸è¿‡ï¼Œå¯ä»¥å‘ç±»æ·»åŠ æ–¹æ³•ï¼ˆé€šè¿‡ <code>class_addMethod</code> å‡½æ•°ï¼‰å’Œåè®®ï¼ˆé€šè¿‡ <code>class_addProtocol</code> å‡½æ•°ï¼‰ã€‚è¿™äº›ä¿®æ”¹åªä¼šå½±å“åˆ°æ·»åŠ æ“ä½œä¹‹ååˆ›å»ºçš„å¯¹è±¡ï¼Œå·²ç»å­˜åœ¨çš„å¯¹è±¡ä¸ä¼šå—åˆ°å½±å“ã€‚</p></details><h3 id="â“èƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡" tabindex="-1"><a class="header-anchor" href="#â“èƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡" aria-hidden="true">#</a> â“èƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ·»åŠ ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”å‘è¿™ä¸ªç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ã€‚</p><p>è¿™ä¸ªæ“ä½œåªèƒ½åœ¨æ³¨å†Œç±»ä¹‹å‰å®Œæˆã€‚ å› ä¸ºä¸€æ—¦ç±»è¢«æ³¨å†Œåˆ°è¿è¡Œæ—¶ç¯å¢ƒä¸­ï¼Œç±»çš„å®ä¾‹å˜é‡å¸ƒå±€å°±å·²ç»ç¡®å®šï¼Œ<code>objc runtime</code> ç³»ç»Ÿä¸å…è®¸å†ä¿®æ”¹ï¼ŒåŒ…æ‹¬æ·»åŠ å®ä¾‹å˜é‡ã€‚è¿™æ˜¯å› ä¸ºå®ä¾‹å˜é‡æ¶‰åŠåˆ°å¯¹è±¡çš„å†…å­˜å¸ƒå±€ï¼Œä¸€æ—¦ç±»è¢«æ³¨å†Œï¼Œå¯¹è±¡çš„å†…å­˜å¸ƒå±€å·²ç»å›ºå®šï¼Œä¸èƒ½å†è¿›è¡Œæ”¹å˜ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°ç±»</span>
Class MyClass <span class="token operator">=</span> <span class="token function">objc_allocateClassPair</span><span class="token punctuation">(</span><span class="token punctuation">[</span>NSObject class<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;MyClass&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ·»åŠ å®ä¾‹å˜é‡(æ³¨å†Œå‰) </span>
<span class="token comment">// âš ï¸ å¦‚æœå°è¯•åœ¨ objc_registerClassPair åé¢å†æ·»åŠ å®ä¾‹å˜é‡ï¼Œå°†ä¼šå¤±è´¥ã€‚</span>
<span class="token function">class_addIvar</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">,</span> <span class="token string">&quot;_myVar&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">log2</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ³¨å†Œè¯¥ç±»</span>
<span class="token function">objc_registerClassPair</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä½¿ç”¨æ–°ç±»</span>
id obj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>MyClass alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><hr><h2 id="åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#åˆ†ç±»" aria-hidden="true">#</a> åˆ†ç±»</h2><h3 id="â“åˆ†ç±»çš„ç»“æ„ä½“é‡Œé¢æœ‰å“ªäº›æˆå‘˜" tabindex="-1"><a class="header-anchor" href="#â“åˆ†ç±»çš„ç»“æ„ä½“é‡Œé¢æœ‰å“ªäº›æˆå‘˜" aria-hidden="true">#</a> â“åˆ†ç±»çš„ç»“æ„ä½“é‡Œé¢æœ‰å“ªäº›æˆå‘˜</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>æ¯ä¸ª <code>Category</code> éƒ½å¯¹åº”ç€ä¸€ä¸ªç»“æ„ä½“ <code>category_t</code></p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// objc-runtime-new.h</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> category_t <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
    classref_t cls<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> method_list_t <span class="token operator">*</span>instanceMethods<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> method_list_t <span class="token operator">*</span>classMethods<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> protocol_list_t <span class="token operator">*</span>protocols<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> property_list_t <span class="token operator">*</span>instanceProperties<span class="token punctuation">;</span>
<span class="token punctuation">}</span> category_t<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>name</code>ï¼šåˆ†ç±»çš„åå­—ã€‚</li><li><code>cls</code>ï¼šåˆ†ç±»æ‰€å±çš„ç±»ã€‚</li><li><code>instanceMethods</code>ï¼šåˆ†ç±»ä¸­æ–°å¢çš„å®ä¾‹æ–¹æ³•åˆ—è¡¨ã€‚</li><li><code>classMethods</code>ï¼šåˆ†ç±»ä¸­æ–°å¢çš„ç±»æ–¹æ³•åˆ—è¡¨ã€‚</li><li><code>protocols</code>ï¼šåˆ†ç±»å®ç°çš„åè®®åˆ—è¡¨ã€‚</li><li><code>instanceProperties</code>ï¼šåˆ†ç±»ä¸­æ–°å¢çš„å®ä¾‹å±æ€§åˆ—è¡¨ã€‚</li></ul><p>æ³¨æ„ï¼šè™½ç„¶å¯ä»¥åœ¨åˆ†ç±»ä¸­å£°æ˜å’Œå®ç°æ–°çš„å±æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨ <code>@synthesize</code> æ¥ç”Ÿæˆå­˜å–æ–¹æ³•ï¼Œä¹Ÿæ— æ³•ç”Ÿæˆå®ä¾‹å˜é‡ã€‚åªèƒ½æ‰‹åŠ¨å®ç° <code>getter</code> å’Œ <code>setter</code> æ¥æ“ä½œå·²å­˜åœ¨çš„å®ä¾‹å˜é‡ï¼Œæˆ–è€…ä½¿ç”¨å…³è”å¯¹è±¡ï¼ˆ<code>Associated Object</code>ï¼‰æ¥æ¨¡æ‹Ÿå®ä¾‹å˜é‡ã€‚</p></details><h3 id="â“åˆ†ç±»ä¸­å¦‚ä½•æ·»åŠ å±æ€§" tabindex="-1"><a class="header-anchor" href="#â“åˆ†ç±»ä¸­å¦‚ä½•æ·»åŠ å±æ€§" aria-hidden="true">#</a> â“åˆ†ç±»ä¸­å¦‚ä½•æ·»åŠ å±æ€§</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>åˆ†ç±»ï¼ˆ<code>Category</code>ï¼‰çš„å®šä¹‰ä¸­å¹¶ä¸æ”¯æŒç›´æ¥æ·»åŠ å±æ€§ï¼ˆ<code>instance variable</code>ï¼‰ã€‚ä½†å¯ä»¥é€šè¿‡å…³è”å¯¹è±¡ï¼ˆ<code>Associative References</code>ï¼‰æœºåˆ¶å®ç°ç»™åˆ†ç±»æ·»åŠ å±æ€§ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">&quot;NSObject+Property.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>objc<span class="token operator">/</span>runtime<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>

<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>MyKey <span class="token operator">=</span> <span class="token operator">&amp;</span>MyKey<span class="token punctuation">;</span>

<span class="token keyword">@implementation</span> <span class="token function">NSObject</span> <span class="token punctuation">(</span>Property<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>myProperty <span class="token punctuation">{</span>
    <span class="token comment">// \`objc_getAssociatedObject\` ç”¨äºå–å…³è”å¯¹è±¡ã€‚</span>
    <span class="token comment">//  - é¦–ä¸ªå‚æ•°æ˜¯è¦å­˜å–çš„å¯¹è±¡</span>
    <span class="token comment">//  - ç¬¬äºŒä¸ªå‚æ•°æ˜¯é”®ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªé™æ€å¸¸é‡ \`MyKey\` ä½œä¸ºé”®ï¼ˆæ¯ä¸ªå…³è”åˆ°å¯¹è±¡çš„é”®å¿…é¡»å…¨å±€å”¯ä¸€ï¼‰</span>
    <span class="token keyword">return</span> <span class="token function">objc_getAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> MyKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setMyProperty<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>myProperty <span class="token punctuation">{</span>
    <span class="token comment">// \`objc_setAssociatedObject\` ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­˜å‚¨çš„å€¼ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯å…³è”ç­–ç•¥</span>
    <span class="token comment">// \`OBJC_ASSOCIATION_COPY_NONATOMIC\`ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª copy ï¼ŒéåŸå­æ“ä½œçš„ç‰¹æ€§</span>
    <span class="token function">objc_setAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> MyKey<span class="token punctuation">,</span> myProperty<span class="token punctuation">,</span> OBJC_ASSOCIATION_COPY_NONATOMIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">@end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><hr><h2 id="å…³è”å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#å…³è”å¯¹è±¡" aria-hidden="true">#</a> å…³è”å¯¹è±¡</h2><h3 id="â“å…³è”å¯¹è±¡çš„åº•å±‚å®ç°" tabindex="-1"><a class="header-anchor" href="#â“å…³è”å¯¹è±¡çš„åº•å±‚å®ç°" aria-hidden="true">#</a> â“å…³è”å¯¹è±¡çš„åº•å±‚å®ç°</h3><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p>å…³è”å¯¹è±¡ï¼ˆ<code>Associated Objects</code>ï¼‰çš„åº•å±‚å®ç°ä¸»è¦ä¾èµ–äº <code>objc_setAssociatedObject</code> å’Œ <code>objc_getAssociatedObject</code> è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬çš„å®ç°æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„ã€‚</p></blockquote><ul><li><p>ä¸¤ä¸ªå“ˆå¸Œè¡¨</p><ul><li>å…¨å±€çš„å“ˆå¸Œè¡¨ï¼šè¿è¡Œæ—¶åº“ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ï¼Œé”®ä¸ºå¯¹è±¡çš„æŒ‡é’ˆï¼Œå€¼ä¸ºå¦ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚</li><li>å€¼å“ˆå¸Œè¡¨ï¼šé”®ä¸ºå…³è”å¯¹è±¡çš„ keyï¼Œå€¼ä¸ºå…³è”å¯¹è±¡æœ¬èº«åŠå…¶ç­–ç•¥ä¿¡æ¯ã€‚</li></ul></li><li><p>å®ç°é€»è¾‘</p><ul><li>è°ƒç”¨ <code>objc_setAssociatedObject(self, key, value, policy)</code> æ—¶ï¼Œä¼šåœ¨å…¨å±€å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°ä»¥ <code>self</code> ä¸ºé”®çš„é‚£ä¸ªå“ˆå¸Œè¡¨ï¼Œç„¶ååœ¨è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ä»¥ <code>key</code> ä¸ºé”®ï¼Œå°† <code>value</code> åŠå…¶ <code>policy</code> å­˜å‚¨è¿›å»ã€‚</li><li>è°ƒç”¨ <code>objc_getAssociatedObject(self, key)</code> æ—¶ï¼Œä¹Ÿä¼šåœ¨å…¨å±€å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°ä»¥ <code>self</code> ä¸ºé”®çš„å“ˆå¸Œè¡¨ï¼Œç„¶ååœ¨è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ä»¥ <code>key</code> ä¸ºé”®ï¼Œæ‰¾åˆ°å¹¶è¿”å›å¯¹åº”çš„å€¼ã€‚</li><li>åœ¨å¯¹è±¡é”€æ¯æ—¶ï¼Œ<code>dealloc</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šè°ƒç”¨ <code>_objc_rootDealloc</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿›ä¸€æ­¥è°ƒç”¨ <code>object_dispose</code> å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šè°ƒç”¨ <code>_object_remove_assocations</code> å‡½æ•°å»æ¸…ç†å…³è”å¯¹è±¡ï¼Œæ ¹æ®å®ƒä»¬çš„ç­–ç•¥å¯¹è¿™äº›å…³è”å¯¹è±¡è¿›è¡Œç›¸åº”çš„å†…å­˜æ¸…ç†æ“ä½œã€‚</li></ul></li></ul></details><h3 id="â“å…³è”å¯¹è±¡çš„å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#â“å…³è”å¯¹è±¡çš„å®é™…åº”ç”¨" aria-hidden="true">#</a> â“å…³è”å¯¹è±¡çš„å®é™…åº”ç”¨</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>å…³è”å¯¹è±¡çš„ä¸»è¦åº”ç”¨åœ¨äºä¸ºç±»åŠ¨æ€åœ°æ·»åŠ ä¸€äº›å±æ€§æˆ–è€…ç§æœ‰å˜é‡ï¼Œè€Œæ— éœ€ä¿®æ”¹åŸæ¥çš„ç±»å®šä¹‰æˆ–è€…åˆ›å»ºå­ç±»ã€‚å³ä½¿ä¸èƒ½è®¿é—®ä¸€ä¸ªç±»çš„æºç ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å…³è”å¯¹è±¡ä¸ºå®ƒæ·»åŠ å±æ€§ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>objc<span class="token operator">/</span>runtime<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>

<span class="token keyword">static</span> <span class="token keyword">char</span> kAssociatedObjectKey<span class="token punctuation">;</span>

<span class="token keyword">@interface</span> <span class="token function">UIView</span> <span class="token punctuation">(</span>AssociatedObject<span class="token punctuation">)</span>
<span class="token comment">// ä¸º UIView æ·»åŠ äº†ä¸€ä¸ª associatedObject å±æ€§</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id associatedObject<span class="token punctuation">;</span>
<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> <span class="token function">UIView</span> <span class="token punctuation">(</span>AssociatedObject<span class="token punctuation">)</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setAssociatedObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>associatedObject <span class="token punctuation">{</span>
    <span class="token function">objc_setAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>kAssociatedObjectKey<span class="token punctuation">,</span> associatedObject<span class="token punctuation">,</span> OBJC_ASSOCIATION_RETAIN_NONATOMIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>associatedObject <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">objc_getAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>kAssociatedObjectKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="å†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ç®¡ç†" aria-hidden="true">#</a> å†…å­˜ç®¡ç†</h3><h4 id="â“å…³è”å¯¹è±¡å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#â“å…³è”å¯¹è±¡å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†" aria-hidden="true">#</a> â“å…³è”å¯¹è±¡å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†</h4><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p>å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†æ˜¯ç”±è¿è¡Œæ—¶ç³»ç»Ÿæ¥å¤„ç†çš„ï¼Œä¸»è¦é€šè¿‡æä¾›çš„ <code>API</code>ï¼ˆ <code>objc_setAssociatedObject</code> å’Œ<code>objc_getAssociatedObject</code> ï¼‰æ¥è¿›è¡Œã€‚</p></blockquote><p><code>objc_setAssociatedObject</code> è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ªå…³è”ç­–ç•¥å‚æ•°ï¼Œå®ƒå†³å®šäº†åœ¨è¿è¡Œæ—¶å¦‚ä½•ç®¡ç†å’Œå¤„ç†è¿™ä¸ªå…³è”å¯¹è±¡ã€‚</p><p>å†…å­˜ç®¡ç†ç­–ç•¥ï¼š</p><ul><li><p><code>OBJC_ASSOCIATION_ASSIGN</code>ï¼šç±»ä¼¼äº <code>assign</code> çš„å±æ€§ã€‚</p><blockquote><p>å…³è”å¯¹è±¡åœ¨è¢«é‡Šæ”¾æ—¶ä¸ä¼šè¢«ä¿ç•™ã€‚å¦‚æœå…³è”å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œ<code>getter</code> æ–¹æ³•å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªæ— æ•ˆçš„å€¼ã€‚</p></blockquote></li><li><p><code>OBJC_ASSOCIATION_RETAIN_NONATOMIC</code>ï¼šç±»ä¼¼äº <code>nonatomic</code>, <code>strong</code> çš„å±æ€§ã€‚</p><blockquote><p>è¿è¡Œæ—¶ç³»ç»Ÿåœ¨è®¾ç½®å…³è”å¯¹è±¡æ—¶ä¼šä¿ç•™å®ƒå¹¶ä¸”åœ¨é‡Šæ”¾åŸå§‹å¯¹è±¡æ—¶é‡Šæ”¾å®ƒã€‚</p></blockquote></li><li><p><code>OBJC_ASSOCIATION_RETAIN</code>ï¼šç±»ä¼¼äº <code>atomic</code>, <code>strong</code> çš„å±æ€§ã€‚</p><blockquote><p>å®ƒä¸ <code>OBJC_ASSOCIATION_RETAIN_NONATOMIC</code> çš„åŒºåˆ«æ˜¯å®ƒåœ¨è®¾ç½®å’Œè·å–å…³è”å¯¹è±¡æ—¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote></li><li><p><code>OBJC_ASSOCIATION_COPY_NONATOMIC</code>ï¼šç±»ä¼¼äº <code>nonatomic</code>, <code>copy</code> çš„å±æ€§ã€‚</p><blockquote><p>è¿è¡Œæ—¶ç³»ç»Ÿåœ¨è®¾ç½®å…³è”å¯¹è±¡æ—¶ä¼šå¤åˆ¶å®ƒå¹¶ä¸”åœ¨é‡Šæ”¾åŸå§‹å¯¹è±¡æ—¶é‡Šæ”¾å®ƒã€‚</p></blockquote></li><li><p><code>OBJC_ASSOCIATION_COPY</code>ï¼šç±»ä¼¼äº <code>atomic</code>, <code>copy</code> çš„å±æ€§ã€‚</p><blockquote><p>ä¸ <code>OBJC_ASSOCIATION_COPY_NONATOMIC</code> çš„åŒºåˆ«æ˜¯å®ƒåœ¨è®¾ç½®å’Œè·å–å…³è”å¯¹è±¡æ—¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote></li></ul><p>å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†æ–¹å¼ä¸»è¦å–å†³äºé€‰æ‹©çš„å…³è”ç­–ç•¥ã€‚å½“åŸå¯¹è±¡è¢« <code>dealloc</code> æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæŒ‰ç…§è®¾å®šçš„ç­–ç•¥ä»¥é€‚å½“çš„æ–¹å¼æ¥å¤„ç†å…³è”å¯¹è±¡ã€‚</p><p>ğŸŒ° å¦‚æœé‡‡ç”¨ <code>OBJC_ASSOCIATION_COPY</code> ç­–ç•¥ï¼Œé‚£ä¹ˆåœ¨åŸå¯¹è±¡è¢« <code>dealloc</code> æ—¶ï¼Œç³»ç»Ÿä¼šé‡Šæ”¾æ‰å…³è”çš„å¯¹è±¡çš„å‰¯æœ¬ï¼›å¦‚æœé‡‡ç”¨ <code>OBJC_ASSOCIATION_ASSIGN</code> ç­–ç•¥ï¼Œé‚£ä¹ˆç³»ç»Ÿåˆ™ä¸ä¼šé‡Šæ”¾å…³è”å¯¹è±¡ã€‚</p></details><h4 id="â“å…³è”å¯¹è±¡å¦‚ä½•å®ç°-weak-ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#â“å…³è”å¯¹è±¡å¦‚ä½•å®ç°-weak-ç­–ç•¥" aria-hidden="true">#</a> â“å…³è”å¯¹è±¡å¦‚ä½•å®ç° <code>weak</code> ç­–ç•¥</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>objc_setAssociatedObject()</code> å‡½æ•°æ˜¯ä¸èƒ½ç›´æ¥æ”¯æŒ <code>weak</code> ç­–ç•¥çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›å˜é€šçš„æ–¹å¼æ¥å®ç°ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ª \`setter\` \`block\` æ¥æŒæœ‰æ–°çš„å¼±å¼•ç”¨</span>
__weak id weakObject<span class="token punctuation">;</span>
<span class="token function">id</span> <span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> weakObject<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">objc_setAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> block<span class="token punctuation">,</span> OBJC_ASSOCIATION_COPY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// å½“æ–°çš„å¯¹è±¡è®¾ç½®æ—¶ï¼Œé€šè¿‡è¿™ä¸ª block æ¥è‡ªåŠ¨å°† weak å˜é‡æŒ‡å‘æ–°çš„å¯¹è±¡ï¼ŒåŒæ—¶å°†æ—§çš„å¯¹è±¡ç§»é™¤è§‚å¯Ÿã€‚</span>
weakObject <span class="token operator">=</span> <span class="token operator">&lt;</span>#æ–°çš„Object#<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// å¾—åˆ°å…³è”å¯¹è±¡çš„å¼±å¼•ç”¨æ—¶ï¼Œéœ€è¦é€šè¿‡ block æ¥è·å–</span>
<span class="token function">id</span> <span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">objc_getAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
id object <span class="token operator">=</span> <span class="token punctuation">(</span>block <span class="token operator">?</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> nil<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>block</code> çš„æ•è·ç‰¹æ€§ï¼Œè¿™å¯¹å†…å­˜ç®¡ç†æ¥è¯´å¯èƒ½é€ æˆä¸€å®šçš„æ··ä¹±ã€‚æ‰€ä»¥è™½ç„¶å¯ä»¥è¿™æ ·åšï¼Œä½†æ˜¯å¹¶ä¸æ¨èåœ¨ä½ çš„ä»£ç ä¸­å¤§é‡ä½¿ç”¨ã€‚åœ¨éœ€è¦å¼±å¼•ç”¨å…³è”å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½æ˜¯é‡æ–°è®¾è®¡ä»£ç ï¼Œé¿å…è¿™ç§éœ€æ±‚ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹å¼æ»¡è¶³éœ€æ±‚ï¼Œæ¯”å¦‚ä½¿ç”¨ä»£ç†æˆ–è€…é€šçŸ¥ç­‰æ–¹å¼ã€‚</p></details><h4 id="â“å…³è”å¯¹è±¡éœ€è¦åœ¨ä¸»å¯¹è±¡-dealloc-çš„æ—¶å€™æ‰‹åŠ¨é‡Šæ”¾å—" tabindex="-1"><a class="header-anchor" href="#â“å…³è”å¯¹è±¡éœ€è¦åœ¨ä¸»å¯¹è±¡-dealloc-çš„æ—¶å€™æ‰‹åŠ¨é‡Šæ”¾å—" aria-hidden="true">#</a> â“å…³è”å¯¹è±¡éœ€è¦åœ¨ä¸»å¯¹è±¡ <code>dealloc</code> çš„æ—¶å€™æ‰‹åŠ¨é‡Šæ”¾å—</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p>ä¸éœ€è¦ã€‚åœ¨ <code>Objective-C</code> å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå³è°ƒç”¨ <code>dealloc</code> æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡Šæ”¾è¯¥å¯¹è±¡çš„æ‰€æœ‰å…³è”å¯¹è±¡ã€‚æ— è®ºå…³è”ç­–ç•¥æ˜¯ <code>retain</code> è¿˜æ˜¯ <code>copy</code>ï¼Œå…³è”å¯¹è±¡éƒ½ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œè¿è¡Œæ—¶ä¼šæŸ¥æ‰¾æ‰€æœ‰èµ‹äºˆè¯¥å¯¹è±¡çš„å…³è”å¯¹è±¡ï¼Œå¹¶æ ¹æ®èµ‹äºˆå®ƒä»¬çš„å…³è”ç­–ç•¥æ¥é‡Šæ”¾è¿™äº›å¯¹è±¡ã€‚</p><p>æ€»ç»“ï¼šæ— éœ€æ‹…å¿ƒå…³è”å¯¹è±¡åœ¨ä¸»å¯¹è±¡ <code>dealloc</code> çš„æ—¶å€™éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚ä½†å¿…é¡»è¦ç¡®ä¿å…³è”å¯¹è±¡ä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p></details><hr><h2 id="æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•" aria-hidden="true">#</a> æ–¹æ³•</h2><h3 id="â“å¯¹è±¡æ–¹æ³•-ä¸-ç±»æ–¹æ³•å­˜æ”¾åœ¨å“ª" tabindex="-1"><a class="header-anchor" href="#â“å¯¹è±¡æ–¹æ³•-ä¸-ç±»æ–¹æ³•å­˜æ”¾åœ¨å“ª" aria-hidden="true">#</a> â“å¯¹è±¡æ–¹æ³• ä¸ ç±»æ–¹æ³•å­˜æ”¾åœ¨å“ª</h3><details class="hint-container details"><summary>ğŸ’¡</summary><ul><li><p>ç»™ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨å¯¹è±¡çš„<strong>ç±»å¯¹è±¡</strong>çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•ã€‚ç±»å¯¹è±¡åŒ…å«äº†ä¸€ä¸ªæŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆå’Œä¸€ä¸ªå®ä¾‹æ–¹æ³•åˆ—è¡¨ã€‚</p></li><li><p>ç»™ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨ç±»çš„<strong>å…ƒç±»å¯¹è±¡</strong>çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•ã€‚å…ƒç±»å¯¹è±¡åŒ…å«äº†ç±»æ–¹æ³•åˆ—è¡¨ï¼Œç±»æ–¹æ³•åˆ—è¡¨å­˜æ”¾çš„æ˜¯æ‰€æœ‰çš„ç±»æ–¹æ³•ã€‚</p></li></ul><p>æ€»ç»“ï¼šå¯¹è±¡æ–¹æ³•å­˜æ”¾åœ¨ç±»å¯¹è±¡ä¸­ï¼Œç±»æ–¹æ³•å­˜æ”¾åœ¨å…ƒç±»å¯¹è±¡ä¸­ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ç”¨ç±»åæ¥è°ƒç”¨ç±»æ–¹æ³•ï¼Œä½†ä¸èƒ½ç”¨å®ä¾‹å¯¹è±¡æ¥è°ƒç”¨ç±»æ–¹æ³•çš„åŸå› ã€‚å› ä¸ºåœ¨æŸ¥æ‰¾æ–¹æ³•æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šå»ä¸åŒçš„åœ°æ–¹æŸ¥æ‰¾ã€‚</p></details><h3 id="â“oc-åº•å±‚æ–¹æ³•åˆ—è¡¨çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“oc-åº•å±‚æ–¹æ³•åˆ—è¡¨çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> â“<code>OC</code> åº•å±‚æ–¹æ³•åˆ—è¡¨çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>åº•å±‚æ˜¯é€šè¿‡ç»“æ„ä½“æ¥å®ç°äº†ï¼Œç»“æ„é‡Œé¢çš„é€šè¿‡æ•°ç»„æ¥å­˜å‚¨æ–¹æ³•åˆ—è¡¨ï¼Œæ–¹æ³•åˆ—è¡¨çš„æ•°æ®ç»“æ„æ˜¯ç”± <code>method_list_t</code> ç»“æ„ä½“ç»„æˆçš„ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// æ–¹æ³•åˆ—è¡¨ç»“æ„ä½“</span>
<span class="token keyword">struct</span> method_list_t <span class="token punctuation">{</span>
  uint32_t entsize<span class="token punctuation">;</span>        <span class="token comment">// ç»“æ„ä½“çš„å¤§å°</span>
  uint32_t method_count<span class="token punctuation">;</span>   <span class="token comment">// æ–¹æ³•çš„æ•°é‡</span>
  method_t method_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ–¹æ³•åˆ—è¡¨</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// æ–¹æ³•ç»“æ„ä½“</span>
<span class="token keyword">struct</span> method_t <span class="token punctuation">{</span>
  SEL sel<span class="token punctuation">;</span>                <span class="token comment">// æ–¹æ³•çš„åç§°</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>types<span class="token punctuation">;</span>      <span class="token comment">// æ–¹æ³•çš„ç±»å‹</span>
  IMP imp<span class="token punctuation">;</span>                <span class="token comment">// å¯¹åº”çš„å®ç°ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸€ä¸ª <code>method_list_t</code> åŒ…å«äº†æ–¹æ³•çš„æ•°é‡å’Œä¸€ä¸ª <code>method_t</code> ç±»å‹çš„æ•°ç»„ã€‚ <code>method_t</code> ç±»å‹çš„æ•°ç»„åŒ…å«äº†æ¯ä¸ªæ–¹æ³•çš„ <code>SEL</code>ï¼ˆæ–¹æ³•é€‰æ‹©å™¨ï¼‰ã€ç±»å‹ç¼–ç å’Œå¯¹åº”çš„ <code>IMP</code>ï¼ˆæ–¹æ³•å®ç°ï¼‰ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token keyword">unsigned</span> <span class="token keyword">int</span> outCount<span class="token punctuation">;</span>
<span class="token comment">// class_copyMethodListï¼šè·å–ä¸€ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•</span>
Method <span class="token operator">*</span>methods <span class="token operator">=</span> <span class="token function">class_copyMethodList</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">self</span> class<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>outCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Method method <span class="token operator">=</span> methods<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// method_getNameï¼šè·å–æ–¹æ³•å</span>
    SEL selector <span class="token operator">=</span> <span class="token function">method_getName</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;Method name: %@&quot;</span><span class="token punctuation">,</span> <span class="token function">NSStringFromSelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">free</span><span class="token punctuation">(</span>methods<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="â“method-t-é‡ŒåŒ…å«ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“method-t-é‡ŒåŒ…å«ä»€ä¹ˆ" aria-hidden="true">#</a> â“<code>method_t</code> é‡ŒåŒ…å«ä»€ä¹ˆ</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>method_t</code> ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨æ¥è¡¨ç¤ºç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><ul><li><p><code>SEL sel</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•åçš„æŒ‡é’ˆï¼Œä¹Ÿå«åšæ–¹æ³•é€‰æ‹©å™¨ï¼ˆ<code>selector</code>ï¼‰ã€‚æ–¹æ³•é€‰æ‹©å™¨æ˜¯ä¸€ä¸ª <code>C</code> å­—ç¬¦ä¸²ï¼Œä»£è¡¨äº†æ–¹æ³•çš„åå­—ã€‚</p></li><li><p><code>const char *types</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•ç±»å‹çš„æŒ‡é’ˆã€‚æ–¹æ³•ç±»å‹æ˜¯ä¸€ä¸ª <code>C</code> å­—ç¬¦ä¸²ï¼Œç”¨ç‰¹å®šçš„ç¼–ç ä»£è¡¨äº†æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å’Œå‚æ•°ç±»å‹ã€‚</p></li><li><p><code>IMP imp</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•å®ç°çš„æŒ‡é’ˆã€‚æ–¹æ³•å®ç°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘äº†å…·ä½“å®ç°è¿™ä¸ªæ–¹æ³•çš„å‡½æ•°ã€‚å¯ä»¥é€šè¿‡æ”¹å˜è¿™ä¸ªæŒ‡é’ˆæ¥åŠ¨æ€åœ°æ”¹å˜æ–¹æ³•çš„å®ç°ã€‚</p></li></ul><p>è¿ç”¨ï¼šå¯ä»¥é€šè¿‡è¿è¡Œæ—¶å‡½æ•°ï¼Œå¦‚ <code>method_getName</code>ï¼ˆè·å–æ–¹æ³•åï¼‰ã€ <code>method_getTypeEncoding</code>ï¼ˆè·å–æ–¹æ³•ç±»å‹ï¼‰ã€ <code>method_getImplementation</code>ï¼ˆè·å–æ–¹æ³•å®ç°ï¼‰ç­‰æ¥æ“ä½œ <code>method_t</code>ã€‚</p></details><hr><h2 id="method-swizzling" tabindex="-1"><a class="header-anchor" href="#method-swizzling" aria-hidden="true">#</a> Method Swizzling</h2><h3 id="â“method-swizzling-vs-isa-swizzling" tabindex="-1"><a class="header-anchor" href="#â“method-swizzling-vs-isa-swizzling" aria-hidden="true">#</a> â“<code>Method Swizzling</code> vs <code>isa-swizzling</code></h3><details class="hint-container details"><summary>ğŸ’¡</summary><ul><li><p><strong>Method Swizzling</strong>: ä¸€ç§åœ¨è¿è¡Œæ—¶é€šè¿‡æ”¹å˜ç±»çš„ <code>method list</code> æ¥æ”¹å˜æ–¹æ³•çš„å®ç°æœºåˆ¶ã€‚è¿™ç§æŠ€æœ¯å¸¸ç”¨äºå¯¹ç³»ç»Ÿæ–¹æ³•è¿›è¡ŒåŠŸèƒ½æ·»åŠ å’Œæ›¿æ¢ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ <code>Method Swizzling</code> å¯¹ <code>UIViewController</code> çš„ <code>viewWillAppear:</code> æ–¹æ³•è¿›è¡Œæ›¿æ¢ï¼Œç”¨è‡ªå·±çš„å®ç°æ¥æ›¿æ¢æ‰ç³»ç»Ÿçš„å®ç°ï¼ŒåŸæ¥ç³»ç»Ÿçš„å®ç°å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œè¢«è°ƒç”¨ï¼Œä»è€Œå®ç°åœ¨ç•Œé¢å‡ºç°æ—¶è®¡ç®—å¹¶è®°å½•é¡µé¢çš„åœç•™æ—¶é—´ç­‰åŠŸèƒ½ã€‚</p></blockquote></li><li><p><strong>isa-swizzling</strong>: å¦ä¸€ç§ä¸åŒçš„æŠ€æœ¯ï¼Œè¿™æ˜¯ <code>Objective-C</code> çš„è¿è¡Œæ—¶ç³»ç»Ÿä½¿ç”¨çš„ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ã€‚åœ¨ <code>Objective-C</code> å­˜åœ¨ä¸€ä¸ªå«åš <code>isa</code> çš„æŒ‡é’ˆï¼Œç”¨æ¥è¡¨ç¤ºå¯¹è±¡çš„ç±»å‹ã€‚ç³»ç»Ÿé€šå¸¸ä¼šå¯¹<code>isa</code>è¿›è¡Œä¼˜åŒ–ï¼Œæ”¹å˜å®ƒçš„å€¼æ¥äº§ç”Ÿä¸åŒçš„æ•ˆæœã€‚</p><blockquote><p>æ¯”å¦‚åœ¨ <code>KVO</code>(Key Value Observing) ä¸­ï¼Œç³»ç»Ÿä¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ªä¸­é—´ç±»ï¼Œå¹¶è®©è¢«è§‚å¯Ÿå¯¹è±¡çš„ <code>isa</code> æŒ‡å‘è¿™ä¸ªæ–°ç”Ÿæˆçš„ä¸­é—´ç±»ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå°±å¯ä»¥åœ¨ä¸­é—´ç±»ä¸­é‡å†™è¢«è§‚å¯Ÿå±æ€§çš„ <code>setter</code> æ–¹æ³•ï¼Œå½“å±æ€§å€¼å˜åŒ–æ—¶ï¼Œå°±å¯ä»¥é€šçŸ¥è§‚å¯Ÿè€…åšå‡ºç›¸åº”çš„å“åº”ï¼Œè¿™å°±æ˜¯ <code>isa-swizzling</code>ã€‚</p></blockquote></li></ul></details><h3 id="â“method-swizzling-çš„åº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#â“method-swizzling-çš„åº•å±‚åŸç†" aria-hidden="true">#</a> â“<code>Method Swizzling</code> çš„åº•å±‚åŸç†</h3><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p><code>Method Swizzling</code> å…è®¸åœ¨è¿è¡Œæ—¶æ›´æ”¹ç±»çš„ä¸€ä¸ªæ–¹æ³•çš„å®ç°ã€‚å¸¸å¸¸ç”¨åœ¨ <code>Objective-C</code> çš„åˆ†ç±»ï¼ˆ<code>Category</code>ï¼‰å’Œæ‰©å±•ï¼ˆ<code>Extension</code>ï¼‰ä¸­ï¼Œé€šè¿‡ <code>Method Swizzling</code> å¯ä»¥è¦†ç›–å’Œæ‰©å±•åŸæœ‰ç±»çš„æ–¹æ³•ã€‚</p></blockquote><p>åŸç†ï¼šä¿®æ”¹ç±»çš„æ–¹æ³•åˆ—è¡¨ï¼Œå°†æŒ‡å‘æŸä¸ªæ–¹æ³•åç§°ï¼ˆ<code>SEL</code>ï¼‰çš„å‡½æ•°æŒ‡é’ˆï¼ˆ<code>IMP</code>ï¼‰æŒ‡å‘å¦å¤–ä¸€ä¸ªå®ç°ã€‚è¿™å°±ç±»ä¼¼äºåœ¨è¿è¡Œæ—¶æ”¹å˜äº†æ–¹æ³•çš„å®ç°ã€‚</p><p>è¿ç”¨ï¼šé€šè¿‡è¿è¡Œæ—¶å‡½æ•° <code>method_exchangeImplementations</code> æˆ–è€… <code>class_replaceMethod</code> å®ç°ï¼Œå‰è€…äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼Œåè€…æ›¿æ¢ä¸€ä¸ªæ–¹æ³•çš„å®ç°ã€‚</p><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// äº¤æ¢ NSString çš„ lowercaseString æ–¹æ³•å’Œ uppercaseString æ–¹æ³•</span>
Method lowercaseMethod <span class="token operator">=</span> <span class="token function">class_getInstanceMethod</span><span class="token punctuation">(</span><span class="token punctuation">[</span>NSString class<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>lowercaseString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Method uppercaseMethod <span class="token operator">=</span> <span class="token function">class_getInstanceMethod</span><span class="token punctuation">(</span><span class="token punctuation">[</span>NSString class<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>uppercaseString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">method_exchangeImplementations</span><span class="token punctuation">(</span>lowercaseMethod<span class="token punctuation">,</span> uppercaseMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="â“method-swizzling-çš„ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#â“method-swizzling-çš„ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> â“<code>Method Swizzling</code> çš„ä¼˜ç¼ºç‚¹</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>å¼ºå¤§ä¸”çµæ´»</p><blockquote><p><code>Swizzling</code> å¯ä»¥æ”¹å˜ç°å­˜çš„æ–¹æ³•ï¼Œæ— éœ€ä¿®æ”¹æºä»£ç ã€‚è¿™ç§ç‰¹æ€§éå¸¸æœ‰ç”¨äºè°ƒè¯•ã€æ”¹è¿›ç°æœ‰çš„æ–¹æ³•ç­‰ã€‚</p></blockquote></li><li><p>é’ˆå¯¹åº“å‡½æ•°æˆ–è€…ç³»ç»Ÿå‡½æ•°</p><blockquote><p>å¯ä»¥ <code>Swizzling</code> ç³»ç»Ÿå‡½æ•°æˆ–åº“å‡½æ•°ï¼Œè¿›è€Œè§£å†³æŸäº› <code>bug</code> æˆ–æé«˜æ€§èƒ½ã€‚</p></blockquote></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><p>éš¾ä»¥è°ƒè¯•å’Œç†è§£</p><blockquote><p>ç”±äºæ–¹æ³•çš„å®ç°åœ¨è¿è¡Œæ—¶è¢«æ”¹å˜ï¼Œå¯¼è‡´è°ƒè¯•å˜å¾—å›°éš¾ã€‚æ­¤å¤–ï¼Œé˜…è¯»å¹¶ç†è§£ <code>Swizzling</code> çš„ä»£ç ä¹Ÿéœ€è¦ä¸€å®šçš„ç»éªŒå’ŒæŠ€å·§ã€‚</p></blockquote></li><li><p>ç ´åå°è£…æ€§</p><blockquote><p><code>Swizzling</code> ä¼šç ´åç±»çš„å°è£…æ€§å’Œéšè—å®ç°ç»†èŠ‚çš„åŸåˆ™ï¼Œä¸åˆ©äºä»£ç çš„ç»´æŠ¤å’Œç†è§£ã€‚</p></blockquote></li><li><p>å‘½åå†²çª</p><blockquote><p>å¦‚æœæœ‰å¤šä¸ªåˆ†ç±»ä½¿ç”¨äº† <code>swizzling</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½å‡ºç°å‘½åå†²çªï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œå‡ºé”™ã€‚</p></blockquote></li><li><p>ä¸å…¼å®¹æ€§é—®é¢˜</p><blockquote><p>ç”±äº <code>Swizzling</code> å¯¹è±¡å˜æ›´åº•å±‚çš„è¿è¡Œæœºåˆ¶ï¼Œå¦‚æœè¢« <code>Swizzling</code> çš„å¯¹è±¡å‡çº§æˆ–è€…è¢«å…¶ä»–å¯¹è±¡æ›¿æ¢ï¼Œå¯èƒ½ä¼šå¼•å‘éš¾ä»¥é¢„æ–™çš„é—®é¢˜ã€‚</p></blockquote></li></ul></details><h3 id="â“å¦‚ä½•å®‰å…¨çš„è¿›è¡Œæ–¹æ³•æ›¿æ¢" tabindex="-1"><a class="header-anchor" href="#â“å¦‚ä½•å®‰å…¨çš„è¿›è¡Œæ–¹æ³•æ›¿æ¢" aria-hidden="true">#</a> â“å¦‚ä½•å®‰å…¨çš„è¿›è¡Œæ–¹æ³•æ›¿æ¢</h3><details class="hint-container details"><summary>ğŸ’¡</summary><ul><li><p>åœ¨ç»Ÿä¸€çš„åœ°æ–¹æ‰§è¡Œ <code>Method Swizzling</code></p><blockquote><p>é€šå¸¸é€‰æ‹©åœ¨ <code>+load</code> æ–¹æ³•ä¸­æ‰§è¡Œ <code>Method Swizzling</code>ï¼Œå› ä¸º <code>+load</code> æ–¹æ³•æ˜¯åœ¨ç±»è¢«åŠ è½½æ—¶åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä»è€Œä¿è¯äº† <code>Method Swizzling</code> ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p></blockquote></li><li><p>æ–¹æ³•çš„è°ƒç”¨æ–¹</p><blockquote><p><code>Method Swizzling</code> äº†ä¸€ä¸ªæ–¹æ³•åï¼ŒåŸæ¥çš„æ–¹æ³•è°ƒç”¨æ–¹å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸ä¼šåœ¨æ–°çš„æ–¹æ³•ä¸­è°ƒç”¨ä¸€æ¬¡åŸæ¥çš„æ–¹æ³•ã€‚å› æ­¤åœ¨ <code>Swizzling</code> æ–¹æ³•æ—¶ï¼Œè¦å°å¿ƒå¹¶ç¡®ä¿åŸæ¥çš„æ–¹æ³•åœ¨æ–°çš„å®ç°ä¸­è¢«æ­£ç¡®åœ°æ‰§è¡Œäº†ã€‚</p></blockquote></li><li><p>çº¿ç¨‹å®‰å…¨</p><blockquote><p>å°½ç®¡ <code>+load</code> æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¦‚æœåœ¨å…¶å®ƒåœ°æ–¹è¿›è¡Œ <code>Method Swizzling</code>ï¼ŒåŒæ—¶éœ€è¦ç¡®ä¿è¿™ä¸ªè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¯ä»¥ä½¿ç”¨ <code>dispatch_once</code> å’Œé”ç­‰æ‰‹æ®µæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p></blockquote></li><li><p>å‘½åå†²çª</p><blockquote><p>å‡å¦‚å¤šä¸ªåˆ†ç±»éƒ½å» <code>Swizzling</code> åŒä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå­˜åœ¨å‘½åå†²çªã€‚æ‰€ä»¥åœ¨ç»™æ–°çš„æ–¹æ³•å‘½åæ—¶ï¼Œåº”ä¿è¯å…¶å”¯ä¸€æ€§ï¼Œä¾‹å¦‚å¯ä»¥åŠ ä¸Šé¡¹ç›®çš„å‰ç¼€ç­‰ã€‚</p></blockquote></li><li><p>éªŒè¯æ–¹æ³•å­˜åœ¨æ€§</p><blockquote><p>æ›¿æ¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•å»æ›¿æ¢ï¼Œéƒ½ä¼šå¯¼è‡´ç¨‹åºé”™è¯¯ã€‚åœ¨è¿›è¡Œ <code>Method Swizzling</code> å‰ï¼Œåº”è¯¥å…ˆç”¨ <code>class_getInstanceMethod</code> ç¡®è®¤è¿™ä¸¤ä¸ªæ–¹æ³•ç¡®å®å­˜åœ¨ã€‚</p></blockquote></li><li><p>å°½é‡ä¸ä½¿ç”¨</p><blockquote><p>ç”±äº <code>Method Swizzling</code> ä¼šæ”¹å˜ä»£ç çš„è¡Œä¸ºï¼Œå¢åŠ äº†ä»£ç ç†è§£çš„å¤æ‚æ€§ï¼Œé™¤éå¿…é¡»ï¼Œå¦åˆ™åº”å°½é‡é¿å…ä½¿ç”¨ã€‚</p></blockquote></li></ul></details><h3 id="å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨" aria-hidden="true">#</a> å®é™…åº”ç”¨</h3><h4 id="â“ä½¿ç”¨-method-swizzling-çˆ¶-view-çš„-touchbegin-çš„æ–¹æ³•-ä¼šå¯¹å­-view-é€ æˆä»€ä¹ˆå½±å“" tabindex="-1"><a class="header-anchor" href="#â“ä½¿ç”¨-method-swizzling-çˆ¶-view-çš„-touchbegin-çš„æ–¹æ³•-ä¼šå¯¹å­-view-é€ æˆä»€ä¹ˆå½±å“" aria-hidden="true">#</a> â“ä½¿ç”¨ <code>Method Swizzling</code> çˆ¶ <code>View</code> çš„ <code>touchBegin</code> çš„æ–¹æ³•, ä¼šå¯¹å­ <code>View</code> é€ æˆä»€ä¹ˆå½±å“</h4><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p><code>Method Swizzling</code>ï¼Œåˆç§°æ–¹æ³•äº¤æ¢ï¼Œæ˜¯ <code>Objective-C</code> çš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚è¿™ç§ç‰¹æ€§å…è®¸æˆ‘ä»¬äº¤æ¢æ–¹æ³•çš„å®ç°ï¼Œè¿™æ ·åœ¨æ‰§è¡Œç‰¹å®šæ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šä¼šæ‰§è¡Œå¦ä¸€ä¸ªæ–¹æ³•ã€‚</p></blockquote><p>å¦‚æœåœ¨çˆ¶Viewä¸­ä½¿ç”¨ <code>Method Swizzling</code> æ¥äº¤æ¢ <code>touchesBegan:withEvents:</code> æ–¹æ³•çš„å®ç°ï¼Œé‚£ä¹ˆç‚¹å‡»çˆ¶ <code>View</code> æˆ–å…¶å­ <code>View</code> æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„å°†æ˜¯äº¤æ¢åçš„æ–¹æ³•ï¼Œè¿™ä¼šå½±å“åˆ°å­ <code>View</code> åŸæœ¬åº”æœ‰çš„è¡Œä¸ºã€‚</p><ul><li><p>å¦‚æœåœ¨æ–°çš„æ–¹æ³•å®ç°ä¸­æ²¡æœ‰è°ƒç”¨åŸå§‹æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨ç‚¹å‡»è§†å›¾æ—¶ï¼ŒåŸå§‹çš„ <code>touchesBegan:withEvent:</code> æ–¹æ³•ä¸­çš„è¡Œä¸ºå°±ä¸ä¼šæ‰§è¡Œï¼Œå¯èƒ½ä¼šå¤±å»ä¸€äº›åº”æœ‰çš„æ•ˆæœæˆ–è€…è§¦æ‘¸åé¦ˆã€‚</p></li><li><p>å¦‚æœåœ¨æ–°çš„æ–¹æ³•å®ç°ä¸­æ”¹å˜äº†è§¦æ‘¸äº‹ä»¶çš„å¤„ç†æ–¹å¼ï¼Œå¯èƒ½ä¼šå½±å“åˆ°å­ <code>View</code> çš„äº¤äº’å“åº”ã€‚ä¾‹å¦‚å¦‚æœåšäº†ä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œé‚£ä¹ˆå­ <code>View</code> å¯èƒ½ä¼šæ— æ³•æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚</p></li></ul></details><h4 id="â“method-swizzling-æ—¶-ä¸æ›¿æ¢çˆ¶ç±»-åªæ›¿æ¢å­ç±»-æ€ä¹ˆå¤„ç†" tabindex="-1"><a class="header-anchor" href="#â“method-swizzling-æ—¶-ä¸æ›¿æ¢çˆ¶ç±»-åªæ›¿æ¢å­ç±»-æ€ä¹ˆå¤„ç†" aria-hidden="true">#</a> â“<code>Method Swizzling</code> æ—¶ï¼Œä¸æ›¿æ¢çˆ¶ç±»ï¼Œåªæ›¿æ¢å­ç±»ï¼Œæ€ä¹ˆå¤„ç†</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p>å¯ä»¥åœ¨å­ç±»ä¸­æ›¿æ¢æ–¹æ³•çš„å®ç°è€Œä¸å½±å“çˆ¶ç±»ã€‚å…·ä½“çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>å®šä¹‰ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼ˆå¦‚<code>newMethod</code>ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•å°†ä½œä¸ºæ—§æ–¹æ³•ï¼ˆå¦‚<code>oldMethod</code>ï¼‰çš„æ›¿æ¢ã€‚</li><li>è°ƒç”¨ <code>class_getInstanceMethod</code> è·å–æ—§æ–¹æ³•å’Œæ–°æ–¹æ³•çš„ <code>Method</code> çš„æŒ‡é’ˆã€‚</li><li>ä½¿ç”¨ <code>method_exchangeImplementations</code> æ¥äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚</li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>objc<span class="token operator">/</span>runtime<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>

<span class="token keyword">@implementation</span> MySubclass

<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>load <span class="token punctuation">{</span>
    <span class="token comment">// ç¡®ä¿äº¤æ¢æ–¹æ³•çš„ä»£ç åªä¼šæ‰§è¡Œä¸€æ¬¡</span>
    <span class="token keyword">static</span> dispatch_once_t onceToken<span class="token punctuation">;</span>
    <span class="token function">dispatch_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>onceToken<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        Class class <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> class<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è·å–æ—§æ–¹æ³•å’Œæ–°æ–¹æ³•</span>
        SEL originalSelector <span class="token operator">=</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>oldMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
        SEL swizzledSelector <span class="token operator">=</span> <span class="token keyword">@selector</span><span class="token punctuation">(</span>newMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        Method originalMethod <span class="token operator">=</span> <span class="token function">class_getInstanceMethod</span><span class="token punctuation">(</span>class<span class="token punctuation">,</span> originalSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Method swizzledMethod <span class="token operator">=</span> <span class="token function">class_getInstanceMethod</span><span class="token punctuation">(</span>class<span class="token punctuation">,</span> swizzledSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
        <span class="token comment">// äº¤æ¢æ–¹æ³•å®ç°</span>
        <span class="token function">method_exchangeImplementations</span><span class="token punctuation">(</span>originalMethod<span class="token punctuation">,</span> swizzledMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿™æ˜¯å°†è¦æ›¿æ¢æ—§æ–¹æ³•çš„æ–°æ–¹æ³•</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>newMethod <span class="token punctuation">{</span>
    <span class="token comment">// Do something</span>
    
    <span class="token comment">// å¦‚æœä½ æƒ³åœ¨æ–°æ–¹æ³•ä¸­è°ƒç”¨æ—§æ–¹æ³•çš„å®ç°ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç :</span>
    <span class="token comment">// [self newMethod];</span>
    
    <span class="token comment">// æ³¨æ„æˆ‘ä»¬å·²ç»äº¤æ¢äº†æ–¹æ³•çš„å®ç°ï¼Œæ‰€ä»¥ \`newMethod\` å®é™…ä¸ŠæŒ‡çš„æ˜¯æ—§æ–¹æ³•çš„å®ç°</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h4 id="â“æ–¹æ³•äº¤æ¢å’Œåˆ†ç±»åŒæ—¶å»-hook-ä¸€ä¸ªæ–¹æ³•-ç»“æœä¼šæ€ä¹ˆæ ·-å…·ä½“äº¤æ¢çš„æ˜¯ä»€ä¹ˆ-äº¤æ¢æ—¶æ˜¯å¦‚ä½•å¤„ç†ä¼ å‚æ•°" tabindex="-1"><a class="header-anchor" href="#â“æ–¹æ³•äº¤æ¢å’Œåˆ†ç±»åŒæ—¶å»-hook-ä¸€ä¸ªæ–¹æ³•-ç»“æœä¼šæ€ä¹ˆæ ·-å…·ä½“äº¤æ¢çš„æ˜¯ä»€ä¹ˆ-äº¤æ¢æ—¶æ˜¯å¦‚ä½•å¤„ç†ä¼ å‚æ•°" aria-hidden="true">#</a> â“æ–¹æ³•äº¤æ¢å’Œåˆ†ç±»åŒæ—¶å» <code>hook</code> ä¸€ä¸ªæ–¹æ³•ï¼Œç»“æœä¼šæ€ä¹ˆæ ·ï¼Œå…·ä½“äº¤æ¢çš„æ˜¯ä»€ä¹ˆï¼Œäº¤æ¢æ—¶æ˜¯å¦‚ä½•å¤„ç†ä¼ å‚æ•°</h4><details class="hint-container details"><summary>ğŸ’¡</summary><p>æœ€ç»ˆçš„ç»“æœå–å†³äºè¿™ä¸¤è€…åŠ è½½åˆ°è¿è¡Œæ—¶çš„å…ˆåé¡ºåºã€‚</p><p>åœ¨ <code>Objective-C</code> ä¸­ï¼Œåˆ†ç±»å’Œ <code>Method Swizzling </code>åœ¨è¿è¡Œæ—¶åŠ è½½çš„é¡ºåºå¹¶éå›ºå®šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†ç±»çš„æ–¹æ³•ä¼šåœ¨ç±»çš„ <code>load</code> æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå› æ­¤ï¼Œå¦‚æœåˆ†ç±»å’Œ <code>Method Swizzling</code> éƒ½å°è¯•å» <code>hook</code> åŒä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ†ç±»ä¼šé¦–å…ˆæ›¿æ¢æ‰åŸæ–¹æ³•çš„å®ç°ï¼Œç„¶å <code>Method Swizzling</code> å†æŠŠåˆ†ç±»æ›¿æ¢åçš„å®ç°ä¸è‡ªå·±çš„å®ç°è¿›è¡Œäº¤æ¢ã€‚</p><p>ä¾‹å¦‚åŒæ—¶ <code>hook</code> æ–¹æ³• <code>doSomething</code></p><ul><li>åˆ†ç±»é¦–å…ˆä¼šæ›¿æ¢æ‰ <code>doSomething</code> çš„åŸå§‹å®ç°ï¼ŒæŠŠå®ƒæ›¿æ¢æˆåˆ†ç±»ä¸­ <code>doSomething</code> çš„å®ç°ã€‚</li><li>ç„¶åï¼Œ<code>Method Swizzling</code> ä¼šæŠŠè¿™ä¸ªè¢«åˆ†ç±»æ›¿æ¢åçš„å®ç°ï¼Œå†ä¸ <code>Swizzling</code> ä¸­çš„æ–°å®ç°è¿›è¡Œäº¤æ¢ã€‚</li></ul><p>ç”±äºåˆ†ç±»å’Œ <code>Swizzling</code> çš„åŠ è½½é¡ºåºå¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ï¼ŒåŒæ ·çš„ä»£ç åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹æˆ–è€…ä¸åŒçš„è¿è¡Œæ—¶ç‰ˆæœ¬ä¸‹å¯èƒ½ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºã€‚å› æ­¤ï¼Œè¿™ç§å°†åˆ†ç±»å’Œ <code>Swizzling</code> æ··ç”¨çš„åšæ³•æ˜¯ä¸ç¨³å®šä¸”ä¸å¯é¢„æµ‹çš„ï¼Œå»ºè®®åœ¨å¼€å‘ä¸­é¿å…ä½¿ç”¨ã€‚</p></details><hr><h2 id="å†…å­˜ç®¡ç†-1" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ç®¡ç†-1" aria-hidden="true">#</a> å†…å­˜ç®¡ç†</h2><h3 id="â“weak-çš„å®ç°åŸç†-sidetable-çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·" tabindex="-1"><a class="header-anchor" href="#â“weak-çš„å®ç°åŸç†-sidetable-çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·" aria-hidden="true">#</a> â“<code>weak</code> çš„å®ç°åŸç†ï¼Œ<code>SideTable</code> çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p><code>weak</code> æ˜¯æŒ‡å¼±å¼•ç”¨ï¼Œå®ƒå…è®¸ä¸€ä¸ªå¯¹è±¡æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æŒæœ‰è¿™ä¸ªå¯¹è±¡ã€‚å½“è¢«å¼•ç”¨çš„å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œè¿™ä¸ªå¼±å¼•ç”¨ä¼šè‡ªåŠ¨ç½®ä¸º nilã€‚</p><p><code>weak</code> çš„å®ç°ä¸»è¦æ˜¯é€šè¿‡ <code>SideTable</code> ç»“æ„æ¥å®ç°çš„ã€‚ä¸€ä¸ª <code>SideTable</code> å®é™…ä¸Šæ˜¯ç”±ä¸€ä¸ª <code>spinlock_t</code> è¡¨ç¤ºçš„è‡ªæ—‹é”å’Œä¸€ä¸ª <code>weak_table_t</code> ç»“æ„çš„ <code>weak_table</code> ç»„æˆçš„ã€‚è€Œä¸€ä¸ª <code>weak_table</code> ç»“æ„å®é™…ä¸Šå°±æ˜¯ä¸€ç»„é”®å€¼å¯¹ï¼Œé”®æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå€¼æ˜¯è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼±å¼•ç”¨åˆ—è¡¨ã€‚</p><p>å½“å£°æ˜ä¸€ä¸ª <code>__weak</code> ç±»å‹çš„å˜é‡æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨æ·»åŠ åˆ°å¯¹åº”çš„ <code>weak_table</code> ä¸­ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨ <code>weak_table</code> æ‰¾åˆ°è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼±å¼•ç”¨ï¼Œç„¶åéå†è¿™ä¸ªåˆ—è¡¨ï¼ŒæŠŠåˆ—è¡¨ä¸­æ‰€æœ‰çš„å¼±å¼•ç”¨éƒ½ç½®ä¸º nilã€‚æœ€åï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šåœ¨ <code>weak_table</code> ä¸­ç§»é™¤è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚</p></details><h3 id="â“å¦‚æœè®©ä½ å®ç°å±æ€§çš„-weak-å¦‚ä½•å®ç°" tabindex="-1"><a class="header-anchor" href="#â“å¦‚æœè®©ä½ å®ç°å±æ€§çš„-weak-å¦‚ä½•å®ç°" aria-hidden="true">#</a> â“å¦‚æœè®©ä½ å®ç°å±æ€§çš„ <code>weak</code>ï¼Œå¦‚ä½•å®ç°</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>è¦å®ç°å±æ€§çš„ <code>weak</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>objc_storeWeak</code> å’Œ <code>objc_loadWeak</code> è¿™ä¸¤ä¸ªå‡½æ•°æ¥å®ç°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å†…éƒ¨åˆ©ç”¨äº† <code>SideTable</code> ç»“æ„æ¥ç»´æŠ¤ <code>weak</code> å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚</p><ul><li><code>objc_storeWeak</code> å‡½æ•°ä¼šæŠŠè¿™ä¸ªå¯¹è±¡åŠ å…¥åˆ° <code>SideTable</code> ï¼Œå¹¶ä¸”å½“è¿™ä¸ªå¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°†æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„ <code>weak</code> å¼•ç”¨è®¾ç½®ä¸º <code>nil</code>ã€‚</li><li><code>objc_loadWeak</code> å‡½æ•°åˆ™æ˜¯ç›´æ¥ä» <code>SideTable</code> ä¸­å–å‡º <code>weak</code> å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚</li></ul><div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// è®¾ç½®ä¸€ä¸ª weak å±æ€§å€¼çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨ objc_storeWeak</span>
id tmpObj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSObject alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">objc_storeWeak</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token operator">-&gt;</span>_tmpObj<span class="token punctuation">,</span> tmpObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">// è¯»å–ä¸€ä¸ª weak å±æ€§çš„å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ objc_loadWeak</span>
id tmpObj <span class="token operator">=</span> <span class="token function">objc_loadWeak</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token operator">-&gt;</span>_tmpObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="â“runtime-ä¸­çš„-sidetables-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#â“runtime-ä¸­çš„-sidetables-äº†è§£å—" aria-hidden="true">#</a> â“<code>runtime</code> ä¸­çš„ <code>SideTables</code> äº†è§£å—</h3><details class="hint-container details"><summary>ğŸ’¡</summary><blockquote><p><code>SideTables</code> ç»“æ„æ˜¯ç”¨æ¥ä¿å­˜ä¸€äº›ä¸å¯¹è±¡æœ‰å…³ä½†æ— æ³•ç›´æ¥ä¿å­˜åœ¨å¯¹è±¡å†…å­˜å¸ƒå±€ä¸­çš„ä¿¡æ¯ã€‚</p></blockquote><ul><li><p>å…³è”å¯¹è±¡ï¼ˆ<code>Associated Object</code>ï¼‰ï¼šå…è®¸å¼€å‘è€…ä¸ºä¸€ä¸ªå¯¹è±¡å…³è”ä»»æ„çš„å…¶ä»–å¯¹è±¡æˆ–å€¼ã€‚ç”±äºè¿™ä¸ªç‰¹æ€§çš„åŠ¨æ€å¹¶ä¸”æ— æ³•é¢„æµ‹çš„æ€§è´¨ï¼Œè¿™äº›å…³è”çš„å¯¹è±¡æˆ–å€¼æ— æ³•è¢«ç›´æ¥ä¿å­˜åœ¨å¯¹è±¡å†…éƒ¨ï¼Œä½¿ç”¨ <code>SideTables</code> æ¥ä¿å­˜ã€‚</p></li><li><p>å¼±å¼•ç”¨ï¼ˆ<code>Weak Reference</code>ï¼‰ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«èµ‹å€¼ç»™ä¸€ä¸ª <code>weak</code> å˜é‡æ—¶ï¼Œè¿™ä¸ª <code>weak</code> å˜é‡çš„åœ°å€å’Œå¯¹åº”çš„å¯¹è±¡éœ€è¦è¢«è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿åœ¨è¿™ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå¯ä»¥éå†æ‰€æœ‰å¯¹å®ƒçš„å¼±å¼•ç”¨å¹¶å°†å®ƒä»¬è®¾ç½®ä¸º <code>nil</code>ã€‚åŒç†ï¼Œç”±äºå¼±å¼•ç”¨çš„åŠ¨æ€æ€§ï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿéœ€è¦ <code>SideTables</code> æ¥ä¿å­˜ã€‚</p></li></ul><blockquote><p><code>SideTables</code> æ˜¯ä¸€ç§æ•£åˆ—è¡¨ï¼ˆ<code>Hash Table</code>ï¼‰çš„ç»“æ„ï¼Œæ¯ä¸€ä¸ªè¡¨é¡¹å…¶å®æ˜¯ä¸€ä¸ª <code>SideTable</code> ç»“æ„ï¼ŒåŒ…å«äº†ä¸€ä¸ªäº’æ–¥é”ï¼ˆ<code>Mutex</code>ï¼‰å’Œå¯¹åº”çš„æ•£åˆ—è¡¨ã€‚<code>SideTables</code> ä¹‹æ‰€ä»¥è®¾è®¡æˆè¿™ä¸ªæ ·å­ï¼Œä¸»è¦åŸå› æ˜¯å‡ºäºçº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½çš„è€ƒè™‘ã€‚å®ƒå¯ä»¥å°†å…³è”å¯¹è±¡å’Œå¼±å¼•ç”¨çš„ä¿¡æ¯ä¿å­˜åœ¨ä¸åŒçš„è¡¨é¡¹é‡Œï¼Œåšåˆ°é”çš„ç²’åº¦æœ€å°åŒ–ï¼Œä»è€Œæå‡å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ€§èƒ½ã€‚</p></blockquote></details><h3 id="â“weak-åº•å±‚å®ç°æ˜¯å•¥çŸ¥é“å—-æ˜¯ä»€ä¹ˆç»“æ„çŸ¥é“å—-æ€ä¹ˆè§£å†³å¯»æ‰¾å†²çªçš„" tabindex="-1"><a class="header-anchor" href="#â“weak-åº•å±‚å®ç°æ˜¯å•¥çŸ¥é“å—-æ˜¯ä»€ä¹ˆç»“æ„çŸ¥é“å—-æ€ä¹ˆè§£å†³å¯»æ‰¾å†²çªçš„" aria-hidden="true">#</a> â“<code>weak</code> åº•å±‚å®ç°æ˜¯å•¥çŸ¥é“å—ï¼Ÿæ˜¯ä»€ä¹ˆç»“æ„çŸ¥é“å—ï¼Ÿæ€ä¹ˆè§£å†³å¯»æ‰¾å†²çªçš„</h3><hr><h2 id="å…¶å®ƒçŸ¥è¯†ç‚¹" tabindex="-1"><a class="header-anchor" href="#å…¶å®ƒçŸ¥è¯†ç‚¹" aria-hidden="true">#</a> å…¶å®ƒçŸ¥è¯†ç‚¹</h2><h3 id="â“runtime-ä¸­çš„-fastpathã€slowpath-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#â“runtime-ä¸­çš„-fastpathã€slowpath-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> â“<code>runtime</code> ä¸­çš„ <code>fastpath</code>ã€<code>slowpath</code> æ˜¯ä»€ä¹ˆ</h3><details class="hint-container details"><summary>ğŸ’¡</summary><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ <code>fastpath</code> å’Œ <code>slowpath</code> æ˜¯ç”¨æ¥æè¿°ä»£ç æ‰§è¡Œè·¯å¾„çš„æœ¯è¯­ï¼Œè¿™ä¸¤ä¸ªæœ¯è¯­ä¸»è¦ç”¨äºæ³¨é‡Šå’Œä¼˜åŒ–ä»£ç ã€‚è¿™æ ·çš„è®¾è®¡å¯ä»¥æ˜¾è‘—åœ°æé«˜å¸¸è§è·¯å¾„çš„æ€§èƒ½ï¼Œå¯¹äºæ€§èƒ½æœ‰è¦æ±‚çš„ä»£ç å¯ä»¥è¿›è¡Œå‚è€ƒã€‚</p><ul><li><p><code>fastpath</code>ï¼šè¿™ä¸ªè·¯å¾„ç”¨æ¥å¤„ç†æœ€å¸¸è§ï¼Œæœ€é¢‘ç¹çš„ï¼Œè®¡ç®—æˆæœ¬æœ€ä½çš„åœºæ™¯æˆ–ä»»åŠ¡ï¼Œä¸ºäº†åŠ é€Ÿæ•´ä½“çš„å¤„ç†æ—¶é—´ï¼Œä¼šä½¿å¾—è¿™éƒ¨åˆ†ä»£ç å°½å¯èƒ½çš„è¿›è¡Œä¼˜åŒ–ã€‚ä¸€èˆ¬ä¼šå°†è¿™éƒ¨åˆ†ä»£ç æ”¾åœ¨å‡½æ•°æˆ–è€…ä¸€æ®µä»£ç çš„å‰é¢ã€‚</p></li><li><p><code>slowpath</code>ï¼šè¿™ä¸ªè·¯å¾„ç”¨æ¥å¤„ç†é‚£äº›ä¸å¸¸è§ï¼Œå¤æ‚åº¦è¾ƒé«˜æˆ–è€…å¯èƒ½å¯¼è‡´é”™è¯¯çš„åœºæ™¯æˆ–ä»»åŠ¡ï¼Œå¤„ç†è¿™éƒ¨åˆ†åœºæ™¯çš„ä»£ç æ”¾åœ¨<code>slowpath</code>ã€‚è¿™éƒ¨åˆ†ä»£ç ä¸€èˆ¬åœ¨ <code>fastpath</code> ä»£ç ä¹‹åï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦è¿›è¡Œä¸€äº›é”™è¯¯å¤„ç†æˆ–è€…å¤æ‚è®¡ç®—ã€‚</p></li></ul><blockquote><p>åœ¨ <code>iOS</code> ç³»ç»Ÿæºç ä¸­ç»å¸¸çœ‹åˆ° <code>__builtin_expect</code> æ–¹æ³•ï¼Œå®ƒç”¨æ¥æŒ‡ç¤ºç¼–è¯‘å™¨å¯¹ä¸€ä¸ªæ¡ä»¶çš„é¢„åˆ¤ã€‚è¿™å°±æ˜¯ <code>fastpath</code> å’Œ <code>slowpath</code> çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†æ›´å¯èƒ½æ‰§è¡Œçš„ä»£ç ï¼ˆ<code>fastpath</code>ï¼‰æ”¾åˆ° <code>CPU</code> é¢„å–ç¼“å­˜ä¸­ï¼Œæé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚</p></blockquote><blockquote><p><code>__builtin_expect</code> æ˜¯ä¸€ä¸ª <code>GCC</code> å’Œ <code>Clang</code> çš„å†…å»ºå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯æä¾›ä»£ç åˆ†æ”¯é¢„æµ‹çš„å»ºè®®ç»™ç¼–è¯‘å™¨ã€‚é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†æ›´å¯èƒ½æ‰§è¡Œçš„ä»£ç æ”¾åˆ° <code>CPU</code> é¢„å–ç¼“å­˜ä¸­ï¼Œè¿›è€Œæé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚</p></blockquote><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">// runtime æºç ä¸¤ä¸ªå®ï¼š åŸºäº \`__builtin_expect\` å‡½æ•°çš„å°è£…</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">FASTPATH</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span><span class="token punctuation">(</span><span class="token function">bool</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SLOWPATH</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span><span class="token punctuation">(</span><span class="token function">bool</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>FASTPATH(x)</code> è¡¨ç¤º <code>x</code> è¿™ä¸ªæ¡ä»¶æœ€å¯èƒ½ä¸º <code>true</code></li><li><code>SLOWPATH(x)</code> è¡¨ç¤º <code>x</code> è¿™ä¸ªæ¡ä»¶æœ€å¯èƒ½ä¸º <code>false</code></li></ul><blockquote><p><code>FASTPATH</code> å’Œ <code>SLOWPATH</code> ä¸»è¦ç”¨æ¥ä¼˜åŒ–ä»£ç è·¯å¾„ã€‚æ¯”å¦‚åœ¨å¤„ç† <code>retain</code> å’Œ <code>release</code> æ—¶ï¼Œ<code>runtime</code> ä¼šä¼˜å…ˆå¤„ç†æœ€å¸¸è§ã€æœ€é¢‘ç¹çš„æƒ…å†µï¼Œå³å¯¹éç©ºå¯¹è±¡è¿›è¡Œ <code>retain</code> å’Œ <code>release</code>ï¼Œè¿™ç§æƒ…å†µå°±æ˜¾å¼åœ°æ ‡è®°ä¸º <code>FASTPATH</code>ã€‚è€Œå¯¹ç©ºå¯¹è±¡è¿›è¡Œ <code>retain</code> å’Œ <code>release</code> æˆ–è€…å¯¹è±¡é‡Šæ”¾åè°ƒç”¨ <code>dealloc</code> ç­‰æƒ…å†µåˆ™è¢«æ ‡è®°ä¸º <code>SLOWPATH</code>ã€‚</p></blockquote></details><h3 id="â“oc-è¿è¡Œæ—¶åœ¨å·¥ç¨‹ä¸­çš„æœ‰è¿‡å®è·µè¿ç”¨å—" tabindex="-1"><a class="header-anchor" href="#â“oc-è¿è¡Œæ—¶åœ¨å·¥ç¨‹ä¸­çš„æœ‰è¿‡å®è·µè¿ç”¨å—" aria-hidden="true">#</a> â“<code>OC</code> è¿è¡Œæ—¶åœ¨å·¥ç¨‹ä¸­çš„æœ‰è¿‡å®è·µè¿ç”¨å—</h3><details class="hint-container details"><summary>ğŸ’¡</summary><ul><li><p>å…³è”å¯¹è±¡ï¼ˆ<code>Associated Object</code>ï¼‰ï¼šå¯ä»¥ä½¿ç”¨å…³è”å¯¹è±¡ä¸ºç°æœ‰çš„ç±»å¢åŠ ä¸€äº›å±æ€§ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç±»çš„æºä»£ç ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œå¯ä»¥ä¸º <code>UIButton</code> æ·»åŠ ä¸€ä¸ª <code>indexPath</code> å±æ€§ï¼Œç”¨äºåœ¨ <code>TableView</code> ä¸­å®šä½è¿™ä¸ªæŒ‰é’®åœ¨å“ªä¸ªå•å…ƒè¡Œã€‚</p></blockquote></li><li><p>æ–¹æ³•äº¤æ¢ï¼ˆ<code>Method Swizzling</code>ï¼‰ï¼šé€šè¿‡è¿è¡Œæ—¶ç³»ç»Ÿï¼Œå¯ä»¥åœ¨ç±»åˆ«ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œå¹¶å°†æ–°çš„æ–¹æ³•ä¸åŸæœ‰çš„æ–¹æ³•è¿›è¡Œäº¤æ¢ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ç±»åˆ«ä¸­ä¸º <code>UIViewController</code> æ·»åŠ ä¸€ä¸ªæ–°çš„ <code>viewWillAppear:</code> æ–¹æ³•ï¼Œç„¶åå°†è¿™ä¸ªæ–°æ–¹æ³•ä¸ç³»ç»ŸåŸæœ‰çš„æ–¹æ³•è¿›è¡Œäº¤æ¢ã€‚è¿™æ ·å°±å¯ä»¥åœ¨æ–°çš„æ–¹æ³•ä¸­æ·»åŠ ä¸€äº›è·Ÿè¸ªä»£ç ï¼Œä»¥ä¾¿è¿½è¸ªåˆ°æ¯ä¸ªè§†å›¾æ§åˆ¶å™¨çš„å‡ºç°ã€‚</p></blockquote></li><li><p>æ‡’åŠ è½½ï¼šä½¿ç”¨ <code>runtime</code> å®ç°å±æ€§çš„æ‡’åŠ è½½ï¼Œ</p><blockquote><p>ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ <code>getter</code> æ–¹æ³•ä¸­æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²ç»è¢«åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå¯ä»¥åˆå§‹åŒ–è¯¥å¯¹è±¡å¹¶æŠŠå®ƒç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚</p></blockquote></li><li><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><blockquote><p>ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡éå†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œç„¶åé€šè¿‡ <code>KVC</code>ï¼ˆé”®å€¼ç¼–ç ï¼‰æ¥å¾—åˆ°æ‰€æœ‰å±æ€§çš„å€¼ï¼Œä¹‹åå°±å¯ä»¥å°†è¿™äº›å€¼åºåˆ—åŒ–ä¸º <code>JSON</code> æˆ–è€… <code>XML</code>ã€‚ååºåˆ—åŒ–ä¹ŸåŒæ ·ï¼Œå¯ä»¥å°†ä¸€ä¸ª <code>JSON</code> æˆ–è€… <code>XML</code> æ•°æ®è½¬åŒ–ä¸ºä¸€ä¸ªå­—å…¸ï¼Œç„¶åé€šè¿‡éå†å­—å…¸ï¼Œå°†å­—å…¸çš„å€¼é€šè¿‡ <code>KVC</code> è®¾ç½®åˆ°å¯¹è±¡çš„å±æ€§ä¸Šã€‚</p></blockquote></li></ul></details>`,85);function Y(F,G){const a=p("ExternalLinkIcon"),d=p("CodeTabs");return r(),k("div",null,[v,o(" more "),_,s("ul",null,[s("li",null,[s("a",g,[n("2020-01-23 Aspects æ·±åº¦è§£æ - iOS é¢å‘åˆ‡é¢ç¼–ç¨‹"),e(a)])]),s("li",null,[s("a",y,[n("2019-08-05 Runtime åŸç†æ¢ç©¶"),e(a)])]),s("li",null,[w,n(),s("a",j,[n("2019-03-07 OC å¯¹è±¡çš„æœ¬è´¨"),e(a)]),f]),s("li",null,[s("a",S,[n("2018-03-16 è¯» objc4 æºç ï¼Œæ·±å…¥ç†è§£ Objective-C Runtime"),e(a)])]),s("li",null,[s("a",O,[n("2014-11-05 Objective-C Runtime"),e(a)])])]),o(" æ¶ˆæ¯å‘é€ & æ¶ˆæ¯è½¬å‘ "),s("ul",null,[s("li",null,[s("a",C,[n("2016-06-15 Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†"),e(a)])]),s("li",null,[s("a",q,[n("2013-11-26 Objective-C ä¸­çš„æ¶ˆæ¯ä¸æ¶ˆæ¯è½¬å‘"),e(a)])])]),o(" isa "),s("ul",null,[s("li",null,[z,s("a",x,[n("2018-07-01 isa && å…ƒç±» && å‡½æ•°è°ƒç”¨"),e(a)])]),s("li",null,[M,s("a",A,[n("2016-09-10 ç¥ç»ç—…é™¢ Objective-C Runtime å…¥é™¢ç¬¬ä¸€å¤©â€”â€” isa å’Œ Class"),e(a)])])]),o(" MetaClass "),s("ul",null,[s("li",null,[N,s("a",I,[n("2020-02-28 ä¸ºä»€ä¹ˆè¦è®¾è®¡ metaclass"),e(a)]),T]),s("li",null,[P,s("a",L,[n("2018-05-02 ä¸ºä»€ä¹ˆè¦å­˜åœ¨ MetaClass"),e(a)])]),s("li",null,[E,n(),s("a",V,[n("2017-09-15 Why is MetaClass in Objective-Cï¼Ÿ"),e(a)]),n(" ğŸ’¯ "),B])]),W,s("details",J,[R,e(d,{id:"373",data:[{id:"objc"},{id:"swift"}]},{title0:c(({value:i,isActive:l})=>[n("objc")]),title1:c(({value:i,isActive:l})=>[n("swift")]),tab0:c(({value:i,isActive:l})=>[K]),tab1:c(({value:i,isActive:l})=>[H]),_:1})]),U])}const Q=u(h,[["render",Y],["__file","0x06.runtime.html.vue"]]);export{Q as default};
