import{_ as p}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as o,o as c,c as i,a as l,b as n,e as s,d as t,f as e}from"./app-j-heE4gB.js";const u={},k=n("blockquote",null,[n("p",null,[n("code",null,"Notification"),s(" 是观察者模式的一种实现，程序中一种一对多的通信方式。"),n("code",null,"androind"),s(" 类似的机制叫做 "),n("code",null,"Broadcast"),s(" 广播。")])],-1),r=e(`<h2 id="notificationcenter-通知中心" tabindex="-1"><a class="header-anchor" href="#notificationcenter-通知中心" aria-hidden="true">#</a> <code>NotificationCenter</code> - “通知中心”</h2><blockquote><p>首先思考一个问题: 如果让你来设计一个精简版通知中心你会怎么设计？</p></blockquote><ul><li><code>NotificationCenter</code> : 设计成为一个单例。</li><li><code>addObserver</code> : 注册通知，常规的参数主要有两个通知的唯一标识名和通知执行的<code>Selector</code>。那么可以很自然地想到使用哈希表来存储注册通知。由于同一个通知可以有多个观察者，就是说可以注册多次。所以哈希表的键可以使用通知名，执行回调应该放在一个数值中。</li><li><code>post</code> : 发送通知时，通过发送的通知名，可以取出回调闭包的数组，然后遍历执行每个通知的 <code>Selector</code>。</li></ul><blockquote><p>通知中心的定义</p></blockquote><div class="language-swift line-numbers-mode" data-ext="swift"><pre class="language-swift"><code><span class="token comment">// 通知中心定义</span>
<span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token class-name">NotificationCenter</span> <span class="token punctuation">:</span> <span class="token class-name">NSObject</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通知中心单例</span>
    <span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token keyword">var</span> \`<span class="token keyword">default</span>\`<span class="token punctuation">:</span> <span class="token class-name">NotificationCenter</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
    <span class="token comment">// 注册通知</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">addObserver</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> observer<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">,</span> selector aSelector<span class="token punctuation">:</span> <span class="token class-name">Selector</span><span class="token punctuation">,</span> name aName<span class="token punctuation">:</span> <span class="token class-name">NSNotification</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token operator">?</span><span class="token punctuation">,</span> object anObject<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">addObserver</span><span class="token punctuation">(</span>forName name<span class="token punctuation">:</span> <span class="token class-name">NSNotification</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token operator">?</span><span class="token punctuation">,</span> object obj<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token operator">?</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token class-name">OperationQueue</span><span class="token operator">?</span><span class="token punctuation">,</span> using block<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">NSObjectProtocol</span>
    <span class="token comment">// 发送通知</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">post</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">post</span><span class="token punctuation">(</span>name aName<span class="token punctuation">:</span> <span class="token class-name">NSNotification</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">,</span> object anObject<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">post</span><span class="token punctuation">(</span>name aName<span class="token punctuation">:</span> <span class="token class-name">NSNotification</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">,</span> object anObject<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token operator">?</span><span class="token punctuation">,</span> userInfo aUserInfo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">AnyHashable</span> <span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
    <span class="token comment">// 移除注册通知</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">removeObserver</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> observer<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">removeObserver</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> observer<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">,</span> name aName<span class="token punctuation">:</span> <span class="token class-name">NSNotification</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token operator">?</span><span class="token punctuation">,</span> object anObject<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token operator">?</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 通知体定义</span>
<span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">Notification</span> <span class="token punctuation">:</span> <span class="token class-name">ReferenceConvertible</span><span class="token punctuation">,</span> <span class="token class-name">Equatable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span> <span class="token punctuation">{</span>
    <span class="token comment">/// A tag identifying the notification.</span>
    <span class="token keyword">public</span> <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">.</span><span class="token class-name">Name</span> <span class="token comment">// 通知的唯一标识</span>
    <span class="token comment">/// An object that the poster wishes to send to observers.</span>
    <span class="token comment">///</span>
    <span class="token comment">/// Typically this is the object that posted the notification.</span>
    <span class="token keyword">public</span> <span class="token keyword">var</span> object<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token operator">?</span> <span class="token comment">// 通知携带对象，发送者希望发送给观察者，一般来说这个对象就是发送者</span>
    <span class="token comment">/// Storage for values or objects related to this notification.</span>
    <span class="token keyword">public</span> <span class="token keyword">var</span> userInfo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">AnyHashable</span> <span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token comment">// 存储与通知相关的值或者对象</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),d={href:"https://github.com/apple/swift-corelibs-foundation/blob/main/Sources/Foundation/Notification.swift",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/gnustep/libs-base/blob/master/Source/NSNotificationCenter.m",target:"_blank",rel:"noopener noreferrer"},v=e(`<div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// line:139 通知体结构</span>
<span class="token keyword">typedef</span>	 <span class="token keyword">struct</span> Obs <span class="token punctuation">{</span>
  id            observer<span class="token punctuation">;</span>   <span class="token comment">/* Object to receive message. */</span>
  SEL           selector<span class="token punctuation">;</span>   <span class="token comment">/* Method selector. */</span>
  <span class="token keyword">struct</span> Obs    <span class="token operator">*</span>next<span class="token punctuation">;</span>      <span class="token comment">/* Next item in linked list. */</span>
  <span class="token keyword">int</span>           retained<span class="token punctuation">;</span>   <span class="token comment">/* Retain count for structure. */</span>
  <span class="token keyword">struct</span> NCTbl  <span class="token operator">*</span>link<span class="token punctuation">;</span>      <span class="token comment">/* Pointer back to chunk table */</span>
<span class="token punctuation">}</span> Observation<span class="token punctuation">;</span>
<span class="token comment">// line:232 通知中心表结构</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> NCTbl <span class="token punctuation">{</span>
  Observation       <span class="token operator">*</span>wildcard<span class="token punctuation">;</span>  <span class="token comment">/* Get ALL messages. */</span>             <span class="token comment">// 所有通配符通知</span>
  GSIMapTable       nameless<span class="token punctuation">;</span>   <span class="token comment">/* Get messages for any name. */</span>    <span class="token comment">// 存放无名的通知</span>
  GSIMapTable       named<span class="token punctuation">;</span>      <span class="token comment">/* Getting named messages only. */</span>  <span class="token comment">// 存放有名的通知</span>
  <span class="token keyword">unsigned</span>          lockCount<span class="token punctuation">;</span>  <span class="token comment">/* Count recursive operations. */</span>
  NSRecursiveLock   <span class="token operator">*</span>_lock<span class="token punctuation">;</span>     <span class="token comment">/* Lock out other threads. */</span>
  Observation       <span class="token operator">*</span>freeList<span class="token punctuation">;</span>
  Observation       <span class="token operator">*</span><span class="token operator">*</span>chunks<span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span>	         numChunks<span class="token punctuation">;</span>
  GSIMapTable       cache<span class="token punctuation">[</span>CACHESIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">short</span>    chunkIndex<span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">short</span>    cacheIndex<span class="token punctuation">;</span>
<span class="token punctuation">}</span> NCTable<span class="token punctuation">;</span>

<span class="token comment">// line:750 添加通知</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> addObserver<span class="token punctuation">:</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>observer 
            selector<span class="token punctuation">:</span> <span class="token punctuation">(</span>SEL<span class="token punctuation">)</span>selector
                name<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSString<span class="token operator">*</span><span class="token punctuation">)</span>name
              object<span class="token punctuation">:</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>object
<span class="token punctuation">{</span>
    Observation     <span class="token operator">*</span>list<span class="token punctuation">;</span>
    Observation     <span class="token operator">*</span>o<span class="token punctuation">;</span> <span class="token comment">// 通知节点</span>
    GSIMapTable     m<span class="token punctuation">;</span>  <span class="token comment">// 通知所在的哈希表</span>
    GSIMapNode      n<span class="token punctuation">;</span>  <span class="token comment">// 通知所在的节点</span>
    
    <span class="token comment">// 校验数据</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>observer <span class="token operator">==</span> nil<span class="token punctuation">)</span>
        <span class="token punctuation">[</span>NSException raise<span class="token punctuation">:</span> NSInvalidArgumentException format<span class="token punctuation">:</span> <span class="token string">@&quot;Nil observer passed to addObserver ...&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selector <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">[</span>NSException raise<span class="token punctuation">:</span> NSInvalidArgumentException format<span class="token punctuation">:</span> <span class="token string">@&quot;Null selector passed to addObserver ...&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>observer respondsToSelector<span class="token punctuation">:</span> selector<span class="token punctuation">]</span> <span class="token operator">==</span> NO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>NSException raise<span class="token punctuation">:</span> NSInvalidArgumentException format<span class="token punctuation">:</span> <span class="token string">@&quot;[%@-%@] Observer &#39;%@&#39; does not respond to selector &#39;%@&#39;&quot;</span><span class="token punctuation">,</span> <span class="token function">NSStringFromClass</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">self</span> class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NSStringFromSelector</span><span class="token punctuation">(</span>_cmd<span class="token punctuation">)</span><span class="token punctuation">,</span> observer<span class="token punctuation">,</span> <span class="token function">NSStringFromSelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 加锁处理</span>
    <span class="token function">lockNCTable</span><span class="token punctuation">(</span>TABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建通知节点</span>
    o <span class="token operator">=</span> <span class="token function">obsNew</span><span class="token punctuation">(</span>TABLE<span class="token punctuation">,</span> selector<span class="token punctuation">,</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/*
     * Record the Observation in one of the linked lists.
     *
     * NB. It is possible to register an observer for a notification more than
     * once - in which case, the observer will receive multiple messages when
     * the notification is posted... odd, but the MacOS-X docs specify this.
     */</span>
     <span class="token comment">// 遍历查找应该加入的链表</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 1&gt; 名字存在，首先通过名字查询</span>
        <span class="token comment">/*
         * Locate the map table for this name - create it if not present.
         */</span>
        <span class="token comment">// 通过名字查询所在哈希表，如果不存在创建</span>
        n <span class="token operator">=</span> <span class="token function">GSIMapNodeForKey</span><span class="token punctuation">(</span>NAMED<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapKey<span class="token punctuation">)</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            m <span class="token operator">=</span> <span class="token function">mapNew</span><span class="token punctuation">(</span>TABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*
        	  * As this is the first observation for the given name, we take a
        	  * copy of the name so it cannot be mutated while in the map.
        	  */</span>
        	  name <span class="token operator">=</span> <span class="token punctuation">[</span>name copyWithZone<span class="token punctuation">:</span> <span class="token function">NSDefaultMallocZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        	  <span class="token function">GSIMapAddPair</span><span class="token punctuation">(</span>NAMED<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapKey<span class="token punctuation">)</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapVal<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	  <span class="token function">GS_CONSUMED</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            m <span class="token operator">=</span> <span class="token punctuation">(</span>GSIMapTable<span class="token punctuation">)</span>n<span class="token operator">-&gt;</span>value<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">/*
         * Add the observation to the list for the correct object.
         */</span>
         <span class="token comment">// 如果通知对象存在，查询对象所在的链表</span>
         n <span class="token operator">=</span> <span class="token function">GSIMapNodeForSimpleKey</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapKey<span class="token punctuation">)</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            o<span class="token operator">-&gt;</span>next <span class="token operator">=</span> ENDOBS<span class="token punctuation">;</span>
            <span class="token function">GSIMapAddPair</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapKey<span class="token punctuation">)</span>object<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapVal<span class="token punctuation">)</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            list <span class="token operator">=</span> <span class="token punctuation">(</span>Observation<span class="token operator">*</span><span class="token punctuation">)</span>n<span class="token operator">-&gt;</span>value<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>
            o<span class="token operator">-&gt;</span>next <span class="token operator">=</span> list<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
            list<span class="token operator">-&gt;</span>next <span class="token operator">=</span> o<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 2&gt; 通过通知对象 object 查询</span>
        n <span class="token operator">=</span> <span class="token function">GSIMapNodeForSimpleKey</span><span class="token punctuation">(</span>NAMELESS<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapKey<span class="token punctuation">)</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            o<span class="token operator">-&gt;</span>next <span class="token operator">=</span> ENDOBS<span class="token punctuation">;</span>
            <span class="token function">GSIMapAddPair</span><span class="token punctuation">(</span>NAMELESS<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapKey<span class="token punctuation">)</span>object<span class="token punctuation">,</span> <span class="token punctuation">(</span>GSIMapVal<span class="token punctuation">)</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            list <span class="token operator">=</span> <span class="token punctuation">(</span>Observation<span class="token operator">*</span><span class="token punctuation">)</span>n<span class="token operator">-&gt;</span>value<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>
            o<span class="token operator">-&gt;</span>next <span class="token operator">=</span> list<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
            list<span class="token operator">-&gt;</span>next <span class="token operator">=</span> o<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 3&gt; 均不存在，加入通配符链表</span>
        o<span class="token operator">-&gt;</span>next <span class="token operator">=</span> WILDCARD<span class="token punctuation">;</span>
        WILDCARD <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">unlockNCTable</span><span class="token punctuation">(</span>TABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>GUNStep</code> 源码实现中，通知体 <code>Obs</code> 是一个链表节点，存放通知方法 <code>Selector</code> 是通过链表来存储，不是通过数组。 通知中心表 <code>NCTbl</code> 中存放的通知主要分为三类</p><ul><li>named : 注册时有名字</li><li>nameless : 注册时无名字，有对象</li><li>wildcard : 通配符，注册时无名字，无对象</li></ul><h2 id="notificationqueue-通知队列" tabindex="-1"><a class="header-anchor" href="#notificationqueue-通知队列" aria-hidden="true">#</a> <code>NotificationQueue</code> - “通知队列”</h2><blockquote><p>通知队列定义</p></blockquote><div class="language-swift line-numbers-mode" data-ext="swift"><pre class="language-swift"><code><span class="token comment">// 通知队列</span>
<span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token class-name">NotificationQueue</span> <span class="token punctuation">:</span> <span class="token class-name">NSObject</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认队列</span>
    <span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token keyword">var</span> \`<span class="token keyword">default</span>\`<span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
    <span class="token comment">// 初始化队列时与一个通知中心关联</span>
    <span class="token keyword">public</span> <span class="token keyword">init</span><span class="token punctuation">(</span>notificationCenter<span class="token punctuation">:</span> <span class="token class-name">NotificationCenter</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 入队列</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">enqueue</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">,</span> postingStyle<span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span><span class="token punctuation">.</span><span class="token class-name">PostingStyle</span><span class="token punctuation">)</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">enqueue</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">,</span> postingStyle<span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span><span class="token punctuation">.</span><span class="token class-name">PostingStyle</span><span class="token punctuation">,</span> coalesceMask<span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span><span class="token punctuation">.</span><span class="token class-name">NotificationCoalescing</span><span class="token punctuation">,</span> forModes modes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">RunLoop</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token comment">// 出队列</span>
    <span class="token keyword">open</span> <span class="token keyword">func</span> <span class="token function-definition function">dequeueNotifications</span><span class="token punctuation">(</span>matching notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">,</span> coalesceMask<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span>

    <span class="token comment">// 通知的发送时机</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">PostingStyle</span> <span class="token punctuation">:</span> <span class="token class-name">UInt</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> whenIdle <span class="token operator">=</span> <span class="token number">1</span>   <span class="token comment">// runloop 空闲时发送</span>
        <span class="token keyword">case</span> asap <span class="token operator">=</span> <span class="token number">2</span>       <span class="token comment">// (As Soon As Possible)尽快发送，穿插在 runloop 每次事件完成期间来发送</span>
        <span class="token keyword">case</span> now <span class="token operator">=</span> <span class="token number">3</span>        <span class="token comment">// 立刻发送</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 通知合并策略</span>
    <span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">NotificationCoalescing</span> <span class="token punctuation">:</span> <span class="token class-name">OptionSet</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">var</span> <span class="token keyword">none</span><span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span><span class="token punctuation">.</span><span class="token class-name">NotificationCoalescing</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>        <span class="token comment">// 不合并</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">var</span> onName<span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span><span class="token punctuation">.</span><span class="token class-name">NotificationCoalescing</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>      <span class="token comment">// 名字相同时合并</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">var</span> onSender<span class="token punctuation">:</span> <span class="token class-name">NotificationQueue</span><span class="token punctuation">.</span><span class="token class-name">NotificationCoalescing</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>    <span class="token comment">// 发送者(object)相同时合并</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),b={href:"https://github.com/apple/swift-corelibs-foundation/blob/main/Sources/Foundation/NotificationQueue.swift",target:"_blank",rel:"noopener noreferrer"},f={href:"https://github.com/gnustep/libs-base/blob/master/Source/NSNotificationQueue.m",target:"_blank",rel:"noopener noreferrer"},y=e(`<div class="language-objc line-numbers-mode" data-ext="objc"><pre class="language-objc"><code><span class="token comment">// line:51 全局通知队列链表(单链表)</span>
<span class="token keyword">@interface</span>	NotificationQueueList <span class="token punctuation">:</span> NSObject
<span class="token punctuation">{</span>
<span class="token keyword">@public</span>
    NotificationQueueList	 <span class="token operator">*</span>next<span class="token punctuation">;</span>
    NSNotificationQueue   <span class="token operator">*</span>queue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> registerQueue<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSNotificationQueue<span class="token operator">*</span><span class="token punctuation">)</span>q<span class="token punctuation">;</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> unregisterQueue<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSNotificationQueue<span class="token operator">*</span><span class="token punctuation">)</span>q<span class="token punctuation">;</span>
<span class="token keyword">@end</span>

<span class="token comment">// line:163 通知节点</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _NSNotificationQueueRegistration
<span class="token punctuation">{</span>
    <span class="token comment">// 双向链表前后指针</span>
    <span class="token keyword">struct</span> _NSNotificationQueueRegistration     <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> _NSNotificationQueueRegistration     <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token comment">// 通知</span>
    NSNotification                              <span class="token operator">*</span>notification<span class="token punctuation">;</span>
    id                                          name<span class="token punctuation">;</span>
    id                                          object<span class="token punctuation">;</span>
    NSArray                                     <span class="token operator">*</span>modes<span class="token punctuation">;</span>
<span class="token punctuation">}</span> NSNotificationQueueRegistration<span class="token punctuation">;</span>
<span class="token comment">// line:175 通知链表(双向链表)</span>
<span class="token keyword">struct</span> _NSNotificationQueueList<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _NSNotificationQueueList
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> _NSNotificationQueueRegistration     <span class="token operator">*</span>head<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> _NSNotificationQueueRegistration     <span class="token operator">*</span>tail<span class="token punctuation">;</span>
<span class="token punctuation">}</span> NSNotificationQueueList<span class="token punctuation">;</span>
<span class="token comment">// line:226 添加到队列链表</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">add_to_queue</span><span class="token punctuation">(</span>NSNotificationQueueList <span class="token operator">*</span>queue<span class="token punctuation">,</span> NSNotification <span class="token operator">*</span>notification<span class="token punctuation">,</span> NSArray <span class="token operator">*</span>modes<span class="token punctuation">,</span> NSZone <span class="token operator">*</span>_zone<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 创建队列节点</span>
    NSNotificationQueueRegistration <span class="token operator">*</span>item<span class="token punctuation">;</span>
    item <span class="token operator">=</span> <span class="token function">NSZoneCalloc</span><span class="token punctuation">(</span>_zone<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>NSNotificationQueueRegistration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>NSException raise<span class="token punctuation">:</span> NSMallocException format<span class="token punctuation">:</span> <span class="token string">@&quot;Unable to add to notification queue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 设置节点信息</span>
    item<span class="token operator">-&gt;</span>notification <span class="token operator">=</span> <span class="token function">RETAIN</span><span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item<span class="token operator">-&gt;</span>name <span class="token operator">=</span> <span class="token punctuation">[</span>notification name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    item<span class="token operator">-&gt;</span>object <span class="token operator">=</span> <span class="token punctuation">[</span>notification object<span class="token punctuation">]</span><span class="token punctuation">;</span>
    item<span class="token operator">-&gt;</span>modes <span class="token operator">=</span> <span class="token punctuation">[</span>modes copyWithZone<span class="token punctuation">:</span> <span class="token punctuation">[</span>modes zone<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加进入链表尾部</span>
    item<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    item<span class="token operator">-&gt;</span>prev <span class="token operator">=</span> queue<span class="token operator">-&gt;</span>tail<span class="token punctuation">;</span>
    queue<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> item<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token operator">-&gt;</span>prev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        item<span class="token operator">-&gt;</span>prev<span class="token operator">-&gt;</span>next <span class="token operator">=</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 链表为空时，设置该节点为头结点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>queue<span class="token operator">-&gt;</span>head<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        queue<span class="token operator">-&gt;</span>head <span class="token operator">=</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">@implementation</span> NSNotificationQueue
<span class="token comment">// line:328 初始化队列</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> initWithNotificationCenter<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSNotificationCenter<span class="token operator">*</span><span class="token punctuation">)</span>notificationCenter
<span class="token punctuation">{</span>
    _zone <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> zone<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// init queue 初始化通知队列，持有通知中心，创建 asap、idle 两个通知链表队列</span>
    _center <span class="token operator">=</span> <span class="token function">RETAIN</span><span class="token punctuation">(</span>notificationCenter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _asapQueue <span class="token operator">=</span> <span class="token function">NSZoneCalloc</span><span class="token punctuation">(</span>_zone<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>NSNotificationQueueList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _idleQueue <span class="token operator">=</span> <span class="token function">NSZoneCalloc</span><span class="token punctuation">(</span>_zone<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>NSNotificationQueueList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_asapQueue <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> _idleQueue <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">DESTROY</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
        * insert in global queue list
        */</span>
        <span class="token comment">// 内存分配成功，加入全局的通知队列链表辽中</span>
        <span class="token punctuation">[</span>NotificationQueueList registerQueue<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// line:506 入队列</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> enqueueNotification<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSNotification<span class="token operator">*</span><span class="token punctuation">)</span>notification
                postingStyle<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSPostingStyle<span class="token punctuation">)</span>postingStyle
                coalesceMask<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSUInteger<span class="token punctuation">)</span>coalesceMask
                    forModes<span class="token punctuation">:</span> <span class="token punctuation">(</span>NSArray<span class="token operator">*</span><span class="token punctuation">)</span>modes
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>modes <span class="token operator">==</span> nil<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 没有指定 runloop 模式，以默认模式进行发送</span>
        modes <span class="token operator">=</span> defaultMode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>coalesceMask <span class="token operator">!=</span> NSNotificationNoCoalescing<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 需要合并的通知，先从队列中移除</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> dequeueNotificationsMatching<span class="token punctuation">:</span> notification coalesceMask<span class="token punctuation">:</span> coalesceMask<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>postingStyle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> NSPostNow<span class="token punctuation">:</span> <span class="token comment">// 立刻发送 </span>
        <span class="token punctuation">{</span>
            NSString <span class="token operator">*</span>mode<span class="token punctuation">;</span>
            mode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSRunLoop currentRunLoop<span class="token punctuation">]</span> currentMode<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 当前 runloop 模式，包含在通知需要发送的模式中，直接调用通知中进行发送</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> nil <span class="token operator">||</span> <span class="token punctuation">[</span>modes indexOfObject<span class="token punctuation">:</span> mode<span class="token punctuation">]</span> <span class="token operator">!=</span> NSNotFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span>_center postNotification<span class="token punctuation">:</span> notification<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> NSPostASAP<span class="token punctuation">:</span> <span class="token comment">// 尽快发送，添加进队列</span>
        <span class="token function">add_to_queue</span><span class="token punctuation">(</span>_asapQueue<span class="token punctuation">,</span> notification<span class="token punctuation">,</span> modes<span class="token punctuation">,</span> _zone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> NSPostWhenIdle<span class="token punctuation">:</span> <span class="token comment">// 闲置发送，添加进队列</span>
        <span class="token function">add_to_queue</span><span class="token punctuation">(</span>_idleQueue<span class="token punctuation">,</span> notification<span class="token punctuation">,</span> modes<span class="token punctuation">,</span> _zone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">@end</span>

<span class="token comment">// runloop 进行通知队列中的通知发送</span>
<span class="token comment">/*
 *	The following code handles sending of queued notifications by NSRunLoop.
 */</span>
<span class="token comment">// line:641 asap 队列通知发送</span>
<span class="token keyword">void</span> <span class="token function">GSPrivateNotifyASAP</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// line:660 idle 队列通知发送</span>
<span class="token keyword">void</span> <span class="token function">GSPrivateNotifyIdle</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通知队列创建时需要关联一个通知中心对象，用于进行通知发送；创建 asap、idle 两个通知队列存储加入的通知。 创建的两个通知队列使用双向链表进行通知信息的存储。 根据发送时机不同通知的发送分为三类</p><ul><li>now : 立即发送，只要 runloop 模式匹配，则直接调用通知中心进行通知发送。</li><li>asap : 尽快发送，runloop 会在时间循环间隙，调用该队列进行通知发送。</li><li>idle : 空闲时发送，runloop 闲置期间，调用该队列进行通知发送。</li></ul>`,3);function N(w,S){const a=o("ExternalLinkIcon");return c(),i("div",null,[k,l(" more "),r,n("blockquote",null,[n("p",null,[n("a",d,[s("Swift - Notification"),t(a)])])]),n("blockquote",null,[n("p",null,[n("a",m,[s("GNUstep 中的实现"),t(a)])])]),v,n("ul",null,[n("li",null,[n("p",null,[n("a",b,[s("Swift - NotifcationQueue"),t(a)])])]),n("li",null,[n("p",null,[n("a",f,[s("GUNStep 中的实现"),t(a)])])])]),y])}const _=p(u,[["render",N],["__file","notification.html.vue"]]);export{_ as default};
